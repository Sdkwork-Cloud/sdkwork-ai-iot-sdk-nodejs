import{m as e,M as a,o as t,B as l,P as i,s,d as o,_ as c}from"./index-mGUiS-yG.js";import{C as n}from"./index-BY_w3BMm.js";import{N as r}from"./index-CXL3Zo3T.js";/* empty css              *//* empty css              *//* empty css              */import{k as u,a as d,f as v,o as m,P as p,Q as f,S as h,j as y,W as g,u as w,a0 as C,a4 as k,$ as I,Z as x,R as _}from"./vue-vendor-B1RsE4Tz.js";import{F as b}from"./index-BkonbJXR.js";import{C as j}from"./index-88IoPNO4.js";class E extends e.BaseService{constructor(){super(a.create(t.IotDeviceManager))}async activateByCode(e,a){const t=await this.manager.activateByCode(e,a);return null==t||null==t.data?Promise.reject(new Error("data error!")):t.data}async activate(e,a,t){const l=await this.manager.activate(e,a,t);return null==l||null==l.data?Promise.reject(new Error("data error!")):l.data}}const N={class:"sdkwork-device-activation"},U={class:"activation-content"},A={class:"activation-icon"},F={key:0,class:"activation-subtitle"},T={key:1,class:"activation-subtitle"},S={key:2,class:"activation-status"},$={class:"help-section"},B={class:"help-popup"},L={class:"help-content"},P=c(u({__name:"sdkwork-device-activation",props:{deviceId:{default:""},client:{default:void 0},autoFillFromUrl:{type:Boolean,default:!0}},emits:["activated","failed","back","urlCodeFilled"],setup(e,{expose:a,emit:t}){const c=e,u=t,P=d(""),R=d(!1),V=d(null),O=d(!1),M=d(""),W=v(()=>{const e=P.value.trim();return e.length>=8&&e.length<=20&&/^[A-Z0-9]+$/.test(e)}),Z=e=>{const a=e.trim();return a.length>=8&&a.length<=20&&/^[A-Z0-9]+$/i.test(a)},q=()=>{if(!c.autoFillFromUrl)return;const e=(()=>{if("undefined"==typeof window)return"";const e=new URLSearchParams(window.location.search),a=e.get("code")||e.get("activationCode")||e.get("key");return a&&Z(a)?a.toUpperCase():""})();e&&(M.value=e,P.value=e,console.log("从URL参数获取激活码:",e),u("urlCodeFilled",e),s("已从链接获取激活码"))},z=()=>{u("back")},D=()=>{V.value&&(V.value=null),M.value&&P.value!==M.value&&(M.value="")},K=()=>{s("扫码功能暂未实现")},Q=async()=>{if(W.value){R.value=!0;try{const e=new E;let a;a=c.deviceId?await e.activate(c.deviceId,{code:P.value}):await e.activateByCode({code:P.value});let t="设备激活成功！";a.activateTime&&(t+=`\n激活时间: ${a.activateTime}`),a.name&&(t+=`\n设备名称: ${a.name}`),a.deviceId&&(t+=`\n设备ID: ${a.deviceId}`),a.status&&(t+=`\n设备状态: ${G(a.status)}`),V.value={type:"success",message:t,icon:"mdi:check-circle",color:"#07c160"},s("设备激活成功");const l=a.deviceId||c.deviceId||"未知设备";u("activated",l,P.value)}catch(e){const a=e instanceof Error?e.message:"激活失败，请重试";V.value={type:"error",message:a,icon:"mdi:close-circle",color:"#ee0a24"},s(a),u("failed",a)}finally{R.value=!1}}else s("请输入有效的激活码")},G=e=>({WAIT_ACTIVATION:"等待激活",INACTIVE:"未激活",ACTIVE:"已激活",ONLINE:"在线",OFFLINE:"离线",SLEEP:"休眠",ERROR:"错误",MAINTENANCE:"维护中",UNKNOWN:"未知"}[e]||e);return m(()=>{q()}),a({reset:()=>{P.value="",V.value=null,R.value=!1,M.value=""},getStatus:()=>V.value,setActivationCode:e=>{P.value=e,M.value=""},refreshFromUrl:()=>{q()},getUrlCodeStatus:()=>({hasUrlCode:!!M.value,urlCode:M.value})}),(e,a)=>{const t=b,s=l,c=j,u=r,d=n,v=i;return f(),p("div",N,[h("div",U,[h("div",A,[y(w(o),{icon:"mdi:key",width:"60",color:"#1989fa"})]),a[5]||(a[5]=h("div",{class:"activation-title"},"输入激活码",-1)),M.value?(f(),p("div",F,"已从链接获取激活码，请确认后激活")):(f(),p("div",T,"请输入您的设备激活码，激活后将可正常使用设备功能")),y(t,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),placeholder:M.value?"从链接获取的激活码":"请输入激活码",maxlength:20,clearable:"",readonly:R.value,class:"activation-input",onInput:D},{extra:C(()=>[y(w(o),{icon:"mdi:qrcode-scan",width:"20",color:"#1989fa",onClick:K})]),_:1},8,["modelValue","placeholder","readonly"]),y(s,{type:"primary",size:"large",loading:R.value,disabled:!W.value,onClick:Q,class:"activation-button"},{default:C(()=>[k(I(R.value?"激活中...":"激活设备"),1)]),_:1},8,["loading","disabled"]),V.value?(f(),p("div",S,[y(w(o),{icon:V.value.icon,color:V.value.color,width:"24"},null,8,["icon","color"]),h("span",{class:_(["status-text",V.value.type])},I(V.value.message),3),"success"===V.value.type?(f(),x(s,{key:0,type:"default",size:"small",onClick:z,class:"back-button"},{default:C(()=>[...a[4]||(a[4]=[k(" 返回 ",-1)])]),_:1})):g("",!0)])):g("",!0),h("div",$,[y(c,{title:"找不到激活码？","is-link":"",onClick:a[1]||(a[1]=e=>O.value=!0)},{icon:C(()=>[y(w(o),{icon:"mdi:help-circle-outline",width:"18",color:"#969799"})]),_:1})])]),y(v,{show:O.value,"onUpdate:show":a[3]||(a[3]=e=>O.value=e),round:"",position:"bottom",style:{height:"60%"}},{default:C(()=>[h("div",B,[y(u,{title:"激活帮助","left-text":"关闭",onClickLeft:a[2]||(a[2]=e=>O.value=!1)}),h("div",L,[y(d,{title:"激活码获取方式"},{default:C(()=>[y(c,{title:"1. 查看设备包装盒",value:"通常在设备底部或侧面"}),y(c,{title:"2. 联系客服获取",value:"提供设备序列号"}),y(c,{title:"3. 购买凭证",value:"查看购买订单详情"})]),_:1}),y(d,{title:"常见问题"},{default:C(()=>[y(c,{title:"激活码无效",value:"请检查输入是否正确"}),y(c,{title:"已激活的设备",value:"无需重复激活"}),y(c,{title:"激活失败",value:"请检查网络连接"})]),_:1})])])]),_:1},8,["show"])])}}}),[["__scopeId","data-v-3e24b2a2"]]);export{P as S};
