import{S as e}from"./sdkwork-page-container-C4RwI7mF.js";import{k as a,O as s,r as o,c as t,f as l,b as i,o as r,P as n,Q as c,S as d,F as u,Y as m,V as p,j as v,u as f,$ as g,W as h,R as b,a0 as y,a4 as w,Z as k}from"./vue-vendor-CnVaDBlt.js";import{j as _,d as P,B as x,k as C,_ as V}from"./index-CJyFKuKg.js";import{R as B,a as M}from"./index-1wJycmk8.js";import{F as j}from"./index-DQY9W-60.js";import{F as $}from"./index-Bn4nl9Oo.js";import"./utils-vendor-WEzSe-CR.js";import"./Checker-sW3PEKJk.js";import"./index-fy7UZAiX.js";import"./use-id-CkVbEcjv.js";const R={class:"tech-background"},I={class:"tech-particles-container"},S={class:"forgot-main-container"},U={class:"brand-section"},F={class:"brand-content"},q={class:"brand-logo-animated"},D={class:"logo-icon"},z={class:"tech-features"},A={class:"form-section"},L={class:"form-container"},E={class:"step-indicator"},Q={key:0,class:"step-content"},T={class:"verification-method"},W={class:"method-options"},Z={class:"input-group"},J={class:"input-icon"},K={class:"form-actions"},O={class:"button-content"},Y={key:1,class:"step-content"},G={class:"input-group"},H={class:"input-icon"},N={class:"form-actions"},X={class:"button-content"},ee={key:2,class:"step-content"},ae={class:"input-group"},se={class:"input-icon"},oe={class:"input-group"},te={class:"input-icon"},le={class:"form-actions"},ie={class:"button-content"},re={class:"back-section"},ne=V(a({__name:"sdkwork-auth-forgot",props:{redirectUrl:{default:"/auth/login"},autoRedirect:{type:Boolean,default:!0},forceDarkMode:{type:Boolean,default:!1},compactMode:{type:Boolean,default:!1}},emits:["forgot-success","forgot-failed","back-to-login","theme-change"],setup(e,{expose:a,emit:k}){const V=e,ne=k,ce=s(),de=_(),ue=o(1),me=o(!1),pe=o(!1),ve=o(!1),fe=o(!1),ge=o(!1),he=o(!1),be=o(0),ye=o(),we=o(),ke=o(),_e=t({method:"email",identifier:""}),Pe=t({verificationCode:""}),xe=t({newPassword:"",confirmPassword:""}),Ce=["智能数据分析","实时监控","AI预测","安全可靠"],Ve={email:[{required:!0,message:"请输入邮箱地址",trigger:"onBlur"},{validator:e=>/^[\w.-]+@[\w.-]+\.\w+$/.test(e),message:"请输入有效的邮箱地址",trigger:"onBlur"}],phone:[{required:!0,message:"请输入手机号",trigger:"onBlur"},{validator:e=>/^1[3-9]\d{9}$/.test(e),message:"请输入有效的手机号",trigger:"onBlur"}]},Be={verificationCode:[{required:!0,message:"请输入验证码",trigger:"onBlur"},{validator:e=>/^\d{6}$/.test(e),message:"请输入6位数字验证码",trigger:"onBlur"}]},Me={newPassword:[{required:!0,message:"请输入新密码",trigger:"onBlur"},{validator:e=>e.length>=6,message:"密码至少6个字符",trigger:"onBlur"},{validator:e=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(e),message:"密码需包含大小写字母和数字",trigger:"onBlur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"onBlur"},{validator:e=>e===xe.newPassword,message:"两次输入的密码不一致",trigger:"onBlur"}]},je=l(()=>_e.identifier.trim().length>0&&("email"===_e.method?/^[\w.-]+@[\w.-]+\.\w+$/.test(_e.identifier):/^1[3-9]\d{9}$/.test(_e.identifier))),$e=l(()=>/^\d{6}$/.test(Pe.verificationCode)),Re=l(()=>xe.newPassword.length>=6&&xe.confirmPassword===xe.newPassword),Ie=e=>{const a=4*Math.random()+1;return{width:`${a}px`,height:`${a}px`,animationDuration:`${6*Math.random()+4}s`,animationDelay:`${5*Math.random()}s`,left:100*Math.random()+"%",top:100*Math.random()+"%"}},Se=()=>{V.forceDarkMode?me.value=!0:(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?me.value=!0:me.value=!1,ne("theme-change",me.value))};let Ue=null;i(()=>{Se(),window.matchMedia&&(Ue=window.matchMedia("(prefers-color-scheme: dark)"),Ue.addEventListener("change",Se))}),r(()=>{Ue&&Ue.removeEventListener("change",Se),clearInterval(Fe)});let Fe=null;const qe=()=>{be.value=60,Fe=setInterval(()=>{be.value>0?be.value--:clearInterval(Fe)},1e3)},De=async()=>{try{pe.value=!0;const e={identifier:_e.identifier.trim(),method:_e.method};(await de.forgotPassword(e)).success&&(C({type:"success",message:"验证码已发送，请查收",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")}),qe(),ue.value=2)}catch(e){C({type:"danger",message:"发送验证码失败，请重试",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")})}finally{pe.value=!1}},ze=async()=>{try{ve.value=!0;const e={identifier:_e.identifier.trim(),verificationCode:Pe.verificationCode,type:"password_reset"};(await de.verifyCode(e)).success&&(C({type:"success",message:"验证码验证成功",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")}),ue.value=3)}catch(e){C({type:"danger",message:"验证码验证失败，请重试",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")})}finally{ve.value=!1}},Ae=async()=>{try{fe.value=!0;const e={identifier:_e.identifier.trim(),verificationCode:Pe.verificationCode,newPassword:xe.newPassword};await de.resetPassword(e)&&(C({type:"success",message:"密码重置成功",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")}),ne("forgot-success"),V.autoRedirect&&setTimeout(()=>{ce.push(V.redirectUrl)},1500))}catch(e){ne("forgot-failed",e),C({type:"danger",message:"密码重置失败，请重试",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")})}finally{fe.value=!1}},Le=async()=>{if(!(be.value>0))try{const e={identifier:_e.identifier.trim(),method:_e.method};(await de.forgotPassword(e)).success&&(C({type:"success",message:"验证码已重新发送",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")}),qe())}catch(e){C({type:"danger",message:"重新发送验证码失败，请重试",background:me.value?"var(--tech-bg-primary)":"#fff",color:(me.value,"var(--tech-text-primary)")})}},Ee=()=>{ne("back-to-login"),ce.push("/auth/login")},Qe=()=>{ue.value=1,_e.method="email",_e.identifier="",Pe.verificationCode="",xe.newPassword="",xe.confirmPassword="",ge.value=!1,he.value=!1,be.value=0,Fe&&clearInterval(Fe)};return a({clear:Qe,reset:()=>{Qe(),ue.value=1}}),(a,s)=>(c(),n("div",{class:b(["sdkwork-auth-forgot",{"dark-mode":me.value,"compact-mode":e.compactMode}])},[d("div",R,[s[7]||(s[7]=d("div",{class:"tech-grid-lines"},null,-1)),d("div",I,[(c(),n(u,null,m(20,e=>d("div",{class:"particle",key:e,style:p(Ie())},null,4)),64))]),s[8]||(s[8]=d("div",{class:"tech-glow-effect"},null,-1))]),d("div",S,[d("div",U,[d("div",F,[d("div",q,[d("div",D,[v(f(P),{icon:"ph:brain",class:"brain-icon"}),s[9]||(s[9]=d("div",{class:"logo-glow"},null,-1))]),s[10]||(s[10]=d("h1",{class:"brand-title-main"},"SDKWork AI",-1)),s[11]||(s[11]=d("p",{class:"brand-subtitle-main"},"智能物联网平台",-1))]),d("div",z,[(c(),n(u,null,m(Ce,e=>d("div",{class:"feature-item",key:e},[v(f(P),{icon:"ph:check-circle",class:"feature-icon"}),d("span",null,g(e),1)])),64))])])]),d("div",A,[d("div",L,[s[24]||(s[24]=d("div",{class:"form-header"},[d("h2",{class:"form-title"},"找回密码"),d("p",{class:"form-subtitle"},"通过邮箱或手机号重置密码")],-1)),d("div",E,[d("div",{class:b(["step-item",{active:1===ue.value,completed:ue.value>1}])},[...s[12]||(s[12]=[d("div",{class:"step-number"},"1",-1),d("span",{class:"step-label"},"验证身份",-1)])],2),s[15]||(s[15]=d("div",{class:"step-divider"},null,-1)),d("div",{class:b(["step-item",{active:2===ue.value,completed:ue.value>2}])},[...s[13]||(s[13]=[d("div",{class:"step-number"},"2",-1),d("span",{class:"step-label"},"验证码验证",-1)])],2),s[16]||(s[16]=d("div",{class:"step-divider"},null,-1)),d("div",{class:b(["step-item",{active:3===ue.value,completed:ue.value>3}])},[...s[14]||(s[14]=[d("div",{class:"step-number"},"3",-1),d("span",{class:"step-label"},"重置密码",-1)])],2)]),1===ue.value?(c(),n("div",Q,[v(f(j),{ref_key:"step1FormRef",ref:ye,model:_e,rules:Ve,onSubmit:De,class:"modern-forgot-form"},{default:y(()=>[d("div",T,[s[19]||(s[19]=d("div",{class:"method-title"},"选择验证方式",-1)),d("div",W,[v(f(B),{modelValue:_e.method,"onUpdate:modelValue":s[0]||(s[0]=e=>_e.method=e),direction:"horizontal"},{default:y(()=>[v(f(M),{name:"email",class:"method-radio"},{icon:y(({checked:e})=>[d("div",{class:b(["radio-icon",{checked:e}])},[v(f(P),{icon:"ph:envelope",class:"method-icon"})],2)]),default:y(()=>[s[17]||(s[17]=d("span",{class:"method-label"},"邮箱验证",-1))]),_:1}),v(f(M),{name:"phone",class:"method-radio"},{icon:y(({checked:e})=>[d("div",{class:b(["radio-icon",{checked:e}])},[v(f(P),{icon:"ph:phone",class:"method-icon"})],2)]),default:y(()=>[s[18]||(s[18]=d("span",{class:"method-label"},"手机验证",-1))]),_:1})]),_:1},8,["modelValue"])])]),d("div",Z,[d("div",J,[v(f(P),{icon:"email"===_e.method?"ph:envelope":"ph:phone",class:"input-icon-svg"},null,8,["icon"])]),v(f($),{modelValue:_e.identifier,"onUpdate:modelValue":s[1]||(s[1]=e=>_e.identifier=e),name:"email"===_e.method?"email":"phone",placeholder:"email"===_e.method?"请输入注册邮箱":"请输入注册手机号",rules:"email"===_e.method?Ve.email:Ve.phone,border:!1,class:"modern-input"},null,8,["modelValue","name","placeholder","rules"])]),d("div",K,[v(f(x),{round:"",block:"",type:"primary","native-type":"submit",loading:pe.value,disabled:!je.value,"loading-text":"发送中...",class:"modern-send-button"},{default:y(()=>[d("span",O,[v(f(P),{icon:"ph:paper-plane",class:"button-icon"}),s[20]||(s[20]=d("span",null,"发送验证码",-1))])]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])])):h("",!0),2===ue.value?(c(),n("div",Y,[v(f(j),{ref_key:"step2FormRef",ref:we,model:Pe,rules:Be,onSubmit:ze,class:"modern-forgot-form"},{default:y(()=>[d("div",G,[d("div",H,[v(f(P),{icon:"ph:key",class:"input-icon-svg"})]),v(f($),{modelValue:Pe.verificationCode,"onUpdate:modelValue":s[2]||(s[2]=e=>Pe.verificationCode=e),name:"verificationCode",placeholder:"请输入6位验证码",rules:Be.verificationCode,border:!1,class:"modern-input"},{button:y(()=>[v(f(x),{size:"small",type:"primary",disabled:be.value>0,onClick:Le,class:"resend-button"},{default:y(()=>[w(g(be.value>0?`${be.value}s后重发`:"重新发送"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue","rules"])]),d("div",N,[v(f(x),{round:"",block:"",type:"primary","native-type":"submit",loading:ve.value,disabled:!$e.value,"loading-text":"验证中...",class:"modern-verify-button"},{default:y(()=>[d("span",X,[v(f(P),{icon:"ph:check-circle",class:"button-icon"}),s[21]||(s[21]=d("span",null,"验证验证码",-1))])]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])])):h("",!0),3===ue.value?(c(),n("div",ee,[v(f(j),{ref_key:"step3FormRef",ref:ke,model:xe,rules:Me,onSubmit:Ae,class:"modern-forgot-form"},{default:y(()=>[d("div",ae,[d("div",se,[v(f(P),{icon:"ph:lock",class:"input-icon-svg"})]),v(f($),{modelValue:xe.newPassword,"onUpdate:modelValue":s[4]||(s[4]=e=>xe.newPassword=e),name:"newPassword",type:ge.value?"text":"password",placeholder:"请输入新密码",rules:Me.newPassword,border:!1,class:"modern-input"},{button:y(()=>[d("div",{class:"password-toggle",onClick:s[3]||(s[3]=e=>ge.value=!ge.value)},[v(f(P),{icon:ge.value?"ph:eye-slash":"ph:eye",class:"toggle-icon"},null,8,["icon"])])]),_:1},8,["modelValue","type","rules"])]),d("div",oe,[d("div",te,[v(f(P),{icon:"ph:lock-key",class:"input-icon-svg"})]),v(f($),{modelValue:xe.confirmPassword,"onUpdate:modelValue":s[6]||(s[6]=e=>xe.confirmPassword=e),name:"confirmPassword",type:he.value?"text":"password",placeholder:"请确认新密码",rules:Me.confirmPassword,border:!1,class:"modern-input"},{button:y(()=>[d("div",{class:"password-toggle",onClick:s[5]||(s[5]=e=>he.value=!he.value)},[v(f(P),{icon:he.value?"ph:eye-slash":"ph:eye",class:"toggle-icon"},null,8,["icon"])])]),_:1},8,["modelValue","type","rules"])]),d("div",le,[v(f(x),{round:"",block:"",type:"primary","native-type":"submit",loading:fe.value,disabled:!Re.value,"loading-text":"重置中...",class:"modern-reset-button"},{default:y(()=>[d("span",ie,[v(f(P),{icon:"ph:key",class:"button-icon"}),s[22]||(s[22]=d("span",null,"重置密码",-1))])]),_:1},8,["loading","disabled"])])]),_:1},8,["model"])])):h("",!0),d("div",re,[v(f(x),{type:"default",size:"large",onClick:Ee,class:"back-button"},{default:y(()=>[v(f(P),{icon:"ph:arrow-left",class:"back-icon"}),s[23]||(s[23]=d("span",null,"返回登录",-1))]),_:1})])])])])],2))}}),[["__scopeId","data-v-25ce6130"]]),ce=V(a({__name:"forgot-password",setup(a){const o=s(),t=e=>{},l=()=>{o.push("/auth/login")},i=()=>{o.push("/auth/login")};return(a,s)=>{const o=e;return c(),k(o,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:y(()=>[v(ne,{onVerifySuccess:t,onResetSuccess:l,onBackToLogin:i})]),_:1})}}}),[["__scopeId","data-v-f6b7601d"]]);export{ce as default};
