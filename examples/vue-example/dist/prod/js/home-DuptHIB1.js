import{I as e,_ as t,L as s}from"./index-TwMLNQLv.js";import{E as a}from"./index-BgNXfbGv.js";import{k as o,f as i,P as r,Q as n,R as l,S as d,j as c,W as m,a0 as p,a4 as v,Z as u,$ as g,r as f,U as h,O as k,c as b}from"./vue-vendor-BAnrfl1G.js";import{u as y}from"./conversation-DYqtpKmG.js";import{S as w}from"./sdkwork-api-list-1BTsecXP.js";import{I as S}from"./index-Ta3Hx-DT.js";import{S as _}from"./sdkwork-page-container-DiWROpn4.js";import{b as C}from"./route-block-B_A1xBdJ.js";import"./utils-vendor-WEzSe-CR.js";import"./use-id-u-J04b09.js";import"./shared-DSXEP7p_.js";import"./sdkwork-search-bar-BZCk6PtW.js";import"./sdkwork-icon-PpLPToyc.js";import"./ListItem-BwLXeDxh.js";/* empty css              */const z={class:"sdkwork-conversation-list-item__avatar"},j={class:"avatar-placeholder"},B={key:0,class:"online-indicator"},I={class:"sdkwork-conversation-list-item__content"},M={class:"conversation-header"},x={class:"conversation-title"},D={class:"conversation-time"},N={class:"conversation-preview"},L={class:"last-message"},T={key:0,class:"message-content"},$={key:1,class:"no-message"},E={key:0,class:"unread-badge"},F=t(o({__name:"sdkwork-conversation-list-item",props:{conversation:{},disabled:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},showBorderBottom:{type:Boolean,default:!0},themeMode:{default:"auto"}},emits:["click","select"],setup(t,{expose:s,emit:a}){const o=t,f=a,h=i(()=>"dark"===o.themeMode||"light"!==o.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),k=i(()=>h.value?"sdkwork-conversation-list-item--dark":"sdkwork-conversation-list-item--light"),b=()=>{o.disabled||f("click",o.conversation)},y=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),a=Math.floor(s/864e5);return 0===a?t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):1===a?"昨天":a<7?`${a}天前`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},w=e=>e.length<=30?e:e.substring(0,30)+"...";return s({getTitle:()=>o.conversation.title,getUnreadCount:()=>o.conversation.unreadCount||0,isPinned:()=>o.conversation.pinned,formatTime:y,truncateMessage:w}),(s,a)=>{const o=e,i=S;return n(),r("div",{class:l(["sdkwork-conversation-list-item",[{"sdkwork-conversation-list-item--selected":t.isSelected,"sdkwork-conversation-list-item--pinned":t.conversation.pinned,"sdkwork-conversation-list-item--unread":(t.conversation.unreadCount||0)>0,"sdkwork-conversation-list-item--disabled":t.disabled,"sdkwork-conversation-list-item--border-bottom":t.showBorderBottom},k.value]]),onClick:b},[d("div",z,[c(i,{src:t.conversation.avatar,width:"44",height:"44",radius:"4",fit:"cover"},{error:p(()=>[d("div",j,[c(o,{name:"chat-o",size:"18"})])]),_:1},8,["src"]),t.conversation.online?(n(),r("div",B)):m("",!0)]),d("div",I,[d("div",M,[d("div",x,[v(g(t.conversation.title)+" ",1),t.conversation.pinned?(n(),u(o,{key:0,name:"pin",class:"pin-icon"})):m("",!0)]),d("div",D,g(y(t.conversation.updatedAt||t.conversation.createdAt||"")),1)]),d("div",N,[d("div",L,[t.conversation.lastMessageId?(n(),r("span",T,g(w(t.conversation.lastMessageId?.toString()||"")),1)):(n(),r("span",$,"暂无消息"))]),(t.conversation.unreadCount||0)>0?(n(),r("div",E,g((t.conversation.unreadCount||0)>99?"99+":t.conversation.unreadCount),1)):m("",!0)])])],2)}}}),[["__scopeId","data-v-63d2bb52"]]),O={class:"sdkwork-conversation-list"},P=t(o({__name:"sdkwork-conversation-list",props:{api:{},params:{default:()=>({})},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1},pageSize:{default:10},itemKey:{default:"id"},itemTitleField:{default:"title"},itemDescriptionField:{default:"description"}},emits:["select","delete","archive","pin","mute","search","load","click","context-menu"],setup(e,{expose:t,emit:o}){const l=e,m=o,u=f(),g=i(()=>({pageNumber:0,pageSize:l.pageSize,filters:l.params})),k=e=>{m("select",e)},b=e=>{m("delete",e)},y=e=>{m("search",e)},S=e=>{m("load",e)},_=e=>{m("select",e)},C=e=>{m("click",e)};return t({refresh:()=>u.value?.refresh(),loadMore:()=>u.value?.loadMore(),getData:()=>u.value?.getData()||[],getSelectedItems:()=>u.value?.getSelectedItems()||[],clearSelected:()=>u.value?.clearSelected(),setSelectedItems:e=>u.value?.setSelectedItems(e)}),(t,o)=>{const i=a,l=s;return n(),r("div",O,[c(w,{api:e.api,params:g.value,selectable:e.selectable,deletable:e.deletable,searchable:e.searchable,"page-size":e.pageSize,"item-key":e.itemKey,"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,"left-spacing":0,"right-spacing":0,onSelect:k,onDelete:b,onSearch:y,onLoad:S,ref_key:"apiListRef",ref:u,showBorderBottom:"",borderBottomLeftOffset:60},{default:p(({item:e,index:t,selected:s})=>[c(F,{conversation:e,"is-selected":s,"show-border-bottom":!0,onClick:C,onSelect:_},null,8,["conversation","is-selected"])]),empty:p(()=>[h(t.$slots,"empty",{},()=>[c(i,{description:"暂无聊天会话",image:"search"},{description:p(()=>[...o[0]||(o[0]=[d("div",{class:"empty-description"},[d("p",null,"暂时没有聊天会话"),d("p",{class:"empty-tip"},"您可以开始新的对话或调整搜索条件")],-1)])]),_:1})],!0)]),loading:p(()=>[h(t.$slots,"loading",{},()=>[c(l,{size:"24px",vertical:""},{default:p(()=>[...o[1]||(o[1]=[v("加载会话数据...",-1)])]),_:1})],!0)]),header:p(()=>[h(t.$slots,"header",{},void 0,!0)]),footer:p(()=>[h(t.$slots,"footer",{},void 0,!0)]),_:3},8,["api","params","selectable","deletable","searchable","page-size","item-key","item-title-field","item-description-field"])])}}}),[["__scopeId","data-v-bb158ad7"]]),R=o({__name:"home",setup(e){const t=k(),o=y(),i=f(),r=b({status:void 0,keyword:"",agentId:"",pinned:void 0,muted:void 0}),l=async e=>{try{return await o.loadMoreConversations(e.pageNumber||0,e.pageSize||10),{content:o.sortedConversations,empty:0===o.sortedConversations.length,first:0===(e.pageNumber||0),last:o.sortedConversations.length<(e.pageSize||10),pageNumber:e.pageNumber||0,numberOfElements:o.sortedConversations.length,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:o.sortedConversations.length,totalPages:Math.ceil(o.sortedConversations.length/(e.pageSize||10))}}catch(t){return{content:[],empty:!0,first:!0,last:!0,pageNumber:e.pageNumber||0,numberOfElements:0,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:0,totalPages:0}}},m=async e=>{try{await o.switchConversation(e.id);const s=e.uuid||e.id;t.push(`/chat/${s}`)}catch(s){}},g=async e=>{try{await o.deleteConversation(e.id)}catch(t){}},h=e=>{},w=e=>{};return(e,t)=>{const o=a,f=s;return n(),u(_,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:p(()=>[c(P,{api:l,params:r,selectable:!1,deletable:!1,searchable:!1,"pageNumber-size":10,onSelect:m,onDelete:g,onSearch:h,onLoad:w,ref_key:"conversationListRef",ref:i},{empty:p(()=>[c(o,{description:"暂无聊天会话",image:"search"},{description:p(()=>[...t[0]||(t[0]=[d("div",{class:"empty-description"},[d("p",null,"暂时没有聊天会话"),d("p",{class:"empty-tip"},"您可以开始新的对话")],-1)])]),_:1})]),loading:p(()=>[c(f,{size:"24px",vertical:""},{default:p(()=>[...t[1]||(t[1]=[v("加载会话数据...",-1)])]),_:1})]),_:1},8,["params"])]),_:1})}}});"function"==typeof C&&C(R);const A=t(R,[["__scopeId","data-v-13ba55e5"]]);export{A as default};
