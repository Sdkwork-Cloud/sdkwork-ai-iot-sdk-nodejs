import{k as e,r as a,c as t,b as l,n as s,w as u,d as o,e as v,t as n,v as i,j as r,q as c,s as f}from"./vue-vendor-fce65f55.js";import{m as p,J as g,K as h,N as x,n as d,O as y,Q as m,T as b,q as T,U as j,V as w,w as k}from"./index-2cafbb5e.js";function C(e,a){return e.reduce((e,t)=>Math.abs(e-a)<Math.abs(t-a)?e:t)}const O={gap:{type:[Number,Object],default:24},icon:String,axis:T("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[S,q]=p("floating-bubble");const M=k(e({name:S,inheritAttrs:!1,props:O,emits:["click","update:offset","offsetChange"],setup(e,{slots:p,emit:T,attrs:k}){const O=a(),S=a({x:0,y:0,width:0,height:0}),M=t(()=>g(e.gap)?e.gap.x:e.gap),N=t(()=>g(e.gap)?e.gap.y:e.gap),P=t(()=>({top:N.value,right:h.value-S.value.width-M.value,bottom:x.value-S.value.height-N.value,left:M.value})),$=a(!1);let A=!1;const D=t(()=>{const e={},a=d(S.value.x),t=d(S.value.y);return e.transform=`translate3d(${a}, ${t}, 0)`,!$.value&&A||(e.transition="none"),e}),F=()=>{if(!Y.value)return;const{width:a,height:t}=j(O.value),{offset:l}=e;S.value={x:l?l.x:h.value-a-M.value,y:l?l.y:x.value-t-N.value,width:a,height:t}},J=y();let K=0,Q=0;const U=e=>{J.start(e),$.value=!0,K=S.value.x,Q=S.value.y};m("touchmove",a=>{if(a.preventDefault(),J.move(a),"lock"!==e.axis&&!J.isTap.value){if("x"===e.axis||"xy"===e.axis){let e=K+J.deltaX.value;e<P.value.left&&(e=P.value.left),e>P.value.right&&(e=P.value.right),S.value.x=e}if("y"===e.axis||"xy"===e.axis){let e=Q+J.deltaY.value;e<P.value.top&&(e=P.value.top),e>P.value.bottom&&(e=P.value.bottom),S.value.y=e}const a=w(S.value,["x","y"]);T("update:offset",a)}},{target:O});const V=()=>{$.value=!1,s(()=>{if("x"===e.magnetic){const e=C([P.value.left,P.value.right],S.value.x);S.value.x=e}if("y"===e.magnetic){const e=C([P.value.top,P.value.bottom],S.value.y);S.value.y=e}if(!J.isTap.value){const e=w(S.value,["x","y"]);T("update:offset",e),K===e.x&&Q===e.y||T("offsetChange",e)}})},X=e=>{J.isTap.value?T("click",e):e.stopPropagation()};l(()=>{F(),s(()=>{A=!0})}),u([h,x,M,N,()=>e.offset],F,{deep:!0});const Y=a(!0);return o(()=>{Y.value=!0}),v(()=>{e.teleport&&(Y.value=!1)}),()=>{const a=n(r("div",c({class:q(),ref:O,onTouchstartPassive:U,onTouchend:V,onTouchcancel:V,onClickCapture:X,style:D.value},k),[p.default?p.default():r(b,{name:e.icon,class:q("icon")},null)]),[[i,Y.value]]);return e.teleport?r(f,{to:e.teleport},{default:()=>[a]}):a}}}));export{M as F};
