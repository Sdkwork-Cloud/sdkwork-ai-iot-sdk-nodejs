import{m as e,M as a,o as t,d as l,s as i,B as s,P as o,_ as c}from"./index-34815b62.js";import{C as n}from"./index-cd6dd4fb.js";import{N as r}from"./index-9f02df9f.js";/* empty css              *//* empty css              *//* empty css              */import{k as u,r as d,c as v,b as m,Q as p,R as f,S as h,j as y,u as g,a0 as C,a4 as k,$ as w,X as I,Z as x,U as b}from"./vue-vendor-905d75e5.js";import{F as j}from"./index-d9bf0347.js";import{C as _}from"./index-a966f53b.js";class E extends e.BaseService{constructor(){super(a.create(t.IotDeviceManager))}async activateByCode(e,a){const t=await this.manager.activateByCode(e,a);return null==t||null==t.data?Promise.reject(new Error("data error!")):t.data}async activate(e,a,t){const l=await this.manager.activate(e,a,t);return null==l||null==l.data?Promise.reject(new Error("data error!")):l.data}}const N={class:"sdkwork-device-activation"},U={class:"activation-content"},A={class:"activation-icon"},F={key:0,class:"activation-subtitle"},T={key:1,class:"activation-subtitle"},S={key:2,class:"activation-status"},$={class:"help-section"},B={class:"help-popup"},L={class:"help-content"},R=c(u({__name:"sdkwork-device-activation",props:{deviceId:{default:""},client:{default:void 0},autoFillFromUrl:{type:Boolean,default:!0}},emits:["activated","failed","back","urlCodeFilled"],setup(e,{expose:a,emit:t}){const c=e,u=t,R=d(""),V=d(!1),O=d(null),P=d(!1),z=d(""),M=v(()=>{const e=R.value.trim();return e.length>=8&&e.length<=20&&/^[A-Z0-9]+$/.test(e)}),Z=e=>{const a=e.trim();return a.length>=8&&a.length<=20&&/^[A-Z0-9]+$/i.test(a)},D=()=>{if(!c.autoFillFromUrl)return;const e=(()=>{if("undefined"==typeof window)return"";const e=new URLSearchParams(window.location.search),a=e.get("code")||e.get("activationCode")||e.get("key");return a&&Z(a)?a.toUpperCase():""})();e&&(z.value=e,R.value=e,console.log("从URL参数获取激活码:",e),u("urlCodeFilled",e),i("已从链接获取激活码"))},W=()=>{u("back")},q=()=>{O.value&&(O.value=null),z.value&&R.value!==z.value&&(z.value="")},G=()=>{i("扫码功能暂未实现")},K=async()=>{if(M.value){V.value=!0;try{const e=new E;let a;a=c.deviceId?await e.activate(c.deviceId,{code:R.value}):await e.activateByCode({code:R.value});let t="设备激活成功！";a.activateTime&&(t+=`\n激活时间: ${a.activateTime}`),a.name&&(t+=`\n设备名称: ${a.name}`),a.deviceId&&(t+=`\n设备ID: ${a.deviceId}`),a.status&&(t+=`\n设备状态: ${Q(a.status)}`),O.value={type:"success",message:t,icon:"mdi:check-circle",color:"#07c160"},i("设备激活成功");const l=a.deviceId||c.deviceId||"未知设备";u("activated",l,R.value)}catch(e){const a=e instanceof Error?e.message:"激活失败，请重试";O.value={type:"error",message:a,icon:"mdi:close-circle",color:"#ee0a24"},i(a),u("failed",a)}finally{V.value=!1}}else i("请输入有效的激活码")},Q=e=>({WAIT_ACTIVATION:"等待激活",INACTIVE:"未激活",ACTIVE:"已激活",ONLINE:"在线",OFFLINE:"离线",SLEEP:"休眠",ERROR:"错误",MAINTENANCE:"维护中",UNKNOWN:"未知"}[e]||e);return m(()=>{D()}),a({reset:()=>{R.value="",O.value=null,V.value=!1,z.value=""},getStatus:()=>O.value,setActivationCode:e=>{R.value=e,z.value=""},refreshFromUrl:()=>{D()},getUrlCodeStatus:()=>({hasUrlCode:!!z.value,urlCode:z.value})}),(e,a)=>{const t=j,i=s,c=_,u=r,d=n,v=o;return p(),f("div",N,[h("div",U,[h("div",A,[y(g(l),{icon:"mdi:key",width:"60",color:"#1989fa"})]),a[5]||(a[5]=h("div",{class:"activation-title"},"输入激活码",-1)),z.value?(p(),f("div",F,"已从链接获取激活码，请确认后激活")):(p(),f("div",T,"请输入您的设备激活码，激活后将可正常使用设备功能")),y(t,{modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value=e),placeholder:z.value?"从链接获取的激活码":"请输入激活码",maxlength:20,clearable:"",readonly:V.value,class:"activation-input",onInput:q},{extra:C(()=>[y(g(l),{icon:"mdi:qrcode-scan",width:"20",color:"#1989fa",onClick:G})]),_:1},8,["modelValue","placeholder","readonly"]),y(i,{type:"primary",size:"large",loading:V.value,disabled:!M.value,onClick:K,class:"activation-button"},{default:C(()=>[k(w(V.value?"激活中...":"激活设备"),1)]),_:1},8,["loading","disabled"]),O.value?(p(),f("div",S,[y(g(l),{icon:O.value.icon,color:O.value.color,width:"24"},null,8,["icon","color"]),h("span",{class:I(["status-text",O.value.type])},w(O.value.message),3),"success"===O.value.type?(p(),x(i,{key:0,type:"default",size:"small",onClick:W,class:"back-button"},{default:C(()=>[...a[4]||(a[4]=[k(" 返回 ",-1)])]),_:1})):b("",!0)])):b("",!0),h("div",$,[y(c,{title:"找不到激活码？","is-link":"",onClick:a[1]||(a[1]=e=>P.value=!0)},{icon:C(()=>[y(g(l),{icon:"mdi:help-circle-outline",width:"18",color:"#969799"})]),_:1})])]),y(v,{show:P.value,"onUpdate:show":a[3]||(a[3]=e=>P.value=e),round:"",position:"bottom",style:{height:"60%"}},{default:C(()=>[h("div",B,[y(u,{title:"激活帮助","left-text":"关闭",onClickLeft:a[2]||(a[2]=e=>P.value=!1)}),h("div",L,[y(d,{title:"激活码获取方式"},{default:C(()=>[y(c,{title:"1. 查看设备包装盒",value:"通常在设备底部或侧面"}),y(c,{title:"2. 联系客服获取",value:"提供设备序列号"}),y(c,{title:"3. 购买凭证",value:"查看购买订单详情"})]),_:1}),y(d,{title:"常见问题"},{default:C(()=>[y(c,{title:"激活码无效",value:"请检查输入是否正确"}),y(c,{title:"已激活的设备",value:"无需重复激活"}),y(c,{title:"激活失败",value:"请检查网络连接"})]),_:1})])])]),_:1},8,["show"])])}}}),[["__scopeId","data-v-3e24b2a2"]]);export{R as S};
