import{S as l}from"./sdkwork-page-container-B9mZ0PBm.js";import{a as e,_ as a}from"./sdkwork-cell-group-Bd8WOOZF.js";import{_ as t}from"./sdkwork-navbar-k1vX6lUO.js";import{_ as o}from"./sdkwork-popup-BV1irj3C.js";import{d as u,_ as i,s}from"./index-C5cIQ-JB.js";import{k as d,r as n,f as p,w as r,P as c,Q as v,S as m,W as f,R as w,F as h,Y as k,Z as g,u as y,$ as b,V as U,j as V,a0 as A}from"./vue-vendor-BAnrfl1G.js";import"./sdkwork-icon-B0kkyH_G.js";import"./utils-vendor-WEzSe-CR.js";const C={class:"sdkwork-uploader-audio"},$={class:"upload-content"},_={key:0,class:"audio-list"},x={class:"audio-player"},M=["onClick","disabled"],L={class:"audio-info"},j={class:"audio-name"},I={class:"audio-details"},P={class:"audio-size"},S={key:0,class:"audio-duration"},z={class:"audio-format"},R={key:0,class:"audio-waveform"},B={key:1,class:"upload-progress"},G={class:"progress-bar"},O={class:"progress-text"},W={class:"audio-actions"},E={class:"status-icons"},F={key:0,class:"success-icon"},D={key:1,class:"error-icon"},T={class:"action-buttons"},N=["onClick"],K=["onClick"],Q={key:1,class:"empty-state"},Y={class:"upload-icon"},Z={class:"upload-text"},q={class:"upload-title"},H={class:"upload-subtitle"},J={key:0,class:"upload-actions"},X=["disabled"],ll=i(d({__name:"sdkwork-uploader-audio",props:{modelValue:{default:()=>[]},accept:{default:"audio/*"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autoUpload:{type:Boolean,default:!0},maxSize:{default:52428800},maxCount:{default:10},maxDuration:{default:600},title:{default:"点击或拖拽音频到此处"},subtitle:{default:"支持 MP3、WAV、OGG、AAC 等格式"},bucket:{default:void 0},scene:{default:"audio"},metadata:{default:()=>({})},contentType:{default:"audio/mpeg"},acl:{default:"private"}},emits:["update:modelValue","upload-start","upload-progress","upload-success","upload-error","upload-complete","audio-add","audio-remove","audio-clear","audio-play","audio-pause","audio-ended","audio-metadata"],setup(l,{expose:e,emit:a}){const t=l,o=a,i=n(),s=n(!1),d=n(),A=n(""),ll=n([]),el=p(()=>ll.value.filter(l=>"uploading"===l.status).length),al=p(()=>ll.value.length<t.maxCount),tl=p(()=>ll.value.slice(0,t.maxCount));r(()=>t.modelValue,l=>{if(l&&l.length>0){const e=ll.value.map(l=>ol(l.file)),a=l.filter(l=>!e.includes(ol(l)));a.length>0&&cl(a)}},{immediate:!0});const ol=l=>`${l.name}-${l.size}-${l.lastModified}`,ul=l=>{const e=l.name.split(".").pop()?.toUpperCase()||"";return{mp3:"MP3",wav:"WAV",ogg:"OGG",aac:"AAC",flac:"FLAC",m4a:"M4A",wma:"WMA"}[e.toLowerCase()]||e},il=async l=>{const e=await(l=>new Promise(e=>{e(URL.createObjectURL(l))}))(l);let a;try{const e=await(l=>new Promise((e,a)=>{const t=URL.createObjectURL(l),o=new Audio;o.onloadedmetadata=()=>{const l={duration:o.duration};URL.revokeObjectURL(t),e(l)},o.onerror=()=>{URL.revokeObjectURL(t),a(new Error("无法获取音频元数据"))},o.src=t}))(l);a=e.duration}catch(t){}return{id:ol(l),file:l,name:l.name,size:l.size,previewUrl:e,duration:a,status:"pending",progress:0}},sl=l=>{if(0===l)return"0 B";const e=Math.floor(Math.log(l)/Math.log(1024));return parseFloat((l/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]},dl=()=>{!t.disabled&&al.value&&i.value?.click()},nl=l=>{l.preventDefault(),!t.disabled&&al.value&&(s.value=!0)},pl=l=>{l.preventDefault(),s.value=!1},rl=async l=>{if(l.preventDefault(),s.value=!1,t.disabled||!al.value)return;const e=l.dataTransfer?.files;e&&e.length>0&&await cl(Array.from(e))},cl=async l=>{if(0===l.length)return;const e=l.filter(l=>l.type.startsWith("audio/"));if(0===e.length)return void window.$message?.warning("请选择音频文件");const a=t.maxCount-ll.value.length,u=e.slice(0,a);if(0===u.length)return void window.$message?.warning(`最多只能上传 ${t.maxCount} 个音频`);const i=[],s=[];for(const o of u)o.size>t.maxSize?s.push(o):i.push(o);if(s.length>0&&window.$message?.warning(`以下音频文件超过 ${sl(t.maxSize)} 限制: ${s.map(l=>l.name).join(", ")}`),0===i.length)return;const d=await Promise.all(i.map(il));ll.value=[...ll.value,...d];const n=ll.value.map(l=>l.file);o("update:modelValue",n),o("audio-add",i),t.autoUpload&&fl()},vl=l=>{const e=ll.value.findIndex(e=>e.id===l);if(-1!==e){const l=ll.value[e];l.id===A.value&&kl(),"uploading"===l.status&&l.uploadId&&window.$uploader?.cancel(l.uploadId),URL.revokeObjectURL(l.previewUrl),ll.value.splice(e,1);const a=ll.value.map(l=>l.file);o("update:modelValue",a),o("audio-remove",l.file)}},ml=()=>{kl(),ll.value.forEach(l=>{"uploading"===l.status&&l.uploadId&&window.$uploader?.cancel(l.uploadId),URL.revokeObjectURL(l.previewUrl)}),ll.value=[],o("update:modelValue",[]),o("audio-clear")},fl=()=>{ll.value.filter(l=>"pending"===l.status).forEach(wl)},wl=async l=>{if(window.$uploader){l.status="uploading",o("upload-start",l.file);try{const e={file:l.file,bucket:t.bucket||{name:"default-bucket"},name:l.name,scene:t.scene,metadata:t.metadata,contentType:t.contentType||"audio/mpeg",acl:t.acl},a=await window.$uploader.upload(e,e=>{l.progress=e.percentage,o("upload-progress",l.file,e.percentage)});l.uploadId=a;const u=await window.$uploader.wait(a);l.status="success",l.progress=100,o("upload-success",l.file,u);ll.value.every(l=>"success"===l.status||"error"===l.status)&&o("upload-complete",ll.value.map(l=>l.file))}catch(e){l.status="error",o("upload-error",l.file,e)}}},hl=async l=>{d.value&&(A.value===l.id?(d.value.pause(),A.value="",o("audio-pause",l.file)):(A.value&&(d.value.pause(),o("audio-pause",ll.value.find(l=>l.id===A.value)?.file)),d.value.src=l.previewUrl,await d.value.play(),A.value=l.id,o("audio-play",l.file)))},kl=()=>{if(d.value){if(A.value){const l=ll.value.find(l=>l.id===A.value);l&&o("audio-pause",l.file)}d.value.pause(),d.value.currentTime=0,A.value=""}},gl=()=>{},yl=()=>{if(A.value){const l=ll.value.find(l=>l.id===A.value);l&&o("audio-ended",l.file),A.value=""}};return e({clearAudios:ml,uploadAudios:fl,getAudioList:()=>ll.value.map(l=>({file:l.file,previewUrl:l.previewUrl,duration:l.duration,status:"success"===l.status?"uploaded":void 0})),playAudio:l=>{const e=ll.value.find(e=>e.file===l);e&&hl(e)},pauseAudio:kl,removeAudio:vl}),(e,a)=>(v(),c("div",C,[m("div",{class:w(["upload-area",{"drag-over":s.value,disabled:l.disabled,"has-audios":ll.value.length>0}]),onClick:dl,onDrop:rl,onDragover:nl,onDragleave:pl},[m("div",$,[ll.value.length>0?(v(),c("div",_,[(v(!0),c(h,null,k(tl.value,(l,e)=>{return v(),c("div",{key:l.id,class:w(["audio-item",{uploading:"uploading"===l.status,success:"success"===l.status,error:"error"===l.status,playing:l.id===A.value}])},[m("div",x,[m("button",{type:"button",class:"play-control",onClick:e=>hl(l),disabled:"success"!==l.status},[l.id===A.value?(v(),g(y(u),{key:0,icon:"material-symbols:pause",width:"20",height:"20"})):(v(),g(y(u),{key:1,icon:"material-symbols:play-arrow",width:"20",height:"20"}))],8,M),m("div",L,[m("div",j,b(l.name),1),m("div",I,[m("span",P,b(sl(l.size)),1),l.duration?(v(),c("span",S,b((a=l.duration,`${Math.floor(a/60)}:${Math.floor(a%60).toString().padStart(2,"0")}`)),1)):f("",!0),m("span",z,b(ul(l.file)),1)]),l.id===A.value?(v(),c("div",R,[(v(),c(h,null,k(20,l=>m("div",{key:l,class:"wave-bar",style:U({height:12*Math.random()+4+"px"})},null,4)),64))])):f("",!0),"uploading"===l.status?(v(),c("div",B,[m("div",G,[m("div",{class:"progress-fill",style:U({width:l.progress+"%"})},null,4)]),m("span",O,b(l.progress)+"%",1)])):f("",!0)]),m("div",W,[m("div",E,["success"===l.status?(v(),c("span",F,"✓")):f("",!0),"error"===l.status?(v(),c("span",D,"✗")):f("",!0)]),m("div",T,["uploading"===l.status?(v(),c("button",{key:0,type:"button",class:"cancel-btn",onClick:e=>(l=>{const e=ll.value.find(e=>e.id===l);e&&e.uploadId&&(window.$uploader?.cancel(e.uploadId),e.status="pending",e.progress=0,e.uploadId=void 0)})(l.id)}," 取消 ",8,N)):(v(),c("button",{key:1,type:"button",class:"remove-btn",onClick:e=>vl(l.id)}," 移除 ",8,K))])])])],2);var a}),128)),al.value?(v(),c("div",{key:0,class:"add-more-btn",onClick:dl},[...a[0]||(a[0]=[m("div",{class:"add-icon"},"+",-1),m("div",{class:"add-text"},"添加音频",-1)])])):f("",!0)])):(v(),c("div",Q,[m("div",Y,[V(y(u),{icon:"material-symbols:audio-file",width:"48",height:"48"})]),m("div",Z,[m("p",q,b(l.title),1),m("p",H,b(l.subtitle),1)])]))])],34),ll.value.length>0&&!l.autoUpload?(v(),c("div",J,[m("button",{type:"button",class:"upload-btn primary",disabled:el.value>0,onClick:fl},b(el.value>0?`上传中... (${el.value})`:"开始上传"),9,X),m("button",{type:"button",class:"upload-btn secondary",onClick:ml}," 取消 ")])):f("",!0),m("audio",{ref_key:"audioPlayer",ref:d,onTimeupdate:gl,onEnded:yl},null,544)]))}}),[["__scopeId","data-v-46e09b4c"]]),el={class:"demo-content"},al={class:"popup-content"},tl={key:0,class:"audio-info"},ol={class:"popup-content"},ul={class:"popup-content"},il={class:"popup-content"},sl={key:0,class:"duration-info"},dl={class:"popup-content"},nl={class:"popup-content"},pl={key:0,class:"format-info"},rl={class:"popup-content"},cl={class:"popup-content"},vl={class:"popup-content"},ml={class:"popup-content"},fl={class:"popup-content"},wl=i(d({__name:"audio-upload-demo",setup(u){const i=n(!1),d=n(!1),p=n(!1),r=n(!1),w=n(!1),y=n(!1),U=n(!1),C=n(!1),$=n(!1),_=n(!1),x=n(!1),M=n([]),L=n([]),j=n([]),I=n([]),P=n([]),S=n([]),z=n([]),R=n([]),B=n([]),G=n([]),O=n([]),W=n([]),E=(l,e)=>{s(`音频上传成功: ${l.name}`)},F=l=>{s(`开始播放: ${l.name}`)},D=l=>{s(`暂停播放: ${l.name}`)},T=l=>{s(`播放结束: ${l.name}`)},N=(l,e)=>{e&&e.duration&&W.value.push({fileName:l.name,duration:e.duration})},K=(l,e)=>{s(`音频时长超出限制: ${l.name}`)},Q=(l,e)=>{s(`音乐上传成功: ${l.name}`)},Y=(l,e)=>{s(`语音消息上传成功: ${l.name}`)},Z=(l,e)=>{s(`播客音频上传成功: ${l.name}`)};return(u,s)=>{const n=t,q=e,H=a,J=l;return v(),g(J,{"safe-area":"",scrollable:"","theme-mode":"auto"},{header:A(()=>[V(n,{title:"音频上传组件演示","left-text":"返回","left-arrow":"",onClickLeft:s[0]||(s[0]=l=>u.$router.back())})]),default:A(()=>[m("div",el,[V(H,{title:"基础功能演示"},{default:A(()=>[V(q,{title:"单个音频上传","is-link":"",onClick:s[1]||(s[1]=l=>i.value=!0)}),V(q,{title:"多个音频上传","is-link":"",onClick:s[2]||(s[2]=l=>d.value=!0)}),V(q,{title:"音频播放控制","is-link":"",onClick:s[3]||(s[3]=l=>p.value=!0)}),V(q,{title:"音频时长检测","is-link":"",onClick:s[4]||(s[4]=l=>r.value=!0)})]),_:1}),V(H,{title:"高级功能演示"},{default:A(()=>[V(q,{title:"波形显示效果","is-link":"",onClick:s[5]||(s[5]=l=>w.value=!0)}),V(q,{title:"音频格式识别","is-link":"",onClick:s[6]||(s[6]=l=>y.value=!0)}),V(q,{title:"音频时长限制","is-link":"",onClick:s[7]||(s[7]=l=>U.value=!0)}),V(q,{title:"播放状态管理","is-link":"",onClick:s[8]||(s[8]=l=>C.value=!0)})]),_:1}),V(H,{title:"特殊场景演示"},{default:A(()=>[V(q,{title:"音乐上传","is-link":"",onClick:s[9]||(s[9]=l=>$.value=!0)}),V(q,{title:"语音消息上传","is-link":"",onClick:s[10]||(s[10]=l=>_.value=!0)}),V(q,{title:"播客音频上传","is-link":"",onClick:s[11]||(s[11]=l=>x.value=!0)})]),_:1})]),V(o,{show:i.value,"onUpdate:show":s[13]||(s[13]=l=>i.value=l),position:"center",title:"单个音频上传",width:450},{default:A(()=>[m("div",al,[V(ll,{modelValue:M.value,"onUpdate:modelValue":s[12]||(s[12]=l=>M.value=l),multiple:!1,"auto-upload":!0,title:"选择单个音频",subtitle:"支持MP3、WAV、OGG等格式",onUploadSuccess:E,onAudioPlay:F},null,8,["modelValue"]),M.value.length>0?(v(),c("div",tl,[m("p",null,"已选择音频: "+b(M.value.length)+" 个",1)])):f("",!0)])]),_:1},8,["show"]),V(o,{show:d.value,"onUpdate:show":s[15]||(s[15]=l=>d.value=l),position:"center",title:"多个音频上传",width:550},{default:A(()=>[m("div",ol,[V(ll,{modelValue:L.value,"onUpdate:modelValue":s[14]||(s[14]=l=>L.value=l),multiple:!0,"auto-upload":!0,"max-count":5,"max-size":52428800,title:"选择多个音频",subtitle:"最多5个音频，每个最大50MB",onUploadSuccess:E},null,8,["modelValue"])])]),_:1},8,["show"]),V(o,{show:p.value,"onUpdate:show":s[17]||(s[17]=l=>p.value=l),position:"center",title:"音频播放控制",width:600},{default:A(()=>[m("div",ul,[V(ll,{modelValue:j.value,"onUpdate:modelValue":s[16]||(s[16]=l=>j.value=l),multiple:!0,"auto-upload":!1,title:"播放控制演示",subtitle:"支持播放、暂停、停止控制",onAudioPlay:F,onAudioPause:D,onAudioEnded:T},null,8,["modelValue"]),s[34]||(s[34]=m("div",{class:"play-control-info"},[m("h4",null,"播放控制功能:"),m("ul",null,[m("li",null,"点击播放按钮开始播放"),m("li",null,"播放时显示暂停按钮"),m("li",null,"支持播放状态管理")])],-1))])]),_:1},8,["show"]),V(o,{show:r.value,"onUpdate:show":s[19]||(s[19]=l=>r.value=l),position:"center",title:"音频时长检测",width:550},{default:A(()=>[m("div",il,[V(ll,{modelValue:I.value,"onUpdate:modelValue":s[18]||(s[18]=l=>I.value=l),multiple:!0,"auto-upload":!1,title:"时长检测演示",subtitle:"自动检测音频时长信息",onAudioMetadata:N},null,8,["modelValue"]),W.value.length>0?(v(),c("div",sl,[s[35]||(s[35]=m("h4",null,"音频时长:",-1)),(v(!0),c(h,null,k(W.value,l=>{return v(),c("div",{key:l.fileName,class:"duration-item"},[m("span",null,b(l.fileName),1),m("span",null,b((e=l.duration,`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`)),1)]);var e}),128))])):f("",!0)])]),_:1},8,["show"]),V(o,{show:w.value,"onUpdate:show":s[21]||(s[21]=l=>w.value=l),position:"center",title:"波形显示效果",width:600},{default:A(()=>[m("div",dl,[V(ll,{modelValue:P.value,"onUpdate:modelValue":s[20]||(s[20]=l=>P.value=l),multiple:!0,"auto-upload":!1,title:"波形显示演示",subtitle:"播放时显示动态波形效果"},null,8,["modelValue"]),s[36]||(s[36]=m("div",{class:"waveform-info"},[m("h4",null,"波形显示功能:"),m("ul",null,[m("li",null,"播放时显示动态波形"),m("li",null,"增强音频播放体验"),m("li",null,"可视化音频播放状态")])],-1))])]),_:1},8,["show"]),V(o,{show:y.value,"onUpdate:show":s[23]||(s[23]=l=>y.value=l),position:"center",title:"音频格式识别",width:550},{default:A(()=>[m("div",nl,[V(ll,{modelValue:S.value,"onUpdate:modelValue":s[22]||(s[22]=l=>S.value=l),multiple:!0,"auto-upload":!1,title:"格式识别演示",subtitle:"自动识别音频文件格式"},null,8,["modelValue"]),S.value.length>0?(v(),c("div",pl,[...s[37]||(s[37]=[m("h4",null,"支持的音频格式:",-1),m("ul",null,[m("li",null,"MP3 - MPEG Audio Layer III"),m("li",null,"WAV - Waveform Audio File Format"),m("li",null,"OGG - Ogg Vorbis"),m("li",null,"AAC - Advanced Audio Coding"),m("li",null,"FLAC - Free Lossless Audio Codec"),m("li",null,"M4A - MPEG-4 Audio"),m("li",null,"WMA - Windows Media Audio")],-1)])])):f("",!0)])]),_:1},8,["show"]),V(o,{show:U.value,"onUpdate:show":s[25]||(s[25]=l=>U.value=l),position:"center",title:"音频时长限制",width:500},{default:A(()=>[m("div",rl,[V(ll,{modelValue:z.value,"onUpdate:modelValue":s[24]||(s[24]=l=>z.value=l),multiple:!0,"auto-upload":!0,"max-duration":300,title:"时长限制演示",subtitle:"最大时长: 5分钟",onUploadError:K},null,8,["modelValue"]),s[38]||(s[38]=m("div",{class:"limit-info"},[m("p",null,"时长限制: 5分钟"),m("p",null,"超过限制的音频将被拒绝")],-1))])]),_:1},8,["show"]),V(o,{show:C.value,"onUpdate:show":s[27]||(s[27]=l=>C.value=l),position:"center",title:"播放状态管理",width:600},{default:A(()=>[m("div",cl,[V(ll,{modelValue:R.value,"onUpdate:modelValue":s[26]||(s[26]=l=>R.value=l),multiple:!0,"auto-upload":!1,title:"播放状态管理",subtitle:"管理多个音频的播放状态"},null,8,["modelValue"]),s[39]||(s[39]=m("div",{class:"playback-state-info"},[m("h4",null,"播放状态管理:"),m("ul",null,[m("li",null,"同时只能播放一个音频"),m("li",null,"播放状态自动切换"),m("li",null,"高亮显示当前播放项")])],-1))])]),_:1},8,["show"]),V(o,{show:$.value,"onUpdate:show":s[29]||(s[29]=l=>$.value=l),position:"center",title:"音乐上传",width:500},{default:A(()=>[m("div",vl,[V(ll,{modelValue:B.value,"onUpdate:modelValue":s[28]||(s[28]=l=>B.value=l),multiple:!0,"auto-upload":!0,"max-duration":600,"max-size":20971520,title:"音乐上传",subtitle:"最大时长: 10分钟，最大文件: 20MB",onUploadSuccess:Q},null,8,["modelValue"]),s[40]||(s[40]=m("div",{class:"music-tips"},[m("p",null,"音乐上传要求:"),m("ul",null,[m("li",null,"支持主流音乐格式"),m("li",null,"音质清晰，无杂音"),m("li",null,"文件大小适中")])],-1))])]),_:1},8,["show"]),V(o,{show:_.value,"onUpdate:show":s[31]||(s[31]=l=>_.value=l),position:"center",title:"语音消息上传",width:500},{default:A(()=>[m("div",ml,[V(ll,{modelValue:G.value,"onUpdate:modelValue":s[30]||(s[30]=l=>G.value=l),multiple:!0,"auto-upload":!0,"max-duration":60,"max-size":5242880,title:"语音消息上传",subtitle:"最大时长: 1分钟，最大文件: 5MB",onUploadSuccess:Y},null,8,["modelValue"]),s[41]||(s[41]=m("div",{class:"voice-message-tips"},[m("p",null,"语音消息要求:"),m("ul",null,[m("li",null,"时长不超过1分钟"),m("li",null,"声音清晰可辨"),m("li",null,"文件体积小")])],-1))])]),_:1},8,["show"]),V(o,{show:x.value,"onUpdate:show":s[33]||(s[33]=l=>x.value=l),position:"center",title:"播客音频上传",width:550},{default:A(()=>[m("div",fl,[V(ll,{modelValue:O.value,"onUpdate:modelValue":s[32]||(s[32]=l=>O.value=l),multiple:!0,"auto-upload":!0,"max-duration":3600,"max-size":104857600,title:"播客音频上传",subtitle:"最大时长: 60分钟，最大文件: 100MB",onUploadSuccess:Z},null,8,["modelValue"]),s[42]||(s[42]=m("div",{class:"podcast-tips"},[m("p",null,"播客音频要求:"),m("ul",null,[m("li",null,"时长可长达60分钟"),m("li",null,"音质清晰，内容完整"),m("li",null,"支持长时间播放")])],-1))])]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-e45d2dda"]]);export{wl as default};
