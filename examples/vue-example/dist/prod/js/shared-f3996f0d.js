import{_ as e}from"./sdkwork-search-bar-d9125bb7.js";import{k as a,r as t,Q as s,R as o,j as r,W as l,ad as i,ae as n,c,w as u}from"./vue-vendor-905d75e5.js";import{_ as p}from"./index-34815b62.js";import{E as m}from"./index-3ae7521b.js";const d={class:"search-section"},v=p(a({__name:"SearchSection",props:{searchable:{type:Boolean}},emits:["search"],setup(a,{emit:l}){const i=l,n=t(""),c=(()=>{let e=null;return a=>{e&&clearTimeout(e),e=setTimeout(()=>{u(a)},300)}})(),u=e=>{const a=void 0!==e?e:n.value;i("search",a)},p=()=>{c(n.value)},m=()=>{n.value="",u("")};return(a,t)=>{const l=e;return s(),o("div",d,[r(l,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),placeholder:"请输入搜索关键词",onSearch:u,onClear:m,onInput:p},null,8,["modelValue"])])}}}),[["__scopeId","data-v-913efe76"]]),g={class:"empty-section"},f=p(a({__name:"EmptySection",props:{empty:{type:Boolean,default:!0}},setup:e=>(e,a)=>{const t=m;return s(),o("div",g,[l(e.$slots,"empty",i(n({empty:!0})),()=>[r(t,{description:"暂无数据"})],!0)])}}),[["__scopeId","data-v-ed806e0f"]]),y=["page","size","sort"];function h(e){const a=t([]),s=t(0),o=t(0),r=t(0),l=t(!1),i=t(!1),n=t(!0),p=c(()=>!l.value&&0===a.value.length),m=c(()=>0===s.value&&0===a.value.length),d=()=>e.api||e.service?(e.api&&e.service&&console.warn("组件同时传入了api和service属性，将优先使用service"),!0):(console.warn("组件必须传入api或service属性之一"),!1),v=(a=0)=>{const{pageableParams:t,queryParams:s}=((e={})=>{const a={},t={};return Object.entries(e).forEach(([e,s])=>{y.includes(e)?a[e]=s:t[e]=s}),{pageableParams:a,queryParams:t}})(e.params),o={size:e.pageSize||10,...t,...e.pageableParams,page:a,pageNumber:a};s.page=a;const r={pageableParams:o,queryParams:s};return console.error("buildRequestParams=============",r),r},g=async(a=0)=>{const{pageableParams:t,queryParams:s}=v(a);if(e.service&&"function"==typeof e.service.listByPage)return await e.service.listByPage(s,t);if(e.api)return await e.api(s,t);throw new Error("组件没有可用的请求方法")},f=async(t=0,c=!1)=>{if(!(l.value||c&&i.value)&&(!c||n.value)){if(!d())return l.value=!1,void(i.value=!1);try{c?i.value=!0:l.value=!0;const u=await g(t);if(0===t)a.value=u.content||[];else{const t=new Set(a.value.map(a=>a.id||a[e.itemKey||"id"])),s=(u.content||[]).filter(a=>{const s=a.id||a[e.itemKey||"id"];return!t.has(s)});a.value=[...a.value,...s],s.length!==(u.content||[]).length&&console.warn("检测到重复数据，已过滤重复项")}const p=u.pageable||{};s.value=p.pageNumber||0,o.value=u.total||0;const m=p.pageSize||e.pageSize||10;r.value=m>0?Math.ceil(o.value/m):0,n.value=!u.last}catch(u){console.error("加载数据失败:",u)}finally{l.value=!1,i.value=!1}}};return u(()=>e.params,()=>{!1!==e.autoLoad&&f(0)},{deep:!0}),u(()=>e.pageSize,()=>{!1!==e.autoLoad&&f(0)}),!1!==e.autoLoad&&f(0),{dataList:a,currentPage:s,totalElements:o,totalPages:r,loading:l,loadingMore:i,hasMore:n,isEmpty:p,isFirstLoad:m,loadData:f,onRefresh:async()=>{l.value=!0;try{console.error("刷新数据=============",l.value),await f(0),l.value=!1}catch(e){console.error("刷新数据失败:",e),l.value=!1}},validateProps:d,buildRequestParams:v,handleRequest:g}}const b={selectable:!1,deletable:!1,searchable:!1,pageSize:10,itemKey:"id",itemTitleField:"name",itemDescriptionField:"description",showBorderBottom:!0,borderBottomLeftOffset:0,showNoMoreData:!1,themeMode:"auto",minSize:92,itemGap:0,fixed:!0,buffer:5,bufferTop:void 0,bufferBottom:void 0,horizontal:!1,scrollDistance:200,fixSelection:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",renderControl:void 0,columns:2,gap:16,categoryKey:"id",categoryNameField:"name",categoryCountField:"count",selectionMode:"single",tabsSticky:!0,tabsSwipeable:!0,topSpacing:"6px",leftSpacing:"8px",rightSpacing:"8px"};export{b as D,f as E,v as S,h as u};
