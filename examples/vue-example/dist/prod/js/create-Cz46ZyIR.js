import{S as e}from"./sdkwork-page-container-BVbK78Br.js";import{k as a,f as t,r as o,w as l,P as s,Q as i,S as n,W as r,Z as d,j as c,$ as u,a1 as m,a0 as p,a4 as g,R as h,V as v,c as f,O as b}from"./vue-vendor-CnVaDBlt.js";import{B as k,I as w,s as y,a as x,_ as C,u as V}from"./index-Cw3XK0oB.js";/* empty css              */import{_,a as j}from"./sdkwork-collapse-item-CktAz265.js";import{_ as M}from"./sdkwork-popup-b7tk1-iO.js";/* empty css              */import"./index-CAnTQw1a.js";import{P as z}from"./index-CKwXjlP8.js";import{S as B}from"./index-DI4DTgT-.js";import{_ as I,a as A}from"./sdkwork-cell-group-BgxCus64.js";/* empty css              *//* empty css              */import{U,S as F}from"./sdkwork-voice-speaker-category-list-popup-l5cFvsNm.js";import{I as P}from"./index-BA8-zepc.js";import{A as T}from"./agent-DAythx91.js";import{F as $}from"./index-PsbbfXyr.js";import"./utils-vendor-WEzSe-CR.js";import"./index-Dk8mYG49.js";import"./sdkwork-icon-5GoI5WlJ.js";import"./LoadMoreSection-DjKjEQ1w.js";import"./index-DB8XvqDx.js";import"./use-id-CkVbEcjv.js";import"./shared-Bto_oBGe.js";import"./sdkwork-search-bar-DHa8hmn8.js";import"./ListItem-B4uOKkVc.js";import"./LoadingSection-C5PnJ-P1.js";const H={class:"sdkwork-avatar"},S={key:0,class:"upload-overlay"},q={class:"progress-text"},G={class:"placeholder-text"},L={key:3,class:"avatar-actions"},O=C(a({__name:"sdkwork-avatar",props:{modelValue:{},src:{},size:{default:"40px"},uploadable:{type:Boolean,default:!0},showAiGenerate:{type:Boolean,default:!1},round:{type:Boolean,default:!0},text:{default:""},background:{default:"#f5f5f5"},disabled:{type:Boolean,default:!1},showClear:{type:Boolean,default:!1},uploadConfig:{}},emits:["update:modelValue","upload","upload-start","upload-progress","upload-complete","upload-error","aiGenerate","click","clear"],setup(e,{emit:a}){const f=e,b=a,C=t({get:()=>f.modelValue||f.src,set:e=>b("update:modelValue",e||"")}),V=o(!1),_=o(0),j=o(null),M=o(null),z=async e=>{let a;if(e instanceof File)a=e;else if(e.file instanceof File)a=e.file;else{if(!e||!e.file)return y("无效的文件格式"),!1;a=(Array.isArray(e)?e[0]:e).file}if(!a?.type?.startsWith("image/"))return y("请上传图片文件"),!1;if(a?.size>5242880)return y("图片大小不能超过5MB"),!1;const t=new FileReader;return t.onload=e=>{const a=e.target?.result;C.value=a},t.readAsDataURL(a),b("upload",a),await B(a),!0},B=async e=>{if(window.$uploader)try{V.value=!0,_.value=0,b("upload-start",e);const a=f.uploadConfig||{},t={file:e,bucket:a.bucket||{name:"public"},name:e.name,scene:"avatar",metadata:a.metadata||{},contentType:a.contentType||e.type,acl:a.acl||"public-read"},o=await window.$uploader.upload(t,e=>{_.value=e.percentage,b("upload-progress",e)});o.url&&o.url.startsWith("http")?(C.value=o.url,y("头像上传成功"),b("upload-complete",o)):y("头像上传完成，但URL无效")}catch(a){y("头像上传失败，请重试"),b("upload-error",a)}finally{V.value=!1,_.value=0}else y("上传器未初始化")},I=()=>{j.value&&window.$uploader&&(window.$uploader.cancel(j.value),V.value=!1,_.value=0,j.value=null,y("上传已取消"))},A=()=>{x({title:"AI生成头像",message:"确定要使用AI生成头像吗？",showCancelButton:!0,confirmButtonText:"生成",cancelButtonText:"取消"}).then(()=>{b("aiGenerate"),y("正在生成头像...")})},F=()=>{!f.disabled&&C.value&&x({title:"清空头像",message:"确定要清空当前头像吗？",showCancelButton:!0,confirmButtonText:"清空",cancelButtonText:"取消"}).then(()=>{C.value="",y("头像已清空"),b("clear")})},T=()=>{f.disabled||!f.uploadable||V.value||setTimeout(()=>{if(M.value)M.value.chooseFile();else{const e=document.querySelector('.upload-btn input[type="file"]');e&&e.click()}},10),b("click")},$=t(()=>({width:"number"==typeof f.size?`${f.size}px`:f.size,height:"number"==typeof f.size?`${f.size}px`:f.size,backgroundColor:f.background}));return l(()=>f.src,e=>{f.modelValue||(C.value=e)}),l(()=>f.modelValue,e=>{C.value=e}),(a,t)=>{const o=k,l=w,f=P,b=U;return i(),s("div",H,[n("div",{class:"avatar-container",onClick:T},[V.value?(i(),s("div",S,[t[3]||(t[3]=n("div",{class:"loading-spinner"},null,-1)),n("div",q,u(_.value)+"%",1),c(o,{type:"danger",onClick:m(I,["stop"]),class:"cancel-btn"},{default:p(()=>[...t[2]||(t[2]=[g(" 取消 ",-1)])]),_:1})])):r("",!0),C.value?(i(),d(f,{key:1,src:C.value,width:e.size,height:e.size,fit:"cover",class:h([{disabled:e.disabled,square:!e.round,uploading:V.value},"avatar-image"])},{extra:p(()=>[e.showClear&&!V.value?(i(),s("div",{key:0,class:"clear-btn",onClick:m(F,["stop"])},[c(l,{name:"cross",size:"12",color:"#fff"})])):r("",!0)]),_:1},8,["src","width","height","class"])):(i(),s("div",{key:2,class:h(["avatar-placeholder",{square:!e.round,uploading:V.value}]),style:v($.value)},[n("span",G,u(e.text),1)],6)),!e.uploadable&&!e.showAiGenerate||V.value?r("",!0):(i(),s("div",L,[e.uploadable?(i(),d(b,{key:0,disabled:e.disabled,"after-read":z,"max-count":1,"preview-image":!1,"show-upload":!1,accept:"image/*",class:"upload-btn",ref_key:"uploaderRef",ref:M,onClick:t[1]||(t[1]=m(()=>{},["stop"]))},{default:p(()=>[c(o,{type:"primary",disabled:e.disabled,class:"action-btn",onClick:t[0]||(t[0]=m(()=>{},["stop"]))},{default:p(()=>[...t[4]||(t[4]=[g(" 上传 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):r("",!0),e.showAiGenerate?(i(),d(o,{key:1,type:"success",disabled:e.disabled,onClick:A,class:"action-btn ai-generate-btn"},{default:p(()=>[...t[5]||(t[5]=[g(" AI生成 ",-1)])]),_:1},8,["disabled"])):r("",!0)]))])])}}}),[["__scopeId","data-v-78cbf5e7"]]),R={class:"header-section"},D={class:"avatar-container"},W={class:"name-field-wrapper"},K={class:"char-count-bottom"},N={class:"prompt-field-wrapper"},Q={class:"char-count-bottom"},Z={class:"char-count"},E={class:"voice-selector"},J={key:0,class:"selected-voice"},X={key:1,class:"placeholder"},Y={class:"description-field-wrapper"},ee={class:"char-count-bottom"},ae={class:"welcome-field-wrapper"},te={class:"char-count-bottom"},oe={class:"char-count"},le={class:"permission-value"},se={class:"bottom-action-bar"},ie=C(a({__name:"sdkwork-agent-create",props:{themeMode:{default:"auto"}},emits:["agent-created","agent-canceled"],setup(e,{expose:a,emit:l}){const m=e,v=t(()=>"dark"===m.themeMode||"light"!==m.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),b=t(()=>v.value?"sdkwork-agent-create--dark":"sdkwork-agent-create--light"),x=o(!1),C=o(!1),V=o(!1),U=o([]),P=o(""),H=o(""),S=o(["view"]),q=new T,G=[{text:"查看",value:"view"},{text:"交互",value:"interact"},{text:"分享",value:"share"}],L=o(""),ie=f({name:"",description:"",isPublic:!1,permissions:[],prompt:{content:""},greeting:"",baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),ne=t(()=>ie.name.trim()&&ie.name.length<=20&&ie.description.length<=200),re=()=>{ie.name.trim()?ie.name.length>20?P.value="名称不能超过20个字符":P.value="":P.value="名称不能为空"},de=e=>{ie.faceImage={url:L.value,type:1,size:e.size},y("头像上传成功")},ce=()=>{},ue=e=>{const a={id:e.id?.toString(),displayName:e.name,description:e.description,provider:"default",product:"default",model:"default",voice:e.name};ie.speechConfig={speakerConfig:{speaker:a}},C.value=!1,y(`已选择: ${e.name}`)},me=e=>{if(!e||0===e.length)return"";const a=G.find(a=>a.value===e[0]);return a?a.text:""},pe=e=>{let a;a=Array.isArray(e)?e[0]:e&&"object"==typeof e?e:{text:e,value:e},ie.permissions=a.value||a,V.value=!1,y(`已选择: ${a.text||a}`)},ge=async()=>{if(re(),!P.value&&ie.name.trim()){x.value=!0;try{L.value&&!ie.faceImage&&(ie.faceImage={url:L.value,type:1,size:0});const e={name:ie.name,description:ie.description,faceImage:ie.faceImage,faceVideo:ie.faceVideo,icon:ie.icon,tags:ie.tags,prompt:ie.prompt,greeting:ie.greeting,speechConfig:ie.speechConfig,isPublic:ie.isPublic,permissions:ie.permissions,baseConfig:ie.baseConfig,type:ie.type,status:ie.status,knowledgeConfig:ie.knowledgeConfig,memoryConfig:ie.memoryConfig,toolConfig:ie.toolConfig,chatOptions:ie.chatOptions};q.create(e),y("智能体创建成功")}catch(e){y("创建失败，请重试")}finally{x.value=!1}}else y("请完善基本信息")};return a({resetForm:()=>{L.value="",Object.assign(ie,{name:"",description:"",faceImage:void 0,faceVideo:void 0,icon:void 0,tags:void 0,prompt:{content:""},greeting:"",speechConfig:void 0,isPublic:!1,permissions:[],baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),U.value=[]},getFormData:()=>ie,setFormData:e=>{Object.assign(ie,e)}}),(a,t)=>{const o=$,l=I,m=w,v=A,f=B,y=z,T=M,q=_,he=j,ve=k;return i(),s("div",{class:h(["agent-create",b.value])},[n("div",R,[n("div",D,[c(O,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=e=>L.value=e),size:80,uploadable:!0,"show-ai-generate":!1,round:!0,text:"头像","theme-mode":e.themeMode,onUpload:de,onClick:ce,class:"avatar-uploader"},null,8,["modelValue","theme-mode"])]),c(l,{class:"name-section","theme-mode":e.themeMode},{default:p(()=>[n("div",W,[c(o,{modelValue:ie.name,"onUpdate:modelValue":t[1]||(t[1]=e=>ie.name=e),placeholder:"请输入智能体名称",maxlength:20,"error-message":P.value,size:"large",onBlur:re,center:""},null,8,["modelValue","error-message"]),n("div",K,[n("span",{class:h(["char-count",{error:ie.name.length>20}])},u(ie.name.length)+"/20 ",3)])])]),_:1},8,["theme-mode"])]),c(l,{class:"basic-info-section","theme-mode":e.themeMode},{default:p(()=>[n("div",N,[c(o,{modelValue:ie.prompt.content,"onUpdate:modelValue":t[2]||(t[2]=e=>ie.prompt.content=e),label:"提示词","label-align":"top",type:"textarea",placeholder:"请输入角色提示词",autosize:{minHeight:100,maxHeight:200},maxlength:1e3},null,8,["modelValue"]),n("div",Q,[n("span",Z,u(ie.prompt.content?.length||0)+"/1000 ",1)])])]),_:1},8,["theme-mode"]),c(l,{class:"voice-section","theme-mode":e.themeMode},{default:p(()=>[c(v,{title:"发音人",center:"","is-link":"",onClick:t[3]||(t[3]=e=>C.value=!0),"theme-mode":e.themeMode},{value:p(()=>[n("div",E,[c(m,{name:"music",class:"voice-icon"}),ie.speechConfig?.speakerConfig?.speaker?(i(),s("span",J,u(ie.speechConfig.speakerConfig.speaker.displayName),1)):(i(),s("span",X,"请选择发音人"))])]),_:1},8,["theme-mode"]),n("div",Y,[c(o,{modelValue:ie.description,"onUpdate:modelValue":t[4]||(t[4]=e=>ie.description=e),label:"描述","label-align":"top",type:"textarea",placeholder:"请输入智能体描述",maxlength:200,autosize:{minHeight:80,maxHeight:120},"error-message":H.value},null,8,["modelValue","error-message"]),n("div",ee,[n("span",{class:h(["char-count",{error:ie.description.length>200}])},u(ie.description.length)+"/200 ",3)])])]),_:1},8,["theme-mode"]),c(he,{modelValue:U.value,"onUpdate:modelValue":t[11]||(t[11]=e=>U.value=e),class:"other-settings-section","theme-mode":e.themeMode},{default:p(()=>[c(q,{title:"其他设置",name:"other","theme-mode":e.themeMode},{default:p(()=>[n("div",ae,[c(o,{modelValue:ie.baseConfig.welcome,"onUpdate:modelValue":t[5]||(t[5]=e=>ie.baseConfig.welcome=e),label:"默认开场白","label-align":"top",type:"textarea",placeholder:"请输入默认开场白",autosize:{minHeight:80,maxHeight:120},maxlength:500},null,8,["modelValue"]),n("div",te,[n("span",oe,u(ie.baseConfig?.welcome?.length||0)+"/500 ",1)])]),c(l,{"theme-mode":e.themeMode},{default:p(()=>[c(v,{title:"公开智能体",center:"","theme-mode":e.themeMode},{value:p(()=>[c(f,{modelValue:ie.isPublic,"onUpdate:modelValue":t[6]||(t[6]=e=>ie.isPublic=e),size:"20"},null,8,["modelValue"])]),_:1},8,["theme-mode"]),ie.isPublic?(i(),d(v,{key:0,title:"权限设置",center:"","is-link":"",onClick:t[7]||(t[7]=e=>V.value=!0),"theme-mode":e.themeMode},{value:p(()=>[n("span",le,u(me(ie.permissions)||"请选择权限"),1)]),_:1},8,["theme-mode"])):r("",!0),c(T,{show:V.value,"onUpdate:show":t[10]||(t[10]=e=>V.value=e),position:"bottom",round:"","theme-mode":e.themeMode},{default:p(()=>[c(y,{columns:G,modelValue:S.value,"onUpdate:modelValue":t[8]||(t[8]=e=>S.value=e),onConfirm:pe,onCancel:t[9]||(t[9]=e=>V.value=!1),title:"选择权限"},null,8,["modelValue"])]),_:1},8,["show","theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["modelValue","theme-mode"]),n("div",se,[c(ve,{type:"primary",size:"large",block:"",loading:x.value,disabled:!ne.value,onClick:ge,class:"create-button"},{default:p(()=>[...t[14]||(t[14]=[g(" 创建智能体 ",-1)])]),_:1},8,["loading","disabled"])]),c(F,{modelValue:C.value,"onUpdate:modelValue":t[12]||(t[12]=e=>C.value=e),title:"选择发音人",height:"100dvh","selected-speaker-id":ie.speechConfig?.speakerConfig?.speaker?.id,"theme-mode":e.themeMode,onConfirm:ue,onClose:t[13]||(t[13]=e=>C.value=!1)},null,8,["modelValue","selected-speaker-id","theme-mode"])],2)}}}),[["__scopeId","data-v-8b63d9a9"]]),ne=C(a({__name:"create",setup(a){const l=b(),{t:s}=V(),n=o("auto");t(()=>"dark"===n.value||"light"!==n.value&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches));const r=e=>{y({message:s("agent.create.successMessage"),type:"success",duration:2e3}),setTimeout(()=>{l.push("/agent/list")},2e3)},u=()=>{y({message:s("agent.create.cancelMessage"),type:"fail",duration:1500}),setTimeout(()=>{l.back()},1500)};return(a,t)=>{const o=e;return i(),d(o,{class:"agent-create-page"},{default:p(()=>[c(ie,{onAgentCreated:r,onAgentCanceled:u,"theme-mode":n.value,class:"agent-create-component"},null,8,["theme-mode"])]),_:1})}}}),[["__scopeId","data-v-90027282"]]);export{ne as default};
