import{S as e}from"./sdkwork-page-container-5d58390b.js";import{s as a,B as l,_ as s,c as i}from"./index-5affcab4.js";import{E as t}from"./index-ccee2c65.js";/* empty css              */import{T as o}from"./index-7bca35b2.js";import{P as n}from"./index-6e9d45f0.js";import{C as r}from"./index-b4fa6a2d.js";/* empty css              *//* empty css              */import{k as d,am as u,an as c,r as v,w as m,c as p,Q as g,Z as f,a0 as h,S as w,j as y,a4 as k,U as b,$ as x,R as _,F as j,Y as P,a1 as S,u as C,b as V,o as U,X as z,n as I}from"./vue-vendor-a2672387.js";/* empty css              *//* empty css              */import{I as $}from"./index-5d6825eb.js";import{_ as D}from"./sdkwork-popup-6e1ec418.js";import{_ as A}from"./sdkwork-speech-to-text-a8f4b58c.js";import{S as M}from"./sdkwork-api-list-2f474514.js";import{D as F,a as N}from"./index-89208972.js";/* empty css              */import{S as L}from"./index-6f177f7f.js";import{_ as T}from"./sdkwork-uploader-image-ad8090cd.js";import{F as R}from"./index-dee6a080.js";import{T as E,a as O,S as B}from"./index-a1493906.js";import{I as J}from"./index-4fcf5799.js";import{S as K}from"./sdkwork-video-player-5c70329d.js";import{P as q}from"./index-6a5403e8.js";import{s as Q}from"./sdkwork-icon-2d6efb98.js";import{u as G}from"./generation-15185035.js";import{C as X}from"./index-44056be1.js";import"./utils-vendor-b5712723.js";import"./use-id-82312033.js";import"./ImagePreview-084463df.js";import"./index-63936d32.js";import"./sdkwork-cell-group-c8f6555d.js";import"./index-8ec8972f.js";/* empty css              */import"./index-b13738ef.js";import"./Checker-704ef18a.js";import"./index-e159e7ef.js";import"./index-56f0d1d3.js";import"./use-tab-status-aca7131d.js";import"./shared-1cf0c357.js";import"./sdkwork-search-bar-4d747e22.js";import"./ListItem-783a2127.js";import"./use-refs-ac90b301.js";import"./video-1a038f9a.js";const Z={class:"popup-content"},H={class:"section"},W={class:"prompt"},Y={class:"section frames"},ee={class:"frame"},ae={class:"frame"},le={class:"section"},se={class:"library-header"},ie={class:"library-filter"},te={class:"library-item"},oe={class:"library-item-image"},ne={class:"library-item-overlay"},re={class:"library-item-info"},de={class:"name"},ue={class:"meta"},ce={class:"size"},ve={key:0,class:"preview"},me={class:"preview-header"},pe={class:"preview-grid"},ge={class:"preview-item-wrapper"},fe={class:"preview-item-overlay"},he={class:"preview-item-info"},we={class:"title"},ye={class:"actions"},ke=s(d({name:"video-scene-image-popup",__name:"video-scene-image-popup",props:u({images:{}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:u(["save"],["update:show"]),setup(e,{emit:s}){const i=e,t=s,n=c(e,"show"),r=v("image2video"),d=v([]),u=v(""),S=v([]),C=v([]),V=v(!1);m(n,e=>{e||setTimeout(()=>{d.value=[],u.value="",S.value=[],C.value=[],r.value="image2video"},300)});const U=async(e,a)=>{await new Promise(e=>setTimeout(e,500));const l=e?.page||0,s=a?.pageSize||10,i=l*s,t=Array.from({length:s}).map((e,a)=>{const l=i+a+1,s=100+l;return{id:`lib-${l}`,name:`ç´ æ-${l}`,fileName:`material-${s}.jpg`,url:`https://picsum.photos/id/${s}/800/450`,previewUrl:`https://picsum.photos/id/${s}/200/150`,type:["product","reference"][Math.floor(2*Math.random())],size:Math.floor(5e5*Math.random())+1e5,width:800,height:450}});return{content:t,pageable:{pageNumber:l,pageSize:s},last:l>=2,total:30,empty:0===t.length,first:0===l}},z=p(()=>{const e=[];return"frames"===r.value?(S.value[0]&&e.push({id:"start-"+S.value[0].name,url:URL.createObjectURL(S.value[0]),type:"startFrame"}),C.value[0]&&e.push({id:"end-"+C.value[0].name,url:URL.createObjectURL(C.value[0]),type:"endFrame"})):"image2video"===r.value?d.value.forEach(a=>e.push({id:"u-"+a.name,url:URL.createObjectURL(a),type:"reference"})):e.push(...i.images||[]),e}),I=()=>{if(V.value)return;if("frames"===r.value){if(!S.value.length||!C.value.length)return void a("è¯·ä¸Šä¼ é¦–å¸§å’Œå°¾å¸§å›¾ç‰‡")}else if("image2video"===r.value&&!d.value.length)return void a("è¯·ä¸Šä¼ è‡³å°‘ä¸€å¼ å‚è€ƒå›¾ç‰‡");V.value=!0;const e=[...z.value];t("save",e),$(),V.value=!1},$=()=>{n.value=!1},A=()=>{d.value=[],S.value=[],C.value=[],a("å·²æ¸…ç©ºæ‰€æœ‰å›¾ç‰‡")},B=v(""),K=v(""),q=[{text:"å…¨éƒ¨",value:""},{text:"å•†å“å›¾",value:"product"},{text:"å‚è€ƒå›¾",value:"reference"}],Q=()=>{a("æœç´¢åŠŸèƒ½å¼€å‘ä¸­")},G=e=>{if(V.value)return;const l={id:e.id||e.fileId||String(Math.random()),url:e.url||e.previewUrl,type:e.type||"reference",title:e.name||e.fileName,width:e.width,height:e.height,size:e.size};if(i.images.some(e=>e.id===l.id))return void a("è¯¥å›¾ç‰‡å·²æ·»åŠ ");V.value=!0;const s=[...i.images||[],l];t("save",s),a("å›¾ç‰‡å·²æ·»åŠ "),V.value=!1};return(e,a)=>{const s=T,t=R,c=E,v=L,m=F,p=N,X=J,ke=l,be=o,xe=M,_e=O,je=D;return g(),f(je,{show:n.value,"onUpdate:show":a[7]||(a[7]=e=>n.value=e),position:"bottom",round:"",class:"image-popup"},{default:h(()=>[w("div",Z,[y(_e,{active:r.value,"onUpdate:active":a[6]||(a[6]=e=>r.value=e)},{default:h(()=>[y(c,{title:"å›¾ç”Ÿè§†é¢‘",name:"image2video"},{default:h(()=>[w("div",H,[a[8]||(a[8]=w("div",{class:"section-header"},[w("div",{class:"title"},"ä¸Šä¼ å‚è€ƒå›¾ç‰‡"),w("div",{class:"tips"},"æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œæœ€å¤§10MBï¼Œæœ€å¤š10å¼ ")],-1)),y(s,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),"max-size":10485760,multiple:!0,"max-count":10},null,8,["modelValue"]),w("div",W,[y(t,{modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e),type:"textarea",rows:"3",maxlength:"500","show-word-limit":"",placeholder:"è¯·è¾“å…¥è§†é¢‘ç”Ÿæˆæè¿°"},null,8,["modelValue"])])])]),_:1}),y(c,{title:"é¦–å°¾å¸§è§†é¢‘",name:"frames"},{default:h(()=>[w("div",Y,[w("div",ee,[a[9]||(a[9]=w("div",{class:"label"},"é¦–å¸§",-1)),y(s,{modelValue:S.value,"onUpdate:modelValue":a[2]||(a[2]=e=>S.value=e),"max-size":10485760,"max-count":1},null,8,["modelValue"])]),w("div",ae,[a[10]||(a[10]=w("div",{class:"label"},"å°¾å¸§",-1)),y(s,{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=e=>C.value=e),"max-size":10485760,"max-count":1},null,8,["modelValue"])])])]),_:1}),y(c,{title:"ä½œå“åº“",name:"library"},{default:h(()=>[w("div",le,[w("div",se,[y(v,{modelValue:B.value,"onUpdate:modelValue":a[4]||(a[4]=e=>B.value=e),placeholder:"æœç´¢ç´ æ",onSearch:Q,onClear:Q},null,8,["modelValue"])]),w("div",ie,[y(p,null,{default:h(()=>[y(m,{modelValue:K.value,"onUpdate:modelValue":a[5]||(a[5]=e=>K.value=e),options:q,title:"å›¾ç‰‡ç±»å‹"},null,8,["modelValue"])]),_:1})]),y(xe,{api:U,"page-size":10,selectable:!0,onSelect:G},{default:h(({item:e})=>{return[w("div",te,[w("div",oe,[y(X,{src:e.url||e.previewUrl,fit:"cover",width:"100%",height:"100"},null,8,["src"]),w("div",ne,[i.images.some(a=>a.id===e.id)?(g(),f(ke,{key:0,size:"mini",type:"success",icon:"success",disabled:""},{default:h(()=>[...a[11]||(a[11]=[k(" å·²æ·»åŠ  ",-1)])]),_:1})):b("",!0)])]),w("div",re,[w("div",de,x(e.name||e.fileName),1),w("div",ue,[y(be,{type:"product"===e.type?"primary":"default"},{default:h(()=>[k(x("product"===e.type?"å•†å“å›¾":"å‚è€ƒå›¾"),1)]),_:2},1032,["type"]),w("span",ce,x((l=e.size,l?l<1048576?`${(l/1024).toFixed(1)}KB`:`${(l/1048576).toFixed(1)}MB`:"æœªçŸ¥å¤§å°")),1)])])])];var l}),_:1})])]),_:1})]),_:1},8,["active"]),z.value.length>0?(g(),_("div",ve,[w("div",me,[w("span",null,"å·²é€‰æ‹©å›¾ç‰‡ ("+x(z.value.length)+")",1),y(ke,{size:"mini",type:"danger",plain:"",onClick:A},{default:h(()=>[...a[12]||(a[12]=[k("æ¸…ç©º",-1)])]),_:1})]),w("div",pe,[(g(!0),_(j,null,P(z.value,(e,a)=>(g(),_("div",{key:e.id,class:"preview-item"},[w("div",ge,[y(X,{src:e.url,fit:"cover",width:"100%",height:"100"},null,8,["src"]),w("div",fe,[y(ke,{size:"mini",type:"danger",icon:"cross",onClick:e=>(e=>{"image2video"===r.value?d.value.splice(e,1):"frames"===r.value&&(0===e&&S.value.length>0?S.value=[]:1===e&&C.value.length>0&&(C.value=[]))})(a)},null,8,["onClick"])])]),w("div",he,[y(be,{type:"success"},{default:h(()=>{return[k(x((a=e.type,{startFrame:"é¦–å¸§",endFrame:"å°¾å¸§",product:"å•†å“å›¾",reference:"å‚è€ƒå›¾"}[a]||a)),1)];var a}),_:2},1024),w("span",we,x(e.title||`å›¾ç‰‡${a+1}`),1)])]))),128))])])):b("",!0),w("div",ye,[y(ke,{type:"primary",loading:V.value,onClick:I},{default:h(()=>[...a[13]||(a[13]=[k("ä¿å­˜åˆ°åˆ†é•œé¡¹",-1)])]),_:1},8,["loading"]),y(ke,{type:"default",onClick:$},{default:h(()=>[...a[14]||(a[14]=[k("å–æ¶ˆ",-1)])]),_:1})])])]),_:1},8,["show"])}}}),[["__scopeId","data-v-b130c4fa"]]),be={class:"video-scene-item"},xe={class:"item-header"},_e={class:"scene-number"},je={key:0,class:"scene-status"},Pe={key:0,class:"images-section"},Se={class:"images-grid"},Ce=["onClick"],Ve={class:"image-meta"},Ue={class:"image-type"},ze={class:"title"},Ie=["disabled"],$e={class:"content-section"},De={class:"field video-prompt"},Ae={class:"tools"},Me={class:"field script-field"},Fe={class:"field-label"},Ne={class:"tools"},Le={class:"action-buttons"},Te={class:"action-section"},Re={class:"main-actions"},Ee={key:0,class:"progress-container"},Oe={class:"progress-text"},Be={key:1,class:"video-preview"},Je={class:"video-actions"},Ke=s(d({name:"video-scene-item",__name:"sdkwork-video-scene-item",props:{scene:{},isProcessing:{type:Boolean}},emits:["update:scene","delete"],setup(e,{emit:s}){const i=e,t=s,o=v(i.scene.videoDescription||""),n=v(i.scene.script||""),r=v("zh-CN"),d=[{text:"ä¸­æ–‡",value:"zh-CN"},{text:"è‹±è¯­",value:"en-US"},{text:"æ—¥è¯­",value:"ja-JP"},{text:"éŸ©è¯­",value:"ko-KR"},{text:"æ³•è¯­",value:"fr-FR"},{text:"å¾·è¯­",value:"de-DE"},{text:"è¥¿ç­ç‰™è¯­",value:"es-ES"}],u=v(i.scene.images||[]),c=v(!1),V=v(!1),U=v(!1),z=v(!1),I=v(!1),M=v(!1),L=v(0),T=v(!1),E=G();let O=null;m([o,n,u],()=>{const e={...i.scene,videoDescription:o.value,script:n.value,images:u.value,updatedAt:new Date};var a;a=e,O&&clearTimeout(O),O=window.setTimeout(()=>{t("update:scene",a),O=null},300)});const B=e=>{u.value=e},X=e=>{n.value=e.slice(0,300),V.value=!1},Z=p(()=>i.scene.videoProgress||0),H=p(()=>(o.value?.trim()?.length||0)>0||u.value.length>0),W=p(()=>{const e=i.scene.videoStatus;return"completed"===e?"å·²å®Œæˆ":"generating"===e?"ç”Ÿæˆä¸­":"failed"===e?"ç”Ÿæˆå¤±è´¥":"å¾…ç”Ÿæˆ"});p(()=>{const e=i.scene.videoStatus;return"completed"===e?"success":"generating"===e?"primary":"failed"===e?"danger":"default"});const Y=async()=>{if(I.value||i.isProcessing)return;if(!H.value)return void a("è¯·å…ˆå¡«å†™æè¿°æˆ–æ·»åŠ å›¾ç‰‡");I.value=!0,M.value=!0;const e={...i.scene,videoStatus:"generating",videoProgress:0,updatedAt:new Date};t("update:scene",e);try{const l=o.value||"æ ¹æ®åˆ†é•œå›¾ç‰‡å’Œå°è¯ç”Ÿæˆè§†é¢‘",s=setInterval(()=>{const a=e.videoProgress||0;if(a<90){const l={...e,videoProgress:Math.min(a+15*Math.random(),90),updatedAt:new Date};t("update:scene",l)}},1e3),n=await E.generateVideo({prompt:l,width:1280,height:720,n:1,responseFormat:"url"});clearInterval(s);const r=n?.videos?.videos?.[0]?.url||"",d={...i.scene,video:r,videoStatus:"completed",videoProgress:100,updatedAt:new Date};t("update:scene",d),a("åˆ†é•œè§†é¢‘ç”Ÿæˆå®Œæˆ")}catch(l){const e={...i.scene,videoStatus:"failed",videoProgress:0,updatedAt:new Date};t("update:scene",e),a("ç”Ÿæˆå¤±è´¥")}finally{I.value=!1,M.value=!1}},ee=async()=>{if(!U.value&&!i.isProcessing){U.value=!0;try{const e=u.value.length>0?`å‚è€ƒå›¾ç‰‡æ•°é‡${u.value.length}ï¼Œç±»å‹${[...new Set(u.value.map(e=>e.type))].join("/")}`:"æ— å‚è€ƒå›¾ç‰‡",l=n.value?`å£æ’­å…³é”®è¯ï¼š${n.value.slice(0,30)}`:"æ— å£æ’­å…³é”®è¯",s=[`ã€åˆ†é•œå»ºè®®ã€‘${e}ï¼›${l}ã€‚é•œå¤´ä»¥äº§å“ä¸ºä¸»ä½“ï¼Œé‡‡ç”¨æŸ”å’Œå…‰çº¿ä¸æµ…æ™¯æ·±ï¼Œçªå‡ºè´¨æ„Ÿä¸ç»†èŠ‚ã€‚ç»“å°¾å›åˆ°å“ç‰Œæ ‡è¯†ä¸è¡ŒåŠ¨å·å¬ã€‚`,`ã€åˆ†é•œå»ºè®®ã€‘${e}ï¼›${l}ã€‚ä¸­æ™¯é•œå¤´å±•ç¤ºäº§å“ç»†èŠ‚ï¼Œé…åˆè½»æŸ”çš„èƒŒæ™¯éŸ³ä¹ï¼Œç”»é¢è‰²è°ƒæ¸©æš–è‡ªç„¶ã€‚`,`ã€åˆ†é•œå»ºè®®ã€‘${e}ï¼›${l}ã€‚å…¨æ™¯é•œå¤´å±•ç¤ºäº§å“ä½¿ç”¨åœºæ™¯ï¼Œç‰¹å†™é•œå¤´å¼ºè°ƒäº§å“ä¼˜åŠ¿ï¼Œæµç•…è½¬åœºå¢å¼ºè§‚çœ‹ä½“éªŒã€‚`],i=s[Math.floor(Math.random()*s.length)];o.value=(o.value||i).slice(0,500),a("AIæè¿°å·²ç”Ÿæˆ")}catch(e){console.error("ç”Ÿæˆæè¿°å¤±è´¥:",e),a("ç”Ÿæˆæè¿°å¤±è´¥")}finally{U.value=!1}}},ae=async()=>{if(!z.value&&!i.isProcessing){z.value=!0;try{o.value&&o.value.slice(0,50);const e=[()=>n.value.length>100?n.value.slice(0,80)+"...":n.value,()=>n.value.includes("äº§å“")?n.value.replace(/äº§å“/g,"è¿™æ¬¾é«˜å“è´¨äº§å“"):n.value,()=>n.value.includes("å¤§å®¶å¥½")||n.value.includes("æ„Ÿè°¢")?n.value:`å¤§å®¶å¥½ï¼Œä»Šå¤©ä¸ºå¤§å®¶ä»‹ç»${n.value}ã€‚å¸Œæœ›è¿™æ¬¡åˆ†äº«èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼Œæ„Ÿè°¢æ”¶çœ‹ï¼`],l=(0,e[Math.floor(Math.random()*e.length)])();n.value=l.slice(0,300),a("å°è¯å·²ä¼˜åŒ–")}catch(e){console.error("ä¼˜åŒ–å°è¯å¤±è´¥:",e),a("ä¼˜åŒ–å¤±è´¥")}finally{z.value=!1}}},le=async()=>{try{await navigator.clipboard.writeText(n.value||""),a("å·²å¤åˆ¶å°è¯")}catch{a("å¤åˆ¶å¤±è´¥")}},se=()=>{n.value=""},ie=()=>{i.isProcessing||t("delete",i.scene.id)};return(s,t)=>{const v=J,m=Q,p=l,M=R,E=F,O=N,G=q,te=K,oe=ke,ne=A,re=D,de=$;return g(),_("div",be,[w("div",xe,[w("div",_e,"åˆ†é•œ "+x(e.scene.order),1),e.scene.videoStatus?(g(),_("div",je,x(W.value),1)):b("",!0)]),u.value.length>0||!e.isProcessing?(g(),_("div",Pe,[w("div",Se,[(g(!0),_(j,null,P(u.value,(l,s)=>{return g(),_("div",{key:l.id,class:"image-card",onClick:e=>((e,a)=>{L.value=void 0!==a?a:u.value.findIndex(a=>a.id===e.id),T.value=!0})(l,s)},[y(v,{src:l.url,fit:"cover",width:"100%",height:"130"},null,8,["src"]),w("div",Ve,[w("span",Ue,x((t=l.type,{startFrame:"é¦–å¸§",endFrame:"å°¾å¸§",product:"å•†å“å›¾",reference:"å‚è€ƒå›¾"}[t]||t)),1),w("div",ze,x(l.title||""),1),e.isProcessing||i.isProcessing?b("",!0):(g(),f(p,{key:0,size:"mini",class:"delete-btn",onClick:S(e=>(e=>{const l=u.value.findIndex(a=>a.id===e.id);-1!==l&&(u.value.splice(l,1),a("å›¾ç‰‡å·²åˆ é™¤"))})(l),["stop"])},{default:h(()=>[y(m,{icon:"ri:close-line"})]),_:1},8,["onClick"]))])],8,Ce);var t}),128)),w("div",{class:"image-card add",onClick:t[0]||(t[0]=e=>c.value=!0),disabled:e.isProcessing||i.isProcessing},[y(m,{icon:"ri:add-line"}),t[10]||(t[10]=w("span",null,"æ·»åŠ ç´ æ",-1))],8,Ie)])])):b("",!0),w("div",$e,[w("div",De,[t[12]||(t[12]=w("div",{class:"field-label"},[w("span",{class:"label-text"},"ç”»é¢æè¿°"),w("span",{class:"ai-icon"},"ğŸ¬")],-1)),y(M,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),type:"textarea",rows:"3",maxlength:"500","show-word-limit":"",placeholder:"æè¿°ç”»é¢å†…å®¹ã€é•œå¤´è¿åŠ¨å’Œæ°›å›´...",class:"custom-textarea"},null,8,["modelValue"]),w("div",Ae,[y(p,{size:"small",round:"",loading:U.value,disabled:e.isProcessing||i.isProcessing,onClick:ee,class:"ai-btn"},{default:h(()=>[y(m,{icon:"ri:lightbulb-line"}),t[11]||(t[11]=k(" AIç”Ÿæˆ ",-1))]),_:1},8,["loading","disabled"])])]),w("div",Me,[w("div",Fe,[t[13]||(t[13]=w("span",{class:"label-text"},"å£æ’­å°è¯",-1)),y(O,{class:"lang-selector"},{default:h(()=>[y(E,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r.value=e),options:d},null,8,["modelValue"])]),_:1})]),y(M,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value=e),type:"textarea",rows:"3",maxlength:"300","show-word-limit":"",placeholder:"è¾“å…¥å£æ’­å°è¯å†…å®¹...",class:"custom-textarea"},null,8,["modelValue"]),w("div",Ne,[y(p,{size:"small",round:"",loading:z.value,disabled:e.isProcessing||i.isProcessing,onClick:ae,class:"ai-btn"},{default:h(()=>[y(m,{icon:"ri:lightbulb-line"}),t[14]||(t[14]=k(" ä¼˜åŒ– ",-1))]),_:1},8,["loading","disabled"]),y(p,{size:"small",round:"",onClick:t[4]||(t[4]=e=>V.value=!0),class:"mic-btn"},{default:h(()=>[y(m,{icon:"ri:mic-line"})]),_:1}),w("div",Le,[y(p,{size:"small",round:"",onClick:le,disabled:!n.value},{default:h(()=>[y(m,{icon:"ri:file-text-line",width:16,height:16})]),_:1},8,["disabled"]),y(p,{size:"small",round:"",onClick:se,disabled:!n.value},{default:h(()=>[y(m,{icon:"ri:close-circle-line",width:16,height:16})]),_:1},8,["disabled"])])])])]),w("div",Te,[w("div",Re,[e.scene.video?(g(),f(p,{key:1,class:"regenerate-btn",loading:I.value,disabled:!H.value||e.isProcessing||i.isProcessing,onClick:Y,round:""},{default:h(()=>[y(m,{icon:"ri:refresh-line"}),t[16]||(t[16]=k(" é‡æ–°ç”Ÿæˆ ",-1))]),_:1},8,["loading","disabled"])):(g(),f(p,{key:0,class:"generate-btn",loading:I.value,disabled:!H.value||e.isProcessing||i.isProcessing,onClick:Y,round:""},{default:h(()=>[y(m,{icon:"ri:play-circle-line"}),t[15]||(t[15]=k(" ç”Ÿæˆè§†é¢‘ ",-1))]),_:1},8,["loading","disabled"])),y(p,{class:"delete-btn-main",round:"",plain:"",onClick:ie,disabled:e.isProcessing||i.isProcessing},{default:h(()=>[y(m,{icon:"ri:delete-bin-line"})]),_:1},8,["disabled"])]),I.value||"generating"===e.scene.videoStatus?(g(),_("div",Ee,[t[17]||(t[17]=w("div",{class:"progress-title"},"è§†é¢‘ç”Ÿæˆä¸­",-1)),y(G,{percentage:Z.value,"show-pivot":!1,"stroke-width":"6",color:"#1976d2"},null,8,["percentage"]),w("div",Oe,x(Z.value)+"% å®Œæˆ",1)])):b("",!0),e.scene.video?(g(),_("div",Be,[y(te,{src:e.scene.video},null,8,["src"]),w("div",Je,[y(p,{size:"small",round:"",onClick:t[5]||(t[5]=()=>C(a)("ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­"))},{default:h(()=>[y(m,{icon:"ri:download-line"}),t[18]||(t[18]=k(" ä¸‹è½½ ",-1))]),_:1}),y(p,{size:"small",round:"",plain:"",onClick:t[6]||(t[6]=()=>C(a)("åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­"))},{default:h(()=>[y(m,{icon:"ri:share-line"}),t[19]||(t[19]=k(" åˆ†äº« ",-1))]),_:1})])])):b("",!0)]),y(oe,{show:c.value,"onUpdate:show":t[7]||(t[7]=e=>c.value=e),images:u.value,onSave:B},null,8,["show","images"]),y(re,{show:V.value,"onUpdate:show":t[8]||(t[8]=e=>V.value=e),position:"bottom",round:""},{default:h(()=>[y(ne,{onRecognitionComplete:X})]),_:1},8,["show"]),y(de,{show:T.value,"onUpdate:show":t[9]||(t[9]=e=>T.value=e),images:u.value.map(e=>e.url),"start-position":L.value},{index:h(()=>[k(x(L.value+1)+" / "+x(u.value.length),1)]),_:1},8,["show","images","start-position"])])}}}),[["__scopeId","data-v-9f4dbf01"]]),qe={class:"sdkwork-video-scenes"},Qe={class:"toolbar"},Ge={class:"main-actions"},Xe={class:"stats"},Ze={key:0,class:"tips"},He=["onDragstart"],We="video-scenes-draft",Ye=d({name:"sdkwork-video-scenes",__name:"sdkwork-video-scenes",setup(e){const s=v(function(){try{const e=localStorage.getItem(We);if(!e)return[];const a=JSON.parse(e);return Array.isArray(a)?a:[]}catch(e){return console.error("åŠ è½½è‰ç¨¿å¤±è´¥:",e),[]}}()),d=v(!1);v([]);const u=v(!1),c=v(!1),f=v(null),b=()=>{if(d.value)return;d.value=!0;const e=new Date,a={id:`${Date.now()}-${Math.random().toString(16).slice(2)}`,order:s.value.length+1,videoDescription:"",script:"",duration:5,images:[],createdAt:e,updatedAt:e,videoStatus:"pending",videoProgress:0};s.value.push(a),I(()=>{const e=document.querySelectorAll(".scene-row"),a=e[e.length-1];a?.scrollIntoView({behavior:"smooth",block:"center"}),d.value=!1})},C=async e=>{if(!d.value){try{await i({title:"ç¡®è®¤åˆ é™¤",message:"åˆ é™¤åä¸å¯æ¢å¤ï¼Œç¡®è®¤åˆ é™¤è¯¥åˆ†é•œï¼Ÿ"}),d.value=!0,s.value=s.value.filter(a=>a.id!==e),M(),a("å·²åˆ é™¤åˆ†é•œ")}catch{}d.value=!1}},$=e=>{const a=s.value.findIndex(a=>a.id===e.id);-1!==a&&(s.value[a]={...e,updatedAt:new Date})},D=()=>{f.value=null,u.value=!1},A=e=>{if(null==f.value||!1===u.value)return;const a=e.target.closest(".scene-row");if(!a)return;const l=Array.from(document.querySelectorAll(".scene-row")).indexOf(a);if(l<0||l===f.value)return;const i=[...s.value],[t]=i.splice(f.value,1);i.splice(l,0,t),s.value=i,M(),f.value=null,u.value=!1},M=()=>{s.value=s.value.map((e,a)=>({...e,order:a+1,updatedAt:new Date}))};m(s,()=>{N()},{deep:!0});let F=null;const N=()=>{F&&window.clearTimeout(F),F=window.setTimeout(()=>{try{localStorage.setItem(We,JSON.stringify(s.value))}catch(e){console.error("è‡ªåŠ¨ä¿å­˜å¤±è´¥:",e)}},600)},L=()=>{try{localStorage.setItem(We,JSON.stringify(s.value)),a("è‰ç¨¿å·²ä¿å­˜")}catch(e){console.error("ä¿å­˜è‰ç¨¿å¤±è´¥:",e),a("ä¿å­˜å¤±è´¥")}},T=()=>{L(),c.value=!1},R=()=>{E().finally(()=>{c.value=!1})},E=async()=>{if(0!==s.value.length&&!d.value){try{await i({title:"æ¸…ç©ºå…¨éƒ¨",message:"ç¡®è®¤æ¸…ç©ºå…¨éƒ¨åˆ†é•œï¼Ÿ"}),d.value=!0,s.value=[],N(),a("å·²æ¸…ç©º")}catch{}d.value=!1}};const O=p(()=>s.value.reduce((e,a)=>e+(Number(a.duration)||0),0)),J=e=>{if((e.ctrlKey||e.metaKey)&&"s"===e.key)e.preventDefault(),L()},K=e=>{const a=e.detail?.sceneId,l=s.value.findIndex(e=>e.id===a);-1!==l&&(f.value=l,u.value=!0)};return V(()=>{window.addEventListener("keydown",J),document.addEventListener("dragstart",K)}),U(()=>{window.removeEventListener("keydown",J),document.removeEventListener("dragstart",K),F&&clearTimeout(F)}),(e,a)=>{const i=l,v=X,m=r,p=n,V=o,U=B,I=t;return g(),_("div",qe,[y(U,null,{default:h(()=>[w("div",Qe,[w("div",Ge,[y(i,{type:"primary",size:"small",round:"",loading:d.value,onClick:b},{default:h(()=>[y(Q,{icon:"ri:add-line"}),a[2]||(a[2]=k(" æ–°å¢ ",-1))]),_:1},8,["loading"]),y(p,{show:c.value,"onUpdate:show":a[0]||(a[0]=e=>c.value=e),placement:"bottom-end",offset:[8,8],class:"popover-menu"},{reference:h(()=>[y(i,{size:"small",round:""},{default:h(()=>[y(Q,{icon:"ri:more-2-fill"})]),_:1})]),default:h(()=>[y(m,null,{default:h(()=>[y(v,{title:"ä¿å­˜è‰ç¨¿","is-link":"",onClick:T,disabled:d.value,center:!0},{icon:h(()=>[y(Q,{icon:"ri:save-line"})]),_:1},8,["disabled"]),y(v,{title:"æ¸…ç©ºå…¨éƒ¨","is-link":"",onClick:R,disabled:0===s.value.length||d.value,center:!0},{icon:h(()=>[y(Q,{icon:"ri:delete-bin-line"})]),_:1},8,["disabled"])]),_:1})]),_:1},8,["show"])]),w("div",Xe,[y(V,{type:"primary"},{default:h(()=>[k(x(s.value.length),1)]),_:1}),y(V,{type:"success"},{default:h(()=>[k(x(O.value)+"s",1)]),_:1})])])]),_:1}),0===s.value.length?(g(),_("div",Ze,[y(I,{description:"æš‚æ— åˆ†é•œ"},{default:h(()=>[y(i,{type:"primary",onClick:b},{default:h(()=>[...a[3]||(a[3]=[k("æ–°å¢åˆ†é•œ",-1)])]),_:1})]),_:1})])):(g(),_("div",{key:1,class:"scene-list",onDragover:a[1]||(a[1]=S(()=>{},["prevent"])),onDrop:S(A,["prevent"])},[(g(!0),_(j,null,P(s.value,(e,a)=>(g(),_("div",{key:e.id,class:z(["scene-row",{dragging:a===f.value,"is-dragging":u.value}]),draggable:"true",onDragstart:e=>(e=>{f.value=e,u.value=!0})(a),onDragend:D},[y(Ke,{scene:e,"onUpdate:scene":$,onDelete:C,"is-processing":d.value},null,8,["scene","is-processing"])],42,He))),128))],32))])}}}),ea=s(Ye,[["__scopeId","data-v-e0e692c5"]]),aa=s(d({__name:"scenes",setup:a=>(a,l)=>{const s=e;return g(),f(s,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:h(()=>[y(ea)]),_:1})}}),[["__scopeId","data-v-6ae03602"]]);export{aa as default};
