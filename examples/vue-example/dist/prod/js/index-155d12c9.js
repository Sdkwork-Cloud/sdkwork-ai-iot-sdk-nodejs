import{aa as e,ab as t,J as a,ac as l,ad as r,m as n,o,q as i,r as s,Z as u,a9 as c,$ as d,n as g,X as m,ae as f,Q as p,af as v,z as h,ag as b,y,a3 as x,D as k,I as w,C as S,w as C}from"./index-2cafbb5e.js";import{c as V,C as M}from"./index-fa16672a.js";import{u as I}from"./use-id-bc367f23.js";import{k as B,a as A,r as z,c as E,p as j,w as T,n as P,b as $,j as q,q as L,a4 as W}from"./vue-vendor-fce65f55.js";function D(e){return Array.isArray(e)?!e.length:0!==e&&!e}function F(e,t){const{message:a}=t;return r(a)?a(e,t):a||""}function H({target:e}){e.composing=!0}function O({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function R(e){return[...e].length}function N(e,t){return[...e].slice(0,t).join("")}const[J,K]=n("field"),Q={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:o,max:Number,min:Number,formatter:Function,clearIcon:i("clear"),modelValue:s(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:i("focus"),formatTrigger:i("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String};const X=C(B({name:J,props:u({},V,Q,{rows:o,type:i("text"),rules:Array,autosize:[Boolean,Object],labelWidth:o,labelClass:c,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(r,{emit:n,slots:o}){const i=I(),s=A({status:"unvalidated",focused:!1,validateMessage:""}),u=z(),c=z(),C=z(),{parent:V}=d(v),B=()=>{var e;return String(null!=(e=r.modelValue)?e:"")},J=e=>h(r[e])?r[e]:V&&h(V.props[e])?V.props[e]:void 0,Q=E(()=>{const e=J("readonly");if(r.clearable&&!e){const e=""!==B(),t="always"===r.clearTrigger||"focus"===r.clearTrigger&&s.focused;return e&&t}return!1}),X=E(()=>C.value&&o.input?C.value():r.modelValue),Z=E(()=>{var e;const t=J("required");return"auto"===t?null==(e=r.rules)?void 0:e.some(e=>e.required):t}),G=e=>e.reduce((e,t)=>e.then(()=>{if("failed"===s.status)return;let{value:e}=X;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(D(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return s.status="failed",void(s.validateMessage=F(e,t));if(t.validator){if(D(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise(a=>{const r=t.validator(e,t);l(r)?r.then(a):a(r)})}(e,t).then(a=>{a&&"string"==typeof a?(s.status="failed",s.validateMessage=a):!1===a&&(s.status="failed",s.validateMessage=F(e,t))})}}),Promise.resolve()),U=()=>{s.status="unvalidated",s.validateMessage=""},Y=()=>n("endValidate",{status:s.status,message:s.validateMessage}),_=(e=r.rules)=>new Promise(t=>{U(),e?(n("startValidate"),G(e).then(()=>{"failed"===s.status?(t({name:r.name,message:s.validateMessage}),Y()):(s.status="passed",t(),Y())})):t()}),ee=e=>{if(V&&r.rules){const{validateTrigger:t}=V.props,a=b(t).includes(e),l=r.rules.filter(t=>t.trigger?b(t.trigger).includes(e):a);l.length&&_(l)}},te=(e,t="onChange")=>{var a,l;const o=e;e=(e=>{var t;const{maxlength:a}=r;if(h(a)&&R(e)>+a){const l=B();if(l&&R(l)===+a)return l;const r=null==(t=u.value)?void 0:t.selectionEnd;if(s.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return N(e,+a)}return e})(e);const i=R(o)-R(e);if("number"===r.type||"digit"===r.type){const n="number"===r.type;if(e=y(e,n,n),"onBlur"===t&&""!==e&&(void 0!==r.min||void 0!==r.max)){const t=x(+e,null!=(a=r.min)?a:-1/0,null!=(l=r.max)?l:1/0);+e!==t&&(e=t.toString())}}let c=0;if(r.formatter&&t===r.formatTrigger){const{formatter:t,maxlength:a}=r;if(e=t(e),h(a)&&R(e)>+a&&(e=N(e,+a)),u.value&&s.focused){const{selectionEnd:e}=u.value,a=N(o,e);c=R(t(a))-R(a)}}if(u.value&&u.value.value!==e)if(s.focused){let{selectionStart:t,selectionEnd:a}=u.value;if(u.value.value=e,h(t)&&h(a)){const l=R(e);i?(t-=i,a-=i):c&&(t+=c,a+=c),u.value.setSelectionRange(Math.min(t,l),Math.min(a,l))}}else u.value.value=e;e!==r.modelValue&&n("update:modelValue",e)},ae=e=>{e.target.composing||te(e.target.value)},le=()=>{var e;return null==(e=u.value)?void 0:e.blur()},re=()=>{var e;return null==(e=u.value)?void 0:e.focus()},ne=()=>{const l=u.value;"textarea"===r.type&&r.autosize&&l&&function(l,r){const n=e();l.style.height="auto";let o=l.scrollHeight;if(a(r)){const{maxHeight:e,minHeight:t}=r;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(l.style.height=`${o}px`,t(n))}(l,r.autosize)},oe=e=>{s.focused=!0,n("focus",e),P(ne),J("readonly")&&le()},ie=e=>{s.focused=!1,te(B(),"onBlur"),n("blur",e),J("readonly")||(ee("onBlur"),P(ne),S())},se=e=>n("clickInput",e),ue=e=>n("clickLeftIcon",e),ce=e=>n("clickRightIcon",e),de=E(()=>"boolean"==typeof r.error?r.error:!(!V||!V.props.showError||"failed"!==s.status)||void 0),ge=E(()=>{const e=J("labelWidth"),t=J("labelAlign");if(e&&"top"!==t)return{width:g(e)}}),me=e=>{if(13===e.keyCode){V&&V.props.submitOnEnter||"textarea"===r.type||k(e),"search"===r.type&&le()}n("keypress",e)},fe=()=>r.id||`${i}-input`,pe=()=>{const e=K("control",[J("inputAlign"),{error:de.value,custom:!!o.input,"min-height":"textarea"===r.type&&!r.autosize}]);if(o.input)return q("div",{class:e,onClick:se},[o.input()]);const t={id:fe(),ref:u,name:r.name,rows:void 0!==r.rows?+r.rows:void 0,class:e,disabled:J("disabled"),readonly:J("readonly"),autofocus:r.autofocus,placeholder:r.placeholder,autocomplete:r.autocomplete,autocapitalize:r.autocapitalize,autocorrect:r.autocorrect,enterkeyhint:r.enterkeyhint,spellcheck:r.spellcheck,"aria-labelledby":r.label?`${i}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:ie,onFocus:oe,onInput:ae,onClick:se,onChange:O,onKeypress:me,onCompositionend:O,onCompositionstart:H};return"textarea"===r.type?q("textarea",L(t,{inputmode:r.inputmode}),null):q("input",L((a=r.type,l=r.inputmode,"number"===a&&(a="text",null!=l||(l="decimal")),"digit"===a&&(a="tel",null!=l||(l="numeric")),{type:a,inputmode:l}),t),null);var a,l},ve=()=>{const e=o["right-icon"];if(r.rightIcon||e)return q("div",{class:K("right-icon"),onClick:ce},[e?e():q(w,{name:r.rightIcon,classPrefix:r.iconPrefix},null)])},he=()=>{if(r.showWordLimit&&r.maxlength){const e=R(B());return q("div",{class:K("word-limit")},[q("span",{class:K("word-num")},[e]),W("/"),r.maxlength])}},be=()=>{if(V&&!1===V.props.showErrorMessage)return;const e=r.errorMessage||s.validateMessage;if(e){const t=o["error-message"],a=J("errorMessageAlign");return q("div",{class:K("error-message",a)},[t?t({message:e}):e])}},ye=()=>[q("div",{class:K("body")},[pe(),Q.value&&q(w,{ref:c,name:r.clearIcon,class:K("clear")},null),ve(),o.button&&q("div",{class:K("button")},[o.button()])]),he(),be()];return m({blur:le,focus:re,validate:_,formValue:X,resetValidation:U,getValidationStatus:()=>s.status}),j(f,{customValue:C,resetValidation:U,validateWithTrigger:ee}),T(()=>r.modelValue,()=>{te(B()),U(),ee("onChange"),P(ne)}),$(()=>{te(B(),r.formatTrigger),P(ne)}),p("touchstart",e=>{k(e),n("update:modelValue",""),n("clear",e)},{target:E(()=>{var e;return null==(e=c.value)?void 0:e.$el})}),()=>{const e=J("disabled"),t=J("labelAlign"),a=(()=>{const e=o["left-icon"];if(r.leftIcon||e)return q("div",{class:K("left-icon"),onClick:ue},[e?e():q(w,{name:r.leftIcon,classPrefix:r.iconPrefix},null)])})();return q(M,{size:r.size,class:K({error:de.value,disabled:e,[`label-${t}`]:t}),center:r.center,border:r.border,isLink:r.isLink,clickable:r.clickable,titleStyle:ge.value,valueClass:K("value"),titleClass:[K("label",[t,{required:Z.value}]),r.labelClass],arrowDirection:r.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=J("labelWidth"),t=J("labelAlign"),a=J("colon")?":":"";return o.label?[o.label(),a]:r.label?q("label",{id:`${i}-label`,for:o.input?void 0:fe(),"data-allow-mismatch":"attribute",onClick:e=>{k(e),re()},style:"top"===t&&e?{width:g(e)}:void 0},[r.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:ye,extra:o.extra})}}}));export{X as F,Q as f};
