import{S as e}from"./sdkwork-page-container-5d58390b.js";import{k as a,r as t,Q as o,R as n,S as l,u as i,j as s,U as c,w as r,n as d,t as u,a8 as v,b as g,o as p,c as m,a0 as h,X as y,F as f,Y as k,V as w,$ as b,T as E,Z as C,W as S,v as _,y as I,a3 as T,O as D}from"./vue-vendor-a2672387.js";import{a as x,_ as A,d as M,e as B,g as R,A as N,s as O}from"./index-5affcab4.js";import{_ as F}from"./app-header-8a2d383f.js";import{u as L,M as P,a as U}from"./chat-76669d74.js";import{u as K}from"./conversation-6ab73d69.js";import{S as $}from"./sdkwork-chat-message-list-6c84ceb8.js";import{N as j}from"./index-1540f2f5.js";import{S as V,_ as z}from"./sdkwork-subtitles-163c052f.js";var H=(e=>(e.SEND_MESSAGE="send-message",e.SEND_VOICE="send-voice",e.SEND_FILE="send-file",e.SEND_IMAGE="send-image",e.SEND_VIDEO="send-video",e.SEND_RTC_REQUEST="send-rtc-request",e.SEND_LOCATION="send-location",e.INPUT_FOCUS="input-focus",e.INPUT_BLUR="input-blur",e.TEXT_CHANGE="text-change",e.UPLOAD_PROGRESS="upload-progress",e.KEY_DOWN="key-down",e.KEY_UP="key-up",e.KEY_PRESS="key-press",e.INPUT="input",e.COMPOSITION_START="composition-start",e.COMPOSITION_UPDATE="composition-update",e.COMPOSITION_END="composition-end",e.SCROLL="scroll",e.SCROLL_TOP="scroll-top",e.SCROLL_BOTTOM="scroll-bottom",e.KEYBOARD_SHOW="keyboard-show",e.KEYBOARD_HIDE="keyboard-hide",e.PASTE="paste",e.CUT="cut",e.COPY="copy",e.SELECTION_CHANGE="selection-change",e))(H||{});const G={class:"chat-input-tool-panel"},Y={class:"tool-section"},W={class:"tool-grid"},q=["disabled"],X={class:"tool-icon-wrapper"},Q={key:0,class:"loading-spinner"},Z=["disabled"],J={class:"tool-icon-wrapper"},ee={key:0,class:"loading-spinner"},ae=["disabled"],te={class:"tool-icon-wrapper"},oe={key:0,class:"loading-spinner"},ne=["disabled"],le={class:"tool-icon-wrapper"},ie={key:0,class:"loading-spinner"},se=A(a({__name:"chat-input-tool-panel",props:{enableCamera:{type:Boolean,default:!0},targetUserId:{default:""},conversationId:{}},emits:["select-tool","send-image","send-file","send-video","send-rtc-request","send-location","take-photo"],setup(e,{emit:a}){const r=e,d=a,u="image",v="file",g="camera",p="video",m="location",h="voice-call",y="video-call",f=t({}),k=e=>{d("select-tool",e)},w=async e=>{const a={image:"chooseImage",file:"chooseFile",video:"chooseVideo"};try{f.value[e]=!0;return await window.$files[a[e]]({count:1,success:e=>e.tempFiles&&e.tempFiles[0]?e.tempFiles[0]:null,fail:a=>{throw new Error(`ÈÄâÊã©${e}Â§±Ë¥•: ${a.message||a}`)}})}catch(t){return console.error(`Â∑•ÂÖ∑ ${e} Êìç‰ΩúÂ§±Ë¥•:`,t),null}finally{f.value[e]=!1}},b=(e,a)=>{if(e.size>10485760)return console.error("Êñá‰ª∂Â§ßÂ∞èË∂ÖËøáÈôêÂà∂"),!1;switch(a){case"image":return e.type.startsWith("image/");case"video":return e.type.startsWith("video/");case"file":return!0;default:return!1}},E={async image(){k(u);const e=await w("image");e&&b(e,"image")&&d("send-image",e)},async file(){k(v);const e=await w("file");e&&b(e,"file")&&d("send-file",e)},async video(){k(p);const e=await w("video");e&&b(e,"video")&&d("send-video",e)},camera(){k(g),d("take-photo")},async location(){if(k(m),navigator.geolocation)try{f.value.location=!0;const e=await new Promise((e,a)=>{navigator.geolocation.getCurrentPosition(e,a,{timeout:1e4,enableHighAccuracy:!0})}),{latitude:a,longitude:t}=e.coords;d("send-location",a,t)}catch(e){console.error("Ëé∑Âèñ‰ΩçÁΩÆÂ§±Ë¥•:",e)}finally{f.value.location=!1}else console.error("ÊµèËßàÂô®‰∏çÊîØÊåÅÂú∞ÁêÜ‰ΩçÁΩÆÊúçÂä°")},voiceCall(){k(h),d("send-rtc-request","voice",r.targetUserId)},videoCall(){k(y),d("send-rtc-request","video",r.targetUserId)}},{image:C,file:S,video:_,camera:I,location:T,voiceCall:D,videoCall:A}=E;return(a,t)=>(o(),n("div",G,[l("div",Y,[t[14]||(t[14]=l("h4",{class:"section-title"},"Â∏∏Áî®Â∑•ÂÖ∑",-1)),l("div",W,[l("button",{class:"tool-item",onClick:t[0]||(t[0]=(...e)=>i(C)&&i(C)(...e)),disabled:f.value.image},[l("div",X,[s(i(x),{icon:"mdi:image",width:"28",height:"28",class:"tool-icon"}),f.value.image?(o(),n("div",Q)):c("",!0)]),t[7]||(t[7]=l("div",{class:"tool-label"},"ÂõæÁâá",-1))],8,q),l("button",{class:"tool-item",onClick:t[1]||(t[1]=(...e)=>i(S)&&i(S)(...e)),disabled:f.value.file},[l("div",J,[s(i(x),{icon:"mdi:file-document-outline",width:"28",height:"28",class:"tool-icon"}),f.value.file?(o(),n("div",ee)):c("",!0)]),t[8]||(t[8]=l("div",{class:"tool-label"},"Êñá‰ª∂",-1))],8,Z),e.enableCamera?(o(),n("button",{key:0,class:"tool-item",onClick:t[2]||(t[2]=(...e)=>i(I)&&i(I)(...e))},[s(i(x),{icon:"mdi:camera",width:"28",height:"28",class:"tool-icon"}),t[9]||(t[9]=l("div",{class:"tool-label"},"Áõ∏Êú∫",-1))])):c("",!0),l("button",{class:"tool-item",onClick:t[3]||(t[3]=(...e)=>i(_)&&i(_)(...e)),disabled:f.value.video},[l("div",te,[s(i(x),{icon:"mdi:video",width:"28",height:"28",class:"tool-icon"}),f.value.video?(o(),n("div",oe)):c("",!0)]),t[10]||(t[10]=l("div",{class:"tool-label"},"ËßÜÈ¢ë",-1))],8,ae),l("button",{class:"tool-item",onClick:t[4]||(t[4]=(...e)=>i(T)&&i(T)(...e)),disabled:f.value.location},[l("div",le,[s(i(x),{icon:"mdi:map-marker",width:"28",height:"28",class:"tool-icon"}),f.value.location?(o(),n("div",ie)):c("",!0)]),t[11]||(t[11]=l("div",{class:"tool-label"},"‰ΩçÁΩÆ",-1))],8,ne),l("button",{class:"tool-item",onClick:t[5]||(t[5]=(...e)=>i(D)&&i(D)(...e))},[s(i(x),{icon:"mdi:microphone",width:"28",height:"28",class:"tool-icon"}),t[12]||(t[12]=l("div",{class:"tool-label"},"ËØ≠Èü≥ÈÄöËØù",-1))]),l("button",{class:"tool-item",onClick:t[6]||(t[6]=(...e)=>i(A)&&i(A)(...e))},[s(i(x),{icon:"mdi:video",width:"28",height:"28",class:"tool-icon"}),t[13]||(t[13]=l("div",{class:"tool-label"},"ËßÜÈ¢ëÈÄöËØù",-1))])])])]))}}),[["__scopeId","data-v-99a43ef4"]]),ce={class:"chat-input-text-area"},re=["placeholder","maxlength"],de={class:"input-actions"},ue=A(a({__name:"chat-input-text-area",props:{placeholder:{default:"ËæìÂÖ•Ê∂àÊÅØ..."},maxLength:{default:1e3},enableEmoji:{type:Boolean,default:!0},modelValue:{default:""}},emits:["update:modelValue","text-change","keydown","keyup","keypress","focus","blur","toggle-emoji-panel","input-event","composition-start","composition-update","composition-end","scroll","paste","cut","copy","selection-change"],setup(e,{expose:a,emit:g}){const p=e,m=g,h=t(p.modelValue),y=t();r(()=>p.modelValue,e=>{h.value=e,R()});const f=e=>{m("update:modelValue",h.value),m("text-change",h.value),m("input-event",e),R()},k=e=>{m("keydown",e)},w=e=>{m("keyup",e)},b=e=>{m("keypress",e)},E=()=>{m("focus"),document.addEventListener("selectionchange",B)},C=()=>{m("blur"),document.removeEventListener("selectionchange",B)},S=e=>{m("composition-start",e)},_=e=>{m("composition-update",e)},I=e=>{m("composition-end",e)},T=e=>{m("scroll",e)},D=e=>{m("paste",e)},A=e=>{m("cut",e)},M=e=>{m("copy",e)},B=()=>{const e=y.value;e&&document.activeElement===e&&m("selection-change")},R=()=>{d(()=>{const e=y.value;e&&(e.style.height="24px",e.scrollHeight>24&&(e.style.height=Math.min(e.scrollHeight,120)+"px"))})};return a({focus:()=>y.value?.focus(),clear:()=>{h.value="",m("update:modelValue",""),R()}}),(a,t)=>(o(),n("div",ce,[u(l("textarea",{ref_key:"textInputRef",ref:y,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),placeholder:e.placeholder,maxlength:e.maxLength,class:"text-input",onInput:f,onKeydown:k,onKeyup:w,onKeypress:b,onFocus:E,onBlur:C,onCompositionstart:S,onCompositionupdate:_,onCompositionend:I,onScroll:T,onPaste:D,onCut:A,onCopy:M},null,40,re),[[v,h.value]]),l("div",de,[e.enableEmoji?(o(),n("button",{key:0,class:"emoji-button",onClick:t[1]||(t[1]=e=>a.$emit("toggle-emoji-panel"))},[s(i(x),{icon:"mdi:emoticon-happy-outline",width:"18",height:"18",class:"emoji-icon"})])):c("",!0)])]))}}),[["__scopeId","data-v-58e2963e"]]),ve={class:"chat-input-voice"},ge={key:0,class:"recording-overlay"},pe={class:"recording-glass"},me={class:"audio-visualizer"},he={key:0,class:"wave-container"},ye={class:"recording-time"},fe={class:"time-digits"},ke={class:"recording-controls"},we={key:0,class:"error-message"},be={class:"voice-input"},Ee=["disabled"],Ce={class:"button-content"},Se={class:"record-icon"},_e={class:"record-text"},Ie=A(a({__name:"chat-input-voice",props:{disabled:{type:Boolean,default:!1},maxDuration:{default:60},minDuration:{default:1}},emits:["start-recording","stop-recording","recording-error","recording-cancelled","recording-timeout"],setup(e,{expose:a,emit:d}){const u=e,v=d,C=M(),S=t(!1),_=t(!1),I=t(0),T=t(!1);t(null),t(null),r(()=>C.currentState,(e,a)=>{"error"===e&&C.errorMessage&&v("recording-error",C.errorMessage),"stopped"!==e&&"idle"!==e||(T.value=!1,_.value=!1,I.value=0),"recording"===e&&"idle"===a&&(_.value=!1)}),r(()=>C.currentDuration,e=>{u.maxDuration>0&&e>=u.maxDuration&&C.isRecording&&F()}),r(()=>u.maxDuration,e=>{C.updateConfig({maxDuration:e})}),g(()=>{S.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>0||navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>0,S.value&&document.addEventListener("touchmove",D,{passive:!1}),C.updateConfig({maxDuration:u.maxDuration})}),p(()=>{S.value&&document.removeEventListener("touchmove",D),C.cleanup()});const D=e=>{if(!C.isRecording||!T.value)return;const a=e.touches[0],t=document.querySelector(".control-button.cancel-button"),o=document.querySelector(".control-button.finish-button"),n=t?.getBoundingClientRect(),l=n&&a.clientX>=n.left&&a.clientX<=n.right&&a.clientY>=n.top&&a.clientY<=n.bottom,i=o?.getBoundingClientRect(),s=i&&a.clientX>=i.left&&a.clientX<=i.right&&a.clientY>=i.top&&a.clientY<=i.bottom;l?(t?.classList.add("highlight"),o?.classList.remove("highlight"),!_.value&&navigator.vibrate&&navigator.vibrate(30),_.value=!0):s?(o?.classList.add("highlight"),t?.classList.remove("highlight"),_.value=!1):(t?.classList.remove("highlight"),o?.classList.remove("highlight"),_.value=!1),e.preventDefault()},A=m(()=>{const e=C.currentDuration,a=Math.floor(e/60);return`${a>0?`${a}:`:""}${(e%60).toString().padStart(2,"0")}`}),B=m(()=>C.currentDuration<u.minDuration);m(()=>u.maxDuration>0&&C.currentDuration>=u.maxDuration);const R=async e=>{if(e.preventDefault(),"touchstart"===e.type&&"ontouchstart"in window&&(e.stopPropagation(),I.value=Date.now(),T.value=!0),!u.disabled)if(C.isRecording||"initializing"===C.currentState)console.warn("Recording already in progress or initializing");else{C.clearError(),_.value=!1;try{await C.startRecording({}),v("start-recording"),S.value&&navigator.vibrate&&navigator.vibrate(50)}catch(a){const e=a instanceof Error?a.message:"ÂΩïÈü≥ÂêØÂä®Â§±Ë¥•";console.error("Recording start failed:",a),v("recording-error",e),T.value=!1}}},N=async e=>{if(e.preventDefault(),"touchend"===e.type&&"ontouchstart"in window){if(e.stopPropagation(),_.value)return void O(e);const a=Date.now()-I.value;if(a<200)return console.log("Touch duration too short, ignoring:",a),void(T.value=!1)}if(C.isRecording){if(B.value)return console.log("Recording too short, cancelling:",C.currentDuration),void O(e);try{const e=await C.stopRecording();e&&e.data&&(console.log("Recording stopped successfully, duration:",e,e.duration),v("stop-recording",e.data,e.duration),S.value&&navigator.vibrate&&navigator.vibrate([50,30,50]))}catch(a){const e=a instanceof Error?a.message:"ÂΩïÈü≥ÂÅúÊ≠¢Â§±Ë¥•";console.error("Recording stop failed:",a),v("recording-error",e)}finally{T.value=!1}}else console.log("Not recording, ignoring stop request")},O=e=>{e.preventDefault(),"touchcancel"===e.type&&"ontouchstart"in window&&e.stopPropagation(),C.isRecording?(console.log("Cancelling recording, duration:",C.currentDuration),C.cancelRecording(),v("recording-cancelled"),S.value&&navigator.vibrate&&navigator.vibrate(100)):console.log("Not recording, ignoring cancel request")},F=()=>{C.isRecording&&(N(new Event("timeout")),v("recording-timeout"))};return a({startRecording:async()=>R(new Event("programmatic")),stopRecording:async()=>N(new Event("programmatic")),cancelRecording:()=>{O(new Event("programmatic"))},isRecording:()=>C.isRecording,getRecordingDuration:()=>C.currentDuration}),(e,a)=>(o(),n("div",ve,[s(E,{name:"fade"},{default:h(()=>[i(C).isRecording?(o(),n("div",ge,[l("div",pe,[l("div",me,[s(i(x),{icon:"mdi:microphone",width:"64",height:"64",class:y(["recording-icon",{pulsing:i(C).isRecording}])},null,8,["class"]),i(C).isRecording?(o(),n("div",he,[(o(),n(f,null,k(8,e=>l("div",{key:e,class:"wave-bar",style:w({animationDelay:.1*(e-1)+"s"})},null,4)),64))])):c("",!0)]),l("div",ye,[l("span",fe,b(A.value),1),a[0]||(a[0]=l("span",{class:"time-unit"},"Áßí",-1))]),l("div",ke,[l("button",{class:"control-button finish-button",onClick:N,onTouchend:N},[s(i(x),{icon:"mdi:send-circle",width:"24",height:"24"})],32),l("button",{class:"control-button cancel-button",onClick:O,onTouchend:O},[s(i(x),{icon:"mdi:close-circle",width:"24",height:"24"})],32)])])])):c("",!0)]),_:1}),i(C).errorMessage?(o(),n("div",we,b(i(C).errorMessage),1)):c("",!0),l("div",be,[l("button",{class:y(["voice-record-button",{disabled:u.disabled,"mobile-device":S.value,recording:i(C).isRecording}]),onMousedown:R,onMouseup:N,onTouchstart:R,onTouchend:N,disabled:u.disabled},[l("div",Ce,[l("span",Se,[s(i(x),{icon:"mdi:microphone",width:"24",height:"24"})]),l("span",_e,b(u.disabled?"ËØ≠Èü≥ËæìÂÖ•":C.isRecording?"ÊùæÂºÄÂèëÈÄÅ":"Êåâ‰ΩèËØ¥ËØù"),1)])],42,Ee)])]))}}),[["__scopeId","data-v-f9f52cfd"]]),Te=["disabled"],De=A(a({__name:"chat-input-send-button",props:{canSend:{type:Boolean,default:!1}},emits:["send"],setup:(e,{emit:a})=>(a,t)=>(o(),n("button",{class:"chat-input-send-button",disabled:!e.canSend,onClick:t[0]||(t[0]=e=>a.$emit("send"))},[s(i(x),{icon:"mdi:send",width:"24",height:"24",class:"send-icon"})],8,Te))}),[["__scopeId","data-v-601990e8"]]),xe={class:"chat-input-emoji-panel"},Ae={class:"emoji-categories"},Me=["onClick"],Be={class:"emoji-grid"},Re=["onClick"],Ne=A(a({__name:"chat-input-emoji-panel",emits:["select-emoji"],setup(e,{emit:a}){const i=t("Ë°®ÊÉÖ"),s=["Ë°®ÊÉÖ","‰∫∫Áâ©","Âä®Áâ©","È£üÁâ©","Ê¥ªÂä®","Á¨¶Âè∑"],c={"Ë°®ÊÉÖ":["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","üòÇ","ü§£","üòä","üòá"],"‰∫∫Áâ©":["üë∂","üëß","üë¶","üë©","üë®","üëµ","üë¥","üëÆ","üë∑","üíÇ"],"Âä®Áâ©":["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ"],"È£üÁâ©":["üçé","üçê","üçä","üçã","üçå","üçâ","üçá","üçì","üçà","üçí"],"Ê¥ªÂä®":["‚öΩ","üèÄ","üèà","‚öæ","üéæ","üèê","üèâ","üé±","üèì","üè∏"],"Á¨¶Âè∑":["‚ù§Ô∏è","üíõ","üíö","üíô","üíú","üñ§","üíî","‚ù£Ô∏è","üíï","üíû"]},r=m(()=>c[i.value]||[]);return(e,a)=>(o(),n("div",xe,[l("div",Ae,[(o(),n(f,null,k(s,e=>l("button",{key:e,class:y(["category-button",{active:i.value===e}]),onClick:a=>i.value=e},b(e),11,Me)),64))]),l("div",Be,[(o(!0),n(f,null,k(r.value,a=>(o(),n("button",{key:a,class:"emoji-item",onClick:t=>e.$emit("select-emoji",a)},b(a),9,Re))),128))])]))}}),[["__scopeId","data-v-14e37487"]]),Oe={class:"chat-input"},Fe={class:"input-area flex flex-row items-center"},Le={class:"input-left"},Pe={class:"input-main"},Ue={class:"input-right"},Ke={class:"bottom-panels"},$e={key:0,class:"tool-panel"},je=A(a({__name:"sdkwork-chat-input",props:{placeholder:{default:"ËæìÂÖ•Ê∂àÊÅØ..."},maxLength:{default:1e3},disabled:{type:Boolean,default:!1},enableVoice:{type:Boolean,default:!0},enableEmoji:{type:Boolean,default:!0},enableFileUpload:{type:Boolean,default:!0},enableCamera:{type:Boolean,default:!0},currentUserId:{},conversationId:{},allowedFileTypes:{default:()=>["image/*","video/*","audio/*",".pdf",".doc",".docx"]},allowMultipleFiles:{type:Boolean,default:!1}},emits:["chat-input-event","send"],setup(e,{emit:a}){const r=e,d=a,u=B(),v=K(),h=L(),f=t(""),k=t(!1),w=t(!1),b=t(!1),E=t(!1),S=t(0),_=t(0),I=t(!1),T=t(0),D=m(()=>f.value.trim().length>0||E.value),A=(e,a,t)=>{const o={type:e,payload:a,timestamp:Date.now(),metadata:t};d("chat-input-event",o)},M=()=>{const e=v.currentConversation,a=h.lastMessage;return{conversation_id:e?.id||r.conversationId||"",user_id:u.currentUser?.id,knowledge_base_id:e?.knowledgeBaseId||"",agent_id:e?.agentId||"",datasource_id:e?.dataSourceId||"",parent_message_id:a?.id,save_audio:!1}},O=e=>{f.value=e,A(H.TEXT_CHANGE,{text:e})},F=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ne()),A(H.KEY_DOWN,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},U=e=>{A(H.KEY_UP,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},$=e=>{A(H.KEY_PRESS,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},j=e=>{A(H.INPUT,{value:f.value,inputType:e.inputType,data:e.data,event:e})},V=e=>{A(H.COMPOSITION_START,{data:e.data,event:e})},z=e=>{A(H.COMPOSITION_UPDATE,{data:e.data,event:e})},G=e=>{A(H.COMPOSITION_END,{data:e.data,event:e})},Y=e=>{const a=e.target,t=a.scrollTop,o=a.scrollHeight,n=a.clientHeight,l=t>(_.value||0)?"down":"up";_.value=t,A(H.SCROLL,{scrollTop:t,scrollHeight:o,clientHeight:n,scrollDirection:l,event:e}),0===t&&A(H.SCROLL_TOP,{scrollTop:t,scrollHeight:o,clientHeight:n,event:e}),t+n>=o-10&&A(H.SCROLL_BOTTOM,{scrollTop:t,scrollHeight:o,clientHeight:n,event:e})},W=e=>{const a=e.clipboardData?.getData("text")||"";A(H.PASTE,{data:a,type:"paste",event:e})},q=e=>{const a=e.clipboardData?.getData("text")||"";A(H.CUT,{data:a,type:"cut",event:e})},X=e=>{const a=e.clipboardData?.getData("text")||"";A(H.COPY,{data:a,type:"copy",event:e})},Q=()=>{const e=document.querySelector(".text-input");e&&A(H.SELECTION_CHANGE,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,selectedText:e.value.substring(e.selectionStart,e.selectionEnd)})},Z=()=>{if("undefined"==typeof window)return;const e=window.innerHeight,a=document.documentElement.clientHeight,t=e<a-100;t!==I.value&&(I.value=t,T.value=Math.max(0,a-e),A(t?H.KEYBOARD_SHOW:H.KEYBOARD_HIDE,{keyboardHeight:T.value,viewportHeight:e,isVisible:t}))},J=()=>{Z()};g(()=>{window.addEventListener("resize",J),Z()}),p(()=>{window.removeEventListener("resize",J)});const ee=()=>{k.value=!k.value,w.value=!1},ae=()=>{b.value=!b.value,k.value=!1,w.value=!1},te=()=>{w.value=!w.value,k.value=!1},oe=e=>{f.value+=e,A(H.TEXT_CHANGE,{text:f.value})},ne=async()=>{if(!D.value)return;const e=f.value.trim();if(e)try{const a={messageType:R.MessageType.TEXT,context:M()},t=P.createTextMessage({content:e},a);d("send",t),A(H.SEND_MESSAGE,{message:{senderId:u.currentUser?.id||"",receiverId:"",content:e,type:R.MessageType.TEXT}}),f.value="",A(H.TEXT_CHANGE,{text:""})}catch(a){console.error("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:",a)}},le=()=>{E.value=!0,S.value=Date.now()},ie=async(e,a)=>{if(E.value){E.value=!1;try{const o={messageType:R.MessageType.AUDIO,context:M()};let n;try{const t=await re(e,"audio/wav");n=P.createAudioMessageByUrl({url:t,duration:a,format:R.AudioFormat.wav},{...o})}catch(t){console.warn("Èü≥È¢ë‰∏ä‰º†Â§±Ë¥•Ôºå‰ΩøÁî®ArrayBufferÊñπÂºèÂàõÂª∫Ê∂àÊÅØ:",t),n=P.createAudioMessage({file:e,duration:a,format:R.AudioFormat.wav},{...o})}d("send",n),A(H.SEND_VOICE,{data:e,duration:a})}catch(o){console.error("ÂèëÈÄÅËØ≠Èü≥Ê∂àÊÅØÂ§±Ë¥•:",o)}}},ce=e=>{console.log("ÈÄâÊã©Â∑•ÂÖ∑:",e)},re=async(e,a)=>{if(!window.$uploader)throw new Error("‰∏ä‰º†Âô®Êú™ÂàùÂßãÂåñÔºåËØ∑Á°Æ‰øùwindow.$uploader = createUploader()Â∑≤ÊâßË°å");const{fileToUpload:t,fileName:o,fileSize:n,detectedFormat:l}=await de(e,a),i=ve(a,t.type),s={file:t,name:o,scene:"chat-message",contentType:i,acl:"public-read",metadata:{uploadTime:Date.now().toString(),source:"chat-input",conversationId:r.conversationId||"unknown",originalMimeType:a,detectedFormat:l}};try{const e=await window.$uploader.upload(s,e=>{console.log(`‰∏ä‰º†ËøõÂ∫¶: ${e.percentage}%`),A(H.UPLOAD_PROGRESS,{fileName:o,format:l,progress:e.percentage,loaded:e.loaded,total:e.total,contentType:i})});return console.log("Êñá‰ª∂‰∏ä‰º†ÊàêÂäü:",e.url),e.url}catch(c){throw console.error("Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•:",c),new Error(`Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•: ${c instanceof Error?c.message:"Êú™Áü•ÈîôËØØ"}`)}},de=async(e,a)=>{let t,o,n,l="unknown";if(e instanceof File)t=e,o=e.name,n=e.size,l=ge(o)||pe(e.type),console.log("‰∏ä‰º†Êñá‰ª∂:",o,"Â§ßÂ∞è:",n,"Á±ªÂûã:",e.type,"Ê†ºÂºè:",l);else if(e instanceof Blob){if(l=N.detectAudioFormat(e)||pe(e.type),"pcm"===l||"audio/pcm"===e.type){console.log("Ê£ÄÊµãÂà∞PCMÊ†ºÂºèÈü≥È¢ëÔºåËΩ¨Êç¢‰∏∫WAVÊ†ºÂºè");const a=await N.blobToArrayBuffer(e);t=N.pcmToWav(a,16e3,1,16),l="wav"}else t=e;o=`audio_${Date.now()}.${l}`,n=t.size,console.log("‰∏ä‰º†BlobÊï∞ÊçÆÔºåÁ±ªÂûã:",a,"Ê†ºÂºè:",l)}else t=new Blob([e],{type:a||"application/octet-stream"}),o=`file_${Date.now()}.dat`,n=t.size,l=pe(a)||"binary",console.log("‰∏ä‰º†ArrayBufferÊï∞ÊçÆÔºåÁ±ªÂûã:",a,"Ê†ºÂºè:",l);return{fileToUpload:t,fileName:o,fileSize:n,detectedFormat:l}},ve=(e,a)=>e&&"application/octet-stream"!==e?e:a&&"application/octet-stream"!==a?a:"application/octet-stream",ge=e=>{const a=e.match(/\.([a-zA-Z0-9]+)$/);return a?a[1].toLowerCase():null},pe=e=>{if(!e)return null;return{"audio/wav":"wav","audio/mp3":"mp3","audio/mpeg":"mp3","audio/ogg":"ogg","audio/flac":"flac","image/jpeg":"jpg","image/png":"png","image/gif":"gif","video/mp4":"mp4","application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx"}[e]||null},me=async e=>{try{const a=await re(e),t={messageType:R.MessageType.FILE,context:M()},o=P.createFileMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(H.SEND_FILE,{file:e,fileType:"file"})}catch(a){console.error("ÂèëÈÄÅÊñá‰ª∂Ê∂àÊÅØÂ§±Ë¥•:",a)}},he=async e=>{try{const a=await re(e),t={messageType:R.MessageType.IMAGE,context:M()},o=P.createImageMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(H.SEND_IMAGE,{file:e,fileType:"image"})}catch(a){console.error("ÂèëÈÄÅÂõæÁâáÊ∂àÊÅØÂ§±Ë¥•:",a)}},ye=async e=>{try{const a=await re(e),t={messageType:R.MessageType.VIDEO,context:M()},o=P.createVideoMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(H.SEND_VIDEO,{file:e,fileType:"video"})}catch(a){console.error("ÂèëÈÄÅËßÜÈ¢ëÊ∂àÊÅØÂ§±Ë¥•:",a)}};return(a,t)=>(o(),n("div",Oe,[l("div",Fe,[l("div",Le,[e.enableVoice?(o(),n("button",{key:0,class:"tool-button",onClick:ae},[b.value?(o(),C(i(x),{key:0,icon:"mdi:microphone",width:"18",height:"18",class:"voice-active-icon"})):(o(),C(i(x),{key:1,icon:"mdi:microphone-outline",width:"18",height:"18",class:"voice-icon"}))])):c("",!0)]),l("div",Pe,[b.value?(o(),C(Ie,{key:1,onStartRecording:le,onStopRecording:ie})):(o(),C(ue,{key:0,modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),placeholder:e.placeholder,"max-length":e.maxLength,"enable-emoji":e.enableEmoji,onTextChange:O,onKeydown:F,onKeyup:U,onKeypress:$,onFocus:t[1]||(t[1]=()=>A(i(H).INPUT_FOCUS)),onBlur:t[2]||(t[2]=()=>A(i(H).INPUT_BLUR)),onInputEvent:j,onCompositionStart:V,onCompositionUpdate:z,onCompositionEnd:G,onScroll:Y,onPaste:W,onCut:q,onCopy:X,onSelectionChange:Q,onToggleEmojiPanel:te},null,8,["modelValue","placeholder","max-length","enable-emoji"]))]),l("div",Ue,[l("button",{class:y(["tool-button",{active:k.value}]),onClick:ee},[s(i(x),{icon:"mdi:plus",width:"18",height:"18",class:"tool-icon"})],2),b.value?c("",!0):(o(),C(De,{key:0,"can-send":D.value,onSend:ne},null,8,["can-send"]))])]),l("div",Ke,[k.value?(o(),n("div",$e,[s(se,{onSelectTool:ce,onSendImage:he,onSendFile:me,onSendVideo:ye,onSendRtcRequest:t[3]||(t[3]=(e,a)=>A(i(H).SEND_RTC_REQUEST,{type:e,targetUserId:a})),onSendLocation:t[4]||(t[4]=(e,a,t)=>A(i(H).SEND_LOCATION,{latitude:e,longitude:a,address:t}))})])):c("",!0),w.value&&e.enableEmoji?(o(),C(Ne,{key:1,onSelectEmoji:oe})):c("",!0)])]))}}),[["__scopeId","data-v-d6fd7c6c"]]),Ve={class:"sdkwork-chat"},ze={class:"chat-header"},He={class:"chat-body"},Ge={class:"chat-footer"},Ye=A(a({__name:"sdkwork-chat-component-text",props:{currentUser:{},receiver:{},conversationId:{},showBackButton:{type:Boolean,default:!0},interlocutorStatus:{default:"Âú®Á∫ø"},showAvatar:{type:Boolean,default:!1},config:{default:()=>({showTimestamp:!0,showReadStatus:!0,enableRevoke:!0,enableFileUpload:!0,maxFileSize:10,allowedFileTypes:["image/*","video/*","audio/*",".pdf",".doc",".docx"],placeholder:"ËæìÂÖ•Ê∂àÊÅØ...",maxLength:1e3})}},emits:["send-message","upload-file","load-more","message-click","back","refresh"],setup(e,{emit:a}){const i=e,c=a,r=U(),u=L(),v=t(),h=()=>{c("back")},y=()=>{console.log("Êõ¥Â§öÊìç‰ΩúÊåâÈíÆË¢´ÁÇπÂáª")},f=m(()=>u.messages.map(e=>({...e,isOwn:e.senderId===i.currentUser.id}))),k=async e=>{try{await r.sendMessage(e),c("send-message",e)}catch(a){console.error("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:",a)}finally{d(()=>{v.value?.scrollToBottom()})}},w=async e=>{try{return await c("upload-file",e)}catch(a){throw console.error("Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•:",a),a}},b=async()=>{try{i.conversationId&&(await u.loadMoreMessages({conversationId:i.conversationId,page:1,size:20}),c("load-more"))}catch(e){console.error("Âä†ËΩΩÊõ¥Â§öÊ∂àÊÅØÂ§±Ë¥•:",e)}},E=e=>{c("message-click",e)},C=e=>{const{type:a,message:t}=e.detail;"MESSAGE_RECEIVED"!==a&&"MESSAGE_STREAM_UPDATE"!==a||d(()=>{v.value?.scrollToBottom()})},_=e=>{d(()=>{v.value?.scrollToBottom()})},I=e=>{d(()=>{v.value?.scrollToBottom()})};return g(()=>{window.addEventListener("sdk:message",C),console.log("ÊñáÊú¨ËÅäÂ§©ÁªÑ‰ª∂Â∑≤ÊåÇËΩΩÂπ∂Ê∑ªÂä†Ê∂àÊÅØÁõëÂê¨")}),p(()=>{window.removeEventListener("sdk:message",C),console.log("ÊñáÊú¨ËÅäÂ§©ÁªÑ‰ª∂Â∑≤Âç∏ËΩΩÂπ∂ÁßªÈô§Ê∂àÊÅØÁõëÂê¨")}),(a,t)=>{const i=j,c=$,r=je;return o(),n("div",Ve,[l("div",ze,[S(a.$slots,"header",{},()=>[s(i,{title:e.receiver?.nickname||"ËÅäÂ§©ÂØπË±°","left-arrow":e.showBackButton,onClickLeft:h,onClickRight:y},null,8,["title","left-arrow"])],!0)]),l("div",He,[s(c,{ref_key:"messageListRef",ref:v,messages:f.value,"current-user-id":e.currentUser.id,"current-user":e.currentUser,receiver:e.receiver,"show-avatar":e.showAvatar,"conversation-id":e.conversationId,onLoadMore:b,onMessageClick:E},null,8,["messages","current-user-id","current-user","receiver","show-avatar","conversation-id"])]),l("div",Ge,[s(r,{placeholder:e.config?.placeholder||"ËæìÂÖ•Ê∂àÊÅØ...","max-length":e.config?.maxLength||1e3,"support-file":e.config?.enableFileUpload,"support-image":e.config?.enableFileUpload,"support-voice":!0,onSend:k,onUploadFile:w,onKeydown:_,onFocus:I},null,8,["placeholder","max-length","support-file","support-image"])])])}}}),[["__scopeId","data-v-86a1e55f"]]),We={class:"chat-background"},qe={class:"background-toggle-top-left"},Xe={key:0,class:"background-menu"},Qe={class:"background-options"},Ze=["onClick"],Je={class:"bg-name"},ea=A(a({__name:"voice-chat-background",props:{selectedBackground:{},backgroundOptions:{}},emits:["update:selectedBackground","background-change"],setup(e,{emit:a}){const r=a,d=t(!1),u=()=>{d.value=!d.value};return(a,t)=>(o(),n("div",We,[l("div",qe,[l("div",{class:y(["background-toggle-btn",{active:d.value}]),onClick:u},[s(i(x),{icon:"mingcute:palette-fill",width:"20",height:"20"})],2)]),d.value?(o(),n("div",Xe,[l("div",Qe,[(o(!0),n(f,null,k(e.backgroundOptions,a=>(o(),n("div",{class:y(["background-option",{active:e.selectedBackground===a.id}]),key:a.id,onClick:e=>{return t=a.id,r("update:selectedBackground",t),r("background-change",t),d.value=!1,void O("ËÉåÊôØÂ∑≤Êõ¥Êç¢");var t},style:w({background:a.gradient})},[l("span",Je,b(a.name),1)],14,Ze))),128))])])):c("",!0)]))}}),[["__scopeId","data-v-c9a37ad5"]]),aa={class:"chat-avatar"},ta={class:"caller-info"},oa={class:"caller-avatar"},na={key:0,class:"default-avatar-icon"},la=["src"],ia={key:2,class:"particles-container"},sa={key:3,class:"ai-badge"},ca={class:"caller-name"},ra=A(a({__name:"voice-chat-avatar",props:{callerName:{},callerAvatar:{},isSpeaking:{type:Boolean,default:!1},speakStateText:{default:"Á©∫Èó≤"}},setup(e){const a=e,d=t("mdi:account-circle"),u=t(!1),v=t(a.callerAvatar),m=()=>{console.warn("Â§¥ÂÉèÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§Â§¥ÂÉè"),u.value=!0},h=()=>{a.callerName.includes("AI")||a.callerName.includes("Âä©Êâã")?d.value="mdi:robot":a.callerName.includes("ÂÆ¢Êúç")?d.value="mdi:headset":a.callerName.includes("ÁÆ°ÁêÜÂëò")?d.value="mdi:shield-account":d.value="mdi:account-circle"},E=t([]),C=t([.3,.5,.7,.9,.7,.5,.3,.1]);let S;const _=()=>{a.isSpeaking?C.value=C.value.map(()=>.6*Math.random()+.4):C.value=C.value.map(e=>Math.max(.1,.8*e))};return g(()=>{S=setInterval(_,200),a.callerAvatar||(u.value=!0),h(),r(()=>a.isSpeaking,e=>{e&&(()=>{E.value=[];for(let e=0;e<12;e++){const a=e/12*Math.PI*2,t=70+30*Math.random(),o=50+Math.cos(a)*t,n=50+Math.sin(a)*t;E.value.push({id:e,style:{left:`${o}%`,top:`${n}%`,animationDelay:.2*e+"s",backgroundColor:`hsl(${360*Math.random()}, 70%, 60%)`}})}})()},{immediate:!0}),r(()=>a.callerName,()=>{h()})}),p(()=>{clearInterval(S)}),(a,t)=>(o(),n("div",aa,[l("div",ta,[l("div",oa,[l("div",{class:y(["avatar-container",{"speaking-active":e.isSpeaking}])},[l("div",{class:y(["tech-halo",{active:e.isSpeaking}])},[...t[0]||(t[0]=[l("div",{class:"halo-ring halo-1"},null,-1),l("div",{class:"halo-ring halo-2"},null,-1),l("div",{class:"halo-ring halo-3"},null,-1)])],2),u.value?(o(),n("div",na,[s(i(x),{icon:d.value,width:"80",height:"80"},null,8,["icon"])])):(o(),n("img",{key:1,src:v.value,alt:"ÂØπÊñπÂ§¥ÂÉè",class:"avatar-image",onError:m},null,40,la)),e.isSpeaking?(o(),n("div",ia,[(o(!0),n(f,null,k(E.value,e=>(o(),n("div",{class:"particle",key:e.id,style:w(e.style)},null,4))),128))])):c("",!0),e.callerName.includes("AI")?(o(),n("div",sa,[...t[1]||(t[1]=[l("span",null,"ü§ñ AI",-1)])])):c("",!0)],2)]),l("div",ca,b(e.callerName),1),l("div",{class:y(["status-text",{active:e.isSpeaking}])},b(e.speakStateText),3)])]))}}),[["__scopeId","data-v-23780b8b"]]),da={class:"voice-call-controls",key:"voice-chat-call-controls"},ua={class:"controls-container"},va={class:"control-button hangup"},ga=A(a({__name:"voice-chat-call-controls",props:{selectedBackground:{default:"default"}},emits:["microphone-toggle","speaker-toggle","camera-toggle","call-end"],setup(e,{emit:a}){const c=e,d=t(!0),u=t(!0),v=t(!0),g=a,p=m(()=>{switch(c.selectedBackground){case"blue":default:return{primary:"#2196F3",secondary:"#03A9F4",accent:"#00BCD4",active:"#0077FF",hover:"#0066CC",hangup:"#FF3B30"};case"purple":return{primary:"#9C27B0",secondary:"#BA68C8",accent:"#E1BEE7",active:"#8E24AA",hover:"#7B1FA2",hangup:"#FF3B30"};case"green":return{primary:"#4CAF50",secondary:"#66BB6A",accent:"#81C784",active:"#43A047",hover:"#388E3C",hangup:"#FF3B30"};case"orange":return{primary:"#FF9800",secondary:"#FFB74D",accent:"#FFCC80",active:"#FB8C00",hover:"#F57C00",hangup:"#FF3B30"}}}),h=e=>{const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?`${parseInt(a[1],16)}, ${parseInt(a[2],16)}, ${parseInt(a[3],16)}`:"33, 150, 243"};r(()=>c.selectedBackground,()=>{const e=p.value,a=document.documentElement;a.style.setProperty("--primary",e.primary),a.style.setProperty("--secondary",e.secondary),a.style.setProperty("--accent",e.accent),a.style.setProperty("--active",e.active),a.style.setProperty("--hover",e.hover),a.style.setProperty("--hangup",e.hangup);const t=h(e.primary),o=h(e.secondary),n=h(e.accent),l=h(e.active);a.style.setProperty("--primary-rgb",t),a.style.setProperty("--secondary-rgb",o),a.style.setProperty("--accent-rgb",n),a.style.setProperty("--active-rgb",l)},{immediate:!0});const f=()=>{d.value=!d.value,g("microphone-toggle",d.value)},k=()=>{u.value=!u.value,g("speaker-toggle",u.value)},w=()=>{v.value=!v.value,g("camera-toggle",v.value)},b=()=>{g("call-end")};return(e,a)=>(o(),n("div",da,[l("div",ua,[l("div",{class:"control-item",onClick:f},[l("div",{class:y(["control-button",{active:d.value}])},[s(i(x),{icon:d.value?"mingcute:mic-fill":"mingcute:mic-off-fill",class:"control-icon"},null,8,["icon"])],2)]),l("div",{class:"control-item",onClick:k},[l("div",{class:y(["control-button",{active:u.value}])},[s(i(x),{icon:u.value?"mingcute:volume-fill":"mingcute:volume-off-fill",class:"control-icon"},null,8,["icon"])],2)]),l("div",{class:"control-item",onClick:w},[l("div",{class:y(["control-button",{active:v.value}])},[s(i(x),{icon:v.value?"mingcute:camera-2-ai-fill":"mingcute:camera-2-off-line",class:"control-icon"},null,8,["icon"])],2)]),l("div",{class:"control-item",onClick:b},[l("div",va,[s(i(x),{icon:"mingcute:close-line",class:"control-icon"})])])])]))}}),[["__scopeId","data-v-f9ad0c65"]]),pa={class:"voice-call-container"},ma={class:"top-time-display"},ha={class:"call-duration"},ya={class:"subtitles-toggle-top-right"},fa={key:1,class:"dev-text-input-container"},ka={class:"dev-input-wrapper"},wa=["disabled"],ba={class:"dev-input-stats"},Ea={key:0},Ca=A(a({__name:"sdkwork-chat-component-voice",props:{conversationId:{},enableWave:{type:Boolean,default:!0}},emits:["mode-change"],setup(e,{emit:a}){const r=a,d=e,h=t("connecting"),f=t(!0),k=t(!0),E=t(!1),S=m(()=>"SPEAKING"===Q.value),T=t(null),D=t("00:00"),A=t(null),B=m(()=>d.enableWave??!0);let R,N;const F=t(!1),L=t(),P=t([{speaker:"AIÂä©Êâã",text:"ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÊâãÔºåÂæàÈ´òÂÖ¥‰∏∫ÊÇ®ÊúçÂä°„ÄÇ",time:"10:00"},{speaker:"Áî®Êà∑",text:"‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∫õÂÖ≥‰∫é‰∫ßÂìÅÁöÑÈóÆÈ¢ò„ÄÇ",time:"10:02"},{speaker:"AIÂä©Êâã",text:"ÂΩìÁÑ∂ÂèØ‰ª•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÔºü",time:"10:03"},{speaker:"Áî®Êà∑",text:"Ëøô‰∏™‰∫ßÂìÅÁöÑÂäüËÉΩÊúâÂì™‰∫õÁâπÁÇπÔºü",time:"10:05"},{speaker:"AIÂä©Êâã",text:"Êàë‰ª¨ÁöÑ‰∫ßÂìÅÂÖ∑ÊúâÊô∫ËÉΩÂØπËØù„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÂ§öËØ≠Ë®ÄÊîØÊåÅÁ≠âÂÖàËøõÂäüËÉΩ„ÄÇ",time:"10:06"}]);t(""),t(0);const K=t(0),$=t("AIÂä©Êâã"),j=t(""),H=t(!1),G=t(""),Y=t(0),W=t(""),q=t("default"),X=t([{id:"default",name:"ÈªòËÆ§",gradient:"linear-gradient(135deg, #007AFF 0%, #0056CC 100%)"},{id:"ocean",name:"Êµ∑Ê¥ã",gradient:"linear-gradient(135deg, #00B4DB 0%, #0083B0 100%)"},{id:"sunset",name:"Êó•ËêΩ",gradient:"linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%)"},{id:"forest",name:"Ê£ÆÊûó",gradient:"linear-gradient(135deg, #00D2FF 0%, #3A7BD5 100%)"},{id:"purple",name:"Á¥´Ëâ≤",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"green",name:"ÁªøËâ≤",gradient:"linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%)"}]),Q=m(()=>ae.speakState),Z=m(()=>{const e=X.value.find(e=>e.id===q.value);return{background:e?.gradient||"linear-gradient(135deg, #007AFF 0%, #0056CC 100%)"}}),J=m(()=>{switch(h.value){case"connecting":return"ËøûÊé•‰∏≠...";case"connected":return"ÈÄöËØù‰∏≠";case"ended":return"ÈÄöËØùÁªìÊùü";default:return"Êú™Áü•Áä∂ÊÄÅ"}}),ee=m(()=>{switch(Q.value){case"SPEAKING":return"ËØ¥ËØù‰∏≠";case"LISTENING":return"ËÅÜÂê¨‰∏≠";case"IDLE":return"Á©∫Èó≤";default:return"Êú™Áü•Áä∂ÊÄÅ"}}),ae=U(),te=e=>{ae.setSpeakState(e)},oe=M(),ne=()=>{F.value=!F.value,O(F.value?"Â≠óÂπïÂ∑≤ÂºÄÂêØ":"Â≠óÂπïÂ∑≤ÂÖ≥Èó≠"),F.value&&le()},le=()=>{K.value=Date.now(),L.value&&L.value.clearDynamicSubtitles(),L.value&&L.value.startPlayback()},ie=(e,a)=>{if(!F.value||!L.value)return;const t=Date.now()-K.value,o=t+5e3,n=`${a}Ôºö${e}`;L.value.addDynamicSubtitle(n,t,o,!0)},se=(e,a)=>{e&&console.log("Â≠óÂπïÂàáÊç¢:",e.text,a)},ce=async e=>{if(f.value=e,e)try{te("LISTENING"),await oe.startRecording({realtime:!0,waveContainer:A.value}),ae.startVoiceListening(),O("È∫¶ÂÖãÈ£éÂ∑≤ÂºÄÂêØ")}catch(a){console.error("ÂºÄÂêØÈ∫¶ÂÖãÈ£éÂ§±Ë¥•:",a),O("ÂºÄÂêØÈ∫¶ÂÖãÈ£éÂ§±Ë¥•")}else try{await oe.pauseRecording(),ae.stopVoiceListening(),te("IDLE"),O("È∫¶ÂÖãÈ£éÂ∑≤ÈùôÈü≥")}catch(a){console.error("ÂÖ≥Èó≠È∫¶ÂÖãÈ£éÂ§±Ë¥•:",a),O("ÂÖ≥Èó≠È∫¶ÂÖãÈ£éÂ§±Ë¥•")}},re=e=>{k.value=e,O(e?"Êâ¨Â£∞Âô®Â∑≤ÂºÄÂêØ":"Êâ¨Â£∞Âô®Â∑≤ÈùôÈü≥")},de=e=>{E.value=e,O(e?"ÊëÑÂÉèÂ§¥Â∑≤ÂºÄÂêØ":"ÊëÑÂÉèÂ§¥Â∑≤ÂÖ≥Èó≠")},ue=()=>{h.value="ended",te("IDLE"),O("ÈÄöËØùÂ∑≤ÁªìÊùü"),setTimeout(()=>{r("mode-change","text")},1e3)},ve=e=>{q.value=e,O("ËÉåÊôØÂ∑≤Êõ¥Êç¢")},ge=e=>{console.log("ËÉåÊôØÂ∑≤Êõ¥Êç¢‰∏∫:",e)},pe=async()=>{if(G.value.trim())try{console.log("ÂèëÈÄÅÂºÄÂèëÁéØÂ¢ÉÊñáÊú¨Ê∂àÊÅØ:",G.value),await ae.sendText(G.value),Y.value++,W.value=G.value.substring(0,20)+(G.value.length>20?"...":""),G.value="",O("ÊñáÊú¨Ê∂àÊÅØÂèëÈÄÅÊàêÂäü"),F.value&&ie(G.value,"Áî®Êà∑")}catch(e){console.error("ÂèëÈÄÅÊñáÊú¨Ê∂àÊÅØÂ§±Ë¥•:",e),O("ÂèëÈÄÅÊñáÊú¨Ê∂àÊÅØÂ§±Ë¥•")}},me=()=>{if(T.value&&"connected"===h.value){const e=new Date,a=Math.floor((e.getTime()-T.value.getTime())/1e3),t=Math.floor(a/60).toString().padStart(2,"0"),o=(a%60).toString().padStart(2,"0");D.value=`${t}:${o}`}};return g(async()=>{(()=>{const e=e=>{if(!e.detail)return;const{type:a,message:t,chunk:o}=e.detail;switch(console.log("Êî∂Âà∞Ê∂àÊÅØ‰∫ã‰ª∂:",{type:a,message:t,chunk:o}),a){case"MESSAGE_RECEIVED":console.log("Ê∂àÊÅØÊé•Êî∂ÂÆåÊàê:",t),"assistant"===t.role?(P.value.push({speaker:"AIÂä©Êâã",text:t.content,time:(new Date).toLocaleTimeString("zh-CN",{hour12:!1})}),F.value&&t.content&&(ie(t.content,"AIÂä©Êâã"),console.log("Â∑≤Ê∑ªÂä†AIÂä©ÊâãÂ≠óÂπï:",t.content))):"user"===t.role&&F.value&&t.content&&(ie(t.content,"Áî®Êà∑"),console.log("Â∑≤Ê∑ªÂä†Áî®Êà∑Â≠óÂπï:",t.content));break;case"MESSAGE_STREAM_UPDATE":if(console.log("Ê∂àÊÅØÊµÅÂºèÊõ¥Êñ∞:",{message:t,chunk:o}),o&&o.choices&&o.choices[0]&&o.choices[0].delta){const e=o.choices[0].delta;e.content&&console.log("ÊµÅÂºèÂÜÖÂÆπÊõ¥Êñ∞:",e.content)}break;default:console.log("Êú™Áü•Ê∂àÊÅØÁ±ªÂûã:",a)}},a=e=>{e.detail&&"AUDIO_STREAM_RECEIVED"===e.detail.type&&te("SPEAKING")};window.addEventListener("sdk:message",e),window.addEventListener("sdk:audioStream",a)})();try{ae.isInitialized||(await ae.initialize(),O("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÊàêÂäü")),await ae.enterVoiceRoom({enableWave:d.enableWave??!0,waveContainer:A.value,sampleRate:16e3,format:"pcm",realtime:!0,hello:{send:!0}}),O("ËØ≠Èü≥ÊàøÈó¥Â∑≤Âª∫Á´ã")}catch(e){console.error("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•:",e),O("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊ®°Âºè")}setTimeout(()=>{h.value="connected",T.value=new Date,O("ÈÄöËØùÂ∑≤ËøûÊé•")},2e3),R=setInterval(me,1e3),N=setInterval(()=>{const e=Math.random();if(e>.7){if(te("SPEAKING"),F.value){const e=["ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÊâãÔºåÂæàÈ´òÂÖ¥‰∏∫ÊÇ®ÊúçÂä°„ÄÇ","ÂΩìÁÑ∂ÂèØ‰ª•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÔºü","Êàë‰ª¨ÁöÑ‰∫ßÂìÅÂÖ∑ÊúâÊô∫ËÉΩÂØπËØù„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÂ§öËØ≠Ë®ÄÊîØÊåÅÁ≠âÂÖàËøõÂäüËÉΩ„ÄÇ","ÊÇ®ËøòÊúâÂÖ∂‰ªñÈóÆÈ¢òÈúÄË¶ÅÂí®ËØ¢ÂêóÔºü","ÊÑüË∞¢ÊÇ®ÁöÑ‰ΩøÁî®ÔºåÁ•ùÊÇ®ÁîüÊ¥ªÊÑâÂø´ÔºÅ"],a=e[Math.floor(Math.random()*e.length)];ie(a,"AIÂä©Êâã")}}else if(e>.4){if(te("LISTENING"),F.value){const e=["‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∫õÂÖ≥‰∫é‰∫ßÂìÅÁöÑÈóÆÈ¢ò„ÄÇ","Ëøô‰∏™‰∫ßÂìÅÁöÑÂäüËÉΩÊúâÂì™‰∫õÁâπÁÇπÔºü","‰ª∑Ê†ºÊòØÂ§öÂ∞ëÔºü","Â¶Ç‰Ωï‰ΩøÁî®Ëøô‰∏™‰∫ßÂìÅÔºü","Ë∞¢Ë∞¢‰Ω†ÁöÑËß£Á≠îÔºÅ"],a=e[Math.floor(Math.random()*e.length)];ie(a,"Áî®Êà∑")}}else te("IDLE")},5e3)}),p(async()=>{R&&(clearInterval(R),R=void 0),N&&(clearInterval(N),N=void 0);try{await ae.exitVoiceRoom(),console.log("ËØ≠Èü≥ÊàøÈó¥Â∑≤ÈÄÄÂá∫")}catch(e){console.error("ÈÄÄÂá∫ËØ≠Èü≥ÊàøÈó¥Â§±Ë¥•:",e)}oe.destroyRecorder()}),(e,a)=>(o(),n("div",{class:"chat-voice-mode",style:w(Z.value)},[l("div",pa,[l("div",ma,[l("div",ha,b(D.value),1),l("div",{class:y(["call-status",h.value])},b(J.value),3)]),s(ea,{"selected-background":q.value,"background-options":X.value,"onUpdate:selectedBackground":ve,onBackgroundChange:ge},null,8,["selected-background","background-options"]),l("div",ya,[l("div",{class:y(["subtitles-toggle-btn",{active:F.value}]),onClick:ne},[s(i(x),{icon:F.value?"mingcute:subtitle-fill":"mingcute:subtitle-line",width:"20",height:"20"},null,8,["icon"])],2)]),s(ra,{"caller-name":$.value,"caller-avatar":j.value,"is-speaking":S.value,"speak-state-text":ee.value},null,8,["caller-name","caller-avatar","is-speaking","speak-state-text"]),u(l("div",{ref_key:"waveContainerRef",ref:A,class:"wave-container"},null,512),[[_,B.value]]),F.value?(o(),C(z,{key:0,ref_key:"subtitlesRef",ref:L,"display-mode":i(V).LINE,"line-count":5,"show-controls":!1,position:"center","font-size":14,"font-color":"#ffffff","background-color":"rgba(0, 0, 0, 0.6)","show-background":!0,"auto-scroll":!0,onEntryChange:se},null,8,["display-mode"])):c("",!0),s(ga,{onMicrophoneToggle:ce,onSpeakerToggle:re,onCameraToggle:de,onCallEnd:ue}),H.value?(o(),n("div",fa,[a[1]||(a[1]=l("div",{class:"dev-input-header"},[l("span",{class:"dev-input-title"},"ÊµãËØïÊñáÊú¨ËæìÂÖ•"),l("span",{class:"dev-input-hint"},"ÔºàÂºÄÂèëÁéØÂ¢É‰∏ìÁî®Ôºâ")],-1)),l("div",ka,[u(l("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),type:"text",placeholder:"ËæìÂÖ•ÊµãËØïÊñáÊú¨Ê∂àÊÅØ...",class:"dev-text-input",onKeyup:I(pe,["enter"])},null,544),[[v,G.value]]),l("button",{onClick:pe,class:"dev-send-btn",disabled:!G.value.trim()}," ÂèëÈÄÅ ",8,wa)]),l("div",ba,[l("span",null,"Â∑≤ÂèëÈÄÅ: "+b(Y.value)+" Êù°",1),W.value?(o(),n("span",Ea,"ÊúÄÂêé: "+b(W.value),1)):c("",!0)])])):c("",!0)])],4))}}),[["__scopeId","data-v-df813176"]]),Sa={class:"mode-switch"},_a={class:"mode-switch",style:{"margin-left":"10px"}},Ia=A(a({__name:"sdkwork-chat-component",props:{conversationId:{},defaultMode:{default:"text"}},emits:["mode-change","back"],setup(a,{emit:t}){const n=a,d=t,u=T(),v=D(),y=U(),f=B(),k=K(),w=m(()=>y.currentChatMode),b=m(()=>{if(n.conversationId)return n.conversationId;const e=u.params.id;return Array.isArray(e)?e[0]:e||""}),E=()=>{if(n.defaultMode)return n.defaultMode;return"voice"===u.query.mode?"voice":"text"},S=m(()=>f.currentUser||{id:"user1",name:"ÂΩìÂâçÁî®Êà∑",avatar:"https://via.placeholder.com/40",online:!0}),_=m(()=>k.currentConversation),I=m(()=>"voice"===w.value?"ËØ≠Èü≥ÈÄöËØù":_.value?.title||"ÂØπËØùËØ¶ÊÉÖ"),A=async()=>{try{await y.switchChatMode("voice"),O("ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°Âºè")}catch(e){console.error("ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°ÂºèÂ§±Ë¥•:",e),O("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•")}},M=()=>{d("back")},R=()=>{v.push(`/chat/profile/${_.value?.agentId||0}`)},N=async e=>{try{await y.switchChatMode(e),d("mode-change",e)}catch(a){console.error("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•:",a),O("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•")}};return r(b,async e=>{if(e)try{await k.switchConversation(e)}catch(a){console.error("Âä†ËΩΩ‰ºöËØùÊï∞ÊçÆÂ§±Ë¥•:",a),O("Âä†ËΩΩ‰ºöËØùÊï∞ÊçÆÂ§±Ë¥•")}},{immediate:!0}),g(async()=>{if(!k.isInitialized)try{await k.initialize()}catch(e){console.error("ÂàùÂßãÂåñ‰ºöËØùÂ≠òÂÇ®Â§±Ë¥•:",e)}try{await y.initialize();const e=E();await y.enterChat({mode:e}),console.log("ËÅäÂ§©ÁªÑ‰ª∂Â∑≤ÊåÇËΩΩÂπ∂ËøõÂÖ•ËÅäÂ§©‰ºöËØùÔºåÊ®°Âºè:",e)}catch(e){console.error("ËÅäÂ§©ÁªÑ‰ª∂ÊåÇËΩΩÂ§±Ë¥•:",e)}console.log("Âä†ËΩΩÂØπËØù:",b.value),console.log("ÈªòËÆ§Ê®°Âºè:",E()),"voice"===E()&&O("Â∑≤ËøõÂÖ•ËØ≠Èü≥ÈÄöËØùÊ®°Âºè")}),p(async()=>{try{await y.exitChat(),console.log("ËÅäÂ§©ÁªÑ‰ª∂Â∑≤Âç∏ËΩΩÂπ∂ÈÄÄÂá∫ËÅäÂ§©‰ºöËØù")}catch(e){console.error("ËÅäÂ§©ÁªÑ‰ª∂Âç∏ËΩΩÂ§±Ë¥•:",e)}}),(a,t)=>{const n=e;return o(),C(n,null,{default:h(()=>["voice"===w.value?(o(),C(Ca,{key:0,"conversation-id":b.value,onModeChange:N},null,8,["conversation-id"])):(o(),C(Ye,{key:1,"conversation-id":b.value,"current-user":S.value,onModeChange:N},{header:h(()=>["text"===w.value?(o(),C(F,{key:0,title:I.value,"show-back":!0,"custom-right":!0,onLeftClick:M},{right:h(()=>[l("div",Sa,[s(i(x),{icon:"mingcute:phone-fill",width:"20",height:"20",class:"mode-switch-icon",onClick:A,title:"ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°Âºè"})]),l("div",_a,[s(i(x),{icon:"mingcute:more-1-fill",width:"16",height:"16",onClick:R})])]),_:1},8,["title"])):c("",!0)]),_:1},8,["conversation-id","current-user"]))]),_:1})}}}),[["__scopeId","data-v-06e91933"]]);export{Ia as S};
