import{S as e}from"./sdkwork-page-container-CTgESEfu.js";import{k as a,f as o,a as t,w as l,P as s,Q as i,S as n,W as r,Z as d,j as c,$ as u,a1 as m,a0 as p,a4 as g,R as h,V as v,r as f,O as k}from"./vue-vendor-BOogp7Xw.js";import{B as b,I as w,s as y,a as x,_ as C,u as V}from"./index-BWqFoNHJ.js";/* empty css              */import{_ as j,a as _}from"./sdkwork-collapse-item-g_7R1wS8.js";import{_ as M}from"./sdkwork-popup-DdVoNvKm.js";/* empty css              */import"./index-gxBGVVhV.js";import{P as z}from"./index-BFHNzIC9.js";import{S as B}from"./index-WMeHWsPV.js";import{_ as I,a as A}from"./sdkwork-cell-group-Cxx6Fokp.js";/* empty css              *//* empty css              */import{S as U}from"./sdkwork-voice-speaker-category-list-popup-hpcdLUli.js";import{I as F}from"./index-vESlx1lA.js";import{U as P}from"./sdkwork-voice-clone-B3MMt-Y4.js";import{A as $}from"./agent-Dh0N0SHM.js";import{F as T}from"./index-B0qHQz1m.js";import"./utils-vendor-WEzSe-CR.js";import"./index-BiePM9Ph.js";import"./sdkwork-icon-CRFBEh8F.js";import"./sdkwork-pull-refresh-DgyaCCGo.js";import"./index-BLpy6kUn.js";import"./shared-B-9fzjxV.js";import"./sdkwork-search-bar-D0Dr2pbD.js";import"./index-C_iDU2JZ.js";import"./use-id-Dx2a3-Lt.js";import"./ListItem-T6yJlaJ8.js";import"./LoadingSection-BuNRibDT.js";import"./LoadMoreSection-DUM7NAWd.js";const H={class:"sdkwork-avatar"},S={key:0,class:"upload-overlay"},q={class:"progress-text"},L={class:"placeholder-text"},R={key:3,class:"avatar-actions"},G=C(a({__name:"sdkwork-avatar",props:{modelValue:{},src:{},size:{default:"40px"},uploadable:{type:Boolean,default:!0},showAiGenerate:{type:Boolean,default:!1},round:{type:Boolean,default:!0},text:{default:""},background:{default:"#f5f5f5"},disabled:{type:Boolean,default:!1},showClear:{type:Boolean,default:!1},uploadConfig:{}},emits:["update:modelValue","upload","upload-start","upload-progress","upload-complete","upload-error","aiGenerate","click","clear"],setup(e,{emit:a}){const f=e,k=a,C=o({get:()=>f.modelValue||f.src,set:e=>k("update:modelValue",e||"")}),V=t(!1),j=t(0),_=t(null),M=t(null),z=async e=>{let a=null;if(e instanceof File)a=e;else if(e&&e.file instanceof File)a=e.file;else if(e&&e.content&&e.content instanceof File)a=e.content;else if(Array.isArray(e)&&e.length>0){const o=e[0];o.file instanceof File?a=o.file:o.content instanceof File&&(a=o.content)}if(!a)return y("无效的文件格式"),!1;if(!a.type?.startsWith("image/"))return y("请上传图片文件"),!1;if(a.size>5242880)return y("图片大小不能超过5MB"),!1;const o=new FileReader;return o.onload=e=>{const a=e.target?.result;C.value=a},o.readAsDataURL(a),k("upload",a),await B(a),!0},B=async e=>{if(window.$uploader)try{V.value=!0,j.value=0,k("upload-start",e);const a=f.uploadConfig||{},o={file:e,bucket:a.bucket||{name:"public"},name:e.name,scene:"avatar",metadata:a.metadata||{},contentType:a.contentType||e.type,acl:a.acl||"public-read"},t=await window.$uploader.upload(o,e=>{j.value=e.percentage,k("upload-progress",e)});t.taskId&&(_.value=t.taskId),t.url&&t.url.startsWith("http")?(C.value=t.url,y("头像上传成功"),k("upload-complete",t)):(console.warn("上传返回的URL无效，保持本地预览:",t.url),y("头像上传完成，但URL无效"))}catch(a){console.error("头像上传失败:",a),y("头像上传失败，请重试"),k("upload-error",a)}finally{V.value=!1,j.value=0}else y("上传器未初始化")},I=()=>{V.value&&window.$uploader&&(_.value?window.$uploader.cancel(_.value):window.$uploader.cancelAll(),V.value=!1,j.value=0,_.value=null,y("上传已取消"),C.value="")},A=()=>{x({title:"AI生成头像",message:"确定要使用AI生成头像吗？",showCancelButton:!0,confirmButtonText:"生成",cancelButtonText:"取消"}).then(()=>{k("aiGenerate"),y("正在生成头像...")})},U=()=>{!f.disabled&&C.value&&x({title:"清空头像",message:"确定要清空当前头像吗？",showCancelButton:!0,confirmButtonText:"清空",cancelButtonText:"取消"}).then(()=>{C.value="",y("头像已清空"),k("clear")})},$=()=>{f.disabled||!f.uploadable||V.value||setTimeout(()=>{if(M.value)M.value.chooseFile();else{const e=document.querySelector('.upload-btn input[type="file"]');e&&e.click()}},10),k("click")},T=o(()=>({width:"number"==typeof f.size?`${f.size}px`:f.size,height:"number"==typeof f.size?`${f.size}px`:f.size,backgroundColor:f.background}));return l(()=>f.src,e=>{f.modelValue||(C.value=e)}),l(()=>f.modelValue,e=>{C.value=e}),(a,o)=>{const t=b,l=w,f=F,k=P;return i(),s("div",H,[n("div",{class:"avatar-container",onClick:$},[V.value?(i(),s("div",S,[o[3]||(o[3]=n("div",{class:"loading-spinner"},null,-1)),n("div",q,u(j.value)+"%",1),c(t,{type:"danger",onClick:m(I,["stop"]),class:"cancel-btn"},{default:p(()=>[...o[2]||(o[2]=[g(" 取消 ",-1)])]),_:1})])):r("",!0),C.value?(i(),d(f,{key:1,src:C.value,width:e.size,height:e.size,fit:"cover",class:h([{disabled:e.disabled,round:e.round,square:!e.round,uploading:V.value},"avatar-image"])},{extra:p(()=>[e.showClear&&!V.value?(i(),s("div",{key:0,class:"clear-btn",onClick:m(U,["stop"])},[c(l,{name:"cross",size:"12",color:"#fff"})])):r("",!0)]),_:1},8,["src","width","height","class"])):(i(),s("div",{key:2,class:h(["avatar-placeholder",{round:e.round,square:!e.round,uploading:V.value}]),style:v(T.value)},[n("span",L,u(e.text),1)],6)),!e.uploadable&&!e.showAiGenerate||V.value?r("",!0):(i(),s("div",R,[e.uploadable?(i(),d(k,{key:0,disabled:e.disabled,"after-read":z,"max-count":1,"preview-image":!1,"show-upload":!1,accept:"image/*",class:"upload-btn",ref_key:"uploaderRef",ref:M,onClick:o[1]||(o[1]=m(()=>{},["stop"]))},{default:p(()=>[c(t,{type:"primary",disabled:e.disabled,class:"action-btn",onClick:o[0]||(o[0]=m(()=>{},["stop"]))},{default:p(()=>[...o[4]||(o[4]=[g(" 上传 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):r("",!0),e.showAiGenerate?(i(),d(t,{key:1,type:"success",disabled:e.disabled,onClick:A,class:"action-btn ai-generate-btn"},{default:p(()=>[...o[5]||(o[5]=[g(" AI生成 ",-1)])]),_:1},8,["disabled"])):r("",!0)]))])])}}}),[["__scopeId","data-v-24222b83"]]),O={class:"header-section"},D={class:"avatar-container"},W={class:"name-field-wrapper"},K={class:"char-count-bottom"},N={class:"prompt-field-wrapper"},E={class:"char-count-bottom"},Q={class:"char-count"},Z={class:"voice-selector"},J={key:0,class:"selected-voice"},X={key:1,class:"placeholder"},Y={class:"description-field-wrapper"},ee={class:"char-count-bottom"},ae={class:"welcome-field-wrapper"},oe={class:"char-count-bottom"},te={class:"char-count"},le={class:"permission-value"},se={class:"bottom-action-bar"},ie=C(a({__name:"sdkwork-agent-create",props:{themeMode:{default:"auto"}},emits:["agent-created","agent-canceled"],setup(e,{expose:a,emit:l}){const m=e,v=o(()=>"dark"===m.themeMode||"light"!==m.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),k=o(()=>v.value?"sdkwork-agent-create--dark":"sdkwork-agent-create--light"),x=t(!1),C=t(!1),V=t(!1),F=t([]),P=t(""),H=t(""),S=t(["view"]),q=new $,L=o(()=>"100%"),R=[{text:"查看",value:"view"},{text:"交互",value:"interact"},{text:"分享",value:"share"}],ie=t(""),ne=f({name:"",description:"",isPublic:!1,permissions:[],prompt:{content:""},greeting:"",baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),re=o(()=>ne.name.trim()&&ne.name.length<=20&&ne.description.length<=200),de=()=>{ne.name.trim()?ne.name.length>20?P.value="名称不能超过20个字符":P.value="":P.value="名称不能为空"},ce=e=>{console.log("头像上传:",e),ne.faceImage={url:ie.value,type:1,size:e.size},y("头像上传成功")},ue=()=>{console.log("头像被点击")},me=e=>{const a={id:e.id?.toString(),displayName:e.name,description:e.description,provider:"default",product:"default",model:"default",voice:e.name};ne.speechConfig={speakerConfig:{speaker:a}},C.value=!1,y(`已选择: ${e.name}`)},pe=e=>{if(!e||0===e.length)return"";const a=R.find(a=>a.value===e[0]);return a?a.text:""},ge=e=>{let a;console.log("Picker返回的值:",e),a=Array.isArray(e)?e[0]:e&&"object"==typeof e?e:{text:e,value:e},ne.permissions=a.value||a,V.value=!1,y(`已选择: ${a.text||a}`)},he=async()=>{if(de(),!P.value&&ne.name.trim()){x.value=!0;try{ie.value&&!ne.faceImage&&(ne.faceImage={url:ie.value,type:1,size:0});const e={name:ne.name,description:ne.description,faceImage:ne.faceImage,faceVideo:ne.faceVideo,icon:ne.icon,tags:ne.tags,prompt:ne.prompt,greeting:ne.greeting,speechConfig:ne.speechConfig,isPublic:ne.isPublic,permissions:ne.permissions,baseConfig:ne.baseConfig,type:ne.type,status:ne.status,knowledgeConfig:ne.knowledgeConfig,memoryConfig:ne.memoryConfig,toolConfig:ne.toolConfig,chatOptions:ne.chatOptions};q.create(e),y("智能体创建成功"),console.log("智能体创建成功，提交的数据:",e)}catch(e){console.error("智能体创建失败:",e),y("创建失败，请重试")}finally{x.value=!1}}else y("请完善基本信息")};return a({resetForm:()=>{ie.value="",Object.assign(ne,{name:"",description:"",faceImage:void 0,faceVideo:void 0,icon:void 0,tags:void 0,prompt:{content:""},greeting:"",speechConfig:void 0,isPublic:!1,permissions:[],baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),F.value=[]},getFormData:()=>ne,setFormData:e=>{Object.assign(ne,e)}}),(a,o)=>{const t=T,l=I,m=w,v=A,f=B,y=z,$=M,q=j,ve=_,fe=b;return i(),s("div",{class:h(["agent-create",k.value])},[n("div",O,[n("div",D,[c(G,{modelValue:ie.value,"onUpdate:modelValue":o[0]||(o[0]=e=>ie.value=e),size:80,uploadable:!0,"show-ai-generate":!1,round:!0,text:"头像","theme-mode":e.themeMode,onUpload:ce,onClick:ue,class:"avatar-uploader"},null,8,["modelValue","theme-mode"])]),c(l,{class:"name-section","theme-mode":e.themeMode},{default:p(()=>[n("div",W,[c(t,{modelValue:ne.name,"onUpdate:modelValue":o[1]||(o[1]=e=>ne.name=e),placeholder:"请输入智能体名称",maxlength:20,"error-message":P.value,size:"large",onBlur:de,center:""},null,8,["modelValue","error-message"]),n("div",K,[n("span",{class:h(["char-count",{error:ne.name.length>20}])},u(ne.name.length)+"/20 ",3)])])]),_:1},8,["theme-mode"])]),c(l,{class:"basic-info-section","theme-mode":e.themeMode},{default:p(()=>[n("div",N,[c(t,{modelValue:ne.prompt.content,"onUpdate:modelValue":o[2]||(o[2]=e=>ne.prompt.content=e),label:"提示词","label-align":"top",type:"textarea",placeholder:"请输入角色提示词",autosize:{minHeight:100,maxHeight:200},maxlength:1e3},null,8,["modelValue"]),n("div",E,[n("span",Q,u(ne.prompt.content?.length||0)+"/1000 ",1)])])]),_:1},8,["theme-mode"]),c(l,{class:"voice-section","theme-mode":e.themeMode},{default:p(()=>[c(v,{title:"发音人",center:"","is-link":"",onClick:o[3]||(o[3]=e=>C.value=!0),"theme-mode":e.themeMode},{value:p(()=>[n("div",Z,[c(m,{name:"music",class:"voice-icon"}),ne.speechConfig?.speakerConfig?.speaker?(i(),s("span",J,u(ne.speechConfig.speakerConfig.speaker.displayName),1)):(i(),s("span",X,"请选择发音人"))])]),_:1},8,["theme-mode"]),n("div",Y,[c(t,{modelValue:ne.description,"onUpdate:modelValue":o[4]||(o[4]=e=>ne.description=e),label:"描述","label-align":"top",type:"textarea",placeholder:"请输入智能体描述",maxlength:200,autosize:{minHeight:80,maxHeight:120},"error-message":H.value},null,8,["modelValue","error-message"]),n("div",ee,[n("span",{class:h(["char-count",{error:ne.description.length>200}])},u(ne.description.length)+"/200 ",3)])])]),_:1},8,["theme-mode"]),c(ve,{modelValue:F.value,"onUpdate:modelValue":o[11]||(o[11]=e=>F.value=e),class:"other-settings-section","theme-mode":e.themeMode},{default:p(()=>[c(q,{title:"其他设置",name:"other","theme-mode":e.themeMode},{default:p(()=>[n("div",ae,[c(t,{modelValue:ne.baseConfig.welcome,"onUpdate:modelValue":o[5]||(o[5]=e=>ne.baseConfig.welcome=e),label:"默认开场白","label-align":"top",type:"textarea",placeholder:"请输入默认开场白",autosize:{minHeight:80,maxHeight:120},maxlength:500},null,8,["modelValue"]),n("div",oe,[n("span",te,u(ne.baseConfig?.welcome?.length||0)+"/500 ",1)])]),c(l,{"theme-mode":e.themeMode},{default:p(()=>[c(v,{title:"公开智能体",center:"","theme-mode":e.themeMode},{value:p(()=>[c(f,{modelValue:ne.isPublic,"onUpdate:modelValue":o[6]||(o[6]=e=>ne.isPublic=e),size:"20"},null,8,["modelValue"])]),_:1},8,["theme-mode"]),ne.isPublic?(i(),d(v,{key:0,title:"权限设置",center:"","is-link":"",onClick:o[7]||(o[7]=e=>V.value=!0),"theme-mode":e.themeMode},{value:p(()=>[n("span",le,u(pe(ne.permissions)||"请选择权限"),1)]),_:1},8,["theme-mode"])):r("",!0),c($,{show:V.value,"onUpdate:show":o[10]||(o[10]=e=>V.value=e),position:"bottom",round:"","theme-mode":e.themeMode},{default:p(()=>[c(y,{columns:R,modelValue:S.value,"onUpdate:modelValue":o[8]||(o[8]=e=>S.value=e),onConfirm:ge,onCancel:o[9]||(o[9]=e=>V.value=!1),title:"选择权限"},null,8,["modelValue"])]),_:1},8,["show","theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["modelValue","theme-mode"]),n("div",se,[c(fe,{type:"primary",size:"large",block:"",loading:x.value,disabled:!re.value,onClick:he,class:"create-button"},{default:p(()=>[...o[14]||(o[14]=[g(" 创建智能体 ",-1)])]),_:1},8,["loading","disabled"])]),c(U,{modelValue:C.value,"onUpdate:modelValue":o[12]||(o[12]=e=>C.value=e),title:"选择发音人",height:L.value,"selected-speaker-id":ne.speechConfig?.speakerConfig?.speaker?.id,"theme-mode":e.themeMode,onConfirm:me,onClose:o[13]||(o[13]=e=>C.value=!1)},null,8,["modelValue","height","selected-speaker-id","theme-mode"])],2)}}}),[["__scopeId","data-v-4243fd2e"]]),ne=C(a({__name:"create",setup(a){const l=k(),{t:s}=V(),n=t("auto");o(()=>"dark"===n.value||"light"!==n.value&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches));const r=e=>{console.log("智能体创建成功:",e),y({message:s("agent.create.successMessage"),type:"success",duration:2e3}),setTimeout(()=>{l.push("/agent/list")},2e3)},u=()=>{console.log("智能体创建取消"),y({message:s("agent.create.cancelMessage"),type:"fail",duration:1500}),setTimeout(()=>{l.back()},1500)};return(a,o)=>{const t=e;return i(),d(t,{class:"agent-create-page"},{default:p(()=>[c(ie,{onAgentCreated:r,onAgentCanceled:u,"theme-mode":n.value,class:"agent-create-component"},null,8,["theme-mode"])]),_:1})}}}),[["__scopeId","data-v-6e8fcb31"]]);export{ne as default};
