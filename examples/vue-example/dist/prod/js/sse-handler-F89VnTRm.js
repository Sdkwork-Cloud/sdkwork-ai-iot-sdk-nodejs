import{M as t,y as e,aX as n,j as a}from"./index-cvC_tnhK.js";import{M as s}from"./chat-eSazejG-.js";import"./vue-vendor-Caw1HGjZ.js";import"./utils-vendor-WEzSe-CR.js";import"./conversation-C9A_VfvY.js";import"./sdkwork_stream_player-B08I9Xf0.js";class o{agentChatManager;constructor(){this.agentChatManager=t.create(e.AgentChatManager)}async stop(t,e){const n=await this.agentChatManager.stop(t,e);return null==n||null==n.data?Promise.reject(new Error("data error!")):n.data}async create(t,e,n){const a=await this.agentChatManager.create(t,e,n);if(t.stream)return a;return a.data}async resumeStream(t,e,n){const a=await this.agentChatManager.resumeStream(t,e,n);if(t.stream)return a;return a.data}}class i{name="SseMessageHandler";connectionState;eventEmitter;eventAdapter;config;constructor(t,e,a){this.config=t,this.eventEmitter=e,this.eventAdapter=a,this.connectionState={state:n.DISCONNECTED,connected:!1}}async initialize(){try{await this.setupSseConnection(),this.setupEventListeners(),this.updateConnectionState({state:n.CONNECTED,connected:!0})}catch(t){throw this.eventEmitter.emit(this.eventAdapter.adaptErrorOccurred(t)),t}}disconnect(){this.updateConnectionState({state:n.DISCONNECTED,connected:!1})}startListening(){}stopListening(){}async send(t,e){const n=new o;let i;i="string"==typeof t?{messages:[{role:a.ChatCompletionRole.user,content:t}],stream:!0}:s.toCompletionParam(t);const r=await n.create(i,{conversationId:e.conversation_id,id:e.agent_id});for await(const a of r)this.eventEmitter.emit(this.eventAdapter.adaptMessageChunkReceived({chunk:a,channelMsgId:a.id,id:a.id}))}sendAudioStream(t,e,n){}sendHello(t,e){}sendEvent(t,e){}sendProtocol(t){}getConnectionState(){return this.connectionState}isConnected(){return this.connectionState.connected}onEvent(t,e){}onMessage(t){}onAudioStream(t){}onData(t){}onToolCall(t){}offData(t){}offEvent(t,e){}onError(t){}offError(t){}async destroy(){this.disconnect()}async reconnect(){this.disconnect(),await this.initialize()}async setupSseConnection(){}setupEventListeners(){}updateConnectionState(t){this.connectionState=t,this.eventEmitter.emit(this.eventAdapter.adaptConnectionChange(t))}}export{i as SseMessageHandler};
