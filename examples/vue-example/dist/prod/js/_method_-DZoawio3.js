import{S as a}from"./sdkwork-page-container-CTgESEfu.js";import{k as o,a as s,f as t,o as e,P as l,Q as i,S as r,W as n,F as c,Y as u,V as h,R as d,$ as p,w as m,Z as v,a0 as g,_ as f,O as k,a3 as w}from"./vue-vendor-BOogp7Xw.js";import{S as y}from"./sdkwork-auth-login-7nNM0OCO.js";import{h as A,_}from"./index-BWqFoNHJ.js";import"./index-B0qHQz1m.js";import"./index-BiePM9Ph.js";import"./use-id-Dx2a3-Lt.js";import"./index-fpzpDTgo.js";import"./Checker-yGAntMIS.js";import"./index-aJGZwLEn.js";import"./utils-vendor-WEzSe-CR.js";const j={class:"sdkwork-auth-oauth-login"},O={class:"oauth-platforms"},C=["onClick"],b={class:"platform-icon"},x={class:"platform-name"},S={key:0,class:"platform-loading"},L={class:"oauth-options"},R={key:0,class:"oauth-error"},E={key:1,class:"oauth-config-hint"},I=_(o({__name:"sdkwork-auth-oauth-login",props:{showAccountLogin:{type:Boolean,default:!0},showRegister:{type:Boolean,default:!0},redirectUri:{},compact:{type:Boolean,default:!1}},emits:["oauth-started","oauth-success","oauth-error","switch-to-account","switch-to-register"],setup(a,{expose:o,emit:m}){const v=a,g=m,f=A(),k=s(null),w=s(""),y=t(()=>f.getOAuthPlatforms());return o({handleOAuthCallback:async(a,o)=>{try{k.value=o,w.value="",await f.handleOAuthCallback(a,o),g("oauth-success",o)}catch(s){const a=s instanceof Error?s.message:"OAuth2回调处理失败";w.value=a,g("oauth-error",a),console.error("OAuth2回调处理失败:",s)}finally{k.value=null}},clearError:()=>{w.value=""}}),e(()=>{console.log("OAuth2登录组件已加载，可用平台:",y.value.map(a=>a.displayName))}),(o,s)=>(i(),l("div",j,[s[7]||(s[7]=r("div",{class:"oauth-header"},[r("h2",{class:"oauth-title"},"第三方登录"),r("p",{class:"oauth-subtitle"},"选择您喜欢的登录方式")],-1)),r("div",O,[(i(!0),l(c,null,u(y.value,a=>(i(),l("div",{key:a.provider,class:"oauth-platform-item",style:h({"--platform-color":a.color}),onClick:o=>(async a=>{try{k.value=a,w.value="",g("oauth-started",a),f.authorizeOAuth({provider:a,redirectUri:v.redirectUri}),g("oauth-success",a)}catch(o){const a=o instanceof Error?o.message:"OAuth2登录失败";w.value=a,g("oauth-error",a),console.error("OAuth2登录失败:",o)}finally{k.value=null}})(a.provider)},[r("div",b,[r("i",{class:d(a.icon)},null,2)]),r("span",x,p(a.displayName),1),k.value===a.provider?(i(),l("div",S,[...s[2]||(s[2]=[r("i",{class:"i-mdi-loading animate-spin"},null,-1)])])):n("",!0)],12,C))),128))]),s[8]||(s[8]=r("div",{class:"oauth-divider"},[r("span",{class:"divider-text"},"或")],-1)),r("div",L,[a.showAccountLogin?(i(),l("button",{key:0,class:"oauth-option-btn",onClick:s[0]||(s[0]=a=>o.$emit("switch-to-account"))},[...s[3]||(s[3]=[r("i",{class:"i-mdi-account"},null,-1),r("span",null,"账号密码登录",-1)])])):n("",!0),a.showRegister?(i(),l("button",{key:1,class:"oauth-option-btn",onClick:s[1]||(s[1]=a=>o.$emit("switch-to-register"))},[...s[4]||(s[4]=[r("i",{class:"i-mdi-account-plus"},null,-1),r("span",null,"注册新账号",-1)])])):n("",!0)]),w.value?(i(),l("div",R,[s[5]||(s[5]=r("i",{class:"i-mdi-alert-circle"},null,-1)),r("span",null,p(w.value),1)])):n("",!0),y.value.length?n("",!0):(i(),l("div",E,[...s[6]||(s[6]=[r("div",{class:"config-hint-content"},[r("i",{class:"i-mdi-cog"}),r("div",{class:"hint-text"},[r("p",null,"未配置OAuth2平台"),r("p",{class:"hint-detail"},"请在环境变量中配置相应的CLIENT_ID")])],-1)])]))]))}}),[["__scopeId","data-v-286cf236"]]),T=_(o({__name:"[method]",setup(o){const s={account:y,oauth:I},e=k(),l=w(),r=t(()=>{const a=l.params.method;return a&&a in s?a:"account"}),n=t(()=>s[r.value]),c=a=>{console.log("登录成功:",a),e.push("/")},u=a=>{console.error("登录失败:",a)},h=()=>{e.push("/auth/register")},d=()=>{e.push("/auth/forgot-password")},p=()=>{e.push("/login/account")};return m(()=>l.params.method,a=>{console.log("登录方法已切换:",a)}),(o,s)=>{const t=a;return i(),v(t,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:g(()=>[(i(),v(f(n.value),{onLoginSuccess:c,onLoginFailed:u,onRegisterClick:h,onForgotPassword:d,onSwitchToAccount:p,onSwitchToRegister:h},null,32))]),_:1})}}}),[["__scopeId","data-v-6b0a3a08"]]);export{T as default};
