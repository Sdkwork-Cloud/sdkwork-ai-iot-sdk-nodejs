import{D as e,u as t,S as a,E as r}from"./shared-3kSlEU-o.js";import{B as o,I as i,_ as n}from"./index-DvK_64jm.js";/* empty css              *//* empty css              *//* empty css              */import{k as l,f as s,P as d,Q as u,R as c,W as f,S as p,j as m,a1 as g,a0 as h,U as y,w as v,r as b,X as w,F as A,Y as O,V as S,A as _,B as k,u as x,p as D,b as I,n as z,o as B,Z as E,ac as P,ad as R}from"./vue-vendor-Caw1HGjZ.js";import{C as j}from"./index-BaRUAN3s.js";import{L as C}from"./LoadingSection-FcPgi3ii.js";import{L as M}from"./LoadMoreSection-FBbM7HDQ.js";const T={key:0,class:"selection-overlay"},$={key:1,class:"delete-overlay"},L={class:"waterfall-item-content"},N=n(l({__name:"WaterfallItem",props:{item:{},index:{},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},itemKey:{default:"id"},itemTitleField:{default:"name"},itemDescriptionField:{default:"description"}},emits:["select","delete","click"],setup(e,{emit:t}){const a=e,r=t,n=e=>{a.selectable&&r("select",a.item)},l=()=>{a.selectable?n(b.value):r("click",a.item)},v=()=>{a.deletable&&r("delete",a.item)},b=s(()=>a.isSelected);return s(()=>a.item[a.itemTitleField]||""),s(()=>a.item[a.itemDescriptionField]||""),(t,a)=>{const r=j,s=i,w=o;return u(),d("div",{class:c(["waterfall-item",{"waterfall-item--selected":b.value,"waterfall-item--selectable":e.selectable,"waterfall-item--deletable":e.deletable}]),onClick:l},[e.selectable?(u(),d("div",T,[m(r,{"model-value":b.value,"onUpdate:modelValue":n,onClick:a[0]||(a[0]=g(()=>{},["stop"])),class:"selection-checkbox"},null,8,["model-value"])])):f("",!0),e.deletable?(u(),d("div",$,[m(w,{type:"danger",round:"",onClick:g(v,["stop"]),class:"delete-button"},{default:h(()=>[m(s,{name:"delete",size:"14"})]),_:1})])):f("",!0),p("div",L,[y(t.$slots,"default",{item:e.item,index:e.index,selected:b.value},void 0,!0)])],2)}}}),[["__scopeId","data-v-65207a2e"]]);const W="undefined"!=typeof window;function F(e,t=200,a={}){return function(e,t){return function(...a){e(()=>t.apply(this,a),{fn:t,thisArg:this,args:a})}}(function(e,t={}){let a,r;return o=>{const i=x(e),n=x(t.maxWait);if(a&&clearTimeout(a),i<=0||void 0!==n&&n<=0)return r&&(clearTimeout(r),r=null),o();n&&!r&&(r=setTimeout(()=>{a&&clearTimeout(a),r=null,o()},n)),a=setTimeout(()=>{r&&clearTimeout(r),r=null,o()},i)}}(t,a),e)}const G=W?window:void 0,K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},V="__vueuse_ssr_handlers__";K[V]=K[V]||{};var H,U,q=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;function Y(e,t,a={}){const r=a,{window:o=G}=r,i=((e,t)=>{var a={};for(var r in e)X.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&q)for(var r of q(e))t.indexOf(r)<0&&Q.call(e,r)&&(a[r]=e[r]);return a})(r,["window"]);let n;const l=o&&"ResizeObserver"in o,s=()=>{n&&(n.disconnect(),n=void 0)},d=v(()=>function(e){var t;const a=x(e);return null!=(t=null==a?void 0:a.$el)?t:a}(e),e=>{s(),l&&o&&e&&(n=new ResizeObserver(t),n.observe(e,i))},{immediate:!0,flush:"post"}),u=()=>{s(),d()};var c;return c=u,_()&&k(c),{isSupported:l,stop:u}}W&&(null==window?void 0:window.navigator)&&(null==(H=null==window?void 0:window.navigator)?void 0:H.platform)&&/iP(ad|hone|od)/.test(null==(U=null==window?void 0:window.navigator)?void 0:U.platform);function Z(e){const t=b(0),a=b(null);Y(a,e=>{const a=e[0],{width:r}=a.contentRect;t.value=r});const r=s(()=>(({breakpoints:e,wrapperWidth:t,gutter:a,hasAroundGutter:r,initWidth:o})=>{const i=Object.keys(e).map(e=>Number(e)).sort((e,t)=>e-t);let n=t,l=!1;for(const u of i)if(t<=u){n=u,l=!0;break}if(!l)return o;let s=0;const d=e[n].rowPerView;return s=r?(t-a)/d-a:(t-(d-1)*a)/d,Math.floor(s)})({wrapperWidth:t.value,breakpoints:e.breakpoints,gutter:e.gutter,hasAroundGutter:e.hasAroundGutter,initWidth:e.width})),o=s(()=>{const a=e.hasAroundGutter?-e.gutter:e.gutter,o=(t.value+a)/(r.value+e.gutter);return Math.floor(o)}),i=s(()=>{if("left"===e.align)return 0;if("center"===e.align){const a=e.hasAroundGutter?e.gutter:-e.gutter,i=o.value*(r.value+e.gutter)+a;return(t.value-i)/2}{const a=e.hasAroundGutter?e.gutter:-e.gutter,i=o.value*(r.value+e.gutter)+a;return t.value-i}});return{waterfallWrapper:a,wrapperWidth:t,colWidth:r,cols:o,offsetX:i}}function J(e,t){return new RegExp(`(^|\\s)${t}(\\s|$)`).test(e.className)}function ee(e,t){if(J(e,t))return;const a=e.className.split(/\s+/);a.push(t),e.className=a.join(" ")}const te=document.createElement("div").style,ae=(()=>{const e={standard:"transform",webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform"};for(const t in e){if(void 0!==te[e[t]])return t}return!1})();function re(e){return!1!==ae&&("standard"===ae?e:ae+e.charAt(0).toUpperCase()+e.substr(1))}const oe=re("transform"),ie=re("animation-duration"),ne=re("animation-delay"),le=re("transition"),se=re("animation-fill-mode");function de(e,t,a,r,o,i,n){const l=b([]),s=b(0),d=a=>{const o=e.hasAroundGutter?a+1:a;return e.gutter*o+t.value*a+r.value},u=t=>{const a=t.firstChild;if(a&&!J(a,e.animationPrefix)){const t=a.style;ee(a,e.animationPrefix),ee(a,e.animationEffect),ie&&(t[ie]=e.animationDuration/1e3+"s"),ne&&(t[ne]=e.animationDelay/1e3+"s"),se&&(t[se]="both")}};return{wrapperHeight:s,layoutHandle:async(r=!1)=>{if(!o.value)return!1;(()=>{const t=e.space||e.gutter;l.value=new Array(a.value).fill(e.hasAroundGutter?t:0)})();const c=o.value,f=[];if(c.childNodes.forEach(e=>{var t;1===(null==e?void 0:e.nodeType)&&(null==(t=e.classList)?void 0:t.contains("waterfall-item"))&&f.push(e)}),0===f.length)return!1;const p=f.map(e=>e.offsetHeight||e.getBoundingClientRect().height),m=e.posDuration/1e3,g=[];for(let o=0;o<f.length;o++){const s=i?o%a.value:ue(l.value,n),c=l.value[s],m=d(s),h=p[o],y=f[o];g.push(()=>{const a=y.style;oe&&(a[oe]=`translate3d(${Math.floor(m)}px,${Math.floor(c)}px,0)`),a.width=`${t.value}px`,a.visibility="visible",r||e.animationCancel||u(y)});const v=e.space||e.gutter;l.value[s]+=h+v}return s.value=Math.max(...l.value),r?(g.forEach(e=>e()),!0):new Promise(t=>{requestAnimationFrame(()=>{g.forEach(e=>e()),requestAnimationFrame(()=>{for(const e of f){const t=e.style;le&&(t[le]=`transform ${m}s`)}setTimeout(()=>t(!0),e.posDuration)})})})}}}function ue(e,t){if(0===e.length)return-1;const a=Math.min(...e),r=a+t;let o=-1;for(let i=0;i<e.length;i++)if(e[i]>=a&&e[i]<=r){o=i;break}return o}const ce="undefined"!=typeof window&&null!==window,fe=function(){if(ce&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)return"isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0;return!1}(),pe=Object.prototype.propertyIsEnumerable,me=Object.getOwnPropertySymbols;function ge(e){return"function"==typeof e||"[object Object]"===toString.call(e)}function he(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e}function ye(e,...t){if(!ge(e))throw new TypeError("expected the first argument to be an object");if(0===t.length||"function"!=typeof Symbol||"function"!=typeof me)return e;for(const a of t){const t=me(a);for(const r of t)pe.call(a,r)&&(e[r]=a[r])}return e}function ve(e,...t){let a=0;var r;for(("object"==typeof(r=e)?null===r:"function"!=typeof r)&&(e=t[a++]),e||(e={});a<t.length;a++)if(ge(t[a])){for(const r of Object.keys(t[a]))he(r)&&(ge(e[r])&&ge(t[a][r])?ve(e[r],t[a][r]):e[r]=t[a][r]);ye(e,t[a])}return e}function be(e,t){return new Promise((a,r)=>{const o=new Image;o.onload=()=>{a(o)},o.onerror=()=>{r(new Error("Image load error"))},t&&(o.crossOrigin="Anonymous"),o.src=e})}var we,Ae;(Ae=we||(we={})).LOADING="loading",Ae.LOADED="loaded",Ae.ERROR="error";const Oe={rootMargin:"0px",threshold:0},Se="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";class _e{constructor(e=!0,t,a=!0){this.lazyActive=!0,this.crossOrigin=!0,this.options={loading:Se,error:"",observerOptions:Oe,log:!0,ratioCalculator:(e,t)=>t/e},this._images=new WeakMap,this.lazyActive=e,this.crossOrigin=a,this.config(t)}config(e={}){ve(this.options,e),e.ratioCalculator&&(this.options.ratioCalculator=e.ratioCalculator)}mount(e,t,a){const{src:r,loading:o,error:i}=this._valueFormatter(t);e.setAttribute("lazy",we.LOADING),e.setAttribute("src",o||Se),this.lazyActive?(fe||(this._setImageSrc(e,r,a,i),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,r,a,i)):this._setImageSrc(e,r,a,i)}resize(e,t){const a=e.getAttribute("lazy"),r=e.getAttribute("src");a&&a===we.LOADED&&r&&be(r,this.crossOrigin).then(a=>{const{width:r,height:o}=a,i=e.width/r*o;e.height=i;e.style.height=`${i}px`,t()})}unmount(e){const t=this._realObserver(e);t&&t.unobserve(e),this._images.delete(e)}_setImageSrc(e,t,a,r){if(!t)return;e.getAttribute("src")!==t&&be(t,this.crossOrigin).then(t=>{var r,o;const{width:i,height:n}=t,l=(null==(o=(r=this.options).ratioCalculator)?void 0:o.call(r,i,n))||n/i;e.parentNode.parentNode.style.paddingBottom=100*l+"%",e.setAttribute("lazy",we.LOADED),e.removeAttribute("src"),e.src=t.src,a(!0)}).catch(()=>{const o=this._realObserver(e);o&&o.disconnect(),r&&(e.setAttribute("lazy",we.ERROR),e.setAttribute("src",r),a(!1)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${t} `)})})}_isOpenLazy(){return fe&&this.lazyActive}_initIntersectionObserver(e,t,a,r){const o=this.options.observerOptions;this._images.set(e,new IntersectionObserver(o=>{Array.prototype.forEach.call(o,o=>{if(o.isIntersecting){const i=this._realObserver(e);i&&i.unobserve(o.target),this._setImageSrc(e,t,a,r)}})},o));const i=this._realObserver(e);i&&i.observe(e)}_valueFormatter(e){let t=e,a=this.options.loading,r=this.options.error;return ge(e)&&(t=e.src,a=e.loading||this.options.loading,r=e.error||this.options.error),{src:t,loading:a,error:r}}_log(e){this.options.log&&e()}_realObserver(e){return this._images.get(e)}}var ke=(e,t)=>{for(const[a,r]of t)e[a]=r;return e};const xe=l({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},space:{type:Number,default:null},hasAroundGutter:{type:Boolean,default:!0},posDuration:{type:Number,default:300},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},animationCancel:{type:Boolean,default:!1},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},crossOrigin:{type:Boolean,default:!0},delay:{type:Number,default:300},align:{type:String,default:"center"},horizontalOrder:{type:Boolean,default:!1},heightDifference:{type:Number,default:0}},setup(e,t){const a=new _e(e.lazyload,e.loadProps,e.crossOrigin);D("lazy",a);const{waterfallWrapper:r,wrapperWidth:o,colWidth:i,cols:n,offsetX:l}=Z(e),{wrapperHeight:s,layoutHandle:d}=de(e,i,n,l,r,e.horizontalOrder,e.heightDifference),u=F(()=>{requestAnimationFrame(()=>{d().then(()=>t.emit("afterRender")),setTimeout(()=>{d()},e.posDuration+50)})},e.delay);v(()=>[o.value,i.value,e.list],()=>{o.value>0&&u()},{deep:!0});const c=b(0);D("sizeChangeTime",c),D("imgLoaded",u);return{colWidth:i,waterfallWrapper:r,wrapperHeight:s,getRenderURL:t=>function(e,...t){return t.map(t=>t.replace(/\[(\w+)\]/g,".$1").split(".").reduce((e,t)=>e&&e[t],e))}(t,e.imgSelector)[0],getKey:(t,a)=>t[e.rowKey]||a,renderer:u}}}),De=()=>{w(e=>({"4cb83f3f":e.backgroundColor}))},Ie=xe.setup;xe.setup=Ie?(e,t)=>(De(),Ie(e,t)):De;const ze={class:"waterfall-card"};var Be=ke(xe,[["render",function(e,t,a,r,o,i){return u(),d("div",{ref:"waterfallWrapper",class:"waterfall-list",style:S({height:`${e.wrapperHeight}px`})},[(u(!0),d(A,null,O(e.list,(t,a)=>(u(),d("div",{key:e.getKey(t,a),class:"waterfall-item"},[p("div",ze,[y(e.$slots,"default",{item:t,index:a,url:e.getRenderURL(t)},void 0,!0),y(e.$slots,"item",{item:t,index:a,url:e.getRenderURL(t)},void 0,!0)])]))),128))],4)}],["__scopeId","data-v-64b9633a"]]);const Ee={key:2,class:"data-section"},Pe=n(l({__name:"sdkwork-api-waterfall",props:{api:{type:Function,default:void 0},service:{default:void 0},params:{default:()=>({})},pageableParams:{default:()=>({})},selectable:{type:Boolean,default:e.selectable},deletable:{type:Boolean,default:e.deletable},searchable:{type:Boolean,default:e.searchable},pageSize:{default:e.pageSize},itemKey:{default:e.itemKey},itemTitleField:{default:e.itemTitleField},itemDescriptionField:{default:e.itemDescriptionField},topSpacing:{default:e.topSpacing},leftSpacing:{default:e.leftSpacing},rightSpacing:{default:e.rightSpacing},showBorderBottom:{type:Boolean,default:e.showBorderBottom},borderBottomLeftOffset:{default:e.borderBottomLeftOffset},showNoMoreData:{type:Boolean,default:e.showNoMoreData},themeMode:{default:e.themeMode},minSize:{},itemGap:{},fixed:{type:Boolean},buffer:{},bufferTop:{},bufferBottom:{},horizontal:{type:Boolean},scrollDistance:{},fixSelection:{type:Boolean},start:{},offset:{},listStyle:{},listClass:{},itemStyle:{},itemClass:{},renderControl:{},waterfallRowKey:{default:"id"},imgSelector:{default:"src"},width:{default:200},breakpoints:{default:()=>({1200:{rowPerView:2},800:{rowPerView:2},500:{rowPerView:2}})},gutter:{default:10},space:{default:10},hasAroundGutter:{type:Boolean,default:!0},posDuration:{default:300},animationPrefix:{default:"animate__animated"},animationEffect:{default:"fadeIn"},animationDuration:{default:1e3},animationDelay:{default:300},animationCancel:{type:Boolean,default:!1},backgroundColor:{default:"#ffffff"},loadProps:{default:()=>({})},lazyload:{type:Boolean,default:!0},crossOrigin:{type:Boolean,default:!0},delay:{default:300},align:{default:"center"},horizontalOrder:{type:Boolean,default:!1},heightDifference:{default:0}},emits:["select","delete","search","reach-top","reach-bottom","scroll","item-resize","range-update","load","after-render"],setup(e,{expose:o,emit:i}){const n=e,l=i,g=b([]),w=b(),A=b(),O=s(()=>"dark"===n.themeMode||"light"!==n.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),_=s(()=>O.value?"dark-mode":"light-mode");let k=null;const{dataList:D,currentPage:j,totalElements:T,totalPages:$,loading:L,loadingMore:W,hasMore:F,loadData:G}=t({api:n.api,service:n.service,params:n.params,pageableParams:n.pageableParams,pageSize:n.pageSize,autoLoad:!0}),K=s(()=>"number"==typeof n.topSpacing?`${n.topSpacing}px`:n.topSpacing),V=s(()=>"number"==typeof n.leftSpacing?`${n.leftSpacing}px`:n.leftSpacing),H=s(()=>"number"==typeof n.rightSpacing?`${n.rightSpacing}px`:n.rightSpacing),U=s(()=>({paddingTop:K.value,paddingLeft:V.value,paddingRight:H.value})),q=(e,t)=>e[n.itemKey]||t,X=e=>g.value.some(t=>q(t,-1)===q(e,-1)),Q=()=>{l("after-render")},Y=e=>{l("search",e),(async(e=0,t=!1)=>{try{await G(e,t),(D.value.length>0||0===e)&&l("load",{content:D.value,number:j.value,totalElements:T.value,totalPages:$.value,last:!F.value})}catch(a){}})(0)},Z=e=>{if(n.selectable){const t=g.value.findIndex(t=>q(t,-1)===q(e,-1));t>-1?g.value.splice(t,1):g.value.push(e)}l("select",e)},J=e=>{l("delete",e)};return v(()=>n.params,()=>{G(0)},{deep:!0}),v(()=>n.pageSize,()=>{G(0)}),I(()=>{z(()=>{w.value?.$el&&(k=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&F.value&&!W.value&&!L.value&&G(j.value+1,!0)})},{root:null,rootMargin:"0px",threshold:.1}),k.observe(w.value.$el))})}),B(()=>{k&&(k.disconnect(),k=null)}),o({refresh:()=>G(0),loadMore:()=>G(j.value+1,!0),getData:()=>D.value,getSelectedItems:()=>g.value,clearSelected:()=>{g.value=[]},setSelectedItems:e=>{g.value=e},renderer:()=>A.value?.renderer?.(),getWaterfallInstance:()=>A.value}),(t,o)=>(u(),d("div",{class:c(["sdkwork-api-waterfall",_.value])},[n.searchable?(u(),E(a,{key:0,searchable:n.searchable,onSearch:Y},null,8,["searchable"])):f("",!0),p("div",{class:"waterfall-content",style:S(U.value)},[x(L)&&!x(D).length?(u(),E(C,{key:0},{default:h(({loading:e})=>[y(t.$slots,"loading",P(R({loading:e})),void 0,!0)]),_:3})):x(L)||x(D).length?(u(),d("div",Ee,[y(t.$slots,"header",{},void 0,!0),m(x(Be),{ref_key:"waterfallRef",ref:A,list:x(D),"row-key":e.waterfallRowKey,"img-selector":e.imgSelector,width:e.width,breakpoints:e.breakpoints,gutter:e.gutter,space:e.space,"has-around-gutter":e.hasAroundGutter,"pos-duration":e.posDuration,"animation-prefix":e.animationPrefix,"animation-effect":e.animationEffect,"animation-duration":e.animationDuration,"animation-delay":e.animationDelay,"animation-cancel":e.animationCancel,"background-color":e.backgroundColor,"load-props":e.loadProps,lazyload:e.lazyload,"cross-origin":e.crossOrigin,delay:e.delay,align:e.align,"horizontal-order":e.horizontalOrder,"height-difference":e.heightDifference,onAfterRender:Q,class:"waterfall-container"},{default:h(({item:a,url:r,index:o})=>[m(N,{item:a,index:o,selectable:e.selectable,deletable:e.deletable,"is-selected":X(a),"item-key":e.itemKey,"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,onSelect:Z,onDelete:J},{default:h(({item:e,index:a,selected:r})=>[y(t.$slots,"default",{item:e,index:a,selected:r},void 0,!0)]),_:3},8,["item","index","selectable","deletable","is-selected","item-key","item-title-field","item-description-field"])]),_:3},8,["list","row-key","img-selector","width","breakpoints","gutter","space","has-around-gutter","pos-duration","animation-prefix","animation-effect","animation-duration","animation-delay","animation-cancel","background-color","load-props","lazyload","cross-origin","delay","align","horizontal-order","height-difference"]),y(t.$slots,"footer",{},void 0,!0),m(M,{"has-more":x(F),"loading-more":x(W),"data-list":x(D),ref_key:"loadMoreSectionRef",ref:w},null,8,["has-more","loading-more","data-list"])])):(u(),E(r,{key:1},{default:h(({empty:e})=>[y(t.$slots,"empty",P(R({empty:e})),void 0,!0)]),_:3}))],4)],2))}}),[["__scopeId","data-v-df364cd6"]]);export{Pe as S};
