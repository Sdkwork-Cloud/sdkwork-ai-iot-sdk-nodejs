import{aP as e,t as a,p as l,n as o,r as t,c as s,C as i,ac as r,D as n,I as u,b as d,F as c,a2 as f,w as h}from"./index-TwMLNQLv.js";import{u as p}from"./use-refs-CNBJ9U0d.js";import{k as m,r as v,f as b,j as g}from"./vue-vendor-BAnrfl1G.js";const[y,x]=s("rate");const w=h(m({name:y,props:{size:o,icon:l("star"),color:String,count:t(5),gutter:o,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:l("star-o"),allowHalf:Boolean,voidColor:String,touchable:a,iconPrefix:String,modelValue:e(0),disabledColor:String},emits:["change","update:modelValue"],setup(e,{emit:a}){const l=i(),[o,t]=p(),s=v(),h=b(()=>e.readonly||e.disabled),m=b(()=>h.value||!e.touchable),y=b(()=>Array(+e.count).fill("").map((a,l)=>function(e,a,l,o){if(e>=a)return{status:"full",value:1};if(e+.5>=a&&l&&!o)return{status:"half",value:.5};if(e+1>=a&&l&&o){const l=10**10;return{status:"half",value:Math.round((e-a+1)*l)/l}}return{status:"void",value:0}}(e.modelValue,l+1,e.allowHalf,e.readonly)));let w,E,V=Number.MAX_SAFE_INTEGER,z=Number.MIN_SAFE_INTEGER;const C=()=>{E=c(s);const a=o.value.map(c);w=[],a.forEach((a,l)=>{V=Math.min(a.top,V),z=Math.max(a.top,z),e.allowHalf?w.push({score:l+.5,left:a.left,top:a.top,height:a.height},{score:l+1,left:a.left+a.width/2,top:a.top,height:a.height}):w.push({score:l+1,left:a.left,top:a.top,height:a.height})})},H=(a,l)=>{for(let e=w.length-1;e>0;e--)if(l>=E.top&&l<=E.bottom){if(a>w[e].left&&l>=w[e].top&&l<=w[e].top+w[e].height)return w[e].score}else{const o=l<E.top?V:z;if(a>w[e].left&&w[e].top===o)return w[e].score}return e.allowHalf?.5:1},I=l=>{h.value||l===e.modelValue||(a("update:modelValue",l),a("change",l))},P=e=>{m.value||(l.start(e),C())},S=(a,o)=>{const{icon:s,size:i,color:r,count:n,gutter:c,voidIcon:f,disabled:h,voidColor:p,allowHalf:m,iconPrefix:v,disabledColor:b}=e,y=o+1,w="full"===a.status,E="void"===a.status,V=m&&a.value>0&&a.value<1;let z;c&&y!==+n&&(z={paddingRight:d(c)});return g("div",{key:o,ref:t(o),role:"radio",style:z,class:x("item"),tabindex:h?void 0:0,"aria-setsize":n,"aria-posinset":y,"aria-checked":!E,onClick:a=>{C();let o=m?H(a.clientX,a.clientY):y;e.clearable&&l.isTap.value&&o===e.modelValue&&(o=0),I(o)}},[g(u,{size:i,name:w?s:f,class:x("icon",{disabled:h,full:w}),color:h?b:w?r:p,classPrefix:v},null),V&&g(u,{size:i,style:{width:a.value+"em"},name:E?f:s,class:x("icon",["half",{disabled:h,full:!E}]),color:h?b:E?p:r,classPrefix:v},null)])};return r(()=>e.modelValue),n("touchmove",e=>{if(!m.value&&(l.move(e),l.isHorizontal()&&!l.isTap.value)){const{clientX:a,clientY:l}=e.touches[0];f(e),I(H(a,l))}},{target:s}),()=>g("div",{ref:s,role:"radiogroup",class:x({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:P},[y.value.map(S)])}}));export{w as R};
