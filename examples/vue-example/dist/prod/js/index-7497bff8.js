import{S as e}from"./sdkwork-chat-message-list-6c84ceb8.js";import{a,r as t,P as l,_ as s,v as o,I as i,s as n,B as r,x as c,y as d}from"./index-5affcab4.js";/* empty css              *//* empty css              */import{k as u,c as v,r as p,Q as m,Z as h,a0 as g,S as f,j as y,u as k,R as x,Y as w,X as V,$ as b,F as _,t as C,v as I,w as j,a1 as S,U,y as M,a as $,a4 as B,V as D,b as T,n as A}from"./vue-vendor-a2672387.js";import{P}from"./index-6e9d45f0.js";/* empty css              *//* empty css              */import"./index-5d6825eb.js";import{U as R}from"./index-fa879ae6.js";import{S as L}from"./index-6f177f7f.js";import{F as O}from"./index-dee6a080.js";/* empty css              */import{S as G}from"./index-8ec8972f.js";import{C as K}from"./index-b4fa6a2d.js";import{C as F}from"./index-44056be1.js";/* empty css              */import{S as z}from"./sdkwork-voice-speaker-category-list-popup-6a918502.js";import{S as E}from"./sdkwork-avatar-f9ee9326.js";import{E as q}from"./index-ccee2c65.js";import{T as J}from"./index-7bca35b2.js";import{T as Q,a as N}from"./index-a1493906.js";import{P as W}from"./index-0a8ae520.js";import{P as H}from"./index-6a5403e8.js";import{C as X}from"./message-c1ac2c8f.js";import{A as Y}from"./chat-88db1a6d.js";import{G as Z}from"./video-1a038f9a.js";import"./utils-vendor-b5712723.js";import"./ImagePreview-084463df.js";import"./index-63936d32.js";import"./index-4fcf5799.js";import"./function-call-e02e5da4.js";import"./use-id-82312033.js";import"./sdkwork-popup-6e1ec418.js";import"./sdkwork-pull-refresh-9d6db096.js";import"./index-e159e7ef.js";import"./shared-1cf0c357.js";import"./sdkwork-search-bar-4d747e22.js";import"./sdkwork-icon-2d6efb98.js";import"./ListItem-783a2127.js";import"./LoadingSection-0e2448c2.js";import"./LoadMoreSection-49ddad4b.js";import"./sdkwork-voice-clone-2a1489b7.js";import"./use-tab-status-aca7131d.js";import"./use-refs-ac90b301.js";const ee={class:"popup-content"},ae={class:"popup-header"},te={class:"header-title"},le={class:"popup-body"},se={class:"parameters-section"},oe={class:"parameter-item"},ie={class:"parameter-label"},ne={class:"aspect-ratio-options"},re=["onClick"],ce={class:"ratio-text"},de={class:"parameter-item"},ue={class:"parameter-label"},ve={class:"duration-control"},pe={class:"duration-display"},me={class:"parameter-item"},he={class:"parameter-label"},ge={class:"quality-options"},fe=["onClick"],ye={class:"quality-name"},ke={class:"quality-desc"},xe={class:"parameter-item"},we={class:"advanced-settings"},Ve={class:"advanced-item"},be={class:"advanced-item"},_e={class:"popup-footer"},Ce={class:"footer-tips"},Ie={class:"footer-buttons"},je=s(u({__name:"VideoGenerateDialog",props:{modelValue:{type:Boolean},generating:{type:Boolean,default:!1},defaultAspectRatio:{default:"16:9"},defaultQuality:{default:"hd"}},emits:["update:modelValue","generate"],setup(e,{emit:s}){const o=e,i=s,n=v({get:()=>o.modelValue,set:e=>i("update:modelValue",e)}),r=[{text:"16:9",value:"16:9"},{text:"9:16",value:"9:16"},{text:"1:1",value:"1:1"},{text:"4:3",value:"4:3"},{text:"21:9",value:"21:9"}],c=[{name:"标清",desc:"流畅，生成快",value:"sd"},{name:"高清",desc:"推荐，平衡质量与速度",value:"hd"},{name:"超高清",desc:"最佳效果，生成慢",value:"uhd"}],d=p(o.defaultAspectRatio),u=p(o.defaultQuality),j=p(30),S=p(50),U=p(50),M=p(!1),$=()=>{M.value=!M.value},B=()=>{n.value=!1},D=()=>{const e={aspectRatio:d.value,duration:j.value,quality:u.value,styleStrength:S.value,motionIntensity:U.value};i("generate",e)};return(s,o)=>{const i=t,v=l;return m(),h(v,{show:n.value,"onUpdate:show":o[3]||(o[3]=e=>n.value=e),position:"top",round:!1,"close-on-click-overlay":!1,class:"video-generate-popup"},{default:g(()=>[f("div",ee,[f("div",ae,[f("div",te,[y(k(a),{icon:"ri:video-line",width:"24",height:"24",class:"title-icon"}),o[4]||(o[4]=f("span",null,"生成视频",-1))]),f("div",{class:"close-button",onClick:B},[y(k(a),{icon:"ri:close-line",width:"20",height:"20"})])]),f("div",le,[f("div",se,[o[11]||(o[11]=f("div",{class:"section-title"},"视频参数",-1)),f("div",oe,[f("div",ie,[y(k(a),{icon:"ri:aspect-ratio-line",width:"16",height:"16"}),o[5]||(o[5]=f("span",null,"视频尺寸",-1))]),f("div",ne,[(m(),x(_,null,w(r,e=>f("div",{key:e.value,class:V(["ratio-item",{active:d.value===e.value}]),onClick:a=>{return t=e.value,void(d.value=t);var t}},[f("span",ce,b(e.text),1),f("div",{class:V(["ratio-preview",`preview-${e.value.replace(":","-")}`])},null,2)],10,re)),64))])]),f("div",de,[f("div",ue,[y(k(a),{icon:"ri:time-line",width:"16",height:"16"}),o[6]||(o[6]=f("span",null,"视频时长",-1))]),f("div",ve,[y(i,{modelValue:j.value,"onUpdate:modelValue":o[0]||(o[0]=e=>j.value=e),min:5,max:120,step:5,"active-color":"#007aff",class:"duration-slider"},null,8,["modelValue"]),f("div",pe,b(j.value)+"秒",1)])]),f("div",me,[f("div",he,[y(k(a),{icon:"ri:hd-line",width:"16",height:"16"}),o[7]||(o[7]=f("span",null,"视频质量",-1))]),f("div",ge,[(m(),x(_,null,w(c,e=>f("div",{key:e.value,class:V(["quality-item",{active:u.value===e.value}]),onClick:a=>(e=>{u.value=e})(e.value)},[f("span",ye,b(e.name),1),f("span",ke,b(e.desc),1)],10,fe)),64))])]),f("div",xe,[f("div",{class:"parameter-label",onClick:$},[y(k(a),{icon:"ri:settings-3-line",width:"16",height:"16"}),o[8]||(o[8]=f("span",null,"高级设置",-1)),y(k(a),{icon:"ri:arrow-down-s-line",width:"14",height:"14",class:V(["expand-icon",{expanded:M.value}])},null,8,["class"])]),C(f("div",we,[f("div",Ve,[o[9]||(o[9]=f("div",{class:"advanced-label"},"风格强度",-1)),y(i,{modelValue:S.value,"onUpdate:modelValue":o[1]||(o[1]=e=>S.value=e),min:0,max:100,step:5,"active-color":"#007aff"},null,8,["modelValue"])]),f("div",be,[o[10]||(o[10]=f("div",{class:"advanced-label"},"运动幅度",-1)),y(i,{modelValue:U.value,"onUpdate:modelValue":o[2]||(o[2]=e=>U.value=e),min:0,max:100,step:5,"active-color":"#007aff"},null,8,["modelValue"])])],512),[[I,M.value]])])])]),f("div",_e,[f("div",Ce,[y(k(a),{icon:"ri:lightbulb-line",width:"14",height:"14"}),o[12]||(o[12]=f("span",null,"生成视频需要一定时间，请耐心等待",-1))]),f("div",Ie,[f("div",{class:"cancel-button",onClick:B},"取消"),f("div",{class:V(["confirm-button",{loading:e.generating}]),onClick:D},[y(k(a),{icon:"ri:sparkling-line",width:"16",height:"16"}),o[13]||(o[13]=f("span",null,"开始生成",-1))],2)])])])]),_:1},8,["show"])}}}),[["__scopeId","data-v-4e5e1959"]]),Se={class:"popup-content"},Ue={class:"popup-header"},Me={class:"search-container"},$e={class:"popup-body"},Be={class:"category-tabs"},De=["onClick"],Te={class:"music-list"},Ae=["onClick"],Pe={class:"music-cover"},Re=["src","alt"],Le=["onClick"],Oe={class:"music-info"},Ge={class:"music-name-artist"},Ke={class:"music-name"},Fe={class:"music-artist"},ze={class:"music-duration"},Ee={class:"music-actions"},qe={class:"popup-footer"},Je={class:"footer-actions"},Qe={class:"left-area"},Ne={key:0,class:"selected-music-container"},We={class:"music-preview"},He=["src","alt"],Xe={class:"selected-info"},Ye={class:"selected-details"},Ze={class:"selected-duration"},ea=s(u({__name:"BackgroundMusicDialog",props:{modelValue:{type:Boolean},defaultMusicId:{default:""}},emits:["update:modelValue","music-change"],setup(e,{emit:t}){const s=e,o=t,i=v({get:()=>s.modelValue,set:e=>o("update:modelValue",e)}),n=p(""),r=p("all"),c=p(s.defaultMusicId),d=p(""),u=[{id:"all",name:"全部"},{id:"popular",name:"热门"},{id:"calm",name:"平静"},{id:"energetic",name:"活力"},{id:"romantic",name:"浪漫"}],C=p([{id:"music1",name:"轻快假日",artist:"未知艺术家",duration:120,url:"/music/music1.mp3",cover:"/covers/music1.jpg",category:"popular"},{id:"music2",name:"宁静晨曦",artist:"音乐创作人",duration:95,url:"/music/music2.mp3",cover:"/covers/music2.jpg",category:"calm"},{id:"music3",name:"城市节奏",artist:"DJ Sound",duration:180,url:"/music/music3.mp3",cover:"/covers/music3.jpg",category:"energetic"},{id:"music4",name:"浪漫之舞",artist:"钢琴师",duration:145,url:"/music/music4.mp3",cover:"/covers/music4.jpg",category:"romantic"},{id:"music5",name:"山水之间",artist:"民族音乐",duration:210,url:"/music/music5.mp3",cover:"/covers/music5.jpg",category:"calm"},{id:"music6",name:"电子未来",artist:"电子音乐制作人",duration:135,url:"/music/music6.mp3",cover:"/covers/music6.jpg",category:"energetic"}]),I=v(()=>{let e=C.value;if("all"!==r.value&&(e=e.filter(e=>e.category===r.value)),n.value.trim()){const a=n.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.artist.toLowerCase().includes(a))}return e}),M=v(()=>c.value?C.value.find(e=>e.id===c.value):null),$=()=>{},B=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,D=()=>{c.value="",d.value=""},T=()=>{void 0!==c.value&&(o("music-change",c.value),A())},A=()=>{i.value=!1};return j(i,e=>{e||(d.value="")}),(e,t)=>{const s=L,o=l;return m(),h(o,{show:i.value,"onUpdate:show":t[1]||(t[1]=e=>i.value=e),position:"top",round:!1,"close-on-click-overlay":!1,class:"background-music-popup"},{default:g(()=>[f("div",Se,[f("div",Ue,[f("div",Me,[y(s,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),placeholder:"搜索音乐",onSearch:$,class:"music-search"},null,8,["modelValue"])]),f("div",{class:"close-button",onClick:A},[y(k(a),{icon:"ri:close-line",width:"20",height:"20"})])]),f("div",$e,[f("div",Be,[(m(),x(_,null,w(u,e=>f("div",{key:e.id,class:V(["category-tab",{active:r.value===e.id}]),onClick:a=>{return t=e.id,void(r.value=t);var t}},b(e.name),11,De)),64))]),f("div",Te,[(m(!0),x(_,null,w(I.value,e=>(m(),x("div",{key:e.id,class:V(["music-item",{active:c.value===e.id}]),onClick:a=>{return t=e.id,void(c.value=t);var t}},[f("div",Pe,[f("img",{src:e.cover||"/default-music-cover.jpg",alt:e.name},null,8,Re),f("div",{class:V(["play-overlay",{playing:d.value===e.id}]),onClick:S(a=>(e=>{const a=C.value.find(a=>a.url===e);a&&(d.value===a.id?d.value="":d.value=a.id),console.log("播放音乐:",e)})(e.url),["stop"])},[y(k(a),{icon:d.value===e.id?"ri:pause-fill":"ri:play-fill",width:"20",height:"20",class:"play-icon"},null,8,["icon"])],10,Le)]),f("div",Oe,[f("div",Ge,[f("div",Ke,b(e.name),1),f("div",Fe,b(e.artist),1)]),f("div",ze,b(B(e.duration)),1)]),f("div",Ee,[c.value===e.id?(m(),h(k(a),{key:0,icon:"ri:check-line",width:"20",height:"20",class:"check-icon"})):U("",!0)])],10,Ae))),128))])]),f("div",qe,[f("div",Je,[f("div",Qe,[M.value?(m(),x("div",Ne,[f("div",We,[f("img",{src:M.value.cover||"/default-music-cover.jpg",alt:M.value.name,class:"selected-cover"},null,8,He),f("div",Xe,[f("div",Ye,b(M.value.name),1),f("div",Ze,b(B(M.value.duration)),1)]),f("div",{class:"remove-selection",onClick:S(D,["stop"])},[y(k(a),{icon:"ri:close-line",width:"14",height:"14"})])])])):U("",!0)]),f("div",{class:V(["confirm-button",{disabled:!c.value&&""!==c.value}]),onClick:T},[y(k(a),{icon:"ri:check-double-line",width:"16",height:"16"}),t[2]||(t[2]=f("span",null,"确认",-1))],2)])])])]),_:1},8,["show"])}}}),[["__scopeId","data-v-7bc12bc2"]]),aa={class:"tech-toolbar"},ta={key:0,class:"left-actions"},la={class:"tech-button-container"},sa={key:1,class:"button-text"},oa={class:"tech-button"},ia={class:"aspect-ratio-popover"},na=["onClick"],ra={class:"center-actions"},ca={class:"right-actions"},da={class:"tech-button-container"},ua={key:0,class:"tech-button-container"},va=s(u({__name:"ChatToolbar",props:{characters:{},inputText:{default:""},generatingDialogue:{type:Boolean,default:!1},generatingVideo:{type:Boolean,default:!1},hasMessages:{type:Boolean,default:!1},speechInputActive:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},uploadButtonText:{default:""},defaultAspectRatio:{default:"16:9"}},emits:["generate-dialogue","generate-video","start-speech-input","aspect-ratio-change","background-music-change","media-upload"],setup(e,{emit:t}){const l=e,s=t,i=p(!1),n=p(l.defaultAspectRatio),r=p(!1),c=p(!1),d=p(""),u=p(!1),v=[{text:"16:9",value:"16:9"},{text:"9:16",value:"9:16"},{text:"1:1",value:"1:1"},{text:"4:3",value:"4:3"},{text:"21:9",value:"21:9"}];o();const C=async e=>{if(e&&e.length>0){i.value=!0;try{const a=Array.isArray(e)?e:[e],t=10485760,l=a.filter(e=>e.size>t);l.length>0&&console.warn("文件过大:",l),await new Promise(e=>setTimeout(e,500)),s("media-upload",a)}catch(a){console.error("上传失败:",a)}finally{i.value=!1}}},I=()=>{u.value=!0},j=e=>{d.value=e,s("background-music-change",e)},S=e=>{e.aspectRatio&&(n.value=e.aspectRatio,s("aspect-ratio-change",e.aspectRatio)),d.value&&(e.backgroundMusic=d.value),s("generate-video",e)};return(t,l)=>{const o=R,p=P;return m(),x("div",aa,[e.showUploadButton?(m(),x("div",ta,[f("div",la,[y(o,{"after-read":C,accept:"image/*,video/*",multiple:""},{default:g(()=>[f("div",{class:V(["tech-button",{loading:i.value}])},[e.uploadButtonText?(m(),h(k(a),{key:0,icon:"ri:upload-2-line",width:"16",height:"16",class:"button-icon"})):U("",!0),e.uploadButtonText?(m(),x("span",sa,b(e.uploadButtonText),1)):(m(),h(k(a),{key:2,icon:"ri:add-line",width:"16",height:"16",class:"button-icon"}))],2)]),_:1})]),f("div",{class:V(["tech-button",{active:d.value}]),onClick:I},[y(k(a),{icon:"ri:music-2-line",width:"16",height:"16",class:"button-icon"})],2),y(p,{show:r.value,"onUpdate:show":l[0]||(l[0]=e=>r.value=e),placement:"top",theme:"dark"},{reference:g(()=>[f("div",oa,[y(k(a),{icon:"ri:aspect-ratio-line",width:"16",height:"16",class:"button-icon"})])]),default:g(()=>[f("div",ia,[(m(),x(_,null,w(v,e=>f("div",{key:e.value,class:V(["ratio-option",{active:n.value===e.value}]),onClick:a=>{return t=e.value,n.value=t,r.value=!1,void s("aspect-ratio-change",t);var t}},b(e.text),11,na)),64))])]),_:1},8,["show"])])):U("",!0),f("div",ra,[f("div",{class:V(["video-generate-button",{loading:e.generatingVideo,disabled:!e.hasMessages}]),onClick:l[1]||(l[1]=a=>e.hasMessages&&void(c.value=!0))},[y(k(a),{icon:"ri:video-line",width:"18",height:"18",class:"button-icon"}),l[6]||(l[6]=f("span",null,"生成视频",-1))],2)]),f("div",ca,[f("div",da,[f("div",{class:V(["tech-button secondary",{loading:e.speechInputActive}]),onClick:l[2]||(l[2]=e=>t.$emit("start-speech-input"))},[y(k(a),{icon:"ri:mic-line",width:"16",height:"16",class:"button-icon"})],2)]),e.characters.length>=2?(m(),x("div",ua,[f("div",{class:V(["tech-button primary",{loading:e.generatingDialogue,disabled:!e.inputText.trim()}]),onClick:l[3]||(l[3]=a=>e.inputText.trim()&&t.$emit("generate-dialogue"))},[y(k(a),{icon:"ri:chat-3-line",width:"16",height:"16",class:"button-icon"})],2)])):U("",!0)]),y(je,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=e=>c.value=e),generating:e.generatingVideo,"default-aspect-ratio":n.value,onGenerate:S},null,8,["modelValue","generating","default-aspect-ratio"]),y(ea,{modelValue:u.value,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value=e),"default-music-id":d.value,onMusicChange:j},null,8,["modelValue","default-music-id"])])}}}),[["__scopeId","data-v-9f80d80a"]]),pa={class:"character-avatar"},ma=["src","alt"],ha={key:1,class:"avatar-placeholder"},ga={class:"character-name"},fa=s(u({__name:"CharacterItem",props:{character:{},selected:{type:Boolean,default:!1}},emits:["select-character","delete-character"],setup(e,{emit:a}){const t=e,l=a,s=v(()=>({main:"主",supporting:"配",extra:"群"}[t.character.roleType||"main"]||"未定义")),o=v(()=>t.character.roleType||"main"),n=()=>{l("select-character",t.character)},r=()=>{l("delete-character",t.character.id)};return(a,t)=>{const l=i;return m(),x("div",{class:V(["character-item",{active:e.selected}]),onClick:n},[f("div",{class:V(["role-type-badge",o.value])},b(s.value),3),f("div",{class:"delete-button",onClick:S(r,["stop"])},[y(l,{name:"cross"})]),f("div",pa,[e.character.avatar?(m(),x("img",{key:0,src:e.character.avatar,alt:e.character.name},null,8,ma)):(m(),x("div",ha,b(e.character.name.charAt(0).toUpperCase()),1))]),f("div",ga,b(e.character.name),1)],2)}}}),[["__scopeId","data-v-90329824"]]),ya={class:"chat-input-area"},ka={key:0,class:"character-selector"},xa={class:"character-list"},wa={class:"character-avatar add"},Va={class:"bottom-input-bar"},ba={class:"input-row"},_a={key:0,class:"status-icon"},Ca={class:"input-container"},Ia=s(u({__name:"ChatInputBar",props:{characters:{},selectedCharacterId:{default:""},inputText:{default:""},generatingDialogue:{type:Boolean,default:!1},generatingVideo:{type:Boolean,default:!1},hasMessages:{type:Boolean,default:!1},showUploadButton:{type:Boolean,default:!0},uploadButtonText:{default:""},placeholder:{default:"输入对话内容，如：小明和小红讨论周末计划"},maxLength:{default:500},autoSize:{type:[Boolean,Object],default:!0}},emits:["select-character","delete-character","show-add-character","generate-dialogue","generate-video","start-speech-input","aspect-ratio-change","update:input-text","media-upload"],setup(e,{emit:a}){const t=e,l=a,s=p(!1);o();const n=v({get:()=>t.inputText,set:e=>l("update:input-text",e)}),r=e=>{e.shiftKey||(e.preventDefault(),l("generate-dialogue"))},c=()=>{s.value=!0},d=()=>{s.value=!1},u=e=>{l("generate-video",e.aspectRatio)};return(a,t)=>{const l=i,s=O;return m(),x("div",ya,[e.characters.length>0?(m(),x("div",ka,[f("div",xa,[(m(!0),x(_,null,w(e.characters,l=>(m(),h(fa,{key:l.id,character:l,selected:e.selectedCharacterId===l.id,onSelectCharacter:t[0]||(t[0]=e=>a.$emit("select-character",e)),onDeleteCharacter:t[1]||(t[1]=e=>a.$emit("delete-character",e))},null,8,["character","selected"]))),128)),f("div",{class:"character-item add-character",onClick:t[2]||(t[2]=e=>a.$emit("show-add-character"))},[f("div",wa,[y(l,{name:"plus"})]),t[8]||(t[8]=f("div",{class:"character-name"},"添加",-1))])])])):U("",!0),f("div",Va,[f("div",ba,[e.characters.length<2?(m(),x("div",_a,[y(l,{name:"info-o"})])):U("",!0),f("div",Ca,[y(s,{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value=e),type:"textarea",placeholder:e.placeholder,autosize:e.autoSize,maxlength:e.maxLength,class:"input-field",onKeydown:M(r,["enter"]),onFocus:c,onBlur:d},null,8,["modelValue","placeholder","autosize","maxlength"])])]),y(va,{characters:e.characters,"input-text":e.inputText,"generating-dialogue":e.generatingDialogue,"generating-video":e.generatingVideo,"has-messages":e.hasMessages,"show-upload-button":e.showUploadButton,"upload-button-text":e.uploadButtonText,onGenerateDialogue:t[4]||(t[4]=e=>a.$emit("generate-dialogue")),onGenerateVideo:u,onStartSpeechInput:t[5]||(t[5]=e=>a.$emit("start-speech-input")),onAspectRatioChange:t[6]||(t[6]=e=>a.$emit("aspect-ratio-change",e)),onMediaUpload:t[7]||(t[7]=e=>a.$emit("media-upload",e))},null,8,["characters","input-text","generating-dialogue","generating-video","has-messages","show-upload-button","upload-button-text"])])])}}}),[["__scopeId","data-v-8275f02e"]]),ja={class:"video-generator"},Sa={class:"video-dialog"},Ua={class:"dialog-header"},Ma={class:"dialog-content"},$a={class:"dialog-footer"},Ba=s(u({__name:"VideoGenerator",props:{modelValue:{type:Boolean,default:!1},messages:{default:()=>[]},generatingVideo:{type:Boolean,default:!1}},emits:["update:modelValue","generate","resolution-picker","format-picker","music-picker"],setup(e,{expose:a,emit:t}){const s=e,c=t,d=p(s.modelValue),u=p(s.generatingVideo),h=$({title:"多人对话视频",description:"",resolution:"720p",format:"mp4",backgroundMusic:"",addSubtitle:!0,addTransition:!0,loopMusic:!0}),w=[{text:"480p",value:"480p"},{text:"720p",value:"720p"},{text:"1080p",value:"1080p"},{text:"4K",value:"4K"}],V=[{text:"MP4",value:"mp4"},{text:"MOV",value:"mov"},{text:"AVI",value:"avi"},{text:"WebM",value:"webm"}],b=[{text:"无",value:""},{text:"轻快",value:"light"},{text:"温馨",value:"warm"},{text:"励志",value:"inspiring"},{text:"浪漫",value:"romantic"}],_=v(()=>{const e={};return w.forEach(a=>{e[a.value]=a.text}),e}),C=v(()=>{const e={};return V.forEach(a=>{e[a.value]=a.text}),e}),I=v(()=>{const e={};return b.forEach(a=>{e[a.value]=a.text}),e}),{isDarkMode:S}=o();j(()=>s.modelValue,e=>{d.value=e}),j(d,e=>{c("update:modelValue",e)}),j(()=>s.generatingVideo,e=>{u.value=e});const U=()=>{d.value=!1},M=()=>{h.title.trim()?0!==s.messages.length?c("generate",h):n("没有可生成视频的对话内容"):n("请输入视频标题")};return a({close:U,updateVideoSettings:(e,a)=>{switch(e){case"resolution":h.resolution=a;break;case"format":h.format=a;break;case"music":h.backgroundMusic=a}}}),(e,a)=>{const t=i,s=O,o=F,n=K,v=G,p=r,w=l;return m(),x("div",ja,[y(w,{show:d.value,"onUpdate:show":a[8]||(a[8]=e=>d.value=e),position:"bottom",style:D({borderRadius:k(S)?"16px 16px 0 0":void 0,backgroundColor:k(S)?"#1a1a1a":void 0})},{default:g(()=>[f("div",Sa,[f("div",Ua,[a[9]||(a[9]=f("span",{class:"dialog-title"},"生成对话视频",-1)),y(t,{name:"cross",onClick:U})]),f("div",Ma,[y(n,{title:"视频设置"},{default:g(()=>[y(s,{label:"视频标题",modelValue:h.title,"onUpdate:modelValue":a[0]||(a[0]=e=>h.title=e),placeholder:"请输入视频标题"},null,8,["modelValue"]),y(s,{label:"视频描述",modelValue:h.description,"onUpdate:modelValue":a[1]||(a[1]=e=>h.description=e),type:"textarea",rows:"2",placeholder:"请输入视频描述"},null,8,["modelValue"]),y(o,{title:"视频分辨率",value:_.value[h.resolution],"is-link":"",onClick:a[2]||(a[2]=e=>c("resolution-picker"))},null,8,["value"]),y(o,{title:"视频格式",value:C.value[h.format],"is-link":"",onClick:a[3]||(a[3]=e=>c("format-picker"))},null,8,["value"]),y(o,{title:"背景音乐",value:h.backgroundMusic?I.value[h.backgroundMusic]:"无","is-link":"",onClick:a[4]||(a[4]=e=>c("music-picker"))},null,8,["value"])]),_:1}),y(n,{title:"生成选项"},{default:g(()=>[y(o,{center:"",title:"添加字幕"},{"right-icon":g(()=>[y(v,{modelValue:h.addSubtitle,"onUpdate:modelValue":a[5]||(a[5]=e=>h.addSubtitle=e)},null,8,["modelValue"])]),_:1}),y(o,{center:"",title:"添加过渡效果"},{"right-icon":g(()=>[y(v,{modelValue:h.addTransition,"onUpdate:modelValue":a[6]||(a[6]=e=>h.addTransition=e)},null,8,["modelValue"])]),_:1}),y(o,{center:"",title:"循环播放背景音乐"},{"right-icon":g(()=>[y(v,{modelValue:h.loopMusic,"onUpdate:modelValue":a[7]||(a[7]=e=>h.loopMusic=e)},null,8,["modelValue"])]),_:1})]),_:1})]),f("div",$a,[y(p,{block:"",type:"primary",onClick:M,loading:u.value},{default:g(()=>[...a[10]||(a[10]=[B(" 开始生成 ",-1)])]),_:1},8,["loading"])])])]),_:1},8,["show","style"])])}}}),[["__scopeId","data-v-64fc7bfd"]]),Da={class:"custom-panel"},Ta={class:"avatar-field"},Aa=s(u({__name:"CustomCharacterPanel",props:{modelValue:{default:()=>({name:"",description:"",avatar:"",appearance:{gender:"male",age:"",style:"",description:""},voice:{voiceId:"standard"}})}},emits:["update:modelValue","show-voice-selector"],setup(e,{expose:a,emit:t}){const l=t,s=$({...e.modelValue}),o=p(null),n=v(()=>o.value?o.value.name:s.voice.voiceId);j(s,e=>{l("update:modelValue",e)},{deep:!0});const r=e=>{console.log("上传头像文件:",e.name)};return a({resetForm:()=>{s.name="",s.description="",s.avatar="",s.appearance.gender="male",s.appearance.age="",s.appearance.style="",s.appearance.description="",s.voice.voiceId="standard",o.value=null},setVoice:e=>{o.value=e,s.voice.voiceId=e.id}}),(e,a)=>{const t=O,l=i;return m(),x("div",Da,[y(t,{label:"角色名称",modelValue:s.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.name=e),placeholder:"请输入角色名称"},null,8,["modelValue"]),y(t,{label:"角色描述",modelValue:s.description,"onUpdate:modelValue":a[1]||(a[1]=e=>s.description=e),type:"textarea",rows:"2",placeholder:"请输入角色描述"},null,8,["modelValue"]),f("div",Ta,[a[4]||(a[4]=f("div",{class:"field-label"},"角色头像",-1)),y(E,{modelValue:s.avatar,"onUpdate:modelValue":a[2]||(a[2]=e=>s.avatar=e),size:"80px",text:s.name?s.name.charAt(0).toUpperCase():"U",uploadable:"",round:"",onUpload:r},null,8,["modelValue","text"])]),y(t,{label:"语音",readonly:"",clickable:"",value:n.value,placeholder:"请选择语音",onClick:a[3]||(a[3]=a=>e.$emit("show-voice-selector"))},{"right-icon":g(()=>[y(l,{name:"arrow"})]),_:1},8,["value"])])}}}),[["__scopeId","data-v-af8c1eed"]]),Pa={class:"search-panel"},Ra={class:"preset-characters"},La=["onClick"],Oa={class:"character-avatar"},Ga=["src","alt"],Ka={key:1,class:"avatar-placeholder"},Fa={class:"character-info"},za={class:"character-name"},Ea={class:"character-desc"},qa={class:"character-tags"},Ja={key:0,class:"empty-result"},Qa=s(u({__name:"SearchCharacterPanel",props:{presetCharacters:{default:()=>[]}},emits:["select"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=p(""),i=p(l.presetCharacters),n=v(()=>{if(!o.value.trim())return i.value;const e=o.value.toLowerCase();return i.value.filter(a=>a.name.toLowerCase().includes(e)||a.description?.toLowerCase().includes(e)||a.tags?.some(a=>a.toLowerCase().includes(e)))}),r=()=>{};return T(()=>{0===i.value.length&&(i.value=[{id:"preset_1",name:"小明",description:"一个活泼开朗的男孩，喜欢运动和冒险",avatar:"",appearance:{gender:"male",age:"20岁",style:"休闲运动风",description:"短发，穿着休闲运动装，笑容阳光"},voice:{voiceId:"young_male"},tags:["开朗","活泼","阳光"]},{id:"preset_2",name:"小红",description:"一个温柔文静的女孩，喜欢阅读和绘画",avatar:"",appearance:{gender:"female",age:"19岁",style:"甜美文艺风",description:"长发，穿着连衣裙，文静温柔"},voice:{voiceId:"young_female"},tags:["温柔","文静","文艺"]},{id:"preset_3",name:"老教授",description:"知识渊博的教授，说话沉稳而有条理",avatar:"",appearance:{gender:"male",age:"60岁",style:"学术风",description:"戴眼镜，穿着西装，沉稳稳重"},voice:{voiceId:"mature_male"},tags:["教授","知识渊博","严肃"]},{id:"preset_4",name:"小可爱",description:"天真可爱的孩子，说话语气稚嫩可爱",avatar:"",appearance:{gender:"female",age:"8岁",style:"童装",description:"扎着小辫子，穿着可爱的童装"},voice:{voiceId:"young_female"},tags:["可爱","孩子","天真"]}])}),a({setPresetCharacters:e=>{i.value=e}}),(e,a)=>{const t=O,l=J,i=q;return m(),x("div",Pa,[y(t,{modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),placeholder:"搜索角色...","left-icon":"search",clearable:"",onInput:r},null,8,["modelValue"]),f("div",Ra,[(m(!0),x(_,null,w(n.value,e=>(m(),x("div",{key:e.id,class:"character-item",onClick:a=>(e=>{s("select",e)})(e)},[f("div",Oa,[e.avatar?(m(),x("img",{key:0,src:e.avatar,alt:e.name},null,8,Ga)):(m(),x("div",Ka,b(e.name.charAt(0).toUpperCase()),1))]),f("div",Fa,[f("div",za,b(e.name),1),f("div",Ea,b(e.description),1),f("div",qa,[(m(!0),x(_,null,w(e.tags,e=>(m(),h(l,{key:e,type:"primary"},{default:g(()=>[B(b(e),1)]),_:2},1024))),128))])])],8,La))),128)),0===n.value.length?(m(),x("div",Ja,[y(i,{description:"未找到匹配的角色"})])):U("",!0)])])}}}),[["__scopeId","data-v-0a08966d"]]),Na={class:"recent-panel"},Wa={key:0,class:"recent-characters"},Ha=["onClick"],Xa={class:"character-avatar"},Ya=["src","alt"],Za={key:1,class:"avatar-placeholder"},et={class:"character-info"},at={class:"character-name"},tt={class:"character-desc"},lt={class:"character-tags"},st={class:"character-time"},ot={key:1,class:"empty-result"},it=s(u({__name:"RecentCharacterPanel",props:{recentCharacters:{default:()=>[]},storageKey:{default:"dialogue-recent-characters"}},emits:["select"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=p(l.recentCharacters),i=e=>{if(!e)return"";const a=Date.now()-e;if(a<6e4)return"刚刚";if(a<36e5)return`${Math.floor(a/6e4)} 分钟前`;if(a<864e5)return`${Math.floor(a/36e5)} 小时前`;if(a<6048e5)return`${Math.floor(a/864e5)} 天前`;return new Date(e).toLocaleDateString()},n=()=>{try{const e=localStorage.getItem(l.storageKey);if(e){const a=JSON.parse(e);Array.isArray(a)&&(o.value=a.sort((e,a)=>(a.lastUsed||0)-(e.lastUsed||0)))}}catch(e){console.error("加载最近使用的角色失败",e)}};return T(()=>{0===o.value.length&&n()}),a({addToRecent:e=>{const a=o.value.findIndex(a=>a.id===e.id);if(a>=0){o.value[a]={...e};const t=o.value.splice(a,1)[0];o.value.unshift(t)}else{const a={...e,lastUsed:Date.now()};o.value.unshift(a)}o.value.length>10&&(o.value=o.value.slice(0,10)),localStorage.setItem(l.storageKey,JSON.stringify(o.value))},setRecentCharacters:e=>{o.value=e},loadRecentCharacters:n}),(e,a)=>{const t=J,l=q;return m(),x("div",Na,[o.value.length>0?(m(),x("div",Wa,[(m(!0),x(_,null,w(o.value,e=>(m(),x("div",{key:e.id,class:"character-item",onClick:a=>(e=>{s("select",e)})(e)},[f("div",Xa,[e.avatar?(m(),x("img",{key:0,src:e.avatar,alt:e.name},null,8,Ya)):(m(),x("div",Za,b(e.name.charAt(0).toUpperCase()),1))]),f("div",et,[f("div",at,b(e.name),1),f("div",tt,b(e.description),1),f("div",lt,[(m(!0),x(_,null,w(e.tags,e=>(m(),h(t,{key:e,type:"primary"},{default:g(()=>[B(b(e),1)]),_:2},1024))),128))]),f("div",st,b(i(e.lastUsed)),1)])],8,Ha))),128))])):(m(),x("div",ot,[y(l,{description:"暂无最近使用的角色"})]))])}}}),[["__scopeId","data-v-a9f19f47"]]),nt={class:"character-dialog"},rt={class:"dialog-header"},ct={class:"dialog-content"},dt={class:"dialog-footer"},ut={key:1,class:"search-footer"},vt=s(u({__name:"AddCharacterDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","add"],setup(e,{expose:a,emit:t}){const s=e,c=t,d=p(s.modelValue),u=p("search"),v=p(!1),w=p(),V=p(),b=$({name:"",description:"",avatar:"",appearance:{gender:"male",age:"",style:"",description:""},voice:{voiceId:"standard",pitch:0,speed:1,emotion:"neutral"}}),C=p([]),I=p([]),{currentTheme:S,isDarkMode:M}=o();j(()=>s.modelValue,e=>{d.value=e}),j(d,e=>{c("update:modelValue",e)});const A=()=>{d.value=!1},P=()=>{b.name="",b.description="",b.avatar="",b.appearance.gender="male",b.appearance.age="",b.appearance.style="",b.appearance.description="",b.voice.voiceId="standard",w.value?.resetForm()},R=()=>{if(!b.name.trim())return void n("请输入角色名称");const e={id:`character_${Date.now()}`,name:b.name,description:b.description,avatar:b.avatar,appearance:{...b.appearance},voice:{...b.voice}};c("add",e),G(e),P(),A()},L=e=>{const a={...e,id:`character_${Date.now()}`};c("add",a),G(e),P(),A()},O=e=>{const a={...e,id:`character_${Date.now()}`};c("add",a),G(e),P(),A()},G=e=>{V.value?.addToRecent(e)},K=e=>{w.value?.setVoice(e),v.value=!1};return T(()=>{C.value=[{id:"preset_1",name:"小明",description:"一个活泼开朗的男孩，喜欢运动和冒险",avatar:"",appearance:{gender:"male",age:"20岁",style:"休闲运动风",description:"短发，穿着休闲运动装，笑容阳光"},voice:{voiceId:"young_male"},tags:["开朗","活泼","阳光"]},{id:"preset_2",name:"小红",description:"一个温柔文静的女孩，喜欢阅读和绘画",avatar:"",appearance:{gender:"female",age:"19岁",style:"甜美文艺风",description:"长发，穿着连衣裙，文静温柔"},voice:{voiceId:"young_female"},tags:["温柔","文静","文艺"]},{id:"preset_3",name:"老教授",description:"知识渊博的教授，说话沉稳而有条理",avatar:"",appearance:{gender:"male",age:"60岁",style:"学术风",description:"戴眼镜，穿着西装，沉稳稳重"},voice:{voiceId:"mature_male"},tags:["教授","知识渊博","严肃"]},{id:"preset_4",name:"小可爱",description:"天真可爱的孩子，说话语气稚嫩可爱",avatar:"",appearance:{gender:"female",age:"8岁",style:"童装",description:"扎着小辫子，穿着可爱的童装"},voice:{voiceId:"young_female"},tags:["可爱","孩子","天真"]}]}),a({resetForm:P,close:A}),(e,a)=>{const t=Q,s=N,o=i,n=r,c=l;return m(),x(_,null,[y(c,{show:d.value,"onUpdate:show":a[3]||(a[3]=e=>d.value=e),position:"bottom",style:D({height:"100vh",borderRadius:"16px 16px 0 0",backgroundColor:k(M)?"#1a1a1a":"#ffffff"})},{default:g(()=>[f("div",nt,[f("div",rt,[y(s,{active:u.value,"onUpdate:active":a[0]||(a[0]=e=>u.value=e),shrink:""},{default:g(()=>[y(t,{title:"搜索添加",name:"search"}),y(t,{title:"最近使用",name:"recent"}),y(t,{title:"自定义添加",name:"custom"})]),_:1},8,["active"]),y(o,{name:"cross",onClick:A})]),f("div",ct,["custom"===u.value?(m(),h(Aa,{key:0,modelValue:b,"onUpdate:modelValue":a[1]||(a[1]=e=>b=e),onShowVoiceSelector:a[2]||(a[2]=e=>v.value=!0),ref_key:"customPanelRef",ref:w},null,8,["modelValue"])):U("",!0),"search"===u.value?(m(),h(Qa,{key:1,"preset-characters":C.value,onSelect:L},null,8,["preset-characters"])):U("",!0),"recent"===u.value?(m(),h(it,{key:2,"recent-characters":I.value,onSelect:O,ref_key:"recentPanelRef",ref:V},null,8,["recent-characters"])):U("",!0)]),f("div",dt,["custom"===u.value?(m(),h(n,{key:0,block:"",type:"primary",onClick:R},{default:g(()=>[...a[5]||(a[5]=[B("添加",-1)])]),_:1})):(m(),x("div",ut,"点击上方角色卡片添加"))])])]),_:1},8,["show","style"]),y(z,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=e=>v.value=e),"theme-mode":k(M)?"dark":"light",title:"选择语音",height:"90vh","show-clone-button":!1,"z-index":9999,onConfirm:K},null,8,["modelValue","theme-mode"])],64)}}}),[["__scopeId","data-v-b8acad72"]]),pt=s(u({__name:"PickerDialog",props:{modelValue:{type:Boolean,default:!1},pickerType:{default:"resolution"}},emits:["update:modelValue","confirm"],setup(e,{expose:a,emit:t}){const s=e,i=t,n=p(s.modelValue),r=[{text:"480p",value:"480p"},{text:"720p",value:"720p"},{text:"1080p",value:"1080p"},{text:"4K",value:"4K"}],c=[{text:"MP4",value:"mp4"},{text:"MOV",value:"mov"},{text:"AVI",value:"avi"},{text:"WebM",value:"webm"}],d=[{text:"无",value:""},{text:"轻快",value:"light"},{text:"温馨",value:"warm"},{text:"励志",value:"inspiring"},{text:"浪漫",value:"romantic"}],u=v(()=>{switch(s.pickerType){case"resolution":return r;case"format":return c;case"music":return d;default:return[]}}),{isDarkMode:f}=o();j(()=>s.modelValue,e=>{n.value=e}),j(n,e=>{i("update:modelValue",e)});const x=()=>{n.value=!1},w=({selectedValues:e})=>{const a=e[0];i("confirm",a),x()};return a({close:x}),(e,a)=>{const t=W,s=l;return m(),h(s,{show:n.value,"onUpdate:show":a[0]||(a[0]=e=>n.value=e),position:"bottom",style:D({backgroundColor:k(f)?"#1a1a1a":void 0})},{default:g(()=>[y(t,{columns:u.value,onConfirm:w,onCancel:x},null,8,["columns"])]),_:1},8,["show","style"])}}}),[["__scopeId","data-v-330c23ee"]]),mt={class:"progress-dialog"},ht={class:"dialog-header"},gt={class:"dialog-title"},ft={class:"progress-content"},yt={class:"progress-text"},kt=s(u({__name:"ProgressDialog",props:{modelValue:{type:Boolean,default:!1},title:{default:"正在生成视频"},progress:{default:0},text:{default:""}},emits:["update:modelValue"],setup(e,{expose:a,emit:t}){const s=e,i=t,n=p(s.modelValue),{isDarkMode:r}=o();return j(()=>s.modelValue,e=>{n.value=e}),j(n,e=>{i("update:modelValue",e)}),a({close:()=>{n.value=!1}}),(a,t)=>{const s=H,o=l;return m(),h(o,{show:n.value,"onUpdate:show":t[0]||(t[0]=e=>n.value=e),"close-on-click-overlay":!1,position:"center",style:D({backgroundColor:k(r)?"#1a1a1a":void 0})},{default:g(()=>[f("div",mt,[f("div",ht,[f("span",gt,b(e.title),1)]),f("div",ft,[y(s,{percentage:e.progress,"stroke-width":"8"},null,8,["percentage"]),f("div",yt,b(e.text),1)])])]),_:1},8,["show","style"])}}}),[["__scopeId","data-v-2052922e"]]),xt={class:"chat-container"},wt={key:0,class:"message-avatar"},Vt=["src","alt"],bt={key:1,class:"avatar-placeholder"},_t={class:"message-bubble"},Ct={key:0,class:"message-sender"},It={class:"message-text"},jt=s(u({__name:"sdkwork-generation-video-dialogue",props:{disabled:{type:Boolean,default:!1},pointsCoefficient:{default:1},showHistory:{type:Boolean,default:!0},themeMode:{default:"auto"}},emits:["generation-start","generation-success","generation-error","validation-change","project-save"],setup(a,{expose:t,emit:l}){const s=a,o=l,i=p(""),r=p([]),u=p([]),h=p("user_current"),k=p(!1),w=p(!1),_=p(!1),C=p(!1),I=p(""),j=p(!1),S=p(!1),M=p(!1),B=p(!1),D=p(0),P=p(""),R=p("正在生成视频"),L=p("resolution"),O=p(!0),G=p(!0),K=p(!1),F=p(!0),z=p(),E=p(),q=p();new X;const J=new Y,Q=new Z,N=e=>({id:e.id,name:e.name,avatar:e.avatar}),W=(e,a,t=!1)=>{const l=(new Date).toISOString();return{id:`msg_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,uuid:`uuid_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,body:{id:`body_${Date.now()}`,payload:{text:{content:e}}},sendAt:l,receiveAt:l,updatedAt:l,createdAt:l,senderId:a.id,content:e,isOwn:t,children:[],messageState:{isThinking:!1,thinkStart:(new Date).getTime()},actions:[],metadata:new Map([["senderInfo",a]])}},H=e=>e.body&&e.body.payload&&e.body.payload.content?e.body.payload.content:e.content?e.content:"",ee=e=>e.metadata&&e.metadata.has("senderInfo")?e.metadata.get("senderInfo"):e.senderInfo?e.senderInfo:null,ae=$({id:`project_${Date.now()}`,title:"多人对话视频项目",description:"",characters:[],scenes:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),status:"draft"}),te=v(()=>"dark"===s.themeMode?"theme-dark":"light"===s.themeMode?"theme-light":"theme-auto"),le=e=>{i.value=e.id,n(`已选择角色: ${e.name}`)},se=e=>{if(console.log("上传的文件:",e),e&&e.length>0){const a=e.map(e=>e.name).join(", ");n(`已选择文件: ${a}`)}},oe=e=>{r.value.push(e),ae.characters=[...r.value],ae.updatedAt=(new Date).toISOString(),ke()},ie=async()=>{if(I.value.trim())if(r.value.length<2)n("至少需要两个角色才能生成对话");else{k.value=!0;try{const a=`请为以下角色生成一段自然的多轮对话：${I.value}\n\n角色列表：\n${r.value.map((e,a)=>`${a+1}. ${e.name}: ${e.description}`).join("\n")}\n\n要求：\n1. 每个角色都有发言\n2. 对话自然流畅\n3. 符合角色设定\n4. 返回格式为"角色名: 对话内容"`;try{const e={model:"gpt-4",messages:[{role:"system",content:"你是一个专业的对话生成助手，能够根据给定的角色设定生成自然流畅的多人对话。"},{role:"user",content:a}],temperature:.7,max_tokens:1e3,stream:!1},t=await J.create(e);if(t&&t.choices&&t.choices.length>0&&t.choices[0].message){const e=t.choices[0].message.content||"",a=ne(e);u.value=[...u.value,...a]}else{console.warn("API返回格式异常，使用模拟数据作为备用");const e=re(I.value);u.value=[...u.value,...e]}}catch(e){console.error("API调用失败，使用模拟数据:",e);const a=re(I.value);u.value=[...u.value,...a]}I.value="",k.value=!1,n("对话生成成功"),A(()=>{ce()}),ke()}catch(a){console.error("生成对话失败:",a),k.value=!1,c("生成对话失败，请稍后重试")}}else n("请输入对话内容")},ne=e=>{const a=[],t=e.split("\n").filter(e=>e.trim());if(t.length<2)return re(e);for(const l of t){const e=l.match(/^(\S+?)[:：]\s*(.+)$/);if(e&&e[1]&&e[2]){const t=e[1].trim(),l=e[2].trim(),s=r.value.find(e=>e.name===t||e.name.includes(t)||t.includes(e.name));if(s){const e=N(s),t=W(l,e,s.id===h.value);a.push(t)}}}return 0===a.length?re(e):a},re=e=>{const a=[],t=r.value[0],l=r.value[1];for(let s=0;s<5;s++){const o=s%2==0?t:l;let i="";i=0===s?`${e}`:1===s?`我觉得这个想法不错，${o.name}很赞同。`:2===s?`我们可以尝试一下，${o.name}觉得很有意思。`:3===s?`${o.name}建议我们周末可以一起去实现这个想法。`:`太好了，${o.name}期待周末的到来！`;const n=N(o),r=W(i,n,o.id===h.value);a.push(r)}return a},ce=()=>{z.value&&z.value.scrollToBottom&&z.value.scrollToBottom()},de=()=>{L.value="resolution",M.value=!0},ue=()=>{L.value="format",M.value=!0},ve=()=>{L.value="music",M.value=!0},pe=e=>{q.value&&q.value.updateVideoSettings&&q.value.updateVideoSettings(L.value,e)},me=async e=>{if(e.title.trim())if(0!==u.value.length){S.value=!1,B.value=!0,_.value=!0,D.value=0,P.value="准备生成...";try{const t=u.value.map(e=>`${ee(e)?.name||"未知"}: ${H(e)}`).join("\n");let l=720,s=1280;switch(e.resolution){case"480p":l=480,s=854;break;case"720p":l=720,s=1280;break;case"1080p":l=1080,s=1920;break;case"4K":l=2160,s=3840}const i=`请生成一个多人对话视频，标题：${e.title}\n    \n描述：${e.description||""}\n\n对话内容：\n${t}\n\n要求：\n1. 根据对话内容生成相应的角色形象和场景\n2. 为每个角色分配符合其特征的配音\n3. 视频风格自然生动，${e.addTransition?"添加过渡效果":"保持简单直接"}\n4. ${e.addSubtitle?"添加字幕":"无需字幕"}\n5. ${e.backgroundMusic?`添加${e.backgroundMusic}风格的背景音乐`:"无背景音乐"}`;try{const a={prompt:i,width:l,height:s,model:"stable-video-diffusion",responseFormat:"url",style:"vivid",aspectRatio:l>s?"16:9":"9:16"},t=await Q.create(a),n=t.videos||[];if(!(n&&n.length>0))throw new Error("生成结果格式不正确");D.value=100,P.value="生成完成!",setTimeout(()=>{B.value=!1,_.value=!1,d("视频生成成功");const a=n[0].url||"https://example.com/video.mp4";o("generation-success",{title:e.title,description:e.description,url:a,thumbnail:n[0].thumbnailUrl||"https://example.com/thumbnail.jpg",taskId:t.taskId}),ae.status="completed",ae.updatedAt=(new Date).toISOString(),o("project-save",{...ae})},1e3)}catch(a){console.error("API调用失败，使用模拟生成:",a),he(e)}}catch(t){console.error("生成视频失败:",t),B.value=!1,_.value=!1,c("生成视频失败，请稍后重试")}}else n("没有可生成视频的对话内容");else n("请输入视频标题")},he=e=>{const a=[{progress:20,text:"分析对话内容..."},{progress:40,text:"生成语音..."},{progress:60,text:"合成视频场景..."},{progress:80,text:"添加字幕和效果..."},{progress:100,text:"完成!"}];let t=0;const l=setInterval(()=>{if(t<a.length){const e=a[t];D.value=e.progress,P.value=e.text,t++}else clearInterval(l),setTimeout(()=>{B.value=!1,_.value=!1,d("视频生成成功"),o("generation-success",{title:e?.title||"多人对话视频",description:e?.description||"",url:"https://example.com/video.mp4",thumbnail:"https://example.com/thumbnail.jpg"}),ae.status="completed",ae.updatedAt=(new Date).toISOString(),o("project-save",{...ae})},1e3)},1500)},ge=e=>{console.log("Message clicked:",e)},fe=e=>{console.log("Message long pressed:",e)},ye=()=>{console.log("Load more messages")},ke=()=>{const e=r.value.length>0,a=u.value.length>0;return C.value=e&&a,o("validation-change",C.value),C.value};return T(async()=>{await new Promise(e=>setTimeout(e,100)),0===r.value.length&&(r.value=[{id:"character_1",name:"小明",description:"一个活泼开朗的男孩",avatar:"",appearance:{gender:"male",age:"20岁",style:"休闲",description:"短发，穿着休闲装，笑容阳光"},voice:{voiceId:"male_young",pitch:1,speed:1,emotion:"开朗"}},{id:"character_2",name:"小红",description:"一个温柔文静的女孩",avatar:"",appearance:{gender:"female",age:"19岁",style:"甜美",description:"长发，穿着连衣裙，文静温柔"},voice:{voiceId:"female_young",pitch:1.2,speed:.9,emotion:"温柔"}}],ae.characters=[...r.value]),ke()}),t({currentProject:ae,characters:r,messages:u,validateProject:ke,generateVideo:()=>{0!==u.value.length?S.value=!0:n("没有可生成视频的对话内容")}}),(t,l)=>(m(),x("div",{class:V(["sdkwork-generation-video-dialogue",te.value])},[f("div",xt,[f("div",{class:"chat-messages",ref_key:"messagesContainerRef",ref:E},[y(e,{messages:u.value,loading:w.value,"current-user-id":h.value,"show-avatar":O.value,"show-time-divider":G.value,"theme-mode":a.themeMode,"has-more":K.value,"show-no-more-data":F.value,onMessageClick:ge,onMessageLongPress:fe,onLoadMore:ye,ref_key:"messageListRef",ref:z},{"message-content":g(({message:e,isOwn:a})=>[f("div",{class:V(["custom-message-content",{"own-message":a}])},[O.value&&ee(e)?(m(),x("div",wt,[ee(e)?.avatar?(m(),x("img",{key:0,src:ee(e)?.avatar,alt:ee(e)?.name},null,8,Vt)):(m(),x("div",bt,b(ee(e)?.name?.charAt(0).toUpperCase()||"?"),1))])):U("",!0),f("div",_t,[ee(e)?(m(),x("div",Ct,b(ee(e)?.name),1)):U("",!0),f("div",It,b(H(e)),1)])],2)]),_:1},8,["messages","loading","current-user-id","show-avatar","show-time-divider","theme-mode","has-more","show-no-more-data"])],512),y(Ia,{characters:r.value,"selected-character-id":i.value,"input-text":I.value,"generating-dialogue":k.value,"generating-video":_.value,"has-messages":u.value.length>0,onSelectCharacter:le,onShowAddCharacter:l[0]||(l[0]=e=>j.value=!0),onGenerateDialogue:ie,onShowVideoGenerator:l[1]||(l[1]=e=>S.value=!0),"onUpdate:inputText":l[2]||(l[2]=e=>I.value=e),onMediaUpload:se},null,8,["characters","selected-character-id","input-text","generating-dialogue","generating-video","has-messages"])]),y(vt,{modelValue:j.value,"onUpdate:modelValue":l[3]||(l[3]=e=>j.value=e),onAdd:oe},null,8,["modelValue"]),y(Ba,{modelValue:S.value,"onUpdate:modelValue":l[4]||(l[4]=e=>S.value=e),messages:u.value,"generating-video":_.value,onGenerate:me,onResolutionPicker:de,onFormatPicker:ue,onMusicPicker:ve,ref_key:"videoGeneratorRef",ref:q},null,8,["modelValue","messages","generating-video"]),y(pt,{modelValue:M.value,"onUpdate:modelValue":l[5]||(l[5]=e=>M.value=e),"picker-type":L.value,onConfirm:pe},null,8,["modelValue","picker-type"]),y(kt,{modelValue:B.value,"onUpdate:modelValue":l[6]||(l[6]=e=>B.value=e),title:R.value,progress:D.value,text:P.value},null,8,["modelValue","title","progress","text"])],2))}}),[["__scopeId","data-v-5b49e75c"]]),St={class:"mobile-video-dialogue-page"},Ut=s(u({__name:"index",setup(e){const a=p();return(e,t)=>(m(),x("div",St,[y(jt,{ref_key:"videoDialogueGenerator",ref:a,onBack:t[0]||(t[0]=a=>e.$router.back())},null,512)]))}}),[["__scopeId","data-v-4dce2ded"]]);export{Ut as default};
