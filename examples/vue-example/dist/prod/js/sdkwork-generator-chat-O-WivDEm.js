import{_ as e,g as l}from"./index-DS3FT4GI.js";import{k as a,r as t,f as o,w as s,b as n,o as i,P as u,Q as r,V as d,R as c,S as v,W as p,s as m,a8 as w,x as y,a1 as b,$ as g,F as h,Y as f,n as k,j as V}from"./vue-vendor-CnVaDBlt.js";import{_ as x}from"./sdkwork-chat-message-list-BJNACvq0.js";const B={class:"input-container"},j={class:"input-area"},T={class:"input-wrapper"},z=["placeholder","maxlength","rows","disabled","onKeydown"],_={class:"bottom-bar"},S=["disabled","title"],E={class:"action-area"},L=["disabled","title"],C={class:"style-icon"},I=["disabled","title"],H={key:0,class:"send-icon"},O={key:1,class:"loading-icon"},R={class:"picker-header"},D=["title"],A={class:"style-grid"},P=["onClick"],K={class:"style-emoji"},M={class:"style-name"},F=e(a({__name:"sdkwork-chat-input-box",props:{modelValue:{type:Object,required:!0,default:()=>({prompt:"",style:"pop"})},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},styleOptions:{type:Array,default:()=>[{label:"流行",value:"pop",icon:"🎤"},{label:"摇滚",value:"rock",icon:"🎸"},{label:"电子",value:"electronic",icon:"🎧"},{label:"古典",value:"classical",icon:"🎻"},{label:"爵士",value:"jazz",icon:"🎷"},{label:"民谣",value:"folk",icon:"🎶"},{label:"嘻哈",value:"hiphop",icon:"🎤"},{label:"氛围",value:"ambient",icon:"🌌"},{label:"电影配乐",value:"cinematic",icon:"🎬"},{label:"游戏音乐",value:"game",icon:"🎮"}]},placeholder:{type:String,default:"描述你想要生成的音乐..."},maxLength:{type:Number,default:200},minRows:{type:Number,default:1},stylePickerTitle:{type:String,default:"选择音乐风格"},addButtonTooltip:{type:String,default:"添加附件"},styleButtonTooltip:{type:String,default:"选择音乐风格"},sendButtonTooltip:{type:String,default:"发送消息"},closeButtonTooltip:{type:String,default:"关闭"}},emits:["update:modelValue","send","style-change","add-click","input","focus","blur","keydown","style-picker-open","style-picker-close"],setup(e,{expose:l,emit:a}){const V=e,x=a,F=t(),N=t(!1),U=t(V.modelValue.prompt),W=t(!1),$=t(!1),q=t(0);t(!1);const Q=t(0),Y=t(0),G=t(0),J=t(),X=o(()=>U.value.trim().length>0&&!V.loading),Z=o(()=>{const e=V.styleOptions.find(e=>e.value===V.modelValue.style);return e?.icon||"🎵"});s(()=>V.modelValue.prompt,e=>{e!==U.value&&(U.value=e)}),s(U,e=>{e!==V.modelValue.prompt&&(x("update:modelValue",{...V.modelValue,prompt:e}),x("input",e)),de()}),s(W,e=>{e&&k(()=>{me()})});const ee=()=>{if(!X.value||V.disabled)return;const e={prompt:U.value.trim(),style:V.modelValue.style};x("send",e)},le=()=>{V.disabled||x("add-click")},ae=()=>{V.disabled||(N.value=!0,x("style-picker-open"))},te=e=>{e!==V.modelValue.style&&(x("update:modelValue",{...V.modelValue,style:e}),x("style-change",e)),oe()},oe=()=>{N.value=!1,x("style-picker-close")},se=e=>{e.target===e.currentTarget&&oe()},ne=e=>{x("input",U.value),de()},ie=e=>{x("keydown",e),e.ctrlKey&&"Enter"===e.key&&ee()},ue=()=>{$.value=!0,x("focus"),ce()&&ve()},re=()=>{$.value=!1,x("blur"),ce()&&setTimeout(()=>{pe()},100)},de=()=>{k(()=>{if(F.value){const e=F.value.scrollTop;F.value.style.height="auto";const l=Math.min(F.value.scrollHeight,120);F.value.style.height=l+"px",F.value.scrollTop=e}})},ce=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ve=()=>{if(!ce())return;const e=window.visualViewport?.height||window.innerHeight,l=window.innerHeight,a=l-e;a>100&&e<.7*l&&(W.value=!0,q.value=a,0===Q.value&&(Q.value=l))},pe=()=>{if(!ce())return;const e=window.visualViewport?.height||window.innerHeight;window.innerHeight-e<50&&Math.abs(e-Q.value)<20&&(W.value=!1,q.value=0)},me=()=>{F.value&&ce()&&k(()=>{F.value?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})})},we=()=>{if("undefined"!=typeof window){const e=getComputedStyle(document.documentElement).getPropertyValue("--safe-area-inset-bottom");Y.value=e?parseInt(e)||0:ce()?34:0}},ye=()=>{G.value=window.innerHeight,we(),$.value&&ce()&&ve()},be=()=>{ce()&&window.visualViewport&&ve()};return n(()=>{we(),G.value=window.innerHeight,window.addEventListener("resize",ye),window.visualViewport&&window.visualViewport.addEventListener("resize",be),"undefined"!=typeof ResizeObserver&&(J.value=new ResizeObserver(()=>{$.value&&ce()&&ve()}),F.value&&J.value.observe(F.value))}),i(()=>{window.removeEventListener("resize",ye),window.visualViewport&&window.visualViewport.removeEventListener("resize",be),J.value&&J.value.disconnect()}),l({focusInput:()=>{F.value?.focus()},clearInput:()=>{U.value=""},setStyle:e=>{te(e)},isKeyboardOpen:W,keyboardHeight:q,safeAreaBottom:Y}),(l,a)=>(r(),u("div",{class:c(["chat-input-box",{"keyboard-open":W.value,focused:$.value}]),style:d({"--keyboard-height":q.value+"px"})},[v("div",B,[v("div",j,[v("div",T,[m(v("textarea",{ref_key:"inputRef",ref:F,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),class:"chat-input",placeholder:e.placeholder,maxlength:e.maxLength,rows:e.minRows,disabled:e.disabled,onInput:ne,onKeydown:[y(b(ee,["exact","prevent"]),["enter"]),ie],onFocus:ue,onBlur:re},null,40,z),[[w,U.value]])])]),v("div",_,[v("button",{class:"add-btn",onClick:le,disabled:e.disabled,title:e.addButtonTooltip},[...a[2]||(a[2]=[v("span",{class:"add-icon"},"+",-1)])],8,S),v("div",E,[v("button",{class:"style-btn",onClick:ae,disabled:e.disabled,title:e.styleButtonTooltip},[v("span",C,g(Z.value),1)],8,L),v("button",{class:c(["send-btn",{disabled:!X.value||e.disabled,loading:e.loading}]),onClick:ee,disabled:!X.value||e.disabled,title:e.sendButtonTooltip},[e.loading?(r(),u("span",O,"⏳")):(r(),u("span",H,"↑"))],10,I)])])]),N.value?(r(),u("div",{key:0,class:"style-picker-modal",onClick:se},[v("div",{class:"picker-content",onClick:a[1]||(a[1]=b(()=>{},["stop"]))},[v("div",R,[v("h3",null,g(e.stylePickerTitle),1),v("button",{class:"close-btn",onClick:oe,title:e.closeButtonTooltip},"×",8,D)]),v("div",A,[(r(!0),u(h,null,f(e.styleOptions,l=>(r(),u("div",{key:l.value,class:c(["style-item",{selected:e.modelValue.style===l.value}]),onClick:e=>te(l.value)},[v("span",K,g(l.icon),1),v("span",M,g(l.label),1)],10,P))),128))])])])):p("",!0)],6))}}),[["__scopeId","data-v-3392e628"]]),N={class:"chat-music-generator"},U=e(a({__name:"sdkwork-generator-chat",setup(e){const a=t({prompt:"",style:"pop"}),s=t(""),d=t(!1),c=t(""),p=t(0);t("");const m=t([]),w=t(!1),y=t(0),b=t(0),g=t(),h=t(),f=t();l(f),t(46);const B=o(()=>f.value?.offsetHeight||0),j=[{label:"流行",value:"pop",icon:"🎤"},{label:"摇滚",value:"rock",icon:"🎸"},{label:"电子",value:"electronic",icon:"🎧"},{label:"古典",value:"classical",icon:"🎻"},{label:"爵士",value:"jazz",icon:"🎷"},{label:"民谣",value:"folk",icon:"🎶"},{label:"嘻哈",value:"hiphop",icon:"🎤"},{label:"氛围",value:"ambient",icon:"🌌"},{label:"电影配乐",value:"cinematic",icon:"🎬"},{label:"游戏音乐",value:"game",icon:"🎮"}],T=o(()=>a.value.prompt.trim().length>0);o(()=>{const e=j.find(e=>e.value===a.value.style);return e?.label||"流行"});const z=o(()=>s.value?s.value.length>15?s.value.substring(0,15)+"...":s.value:"未命名音乐"),_=e=>{a.value.style=e},S=()=>{},E=e=>{T.value&&!d.value&&(L(e.prompt,e.style),s.value=e.prompt,a.value.prompt="",c.value="",O())},L=(e,l)=>{const a={id:Date.now(),type:"user",text:e,avatar:"👤",style:l,timestamp:Date.now()};m.value.push(a),k(()=>{g.value?.scrollToBottom()})},C=(e,l)=>{m.value=m.value.filter(e=>"generating"!==e.type);const a={id:"generating",type:"generating",text:"",avatar:"🤖",status:e,progress:l,timestamp:Date.now()};m.value.push(a),k(()=>{g.value?.scrollToBottom()})},I=()=>{w.value=!0,h.value&&g.value},H=()=>{w.value=!1,h.value&&g.value},O=async()=>{if(!T.value)return;d.value=!0,p.value=0;const e=["正在分析音乐描述...","创作旋律和和弦进行...","编排乐器声部...","混音和母带处理...","导出最终音频..."];let l=0;const t=setInterval(()=>{p.value>=25*l&&(C(e[l],p.value),l++),p.value+=2+3*Math.random(),p.value>=100&&(p.value=100,C("音乐生成完成！",p.value),clearInterval(t),setTimeout(()=>{const e={pop:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",rock:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",electronic:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",classical:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",jazz:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",folk:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",hiphop:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",ambient:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",cinematic:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",game:"https://www.soundjay.com/misc/sounds/bell-ringing-05.wav"};c.value=e[a.value.style]||e.pop,((e,l,a)=>{const t={id:Date.now()+1,type:"ai",text:"为你生成了一首音乐",avatar:"🎵",music:{title:l,url:e,style:a},timestamp:Date.now()};m.value.push(t),k(()=>{g.value?.scrollToBottom()})})(c.value,z.value,a.value.style),m.value=m.value.filter(e=>"generating"!==e.type),d.value=!1},800))},400)},R=e=>{if(e.music?.url){const l=document.createElement("a");l.href=e.music.url,l.download=`generated-music-${Date.now()}.mp3`,l.click()}},D=e=>{"user"===e.type&&(a.value.prompt=e.text,a.value.style=e.style||"pop",k(()=>{E(a.value)}))},A=()=>{m.value=[{id:"system",type:"system",text:"你好！我是AI音乐助手，请输入音乐描述，我将为你生成专属音乐。",avatar:"🤖",timestamp:Date.now()}]};n(()=>{A()});const P=()=>{h.value&&g.value&&(w.value=h.value.isKeyboardOpen,y.value=h.value.keyboardHeight,b.value=h.value.safeAreaBottom)};return n(()=>{A(),window.addEventListener("resize",P),window.visualViewport&&window.visualViewport.addEventListener("resize",P)}),i(()=>{window.removeEventListener("resize",P),window.visualViewport&&window.visualViewport.removeEventListener("resize",P)}),(e,l)=>(r(),u("div",N,[V(x,{ref_key:"messageListRef",ref:g,messages:m.value,"style-options":j,"input-box-height":B.value,onRegenerate:D,onDownload:R},null,8,["messages","input-box-height"]),v("div",{class:"input-box-wrapper",ref_key:"inputBoxWrapperRef",ref:f},[V(F,{ref_key:"inputBoxRef",ref:h,modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),loading:d.value,"style-options":j,onSend:E,onStyleChange:_,onAddClick:S,onFocus:I,onBlur:H},null,8,["modelValue","loading"])],512)]))}}),[["__scopeId","data-v-f5ff9f25"]]);export{U as S};
