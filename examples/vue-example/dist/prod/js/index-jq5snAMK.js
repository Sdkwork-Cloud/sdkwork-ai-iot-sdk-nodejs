import{c as e,V as t,a4 as l,a2 as o,a5 as n,a6 as a,n as i,E as s,W as u,U as c,F as r,a3 as v,a7 as p,t as m,r as d,T as f,a8 as h,L as g,J as b,p as x,a9 as w,aa as y,w as H}from"./index-CS7g9XHh.js";import{k as O,a as k,f as T,m as I,j as N,w as S,n as C,q as V}from"./vue-vendor-BvtDOCb5.js";const[B,D,M]=e("picker"),j=e=>e.find(e=>!e.disabled)||e[0];function P(e,t){for(let l=t=o(t,0,e.length);l<e.length;l++)if(!e[l].disabled)return l;for(let l=t-1;l>=0;l--)if(!e[l].disabled)return l;return 0}const $=(e,t,l)=>void 0!==t&&e.some(e=>e[l.value]===t);function E(e,t,l){const o=e.findIndex(e=>e[l.value]===t);return e[P(e,o)]}const[F,A]=e("picker-column"),L=Symbol(F);var q=O({name:F,props:{value:i,fields:n(Object),options:a(),readonly:Boolean,allowHtml:Boolean,optionHeight:n(Number),swipeDuration:n(i),visibleOptionNum:n(i)},emits:["change","clickOption","scrollInto"],setup(e,{emit:t,slots:l}){let n,a,i,p,m;const d=k(),f=k(),h=k(0),g=k(0),b=s(),x=()=>e.options.length,w=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,y=l=>{let o=P(e.options,l);const a=-o*e.optionHeight,i=()=>{o>x()-1&&(o=P(e.options,l));const n=e.options[o][e.fields.value];n!==e.value&&t("change",n)};n&&a!==h.value?m=i:i(),h.value=a},H=()=>e.readonly||!e.options.length,O=t=>o(Math.round(-t/e.optionHeight),0,x()-1),S=T(()=>O(h.value)),C=()=>{n=!1,g.value=0,m&&(m(),m=null)},V=e=>{if(!H()){if(b.start(e),n){const e=function(e){const{transform:t}=window.getComputedStyle(e),l=t.slice(7,t.length-1).split(", ")[5];return Number(l)}(f.value);h.value=Math.min(0,e-w())}g.value=0,a=h.value,i=Date.now(),p=a,m=null}},B=()=>{if(H())return;const t=h.value-p,l=Date.now()-i;if(l<300&&Math.abs(t)>15)return void((t,l)=>{const o=Math.abs(t/l);t=h.value+o/.003*(t<0?-1:1);const n=O(t);g.value=+e.swipeDuration,y(n)})(t,l);const o=O(h.value);g.value=200,y(o),setTimeout(()=>{n=!1},0)},D=()=>{const o={height:`${e.optionHeight}px`};return e.options.map((a,i)=>{const s=a[e.fields.text],{disabled:u}=a,c=a[e.fields.value],r={role:"button",style:o,tabindex:u?-1:0,class:[A("item",{disabled:u,selected:c===e.value}),a.className],onClick:()=>(l=>{n||H()||(m=null,g.value=200,y(l),t("clickOption",e.options[l]))})(i)},v={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:s};return N("li",r,[l.option?l.option(a,i):N("div",v,null)])})};return u(L),c({stopMomentum:C}),I(()=>{const t=n?Math.floor(-h.value/e.optionHeight):e.options.findIndex(t=>t[e.fields.value]===e.value),l=P(e.options,t),o=-l*e.optionHeight;n&&l<t&&C(),h.value=o}),r("touchmove",l=>{if(H())return;b.move(l),b.isVertical()&&(n=!0,v(l,!0));const s=o(a+b.deltaY.value,-x()*e.optionHeight,e.optionHeight),u=O(s);u!==S.value&&t("scrollInto",e.options[u]),h.value=s;const c=Date.now();c-i>300&&(i=c,p=s)},{target:d}),()=>N("div",{ref:d,class:A(),onTouchstartPassive:V,onTouchend:B,onTouchcancel:B},[N("ul",{ref:f,style:{transform:`translate3d(0, ${h.value+w()}px, 0)`,transitionDuration:`${g.value}ms`,transitionProperty:g.value?"all":"none"},class:A("wrapper"),onTransitionend:C},[D()])])}});const[z]=e("picker-toolbar"),J={title:String,cancelButtonText:String,confirmButtonText:String},U=["cancel","confirm","title","toolbar"],W=Object.keys(J);var Y=O({name:z,props:J,emits:["confirm","cancel"],setup(e,{emit:t,slots:l}){const o=()=>t("cancel"),n=()=>t("confirm"),a=()=>{var t;const n=null!=(t=e.cancelButtonText)?t:M("cancel");if(l.cancel||n)return N("button",{type:"button",class:[D("cancel"),p],onClick:o},[l.cancel?l.cancel():n])},i=()=>{var t;const o=null!=(t=e.confirmButtonText)?t:M("confirm");if(l.confirm||o)return N("button",{type:"button",class:[D("confirm"),p],onClick:n},[l.confirm?l.confirm():o])};return()=>N("div",{class:D("toolbar")},[l.toolbar?l.toolbar():[a(),l.title?l.title():e.title?N("div",{class:[D("title"),"van-ellipsis"]},[e.title]):void 0,i()]])}});const[G]=e("picker-group"),K=Symbol(G);t({tabs:a(),activeTab:d(0),nextStepText:String,showToolbar:m},J);const Q=t({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:d(44),showToolbar:m,swipeDuration:d(1e3),visibleOptionNum:d(6)},J);const R=H(O({name:B,props:t({},Q,{columns:a(),modelValue:a(),toolbarPosition:x("top"),columnsFieldNames:Object}),emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const a=k(),i=k(e.modelValue.slice(0)),{parent:s}=u(K),{children:p,linkChildren:m}=f(L);m();const d=T(()=>function(e){return t({text:"text",value:"value",children:"children"},e)}(e.columnsFieldNames)),x=T(()=>h(e.optionHeight)),H=T(()=>function(e,t){const l=e[0];if(l){if(Array.isArray(l))return"multiple";if(t.children in l)return"cascade"}return"default"}(e.columns,d.value)),O=T(()=>{const{columns:t}=e;switch(H.value){case"multiple":return t;case"cascade":return function(e,t,o){const n=[];let a={[t.children]:e},i=0;for(;a&&a[t.children];){const e=a[t.children],s=o.value[i];a=l(s)?E(e,s,t):void 0,!a&&e.length&&(a=E(e,j(e)[t.value],t)),i++,n.push(e)}return n}(t,d.value,i);default:return[t]}}),I=T(()=>O.value.some(e=>e.length)),B=T(()=>O.value.map((e,t)=>E(e,i.value[t],d.value))),M=T(()=>O.value.map((e,t)=>e.findIndex(e=>e[d.value.value]===i.value[t]))),P=(e,t)=>{if(i.value[e]!==t){const l=i.value.slice(0);l[e]=t,i.value=l}},F=()=>({selectedValues:i.value.slice(0),selectedOptions:B.value,selectedIndexes:M.value}),A=()=>{p.forEach(e=>e.stopMomentum());const e=F();return C(()=>{const e=F();o("confirm",e)}),e},z=()=>o("cancel",F()),J=()=>O.value.map((l,a)=>N(q,{value:i.value[a],fields:d.value,options:l,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:x.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:e=>((e,l)=>{P(l,e),"cascade"===H.value&&i.value.forEach((e,t)=>{const l=O.value[t];$(l,e,d.value)||P(t,l.length?l[0][d.value.value]:void 0)}),C(()=>{o("change",t({columnIndex:l},F()))})})(e,a),onClickOption:e=>((e,l)=>{const n={columnIndex:l,currentOption:e};o("clickOption",t(F(),n)),o("scrollInto",n)})(e,a),onScrollInto:e=>{o("scrollInto",{currentOption:e,columnIndex:a})}},{option:n.option})),G=e=>{if(I.value){const t={height:`${x.value}px`},l={backgroundSize:`100% ${(e-x.value)/2}px`};return[N("div",{class:D("mask"),style:l},null),N("div",{class:[w,D("frame")],style:t},null)]}},Q=()=>{const t=x.value*+e.visibleOptionNum,l={height:`${t}px`};return e.loading||I.value||!n.empty?N("div",{ref:a,class:D("columns"),style:l},[J(),G(t)]):n.empty()},R=()=>{if(e.showToolbar&&!s)return N(Y,V(b(e,W),{onConfirm:A,onCancel:z}),b(n,U))},X=e=>{e.forEach((e,t)=>{e.length&&!$(e,i.value[t],d.value)&&P(t,j(e)[d.value.value])})};let Z;S(O,e=>X(e),{immediate:!0}),S(()=>e.modelValue,t=>{y(t,i.value)||y(t,Z)||(i.value=t.slice(0),Z=t.slice(0)),0===e.modelValue.length&&X(O.value)},{deep:!0}),S(i,t=>{y(t,e.modelValue)||(Z=t.slice(0),o("update:modelValue",Z))},{immediate:!0}),r("touchmove",v,{target:a});return c({confirm:A,getSelectedOptions:()=>B.value}),()=>{var t,l;return N("div",{class:D()},["top"===e.toolbarPosition?R():null,e.loading?N(g,{class:D("loading")},null):null,null==(t=n["columns-top"])?void 0:t.call(n),Q(),null==(l=n["columns-bottom"])?void 0:l.call(n),"bottom"===e.toolbarPosition?R():null])}}}));export{R as P,Q as p};
