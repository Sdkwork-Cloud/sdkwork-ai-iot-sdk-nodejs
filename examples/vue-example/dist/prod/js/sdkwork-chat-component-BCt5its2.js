import{S as e}from"./sdkwork-page-container-CGxg83zK.js";import{k as a,r as t,P as o,Q as n,S as i,W as l,u as s,j as c,w as r,t as d,a8 as u,n as v,b as p,o as m,f as g,T as h,a0 as y,R as f,F as k,Y as w,V as b,$ as E,Z as C,U as S,v as _,y as I,a3 as T,O as D}from"./vue-vendor-Caw1HGjZ.js";import{d as x,_ as A,g as M,h as B,j as R,A as O,s as N}from"./index-DvK_64jm.js";import{_ as F}from"./app-header-CocRmc_c.js";import{u as L,M as P,a as U}from"./chat-Ci0JGkFm.js";import{u as K}from"./conversation-7XgEGRA7.js";import{_ as j}from"./sdkwork-chat-message-list-Cutz77Mf.js";import{N as $}from"./index-IgJwgFsk.js";import{_ as V,S as z}from"./sdkwork-subtitles-1lCTzABu.js";var H=(e=>(e.SEND_MESSAGE="send-message",e.SEND_VOICE="send-voice",e.SEND_FILE="send-file",e.SEND_IMAGE="send-image",e.SEND_VIDEO="send-video",e.SEND_RTC_REQUEST="send-rtc-request",e.SEND_LOCATION="send-location",e.INPUT_FOCUS="input-focus",e.INPUT_BLUR="input-blur",e.TEXT_CHANGE="text-change",e.UPLOAD_PROGRESS="upload-progress",e.KEY_DOWN="key-down",e.KEY_UP="key-up",e.KEY_PRESS="key-press",e.INPUT="input",e.COMPOSITION_START="composition-start",e.COMPOSITION_UPDATE="composition-update",e.COMPOSITION_END="composition-end",e.SCROLL="scroll",e.SCROLL_TOP="scroll-top",e.SCROLL_BOTTOM="scroll-bottom",e.KEYBOARD_SHOW="keyboard-show",e.KEYBOARD_HIDE="keyboard-hide",e.PASTE="paste",e.CUT="cut",e.COPY="copy",e.SELECTION_CHANGE="selection-change",e))(H||{});const G={class:"chat-input-tool-panel"},Y={class:"tool-section"},W={class:"tool-grid"},X=["disabled"],q={class:"tool-icon-wrapper"},Q={key:0,class:"loading-spinner"},Z=["disabled"],J={class:"tool-icon-wrapper"},ee={key:0,class:"loading-spinner"},ae=["disabled"],te={class:"tool-icon-wrapper"},oe={key:0,class:"loading-spinner"},ne=["disabled"],ie={class:"tool-icon-wrapper"},le={key:0,class:"loading-spinner"},se=A(a({__name:"chat-input-tool-panel",props:{enableCamera:{type:Boolean,default:!0},targetUserId:{default:""},conversationId:{}},emits:["select-tool","send-image","send-file","send-video","send-rtc-request","send-location","take-photo"],setup(e,{emit:a}){const r=e,d=a,u="image",v="file",p="camera",m="video",g="location",h="voice-call",y="video-call",f=t({}),k=e=>{d("select-tool",e)},w=async e=>{const a={image:"chooseImage",file:"chooseFile",video:"chooseVideo"};try{f.value[e]=!0;return await window.$files[a[e]]({count:1,success:e=>e.tempFiles&&e.tempFiles[0]?e.tempFiles[0]:null,fail:a=>{throw new Error(`ÈÄâÊã©${e}Â§±Ë¥•: ${a.message||a}`)}})}catch(t){return null}finally{f.value[e]=!1}},b=(e,a)=>{if(e.size>10485760)return!1;switch(a){case"image":return e.type.startsWith("image/");case"video":return e.type.startsWith("video/");case"file":return!0;default:return!1}},E={async image(){k(u);const e=await w("image");e&&b(e,"image")&&d("send-image",e)},async file(){k(v);const e=await w("file");e&&b(e,"file")&&d("send-file",e)},async video(){k(m);const e=await w("video");e&&b(e,"video")&&d("send-video",e)},camera(){k(p),d("take-photo")},async location(){if(k(g),navigator.geolocation)try{f.value.location=!0;const e=await new Promise((e,a)=>{navigator.geolocation.getCurrentPosition(e,a,{timeout:1e4,enableHighAccuracy:!0})}),{latitude:a,longitude:t}=e.coords;d("send-location",a,t)}catch(e){}finally{f.value.location=!1}},voiceCall(){k(h),d("send-rtc-request","voice",r.targetUserId)},videoCall(){k(y),d("send-rtc-request","video",r.targetUserId)}},{image:C,file:S,video:_,camera:I,location:T,voiceCall:D,videoCall:A}=E;return(a,t)=>(n(),o("div",G,[i("div",Y,[t[14]||(t[14]=i("h4",{class:"section-title"},"Â∏∏Áî®Â∑•ÂÖ∑",-1)),i("div",W,[i("button",{class:"tool-item",onClick:t[0]||(t[0]=(...e)=>s(C)&&s(C)(...e)),disabled:f.value.image},[i("div",q,[c(s(x),{icon:"mdi:image",width:"28",height:"28",class:"tool-icon"}),f.value.image?(n(),o("div",Q)):l("",!0)]),t[7]||(t[7]=i("div",{class:"tool-label"},"ÂõæÁâá",-1))],8,X),i("button",{class:"tool-item",onClick:t[1]||(t[1]=(...e)=>s(S)&&s(S)(...e)),disabled:f.value.file},[i("div",J,[c(s(x),{icon:"mdi:file-document-outline",width:"28",height:"28",class:"tool-icon"}),f.value.file?(n(),o("div",ee)):l("",!0)]),t[8]||(t[8]=i("div",{class:"tool-label"},"Êñá‰ª∂",-1))],8,Z),e.enableCamera?(n(),o("button",{key:0,class:"tool-item",onClick:t[2]||(t[2]=(...e)=>s(I)&&s(I)(...e))},[c(s(x),{icon:"mdi:camera",width:"28",height:"28",class:"tool-icon"}),t[9]||(t[9]=i("div",{class:"tool-label"},"Áõ∏Êú∫",-1))])):l("",!0),i("button",{class:"tool-item",onClick:t[3]||(t[3]=(...e)=>s(_)&&s(_)(...e)),disabled:f.value.video},[i("div",te,[c(s(x),{icon:"mdi:video",width:"28",height:"28",class:"tool-icon"}),f.value.video?(n(),o("div",oe)):l("",!0)]),t[10]||(t[10]=i("div",{class:"tool-label"},"ËßÜÈ¢ë",-1))],8,ae),i("button",{class:"tool-item",onClick:t[4]||(t[4]=(...e)=>s(T)&&s(T)(...e)),disabled:f.value.location},[i("div",ie,[c(s(x),{icon:"mdi:map-marker",width:"28",height:"28",class:"tool-icon"}),f.value.location?(n(),o("div",le)):l("",!0)]),t[11]||(t[11]=i("div",{class:"tool-label"},"‰ΩçÁΩÆ",-1))],8,ne),i("button",{class:"tool-item",onClick:t[5]||(t[5]=(...e)=>s(D)&&s(D)(...e))},[c(s(x),{icon:"mdi:microphone",width:"28",height:"28",class:"tool-icon"}),t[12]||(t[12]=i("div",{class:"tool-label"},"ËØ≠Èü≥ÈÄöËØù",-1))]),i("button",{class:"tool-item",onClick:t[6]||(t[6]=(...e)=>s(A)&&s(A)(...e))},[c(s(x),{icon:"mdi:video",width:"28",height:"28",class:"tool-icon"}),t[13]||(t[13]=i("div",{class:"tool-label"},"ËßÜÈ¢ëÈÄöËØù",-1))])])])]))}}),[["__scopeId","data-v-99a43ef4"]]),ce={class:"chat-input-text-area"},re=["placeholder","maxlength"],de={class:"input-actions"},ue=A(a({__name:"chat-input-text-area",props:{placeholder:{default:"ËæìÂÖ•Ê∂àÊÅØ..."},maxLength:{default:1e3},enableEmoji:{type:Boolean,default:!0},modelValue:{default:""}},emits:["update:modelValue","text-change","keydown","keyup","keypress","focus","blur","toggle-emoji-panel","input-event","composition-start","composition-update","composition-end","scroll","paste","cut","copy","selection-change"],setup(e,{expose:a,emit:p}){const m=e,g=p,h=t(m.modelValue),y=t();r(()=>m.modelValue,e=>{h.value=e,R()});const f=e=>{g("update:modelValue",h.value),g("text-change",h.value),g("input-event",e),R()},k=e=>{g("keydown",e)},w=e=>{g("keyup",e)},b=e=>{g("keypress",e)},E=()=>{g("focus"),document.addEventListener("selectionchange",B)},C=()=>{g("blur"),document.removeEventListener("selectionchange",B)},S=e=>{g("composition-start",e)},_=e=>{g("composition-update",e)},I=e=>{g("composition-end",e)},T=e=>{g("scroll",e)},D=e=>{g("paste",e)},A=e=>{g("cut",e)},M=e=>{g("copy",e)},B=()=>{const e=y.value;e&&document.activeElement===e&&g("selection-change")},R=()=>{v(()=>{const e=y.value;e&&(e.style.height="24px",e.scrollHeight>24&&(e.style.height=Math.min(e.scrollHeight,120)+"px"))})};return a({focus:()=>y.value?.focus(),clear:()=>{h.value="",g("update:modelValue",""),R()}}),(a,t)=>(n(),o("div",ce,[d(i("textarea",{ref_key:"textInputRef",ref:y,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),placeholder:e.placeholder,maxlength:e.maxLength,class:"text-input",onInput:f,onKeydown:k,onKeyup:w,onKeypress:b,onFocus:E,onBlur:C,onCompositionstart:S,onCompositionupdate:_,onCompositionend:I,onScroll:T,onPaste:D,onCut:A,onCopy:M},null,40,re),[[u,h.value]]),i("div",de,[e.enableEmoji?(n(),o("button",{key:0,class:"emoji-button",onClick:t[1]||(t[1]=e=>a.$emit("toggle-emoji-panel"))},[c(s(x),{icon:"mdi:emoticon-happy-outline",width:"18",height:"18",class:"emoji-icon"})])):l("",!0)])]))}}),[["__scopeId","data-v-58e2963e"]]),ve={class:"chat-input-voice"},pe={key:0,class:"recording-overlay"},me={class:"recording-glass"},ge={class:"audio-visualizer"},he={key:0,class:"wave-container"},ye={class:"recording-time"},fe={class:"time-digits"},ke={class:"recording-controls"},we={key:0,class:"error-message"},be={class:"voice-input"},Ee=["disabled"],Ce={class:"button-content"},Se={class:"record-icon"},_e={class:"record-text"},Ie=A(a({__name:"chat-input-voice",props:{disabled:{type:Boolean,default:!1},maxDuration:{default:60},minDuration:{default:1}},emits:["start-recording","stop-recording","recording-error","recording-cancelled","recording-timeout"],setup(e,{expose:a,emit:d}){const u=e,v=d,C=M(),S=t(!1),_=t(!1),I=t(0),T=t(!1);t(null),t(null),r(()=>C.currentState,(e,a)=>{"error"===e&&C.errorMessage&&v("recording-error",C.errorMessage),"stopped"!==e&&"idle"!==e||(T.value=!1,_.value=!1,I.value=0),"recording"===e&&"idle"===a&&(_.value=!1)}),r(()=>C.currentDuration,e=>{u.maxDuration>0&&e>=u.maxDuration&&C.isRecording&&F()}),r(()=>u.maxDuration,e=>{C.updateConfig({maxDuration:e})}),p(()=>{S.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>0||navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>0,S.value&&document.addEventListener("touchmove",D,{passive:!1}),C.updateConfig({maxDuration:u.maxDuration})}),m(()=>{S.value&&document.removeEventListener("touchmove",D),C.cleanup()});const D=e=>{if(!C.isRecording||!T.value)return;const a=e.touches[0],t=document.querySelector(".control-button.cancel-button"),o=document.querySelector(".control-button.finish-button"),n=t?.getBoundingClientRect(),i=n&&a.clientX>=n.left&&a.clientX<=n.right&&a.clientY>=n.top&&a.clientY<=n.bottom,l=o?.getBoundingClientRect(),s=l&&a.clientX>=l.left&&a.clientX<=l.right&&a.clientY>=l.top&&a.clientY<=l.bottom;i?(t?.classList.add("highlight"),o?.classList.remove("highlight"),!_.value&&navigator.vibrate&&navigator.vibrate(30),_.value=!0):s?(o?.classList.add("highlight"),t?.classList.remove("highlight"),_.value=!1):(t?.classList.remove("highlight"),o?.classList.remove("highlight"),_.value=!1),e.preventDefault()},A=g(()=>{const e=C.currentDuration,a=Math.floor(e/60);return`${a>0?`${a}:`:""}${(e%60).toString().padStart(2,"0")}`}),B=g(()=>C.currentDuration<u.minDuration);g(()=>u.maxDuration>0&&C.currentDuration>=u.maxDuration);const R=async e=>{if(e.preventDefault(),"touchstart"===e.type&&"ontouchstart"in window&&(e.stopPropagation(),I.value=Date.now(),T.value=!0),!u.disabled&&!C.isRecording&&"initializing"!==C.currentState){C.clearError(),_.value=!1;try{await C.startRecording({}),v("start-recording"),S.value&&navigator.vibrate&&navigator.vibrate(50)}catch(a){const e=a instanceof Error?a.message:"ÂΩïÈü≥ÂêØÂä®Â§±Ë¥•";v("recording-error",e),T.value=!1}}},O=async e=>{if(e.preventDefault(),"touchend"===e.type&&"ontouchstart"in window){if(e.stopPropagation(),_.value)return void N(e);if(Date.now()-I.value<200)return void(T.value=!1)}if(C.isRecording)if(B.value)N(e);else try{const e=await C.stopRecording();e&&e.data&&(v("stop-recording",e.data,e.duration),S.value&&navigator.vibrate&&navigator.vibrate([50,30,50]))}catch(a){const e=a instanceof Error?a.message:"ÂΩïÈü≥ÂÅúÊ≠¢Â§±Ë¥•";v("recording-error",e)}finally{T.value=!1}},N=e=>{e.preventDefault(),"touchcancel"===e.type&&"ontouchstart"in window&&e.stopPropagation(),C.isRecording&&(C.cancelRecording(),v("recording-cancelled"),S.value&&navigator.vibrate&&navigator.vibrate(100))},F=()=>{C.isRecording&&(O(new Event("timeout")),v("recording-timeout"))};return a({startRecording:async()=>R(new Event("programmatic")),stopRecording:async()=>O(new Event("programmatic")),cancelRecording:()=>{N(new Event("programmatic"))},isRecording:()=>C.isRecording,getRecordingDuration:()=>C.currentDuration}),(e,a)=>(n(),o("div",ve,[c(h,{name:"fade"},{default:y(()=>[s(C).isRecording?(n(),o("div",pe,[i("div",me,[i("div",ge,[c(s(x),{icon:"mdi:microphone",width:"64",height:"64",class:f(["recording-icon",{pulsing:s(C).isRecording}])},null,8,["class"]),s(C).isRecording?(n(),o("div",he,[(n(),o(k,null,w(8,e=>i("div",{key:e,class:"wave-bar",style:b({animationDelay:.1*(e-1)+"s"})},null,4)),64))])):l("",!0)]),i("div",ye,[i("span",fe,E(A.value),1),a[0]||(a[0]=i("span",{class:"time-unit"},"Áßí",-1))]),i("div",ke,[i("button",{class:"control-button finish-button",onClick:O,onTouchend:O},[c(s(x),{icon:"mdi:send-circle",width:"24",height:"24"})],32),i("button",{class:"control-button cancel-button",onClick:N,onTouchend:N},[c(s(x),{icon:"mdi:close-circle",width:"24",height:"24"})],32)])])])):l("",!0)]),_:1}),s(C).errorMessage?(n(),o("div",we,E(s(C).errorMessage),1)):l("",!0),i("div",be,[i("button",{class:f(["voice-record-button",{disabled:u.disabled,"mobile-device":S.value,recording:s(C).isRecording}]),onMousedown:R,onMouseup:O,onTouchstart:R,onTouchend:O,disabled:u.disabled},[i("div",Ce,[i("span",Se,[c(s(x),{icon:"mdi:microphone",width:"24",height:"24"})]),i("span",_e,E(u.disabled?"ËØ≠Èü≥ËæìÂÖ•":C.isRecording?"ÊùæÂºÄÂèëÈÄÅ":"Êåâ‰ΩèËØ¥ËØù"),1)])],42,Ee)])]))}}),[["__scopeId","data-v-f9f52cfd"]]),Te=["disabled"],De=A(a({__name:"chat-input-send-button",props:{canSend:{type:Boolean,default:!1}},emits:["send"],setup:(e,{emit:a})=>(a,t)=>(n(),o("button",{class:"chat-input-send-button",disabled:!e.canSend,onClick:t[0]||(t[0]=e=>a.$emit("send"))},[c(s(x),{icon:"mdi:send",width:"24",height:"24",class:"send-icon"})],8,Te))}),[["__scopeId","data-v-601990e8"]]),xe={class:"chat-input-emoji-panel"},Ae={class:"emoji-categories"},Me=["onClick"],Be={class:"emoji-grid"},Re=["onClick"],Oe=A(a({__name:"chat-input-emoji-panel",emits:["select-emoji"],setup(e,{emit:a}){const l=t("Ë°®ÊÉÖ"),s=["Ë°®ÊÉÖ","‰∫∫Áâ©","Âä®Áâ©","È£üÁâ©","Ê¥ªÂä®","Á¨¶Âè∑"],c={"Ë°®ÊÉÖ":["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","üòÇ","ü§£","üòä","üòá"],"‰∫∫Áâ©":["üë∂","üëß","üë¶","üë©","üë®","üëµ","üë¥","üëÆ","üë∑","üíÇ"],"Âä®Áâ©":["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ"],"È£üÁâ©":["üçé","üçê","üçä","üçã","üçå","üçâ","üçá","üçì","üçà","üçí"],"Ê¥ªÂä®":["‚öΩ","üèÄ","üèà","‚öæ","üéæ","üèê","üèâ","üé±","üèì","üè∏"],"Á¨¶Âè∑":["‚ù§Ô∏è","üíõ","üíö","üíô","üíú","üñ§","üíî","‚ù£Ô∏è","üíï","üíû"]},r=g(()=>c[l.value]||[]);return(e,a)=>(n(),o("div",xe,[i("div",Ae,[(n(),o(k,null,w(s,e=>i("button",{key:e,class:f(["category-button",{active:l.value===e}]),onClick:a=>l.value=e},E(e),11,Me)),64))]),i("div",Be,[(n(!0),o(k,null,w(r.value,a=>(n(),o("button",{key:a,class:"emoji-item",onClick:t=>e.$emit("select-emoji",a)},E(a),9,Re))),128))])]))}}),[["__scopeId","data-v-14e37487"]]),Ne={class:"chat-input"},Fe={class:"input-area flex flex-row items-center"},Le={class:"input-left"},Pe={class:"input-main"},Ue={class:"input-right"},Ke={class:"bottom-panels"},je={key:0,class:"tool-panel"},$e=A(a({__name:"sdkwork-chat-input",props:{placeholder:{default:"ËæìÂÖ•Ê∂àÊÅØ..."},maxLength:{default:1e3},disabled:{type:Boolean,default:!1},enableVoice:{type:Boolean,default:!0},enableEmoji:{type:Boolean,default:!0},enableFileUpload:{type:Boolean,default:!0},enableCamera:{type:Boolean,default:!0},currentUserId:{},conversationId:{},allowedFileTypes:{default:()=>["image/*","video/*","audio/*",".pdf",".doc",".docx"]},allowMultipleFiles:{type:Boolean,default:!1}},emits:["chat-input-event","send"],setup(e,{emit:a}){const r=e,d=a,u=B(),v=K(),h=L(),y=t(""),k=t(!1),w=t(!1),b=t(!1),E=t(!1),S=t(0),_=t(0),I=t(!1),T=t(0),D=g(()=>y.value.trim().length>0||E.value),A=(e,a,t)=>{const o={type:e,payload:a,timestamp:Date.now(),metadata:t};d("chat-input-event",o)},M=()=>{const e=v.currentConversation,a=h.lastMessage;return{conversation_id:e?.id||r.conversationId||"",user_id:u.currentUser?.id,knowledge_base_id:e?.knowledgeBaseId||"",agent_id:e?.agentId||"",datasource_id:e?.dataSourceId||"",parent_message_id:a?.id,save_audio:!1}},N=e=>{y.value=e,A(H.TEXT_CHANGE,{text:e})},F=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ne()),A(H.KEY_DOWN,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},U=e=>{A(H.KEY_UP,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},j=e=>{A(H.KEY_PRESS,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},$=e=>{A(H.INPUT,{value:y.value,inputType:e.inputType,data:e.data,event:e})},V=e=>{A(H.COMPOSITION_START,{data:e.data,event:e})},z=e=>{A(H.COMPOSITION_UPDATE,{data:e.data,event:e})},G=e=>{A(H.COMPOSITION_END,{data:e.data,event:e})},Y=e=>{const a=e.target,t=a.scrollTop,o=a.scrollHeight,n=a.clientHeight,i=t>(_.value||0)?"down":"up";_.value=t,A(H.SCROLL,{scrollTop:t,scrollHeight:o,clientHeight:n,scrollDirection:i,event:e}),0===t&&A(H.SCROLL_TOP,{scrollTop:t,scrollHeight:o,clientHeight:n,event:e}),t+n>=o-10&&A(H.SCROLL_BOTTOM,{scrollTop:t,scrollHeight:o,clientHeight:n,event:e})},W=e=>{const a=e.clipboardData?.getData("text")||"";A(H.PASTE,{data:a,type:"paste",event:e})},X=e=>{const a=e.clipboardData?.getData("text")||"";A(H.CUT,{data:a,type:"cut",event:e})},q=e=>{const a=e.clipboardData?.getData("text")||"";A(H.COPY,{data:a,type:"copy",event:e})},Q=()=>{const e=document.querySelector(".text-input");e&&A(H.SELECTION_CHANGE,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,selectedText:e.value.substring(e.selectionStart,e.selectionEnd)})},Z=()=>{if("undefined"==typeof window)return;const e=window.innerHeight,a=document.documentElement.clientHeight,t=e<a-100;t!==I.value&&(I.value=t,T.value=Math.max(0,a-e),A(t?H.KEYBOARD_SHOW:H.KEYBOARD_HIDE,{keyboardHeight:T.value,viewportHeight:e,isVisible:t}))},J=()=>{Z()};p(()=>{window.addEventListener("resize",J),Z()}),m(()=>{window.removeEventListener("resize",J)});const ee=()=>{k.value=!k.value,w.value=!1},ae=()=>{b.value=!b.value,k.value=!1,w.value=!1},te=()=>{w.value=!w.value,k.value=!1},oe=e=>{y.value+=e,A(H.TEXT_CHANGE,{text:y.value})},ne=async()=>{if(!D.value)return;const e=y.value.trim();if(e)try{const a={messageType:R.MessageType.TEXT,context:M()},t=P.createTextMessage({content:e},a);d("send",t),A(H.SEND_MESSAGE,{message:{senderId:u.currentUser?.id||"",receiverId:"",content:e,type:R.MessageType.TEXT}}),y.value="",A(H.TEXT_CHANGE,{text:""})}catch(a){}},ie=()=>{E.value=!0,S.value=Date.now()},le=async(e,a)=>{if(E.value){E.value=!1;try{const o={messageType:R.MessageType.AUDIO,context:M()};let n;try{const t=await re(e,"audio/wav");n=P.createAudioMessageByUrl({url:t,duration:a,format:R.AudioFormat.wav},{...o})}catch(t){n=P.createAudioMessage({file:e,duration:a,format:R.AudioFormat.wav},{...o})}d("send",n),A(H.SEND_VOICE,{data:e,duration:a})}catch(o){}}},ce=e=>{},re=async(e,a)=>{if(!window.$uploader)throw new Error("‰∏ä‰º†Âô®Êú™ÂàùÂßãÂåñÔºåËØ∑Á°Æ‰øùwindow.$uploader = createUploader()Â∑≤ÊâßË°å");const{fileToUpload:t,fileName:o,fileSize:n,detectedFormat:i}=await de(e,a),l=ve(a,t.type),s={file:t,name:o,scene:"chat-message",contentType:l,acl:"public-read",metadata:{uploadTime:Date.now().toString(),source:"chat-input",conversationId:r.conversationId||"unknown",originalMimeType:a,detectedFormat:i}};try{return(await window.$uploader.upload(s,e=>{A(H.UPLOAD_PROGRESS,{fileName:o,format:i,progress:e.percentage,loaded:e.loaded,total:e.total,contentType:l})})).url}catch(c){throw new Error(`Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•: ${c instanceof Error?c.message:"Êú™Áü•ÈîôËØØ"}`)}},de=async(e,a)=>{let t,o,n,i="unknown";if(e instanceof File)t=e,o=e.name,n=e.size,i=pe(o)||me(e.type);else if(e instanceof Blob){if(i=O.detectAudioFormat(e)||me(e.type),"pcm"===i||"audio/pcm"===e.type){const a=await O.blobToArrayBuffer(e);t=O.pcmToWav(a,16e3,1,16),i="wav"}else t=e;o=`audio_${Date.now()}.${i}`,n=t.size}else t=new Blob([e],{type:a||"application/octet-stream"}),o=`file_${Date.now()}.dat`,n=t.size,i=me(a)||"binary";return{fileToUpload:t,fileName:o,fileSize:n,detectedFormat:i}},ve=(e,a)=>e&&"application/octet-stream"!==e?e:a&&"application/octet-stream"!==a?a:"application/octet-stream",pe=e=>{const a=e.match(/\.([a-zA-Z0-9]+)$/);return a?a[1].toLowerCase():null},me=e=>{if(!e)return null;return{"audio/wav":"wav","audio/mp3":"mp3","audio/mpeg":"mp3","audio/ogg":"ogg","audio/flac":"flac","image/jpeg":"jpg","image/png":"png","image/gif":"gif","video/mp4":"mp4","application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx"}[e]||null},ge=async e=>{try{const a=await re(e),t={messageType:R.MessageType.FILE,context:M()},o=P.createFileMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(H.SEND_FILE,{file:e,fileType:"file"})}catch(a){}},he=async e=>{try{const a=await re(e),t={messageType:R.MessageType.IMAGE,context:M()},o=P.createImageMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(H.SEND_IMAGE,{file:e,fileType:"image"})}catch(a){}},ye=async e=>{try{const a=await re(e),t={messageType:R.MessageType.VIDEO,context:M()},o=P.createVideoMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(H.SEND_VIDEO,{file:e,fileType:"video"})}catch(a){}};return(a,t)=>(n(),o("div",Ne,[i("div",Fe,[i("div",Le,[e.enableVoice?(n(),o("button",{key:0,class:"tool-button",onClick:ae},[b.value?(n(),C(s(x),{key:0,icon:"mdi:microphone",width:"18",height:"18",class:"voice-active-icon"})):(n(),C(s(x),{key:1,icon:"mdi:microphone-outline",width:"18",height:"18",class:"voice-icon"}))])):l("",!0)]),i("div",Pe,[b.value?(n(),C(Ie,{key:1,onStartRecording:ie,onStopRecording:le})):(n(),C(ue,{key:0,modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),placeholder:e.placeholder,"max-length":e.maxLength,"enable-emoji":e.enableEmoji,onTextChange:N,onKeydown:F,onKeyup:U,onKeypress:j,onFocus:t[1]||(t[1]=()=>A(s(H).INPUT_FOCUS)),onBlur:t[2]||(t[2]=()=>A(s(H).INPUT_BLUR)),onInputEvent:$,onCompositionStart:V,onCompositionUpdate:z,onCompositionEnd:G,onScroll:Y,onPaste:W,onCut:X,onCopy:q,onSelectionChange:Q,onToggleEmojiPanel:te},null,8,["modelValue","placeholder","max-length","enable-emoji"]))]),i("div",Ue,[i("button",{class:f(["tool-button",{active:k.value}]),onClick:ee},[c(s(x),{icon:"mdi:plus",width:"18",height:"18",class:"tool-icon"})],2),b.value?l("",!0):(n(),C(De,{key:0,"can-send":D.value,onSend:ne},null,8,["can-send"]))])]),i("div",Ke,[k.value?(n(),o("div",je,[c(se,{onSelectTool:ce,onSendImage:he,onSendFile:ge,onSendVideo:ye,onSendRtcRequest:t[3]||(t[3]=(e,a)=>A(s(H).SEND_RTC_REQUEST,{type:e,targetUserId:a})),onSendLocation:t[4]||(t[4]=(e,a,t)=>A(s(H).SEND_LOCATION,{latitude:e,longitude:a,address:t}))})])):l("",!0),w.value&&e.enableEmoji?(n(),C(Oe,{key:1,onSelectEmoji:oe})):l("",!0)])]))}}),[["__scopeId","data-v-d6fd7c6c"]]),Ve={class:"sdkwork-chat"},ze={class:"chat-header"},He={class:"chat-body"},Ge={class:"chat-footer"},Ye=A(a({__name:"sdkwork-chat-component-text",props:{currentUser:{},receiver:{},conversationId:{},showBackButton:{type:Boolean,default:!0},interlocutorStatus:{default:"Âú®Á∫ø"},showAvatar:{type:Boolean,default:!1},config:{default:()=>({showTimestamp:!0,showReadStatus:!0,enableRevoke:!0,enableFileUpload:!0,maxFileSize:10,allowedFileTypes:["image/*","video/*","audio/*",".pdf",".doc",".docx"],placeholder:"ËæìÂÖ•Ê∂àÊÅØ...",maxLength:1e3})}},emits:["send-message","upload-file","load-more","message-click","back","refresh"],setup(e,{emit:a}){const l=e,s=a,r=U(),d=L(),u=t(),h=()=>{s("back")},y=()=>{},f=g(()=>d.messages.map(e=>({...e,isOwn:e.senderId===l.currentUser.id}))),k=async e=>{try{await r.sendMessage(e),s("send-message",e)}catch(a){}finally{v(()=>{u.value?.scrollToBottom()})}},w=async e=>{try{return await s("upload-file",e)}catch(a){throw a}},b=async()=>{try{l.conversationId&&(await d.loadMoreMessages({conversationId:l.conversationId,page:1,size:20}),s("load-more"))}catch(e){}},E=e=>{s("message-click",e)},C=e=>{const{type:a,message:t}=e.detail;"MESSAGE_RECEIVED"!==a&&"MESSAGE_STREAM_UPDATE"!==a||v(()=>{u.value?.scrollToBottom()})},_=e=>{v(()=>{u.value?.scrollToBottom()})},I=e=>{v(()=>{u.value?.scrollToBottom()})};return p(()=>{window.addEventListener("sdk:message",C)}),m(()=>{window.removeEventListener("sdk:message",C)}),(a,t)=>{const l=$,s=j,r=$e;return n(),o("div",Ve,[i("div",ze,[S(a.$slots,"header",{},()=>[c(l,{title:e.receiver?.nickname||"ËÅäÂ§©ÂØπË±°","left-arrow":e.showBackButton,onClickLeft:h,onClickRight:y},null,8,["title","left-arrow"])],!0)]),i("div",He,[c(s,{ref_key:"messageListRef",ref:u,messages:f.value,"current-user-id":e.currentUser.id,"current-user":e.currentUser,receiver:e.receiver,"show-avatar":e.showAvatar,"conversation-id":e.conversationId,onLoadMore:b,onMessageClick:E},null,8,["messages","current-user-id","current-user","receiver","show-avatar","conversation-id"])]),i("div",Ge,[c(r,{placeholder:e.config?.placeholder||"ËæìÂÖ•Ê∂àÊÅØ...","max-length":e.config?.maxLength||1e3,"support-file":e.config?.enableFileUpload,"support-image":e.config?.enableFileUpload,"support-voice":!0,onSend:k,onUploadFile:w,onKeydown:_,onFocus:I},null,8,["placeholder","max-length","support-file","support-image"])])])}}}),[["__scopeId","data-v-86a1e55f"]]),We={class:"chat-background"},Xe={class:"background-toggle-top-left"},qe={key:0,class:"background-menu"},Qe={class:"background-options"},Ze=["onClick"],Je={class:"bg-name"},ea=A(a({__name:"voice-chat-background",props:{selectedBackground:{},backgroundOptions:{}},emits:["update:selectedBackground","background-change"],setup(e,{emit:a}){const r=a,d=t(!1),u=()=>{d.value=!d.value};return(a,t)=>(n(),o("div",We,[i("div",Xe,[i("div",{class:f(["background-toggle-btn",{active:d.value}]),onClick:u},[c(s(x),{icon:"mingcute:palette-fill",width:"20",height:"20"})],2)]),d.value?(n(),o("div",qe,[i("div",Qe,[(n(!0),o(k,null,w(e.backgroundOptions,a=>(n(),o("div",{class:f(["background-option",{active:e.selectedBackground===a.id}]),key:a.id,onClick:e=>{return t=a.id,r("update:selectedBackground",t),r("background-change",t),d.value=!1,void N("ËÉåÊôØÂ∑≤Êõ¥Êç¢");var t},style:b({background:a.gradient})},[i("span",Je,E(a.name),1)],14,Ze))),128))])])):l("",!0)]))}}),[["__scopeId","data-v-c9a37ad5"]]),aa={class:"chat-avatar"},ta={class:"caller-info"},oa={class:"caller-avatar"},na={key:0,class:"default-avatar-icon"},ia=["src"],la={key:2,class:"particles-container"},sa={key:3,class:"ai-badge"},ca={class:"caller-name"},ra=A(a({__name:"voice-chat-avatar",props:{callerName:{},callerAvatar:{},isSpeaking:{type:Boolean,default:!1},speakStateText:{default:"Á©∫Èó≤"}},setup(e){const a=e,d=t("mdi:account-circle"),u=t(!1),v=t(a.callerAvatar),g=()=>{u.value=!0},h=()=>{a.callerName.includes("AI")||a.callerName.includes("Âä©Êâã")?d.value="mdi:robot":a.callerName.includes("ÂÆ¢Êúç")?d.value="mdi:headset":a.callerName.includes("ÁÆ°ÁêÜÂëò")?d.value="mdi:shield-account":d.value="mdi:account-circle"},y=t([]),C=t([.3,.5,.7,.9,.7,.5,.3,.1]);let S;const _=()=>{a.isSpeaking?C.value=C.value.map(()=>.6*Math.random()+.4):C.value=C.value.map(e=>Math.max(.1,.8*e))};return p(()=>{S=setInterval(_,200),a.callerAvatar||(u.value=!0),h(),r(()=>a.isSpeaking,e=>{e&&(()=>{y.value=[];for(let e=0;e<12;e++){const a=e/12*Math.PI*2,t=70+30*Math.random(),o=50+Math.cos(a)*t,n=50+Math.sin(a)*t;y.value.push({id:e,style:{left:`${o}%`,top:`${n}%`,animationDelay:.2*e+"s",backgroundColor:`hsl(${360*Math.random()}, 70%, 60%)`}})}})()},{immediate:!0}),r(()=>a.callerName,()=>{h()})}),m(()=>{clearInterval(S)}),(a,t)=>(n(),o("div",aa,[i("div",ta,[i("div",oa,[i("div",{class:f(["avatar-container",{"speaking-active":e.isSpeaking}])},[i("div",{class:f(["tech-halo",{active:e.isSpeaking}])},[...t[0]||(t[0]=[i("div",{class:"halo-ring halo-1"},null,-1),i("div",{class:"halo-ring halo-2"},null,-1),i("div",{class:"halo-ring halo-3"},null,-1)])],2),u.value?(n(),o("div",na,[c(s(x),{icon:d.value,width:"80",height:"80"},null,8,["icon"])])):(n(),o("img",{key:1,src:v.value,alt:"ÂØπÊñπÂ§¥ÂÉè",class:"avatar-image",onError:g},null,40,ia)),e.isSpeaking?(n(),o("div",la,[(n(!0),o(k,null,w(y.value,e=>(n(),o("div",{class:"particle",key:e.id,style:b(e.style)},null,4))),128))])):l("",!0),e.callerName.includes("AI")?(n(),o("div",sa,[...t[1]||(t[1]=[i("span",null,"ü§ñ AI",-1)])])):l("",!0)],2)]),i("div",ca,E(e.callerName),1),i("div",{class:f(["status-text",{active:e.isSpeaking}])},E(e.speakStateText),3)])]))}}),[["__scopeId","data-v-c81cb500"]]),da={class:"voice-call-controls",key:"voice-chat-call-controls"},ua={class:"controls-container"},va={class:"control-button hangup"},pa=A(a({__name:"voice-chat-call-controls",props:{selectedBackground:{default:"default"}},emits:["microphone-toggle","speaker-toggle","camera-toggle","call-end"],setup(e,{emit:a}){const l=e,d=t(!0),u=t(!0),v=t(!0),p=a,m=g(()=>{switch(l.selectedBackground){case"blue":default:return{primary:"#2196F3",secondary:"#03A9F4",accent:"#00BCD4",active:"#0077FF",hover:"#0066CC",hangup:"#FF3B30"};case"purple":return{primary:"#9C27B0",secondary:"#BA68C8",accent:"#E1BEE7",active:"#8E24AA",hover:"#7B1FA2",hangup:"#FF3B30"};case"green":return{primary:"#4CAF50",secondary:"#66BB6A",accent:"#81C784",active:"#43A047",hover:"#388E3C",hangup:"#FF3B30"};case"orange":return{primary:"#FF9800",secondary:"#FFB74D",accent:"#FFCC80",active:"#FB8C00",hover:"#F57C00",hangup:"#FF3B30"}}}),h=e=>{const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?`${parseInt(a[1],16)}, ${parseInt(a[2],16)}, ${parseInt(a[3],16)}`:"33, 150, 243"};r(()=>l.selectedBackground,()=>{const e=m.value,a=document.documentElement;a.style.setProperty("--primary",e.primary),a.style.setProperty("--secondary",e.secondary),a.style.setProperty("--accent",e.accent),a.style.setProperty("--active",e.active),a.style.setProperty("--hover",e.hover),a.style.setProperty("--hangup",e.hangup);const t=h(e.primary),o=h(e.secondary),n=h(e.accent),i=h(e.active);a.style.setProperty("--primary-rgb",t),a.style.setProperty("--secondary-rgb",o),a.style.setProperty("--accent-rgb",n),a.style.setProperty("--active-rgb",i)},{immediate:!0});const y=()=>{d.value=!d.value,p("microphone-toggle",d.value)},k=()=>{u.value=!u.value,p("speaker-toggle",u.value)},w=()=>{v.value=!v.value,p("camera-toggle",v.value)},b=()=>{p("call-end")};return(e,a)=>(n(),o("div",da,[i("div",ua,[i("div",{class:"control-item",onClick:y},[i("div",{class:f(["control-button",{active:d.value}])},[c(s(x),{icon:d.value?"mingcute:mic-fill":"mingcute:mic-off-fill",class:"control-icon"},null,8,["icon"])],2)]),i("div",{class:"control-item",onClick:k},[i("div",{class:f(["control-button",{active:u.value}])},[c(s(x),{icon:u.value?"mingcute:volume-fill":"mingcute:volume-off-fill",class:"control-icon"},null,8,["icon"])],2)]),i("div",{class:"control-item",onClick:w},[i("div",{class:f(["control-button",{active:v.value}])},[c(s(x),{icon:v.value?"mingcute:camera-2-ai-fill":"mingcute:camera-2-off-line",class:"control-icon"},null,8,["icon"])],2)]),i("div",{class:"control-item",onClick:b},[i("div",va,[c(s(x),{icon:"mingcute:close-line",class:"control-icon"})])])])]))}}),[["__scopeId","data-v-f9ad0c65"]]),ma={class:"voice-call-container"},ga={class:"top-time-display"},ha={class:"call-duration"},ya={class:"subtitles-toggle-top-right"},fa={key:1,class:"dev-text-input-container"},ka={class:"dev-input-wrapper"},wa=["disabled"],ba={class:"dev-input-stats"},Ea={key:0},Ca=A(a({__name:"sdkwork-chat-component-voice",props:{conversationId:{},enableWave:{type:Boolean,default:!0}},emits:["mode-change"],setup(e,{emit:a}){const r=a,v=e,h=t("connecting"),y=t(!0),k=t(!0),w=t(!1),S=g(()=>"SPEAKING"===Q.value),T=t(null),D=t("00:00"),A=t(null),B=g(()=>v.enableWave??!0);let R,O;const F=t(!1),L=t(),P=t([{speaker:"AIÂä©Êâã",text:"ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÊâãÔºåÂæàÈ´òÂÖ¥‰∏∫ÊÇ®ÊúçÂä°„ÄÇ",time:"10:00"},{speaker:"Áî®Êà∑",text:"‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∫õÂÖ≥‰∫é‰∫ßÂìÅÁöÑÈóÆÈ¢ò„ÄÇ",time:"10:02"},{speaker:"AIÂä©Êâã",text:"ÂΩìÁÑ∂ÂèØ‰ª•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÔºü",time:"10:03"},{speaker:"Áî®Êà∑",text:"Ëøô‰∏™‰∫ßÂìÅÁöÑÂäüËÉΩÊúâÂì™‰∫õÁâπÁÇπÔºü",time:"10:05"},{speaker:"AIÂä©Êâã",text:"Êàë‰ª¨ÁöÑ‰∫ßÂìÅÂÖ∑ÊúâÊô∫ËÉΩÂØπËØù„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÂ§öËØ≠Ë®ÄÊîØÊåÅÁ≠âÂÖàËøõÂäüËÉΩ„ÄÇ",time:"10:06"}]);t(""),t(0);const K=t(0),j=t("AIÂä©Êâã"),$=t(""),H=t(!1),G=t(""),Y=t(0),W=t(""),X=t("default"),q=t([{id:"default",name:"ÈªòËÆ§",gradient:"linear-gradient(135deg, #007AFF 0%, #0056CC 100%)"},{id:"ocean",name:"Êµ∑Ê¥ã",gradient:"linear-gradient(135deg, #00B4DB 0%, #0083B0 100%)"},{id:"sunset",name:"Êó•ËêΩ",gradient:"linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%)"},{id:"forest",name:"Ê£ÆÊûó",gradient:"linear-gradient(135deg, #00D2FF 0%, #3A7BD5 100%)"},{id:"purple",name:"Á¥´Ëâ≤",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"green",name:"ÁªøËâ≤",gradient:"linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%)"}]),Q=g(()=>ae.speakState),Z=g(()=>{const e=q.value.find(e=>e.id===X.value);return{background:e?.gradient||"linear-gradient(135deg, #007AFF 0%, #0056CC 100%)"}}),J=g(()=>{switch(h.value){case"connecting":return"ËøûÊé•‰∏≠...";case"connected":return"ÈÄöËØù‰∏≠";case"ended":return"ÈÄöËØùÁªìÊùü";default:return"Êú™Áü•Áä∂ÊÄÅ"}}),ee=g(()=>{switch(Q.value){case"SPEAKING":return"ËØ¥ËØù‰∏≠";case"LISTENING":return"ËÅÜÂê¨‰∏≠";case"IDLE":return"Á©∫Èó≤";default:return"Êú™Áü•Áä∂ÊÄÅ"}}),ae=U(),te=e=>{ae.setSpeakState(e)},oe=M(),ne=()=>{F.value=!F.value,N(F.value?"Â≠óÂπïÂ∑≤ÂºÄÂêØ":"Â≠óÂπïÂ∑≤ÂÖ≥Èó≠"),F.value&&ie()},ie=()=>{K.value=Date.now(),L.value&&L.value.clearDynamicSubtitles(),L.value&&L.value.startPlayback()},le=(e,a)=>{if(!F.value||!L.value)return;const t=Date.now()-K.value,o=t+5e3,n=`${a}Ôºö${e}`;L.value.addDynamicSubtitle(n,t,o,!0)},se=(e,a)=>{},ce=async e=>{if(y.value=e,e)try{te("LISTENING"),await oe.startRecording({realtime:!0,waveContainer:A.value}),ae.startVoiceListening(),N("È∫¶ÂÖãÈ£éÂ∑≤ÂºÄÂêØ")}catch(a){N("ÂºÄÂêØÈ∫¶ÂÖãÈ£éÂ§±Ë¥•")}else try{await oe.pauseRecording(),ae.stopVoiceListening(),te("IDLE"),N("È∫¶ÂÖãÈ£éÂ∑≤ÈùôÈü≥")}catch(a){N("ÂÖ≥Èó≠È∫¶ÂÖãÈ£éÂ§±Ë¥•")}},re=e=>{k.value=e,N(e?"Êâ¨Â£∞Âô®Â∑≤ÂºÄÂêØ":"Êâ¨Â£∞Âô®Â∑≤ÈùôÈü≥")},de=e=>{w.value=e,N(e?"ÊëÑÂÉèÂ§¥Â∑≤ÂºÄÂêØ":"ÊëÑÂÉèÂ§¥Â∑≤ÂÖ≥Èó≠")},ue=()=>{h.value="ended",te("IDLE"),N("ÈÄöËØùÂ∑≤ÁªìÊùü"),setTimeout(()=>{r("mode-change","text")},1e3)},ve=e=>{X.value=e,N("ËÉåÊôØÂ∑≤Êõ¥Êç¢")},pe=e=>{},me=async()=>{if(G.value.trim())try{await ae.sendText(G.value),Y.value++,W.value=G.value.substring(0,20)+(G.value.length>20?"...":""),G.value="",N("ÊñáÊú¨Ê∂àÊÅØÂèëÈÄÅÊàêÂäü"),F.value&&le(G.value,"Áî®Êà∑")}catch(e){N("ÂèëÈÄÅÊñáÊú¨Ê∂àÊÅØÂ§±Ë¥•")}},ge=()=>{if(T.value&&"connected"===h.value){const e=new Date,a=Math.floor((e.getTime()-T.value.getTime())/1e3),t=Math.floor(a/60).toString().padStart(2,"0"),o=(a%60).toString().padStart(2,"0");D.value=`${t}:${o}`}};return p(async()=>{(()=>{const e=e=>{if(!e.detail)return;const{type:a,message:t,chunk:o}=e.detail;switch(a){case"MESSAGE_RECEIVED":"assistant"===t.role?(P.value.push({speaker:"AIÂä©Êâã",text:t.content,time:(new Date).toLocaleTimeString("zh-CN",{hour12:!1})}),F.value&&t.content&&le(t.content,"AIÂä©Êâã")):"user"===t.role&&F.value&&t.content&&le(t.content,"Áî®Êà∑");break;case"MESSAGE_STREAM_UPDATE":o&&o.choices&&o.choices[0]&&o.choices[0].delta&&o.choices[0].delta.content}},a=e=>{e.detail&&"AUDIO_STREAM_RECEIVED"===e.detail.type&&te("SPEAKING")};window.addEventListener("sdk:message",e),window.addEventListener("sdk:audioStream",a)})();try{ae.isInitialized||(await ae.initialize(),N("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÊàêÂäü")),await ae.enterVoiceRoom({enableWave:v.enableWave??!0,waveContainer:A.value,sampleRate:16e3,format:"pcm",realtime:!0,hello:{send:!0}}),N("ËØ≠Èü≥ÊàøÈó¥Â∑≤Âª∫Á´ã")}catch(e){N("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊ®°Âºè")}setTimeout(()=>{h.value="connected",T.value=new Date,N("ÈÄöËØùÂ∑≤ËøûÊé•")},2e3),R=setInterval(ge,1e3),O=setInterval(()=>{const e=Math.random();if(e>.7){if(te("SPEAKING"),F.value){const e=["ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÊâãÔºåÂæàÈ´òÂÖ¥‰∏∫ÊÇ®ÊúçÂä°„ÄÇ","ÂΩìÁÑ∂ÂèØ‰ª•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÔºü","Êàë‰ª¨ÁöÑ‰∫ßÂìÅÂÖ∑ÊúâÊô∫ËÉΩÂØπËØù„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÂ§öËØ≠Ë®ÄÊîØÊåÅÁ≠âÂÖàËøõÂäüËÉΩ„ÄÇ","ÊÇ®ËøòÊúâÂÖ∂‰ªñÈóÆÈ¢òÈúÄË¶ÅÂí®ËØ¢ÂêóÔºü","ÊÑüË∞¢ÊÇ®ÁöÑ‰ΩøÁî®ÔºåÁ•ùÊÇ®ÁîüÊ¥ªÊÑâÂø´ÔºÅ"],a=e[Math.floor(Math.random()*e.length)];le(a,"AIÂä©Êâã")}}else if(e>.4){if(te("LISTENING"),F.value){const e=["‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∫õÂÖ≥‰∫é‰∫ßÂìÅÁöÑÈóÆÈ¢ò„ÄÇ","Ëøô‰∏™‰∫ßÂìÅÁöÑÂäüËÉΩÊúâÂì™‰∫õÁâπÁÇπÔºü","‰ª∑Ê†ºÊòØÂ§öÂ∞ëÔºü","Â¶Ç‰Ωï‰ΩøÁî®Ëøô‰∏™‰∫ßÂìÅÔºü","Ë∞¢Ë∞¢‰Ω†ÁöÑËß£Á≠îÔºÅ"],a=e[Math.floor(Math.random()*e.length)];le(a,"Áî®Êà∑")}}else te("IDLE")},5e3)}),m(async()=>{R&&(clearInterval(R),R=void 0),O&&(clearInterval(O),O=void 0);try{await ae.exitVoiceRoom()}catch(e){}oe.destroyRecorder()}),(e,a)=>(n(),o("div",{class:"chat-voice-mode",style:b(Z.value)},[i("div",ma,[i("div",ga,[i("div",ha,E(D.value),1),i("div",{class:f(["call-status",h.value])},E(J.value),3)]),c(ea,{"selected-background":X.value,"background-options":q.value,"onUpdate:selectedBackground":ve,onBackgroundChange:pe},null,8,["selected-background","background-options"]),i("div",ya,[i("div",{class:f(["subtitles-toggle-btn",{active:F.value}]),onClick:ne},[c(s(x),{icon:F.value?"mingcute:subtitle-fill":"mingcute:subtitle-line",width:"20",height:"20"},null,8,["icon"])],2)]),c(ra,{"caller-name":j.value,"caller-avatar":$.value,"is-speaking":S.value,"speak-state-text":ee.value},null,8,["caller-name","caller-avatar","is-speaking","speak-state-text"]),d(i("div",{ref_key:"waveContainerRef",ref:A,class:"wave-container"},null,512),[[_,B.value]]),F.value?(n(),C(V,{key:0,ref_key:"subtitlesRef",ref:L,"display-mode":s(z).LINE,"line-count":5,"show-controls":!1,position:"center","font-size":14,"font-color":"#ffffff","background-color":"rgba(0, 0, 0, 0.6)","show-background":!0,"auto-scroll":!0,onEntryChange:se},null,8,["display-mode"])):l("",!0),c(pa,{onMicrophoneToggle:ce,onSpeakerToggle:re,onCameraToggle:de,onCallEnd:ue}),H.value?(n(),o("div",fa,[a[1]||(a[1]=i("div",{class:"dev-input-header"},[i("span",{class:"dev-input-title"},"ÊµãËØïÊñáÊú¨ËæìÂÖ•"),i("span",{class:"dev-input-hint"},"ÔºàÂºÄÂèëÁéØÂ¢É‰∏ìÁî®Ôºâ")],-1)),i("div",ka,[d(i("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),type:"text",placeholder:"ËæìÂÖ•ÊµãËØïÊñáÊú¨Ê∂àÊÅØ...",class:"dev-text-input",onKeyup:I(me,["enter"])},null,544),[[u,G.value]]),i("button",{onClick:me,class:"dev-send-btn",disabled:!G.value.trim()}," ÂèëÈÄÅ ",8,wa)]),i("div",ba,[i("span",null,"Â∑≤ÂèëÈÄÅ: "+E(Y.value)+" Êù°",1),W.value?(n(),o("span",Ea,"ÊúÄÂêé: "+E(W.value),1)):l("",!0)])])):l("",!0)])],4))}}),[["__scopeId","data-v-ae5f1a52"]]),Sa={class:"mode-switch"},_a={class:"mode-switch",style:{"margin-left":"10px"}},Ia=A(a({__name:"sdkwork-chat-component",props:{conversationId:{},defaultMode:{default:"text"}},emits:["mode-change","back"],setup(a,{emit:t}){const o=a,d=t,u=T(),v=D(),h=U(),f=B(),k=K(),w=g(()=>h.currentChatMode),b=g(()=>{if(o.conversationId)return o.conversationId;const e=u.params.id;return Array.isArray(e)?e[0]:e||""}),E=()=>{if(o.defaultMode)return o.defaultMode;return"voice"===u.query.mode?"voice":"text"},S=g(()=>f.currentUser||{id:"user1",name:"ÂΩìÂâçÁî®Êà∑",avatar:"https://via.placeholder.com/40",online:!0}),_=g(()=>k.currentConversation),I=g(()=>"voice"===w.value?"ËØ≠Èü≥ÈÄöËØù":_.value?.title||"ÂØπËØùËØ¶ÊÉÖ"),A=async()=>{try{await h.switchChatMode("voice"),N("ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°Âºè")}catch(e){N("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•")}},M=()=>{d("back")},R=()=>{v.push(`/chat/profile/${_.value?.agentId||0}`)},O=async e=>{try{await h.switchChatMode(e),d("mode-change",e)}catch(a){N("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•")}};return r(b,async e=>{if(e)try{await k.switchConversation(e)}catch(a){N("Âä†ËΩΩ‰ºöËØùÊï∞ÊçÆÂ§±Ë¥•")}},{immediate:!0}),p(async()=>{if(!k.isInitialized)try{await k.initialize()}catch(e){}try{await h.initialize();const e=E();await h.enterChat({mode:e})}catch(e){}"voice"===E()&&N("Â∑≤ËøõÂÖ•ËØ≠Èü≥ÈÄöËØùÊ®°Âºè")}),m(async()=>{try{await h.exitChat()}catch(e){}}),(a,t)=>{const o=e;return n(),C(o,null,{default:y(()=>["voice"===w.value?(n(),C(Ca,{key:0,"conversation-id":b.value,onModeChange:O},null,8,["conversation-id"])):(n(),C(Ye,{key:1,"conversation-id":b.value,"current-user":S.value,onModeChange:O},{header:y(()=>["text"===w.value?(n(),C(F,{key:0,title:I.value,"show-back":!0,"custom-right":!0,onLeftClick:M},{right:y(()=>[i("div",Sa,[c(s(x),{icon:"mingcute:phone-fill",width:"20",height:"20",class:"mode-switch-icon",onClick:A,title:"ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°Âºè"})]),i("div",_a,[c(s(x),{icon:"mingcute:more-1-fill",width:"16",height:"16",onClick:R})])]),_:1},8,["title"])):l("",!0)]),_:1},8,["conversation-id","current-user"]))]),_:1})}}}),[["__scopeId","data-v-06e91933"]]);export{Ia as S};
