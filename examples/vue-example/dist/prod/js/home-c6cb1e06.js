import{I as e,_ as t,L as s}from"./index-2cafbb5e.js";import{E as o}from"./index-17b6a864.js";import{k as a,c as i,Q as r,R as n,S as l,j as d,a0 as c,U as m,a4 as p,$ as v,Z as u,X as g,r as h,W as f,O as k,a as b}from"./vue-vendor-fce65f55.js";import{u as y}from"./conversation-0c5ab619.js";import{S as w}from"./sdkwork-api-list-be20b211.js";/* empty css              */import{I as S}from"./index-a5403cf2.js";import{S as _}from"./sdkwork-page-container-390f5fca.js";import{b as j}from"./route-block-83d24a4e.js";import"./utils-vendor-b5712723.js";import"./use-id-bc367f23.js";import"./index-ead435a5.js";import"./index-6e9c758b.js";import"./use-tab-status-2f29a6cd.js";import"./shared-9d0b1b96.js";import"./sdkwork-search-bar-a4feada5.js";import"./sdkwork-icon-105dbc30.js";import"./ListItem-b5deca21.js";/* empty css              */const C={class:"sdkwork-conversation-list-item__avatar"},z={class:"avatar-placeholder"},x={key:0,class:"online-indicator"},B={class:"sdkwork-conversation-list-item__content"},I={class:"conversation-header"},M={class:"conversation-title"},L={class:"conversation-time"},N={class:"conversation-preview"},D={class:"last-message"},T={key:0,class:"message-content"},$={key:1,class:"no-message"},E={key:0,class:"unread-badge"},F=t(a({__name:"sdkwork-conversation-list-item",props:{conversation:{},disabled:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},showBorderBottom:{type:Boolean,default:!0},themeMode:{default:"auto"}},emits:["click","select"],setup(t,{expose:s,emit:o}){const a=t,h=o,f=i(()=>"dark"===a.themeMode||"light"!==a.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),k=i(()=>f.value?"sdkwork-conversation-list-item--dark":"sdkwork-conversation-list-item--light"),b=()=>{a.disabled||h("click",a.conversation)},y=e=>{const t=window.$date.parse(e),s=(new Date).getTime()-t.getTime(),o=Math.floor(s/864e5);return 0===o?t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):1===o?"昨天":o<7?`${o}天前`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},w=e=>e.length<=30?e:e.substring(0,30)+"...";return s({getTitle:()=>a.conversation.title,getUnreadCount:()=>a.conversation.unreadCount||0,isPinned:()=>a.conversation.pinned,formatTime:y,truncateMessage:w}),(s,o)=>{const a=e,i=S;return r(),n("div",{class:g(["sdkwork-conversation-list-item",[{"sdkwork-conversation-list-item--selected":t.isSelected,"sdkwork-conversation-list-item--pinned":t.conversation.pinned,"sdkwork-conversation-list-item--unread":(t.conversation.unreadCount||0)>0,"sdkwork-conversation-list-item--disabled":t.disabled,"sdkwork-conversation-list-item--border-bottom":t.showBorderBottom},k.value]]),onClick:b},[l("div",C,[d(i,{src:t.conversation.avatar,width:"44",height:"44",radius:"4",fit:"cover"},{error:c(()=>[l("div",z,[d(a,{name:"chat-o",size:"18"})])]),_:1},8,["src"]),t.conversation.online?(r(),n("div",x)):m("",!0)]),l("div",B,[l("div",I,[l("div",M,[p(v(t.conversation.title)+" ",1),t.conversation.pinned?(r(),u(a,{key:0,name:"pin",class:"pin-icon"})):m("",!0)]),l("div",L,v(y(t.conversation.updatedAt||t.conversation.createdAt||"")),1)]),l("div",N,[l("div",D,[t.conversation.lastMessageId?(r(),n("span",T,v(w(t.conversation.lastMessageId?.toString()||"")),1)):(r(),n("span",$,"暂无消息"))]),(t.conversation.unreadCount||0)>0?(r(),n("div",E,v((t.conversation.unreadCount||0)>99?"99+":t.conversation.unreadCount),1)):m("",!0)])])],2)}}}),[["__scopeId","data-v-0b6b8730"]]),O={class:"sdkwork-conversation-list"},P=t(a({__name:"sdkwork-conversation-list",props:{api:{},params:{default:()=>({})},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1},pageSize:{default:10},itemKey:{default:"id"},itemTitleField:{default:"title"},itemDescriptionField:{default:"description"}},emits:["select","delete","archive","pin","mute","search","load","click","context-menu"],setup(e,{expose:t,emit:a}){const m=e,v=a,u=h(),g=i(()=>({pageNumber:0,pageSize:m.pageSize,filters:m.params})),k=e=>{v("select",e)},b=e=>{v("delete",e)},y=e=>{v("search",e)},S=e=>{v("load",e)},_=e=>{v("select",e)},j=e=>{v("click",e)};return t({refresh:()=>u.value?.refresh(),loadMore:()=>u.value?.loadMore(),getData:()=>u.value?.getData()||[],getSelectedItems:()=>u.value?.getSelectedItems()||[],clearSelected:()=>u.value?.clearSelected(),setSelectedItems:e=>u.value?.setSelectedItems(e)}),(t,a)=>{const i=o,m=s;return r(),n("div",O,[d(w,{api:e.api,params:g.value,selectable:e.selectable,deletable:e.deletable,searchable:e.searchable,"page-size":e.pageSize,"item-key":e.itemKey,"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,"left-spacing":0,"right-spacing":0,onSelect:k,onDelete:b,onSearch:y,onLoad:S,ref_key:"apiListRef",ref:u,showBorderBottom:"",borderBottomLeftOffset:60},{default:c(({item:e,index:t,selected:s})=>[d(F,{conversation:e,"is-selected":s,"show-border-bottom":!0,onClick:j,onSelect:_},null,8,["conversation","is-selected"])]),empty:c(()=>[f(t.$slots,"empty",{},()=>[d(i,{description:"暂无聊天会话",image:"search"},{description:c(()=>[...a[0]||(a[0]=[l("div",{class:"empty-description"},[l("p",null,"暂时没有聊天会话"),l("p",{class:"empty-tip"},"您可以开始新的对话或调整搜索条件")],-1)])]),_:1})],!0)]),loading:c(()=>[f(t.$slots,"loading",{},()=>[d(m,{size:"24px",vertical:""},{default:c(()=>[...a[1]||(a[1]=[p("加载会话数据...",-1)])]),_:1})],!0)]),header:c(()=>[f(t.$slots,"header",{},void 0,!0)]),footer:c(()=>[f(t.$slots,"footer",{},void 0,!0)]),_:3},8,["api","params","selectable","deletable","searchable","page-size","item-key","item-title-field","item-description-field"])])}}}),[["__scopeId","data-v-bb158ad7"]]),R=a({__name:"home",setup(e){const t=k(),a=y(),i=h(),n=b({status:void 0,keyword:"",agentId:"",pinned:void 0,muted:void 0}),m=async e=>{try{return console.log("getConversationList:",e),await a.loadMoreConversations(e.pageNumber||0,e.pageSize||10),{content:a.sortedConversations,empty:0===a.sortedConversations.length,first:0===(e.pageNumber||0),last:a.sortedConversations.length<(e.pageSize||10),pageNumber:e.pageNumber||0,numberOfElements:a.sortedConversations.length,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:a.sortedConversations.length,totalPages:Math.ceil(a.sortedConversations.length/(e.pageSize||10))}}catch(t){return console.error("获取会话列表失败:",t),{content:[],empty:!0,first:!0,last:!0,pageNumber:e.pageNumber||0,numberOfElements:0,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:0,totalPages:0}}},v=async e=>{try{console.log("选择会话:",e),await a.switchConversation(e.id);const s=e.uuid||e.id;t.push(`/chat/${s}`)}catch(s){console.error("选择会话失败:",s)}},g=async e=>{try{console.log("删除会话:",e),await a.deleteConversation(e.id),console.log("会话删除成功")}catch(t){console.error("删除会话失败:",t)}},f=e=>{console.log("搜索会话:",e)},w=e=>{console.log("会话数据加载完成:",e)};return(e,t)=>{const a=o,h=s;return r(),u(_,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:c(()=>[d(P,{api:m,params:n,selectable:!1,deletable:!1,searchable:!1,"pageNumber-size":10,onSelect:v,onDelete:g,onSearch:f,onLoad:w,ref_key:"conversationListRef",ref:i},{empty:c(()=>[d(a,{description:"暂无聊天会话",image:"search"},{description:c(()=>[...t[0]||(t[0]=[l("div",{class:"empty-description"},[l("p",null,"暂时没有聊天会话"),l("p",{class:"empty-tip"},"您可以开始新的对话")],-1)])]),_:1})]),loading:c(()=>[d(h,{size:"24px",vertical:""},{default:c(()=>[...t[1]||(t[1]=[p("加载会话数据...",-1)])]),_:1})]),_:1},8,["params"])]),_:1})}}});"function"==typeof j&&j(R);const U=t(R,[["__scopeId","data-v-13ba55e5"]]);export{U as default};
