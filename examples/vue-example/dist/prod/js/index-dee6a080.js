import{a6 as e,a7 as t,F as a,a8 as l,a9 as r,k as n,n as o,o as i,p as s,K as u,a5 as c,N as d,l as g,H as m,aa as f,Z as p,ab as v,U as h,ac as b,ad as y,V as x,$ as k,I as w,ae as S,w as V}from"./index-5affcab4.js";import{c as C,C as M}from"./index-44056be1.js";import{u as I}from"./use-id-82312033.js";import{k as B,a as A,r as E,c as z,p as j,w as P,n as T,b as W,j as $,q as L,a4 as q}from"./vue-vendor-a2672387.js";function F(e){return Array.isArray(e)?!e.length:0!==e&&!e}function H(e,t){const{message:a}=t;return r(a)?a(e,t):a||""}function N({target:e}){e.composing=!0}function R({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function D(e){return[...e].length}function K(e,t){return[...e].slice(0,t).join("")}const[O,U]=n("field"),Z={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:o,max:Number,min:Number,formatter:Function,clearIcon:i("clear"),modelValue:s(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:i("focus"),formatTrigger:i("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String};const G=V(B({name:O,props:u({},C,Z,{rows:o,type:i("text"),rules:Array,autosize:[Boolean,Object],labelWidth:o,labelClass:c,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(r,{emit:n,slots:o}){const i=I(),s=A({status:"unvalidated",focused:!1,validateMessage:""}),u=E(),c=E(),V=E(),{parent:C}=d(v),B=()=>{var e;return String(null!=(e=r.modelValue)?e:"")},O=e=>h(r[e])?r[e]:C&&h(C.props[e])?C.props[e]:void 0,Z=z(()=>{const e=O("readonly");if(r.clearable&&!e){const e=""!==B(),t="always"===r.clearTrigger||"focus"===r.clearTrigger&&s.focused;return e&&t}return!1}),G=z(()=>V.value&&o.input?V.value():r.modelValue),J=z(()=>{var e;const t=O("required");return"auto"===t?null==(e=r.rules)?void 0:e.some(e=>e.required):t}),Q=e=>e.reduce((e,t)=>e.then(()=>{if("failed"===s.status)return;let{value:e}=G;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(F(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return s.status="failed",void(s.validateMessage=H(e,t));if(t.validator){if(F(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise(a=>{const r=t.validator(e,t);l(r)?r.then(a):a(r)})}(e,t).then(a=>{a&&"string"==typeof a?(s.status="failed",s.validateMessage=a):!1===a&&(s.status="failed",s.validateMessage=H(e,t))})}}),Promise.resolve()),X=()=>{s.status="unvalidated",s.validateMessage=""},Y=()=>n("endValidate",{status:s.status,message:s.validateMessage}),_=(e=r.rules)=>new Promise(t=>{X(),e?(n("startValidate"),Q(e).then(()=>{"failed"===s.status?(t({name:r.name,message:s.validateMessage}),Y()):(s.status="passed",t(),Y())})):t()}),ee=e=>{if(C&&r.rules){const{validateTrigger:t}=C.props,a=b(t).includes(e),l=r.rules.filter(t=>t.trigger?b(t.trigger).includes(e):a);l.length&&_(l)}},te=(e,t="onChange")=>{var a,l;const o=e;e=(e=>{var t;const{maxlength:a}=r;if(h(a)&&D(e)>+a){const l=B();if(l&&D(l)===+a)return l;const r=null==(t=u.value)?void 0:t.selectionEnd;if(s.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return K(e,+a)}return e})(e);const i=D(o)-D(e);if("number"===r.type||"digit"===r.type){const n="number"===r.type;if(e=y(e,n,n),"onBlur"===t&&""!==e&&(void 0!==r.min||void 0!==r.max)){const t=x(+e,null!=(a=r.min)?a:-1/0,null!=(l=r.max)?l:1/0);+e!==t&&(e=t.toString())}}let c=0;if(r.formatter&&t===r.formatTrigger){const{formatter:t,maxlength:a}=r;if(e=t(e),h(a)&&D(e)>+a&&(e=K(e,+a)),u.value&&s.focused){const{selectionEnd:e}=u.value,a=K(o,e);c=D(t(a))-D(a)}}if(u.value&&u.value.value!==e)if(s.focused){let{selectionStart:t,selectionEnd:a}=u.value;if(u.value.value=e,h(t)&&h(a)){const l=D(e);i?(t-=i,a-=i):c&&(t+=c,a+=c),u.value.setSelectionRange(Math.min(t,l),Math.min(a,l))}}else u.value.value=e;e!==r.modelValue&&n("update:modelValue",e)},ae=e=>{e.target.composing||te(e.target.value)},le=()=>{var e;return null==(e=u.value)?void 0:e.blur()},re=()=>{var e;return null==(e=u.value)?void 0:e.focus()},ne=()=>{const l=u.value;"textarea"===r.type&&r.autosize&&l&&function(l,r){const n=e();l.style.height="auto";let o=l.scrollHeight;if(a(r)){const{maxHeight:e,minHeight:t}=r;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(l.style.height=`${o}px`,t(n))}(l,r.autosize)},oe=e=>{s.focused=!0,n("focus",e),T(ne),O("readonly")&&le()},ie=e=>{s.focused=!1,te(B(),"onBlur"),n("blur",e),O("readonly")||(ee("onBlur"),T(ne),S())},se=e=>n("clickInput",e),ue=e=>n("clickLeftIcon",e),ce=e=>n("clickRightIcon",e),de=z(()=>"boolean"==typeof r.error?r.error:!(!C||!C.props.showError||"failed"!==s.status)||void 0),ge=z(()=>{const e=O("labelWidth"),t=O("labelAlign");if(e&&"top"!==t)return{width:g(e)}}),me=e=>{if(13===e.keyCode){C&&C.props.submitOnEnter||"textarea"===r.type||k(e),"search"===r.type&&le()}n("keypress",e)},fe=()=>r.id||`${i}-input`,pe=()=>{const e=U("control",[O("inputAlign"),{error:de.value,custom:!!o.input,"min-height":"textarea"===r.type&&!r.autosize}]);if(o.input)return $("div",{class:e,onClick:se},[o.input()]);const t={id:fe(),ref:u,name:r.name,rows:void 0!==r.rows?+r.rows:void 0,class:e,disabled:O("disabled"),readonly:O("readonly"),autofocus:r.autofocus,placeholder:r.placeholder,autocomplete:r.autocomplete,autocapitalize:r.autocapitalize,autocorrect:r.autocorrect,enterkeyhint:r.enterkeyhint,spellcheck:r.spellcheck,"aria-labelledby":r.label?`${i}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:ie,onFocus:oe,onInput:ae,onClick:se,onChange:R,onKeypress:me,onCompositionend:R,onCompositionstart:N};return"textarea"===r.type?$("textarea",L(t,{inputmode:r.inputmode}),null):$("input",L((a=r.type,l=r.inputmode,"number"===a&&(a="text",null!=l||(l="decimal")),"digit"===a&&(a="tel",null!=l||(l="numeric")),{type:a,inputmode:l}),t),null);var a,l},ve=()=>{const e=o["right-icon"];if(r.rightIcon||e)return $("div",{class:U("right-icon"),onClick:ce},[e?e():$(w,{name:r.rightIcon,classPrefix:r.iconPrefix},null)])},he=()=>{if(r.showWordLimit&&r.maxlength){const e=D(B());return $("div",{class:U("word-limit")},[$("span",{class:U("word-num")},[e]),q("/"),r.maxlength])}},be=()=>{if(C&&!1===C.props.showErrorMessage)return;const e=r.errorMessage||s.validateMessage;if(e){const t=o["error-message"],a=O("errorMessageAlign");return $("div",{class:U("error-message",a)},[t?t({message:e}):e])}},ye=()=>[$("div",{class:U("body")},[pe(),Z.value&&$(w,{ref:c,name:r.clearIcon,class:U("clear")},null),ve(),o.button&&$("div",{class:U("button")},[o.button()])]),he(),be()];return m({blur:le,focus:re,validate:_,formValue:G,resetValidation:X,getValidationStatus:()=>s.status}),j(f,{customValue:V,resetValidation:X,validateWithTrigger:ee}),P(()=>r.modelValue,()=>{te(B()),X(),ee("onChange"),T(ne)}),W(()=>{te(B(),r.formatTrigger),T(ne)}),p("touchstart",e=>{k(e),n("update:modelValue",""),n("clear",e)},{target:z(()=>{var e;return null==(e=c.value)?void 0:e.$el})}),()=>{const e=O("disabled"),t=O("labelAlign"),a=(()=>{const e=o["left-icon"];if(r.leftIcon||e)return $("div",{class:U("left-icon"),onClick:ue},[e?e():$(w,{name:r.leftIcon,classPrefix:r.iconPrefix},null)])})();return $(M,{size:r.size,class:U({error:de.value,disabled:e,[`label-${t}`]:t}),center:r.center,border:r.border,isLink:r.isLink,clickable:r.clickable,titleStyle:ge.value,valueClass:U("value"),titleClass:[U("label",[t,{required:J.value}]),r.labelClass],arrowDirection:r.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=O("labelWidth"),t=O("labelAlign"),a=O("colon")?":":"";return o.label?[o.label(),a]:r.label?$("label",{id:`${i}-label`,for:o.input?void 0:fe(),"data-allow-mismatch":"attribute",onClick:e=>{k(e),re()},style:"top"===t&&e?{width:g(e)}:void 0},[r.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:ye,extra:o.extra})}}}));export{G as F,Z as f};
