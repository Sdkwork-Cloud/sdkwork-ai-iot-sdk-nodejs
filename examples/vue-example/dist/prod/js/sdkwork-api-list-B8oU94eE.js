import{_ as e}from"./index-CS7g9XHh.js";import{P as t}from"./index-PnL9L784.js";import{L as a}from"./index-BWgZZY7i.js";import{D as l,u as o,E as i,S as s}from"./shared-DPkvtz4r.js";import{L as d}from"./ListItem-BKv55VP8.js";import{k as r,a as n,f as m,w as p,o as f,n as c,b as u,P as h,R as v,Z as g,u as b,ac as y,q as S,a0 as w,Q as B,U as k,ad as x,j as L,F as M,Y as z,W as D,i as _}from"./vue-vendor-BvtDOCb5.js";const F=e(r({__name:"sdkwork-api-list",props:{api:{type:Function,default:void 0},service:{default:void 0},params:{default:()=>({})},pageableParams:{default:()=>({})},selectable:{type:Boolean,default:l.selectable},deletable:{type:Boolean,default:l.deletable},searchable:{type:Boolean,default:l.searchable},pageSize:{default:l.pageSize},itemKey:{default:l.itemKey},itemTitleField:{default:l.itemTitleField},itemDescriptionField:{default:l.itemDescriptionField},topSpacing:{default:l.topSpacing},leftSpacing:{default:l.leftSpacing},rightSpacing:{default:l.rightSpacing},showBorderBottom:{type:Boolean,default:l.showBorderBottom},borderBottomLeftOffset:{default:l.borderBottomLeftOffset},showNoMoreData:{type:Boolean,default:l.showNoMoreData},themeMode:{default:l.themeMode},minSize:{},itemGap:{},fixed:{type:Boolean},buffer:{},bufferTop:{},bufferBottom:{},horizontal:{type:Boolean},scrollDistance:{},fixSelection:{type:Boolean},start:{},offset:{},listStyle:{},listClass:{},itemStyle:{},itemClass:{},renderControl:{}},emits:["select","delete","search","reach-top","reach-bottom","scroll","item-resize","range-update","load"],setup(e,{expose:l,emit:r}){const F=e,P=r,$=n([]),j=n(!1);n(!1),n(!1),n(0);const E=m(()=>"dark"===F.themeMode||"light"!==F.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),I=m(()=>E.value?"dark-mode":"light-mode"),T=async()=>{U.value||V.value||!q.value||(V.value=!0,await Z(C.value+1,!0))},{dataList:O,currentPage:C,totalElements:K,totalPages:R,loading:U,loadingMore:V,hasMore:q,isEmpty:N,loadData:G}=o({api:F.api,service:F.service,params:F.params,pageableParams:F.pageableParams,pageSize:F.pageSize,autoLoad:!0}),H=m(()=>"number"==typeof F.topSpacing?`${F.topSpacing}px`:F.topSpacing),Q=m(()=>"number"==typeof F.leftSpacing?`${F.leftSpacing}px`:F.leftSpacing),W=m(()=>"number"==typeof F.rightSpacing?`${F.rightSpacing}px`:F.rightSpacing);m(()=>({paddingTop:H.value,paddingLeft:Q.value,paddingRight:W.value}));const Y=(e,t)=>{const a=e[F.itemKey];return null!=a&&""!==a?a:`index_${t}`},Z=async(e=0,t=!1)=>{try{const a=O.value.length;await G(e,t);(0===e||O.value.length!==a)&&P("load",{content:O.value,number:C.value,totalElements:K.value,totalPages:R.value,last:!q.value})}catch(a){}finally{U.value=!1}},A=async()=>{try{j.value=!0,await Z(0)}catch(e){}finally{j.value=!1}},J=e=>{P("search",e),Z(0)},X=e=>{if(F.selectable){const t=$.value.findIndex(t=>Y(t,-1)===Y(e,-1));t>-1?$.value.splice(t,1):$.value.push(e)}P("select",e)},ee=e=>{P("delete",e)};p(()=>F.params,()=>{Z(0)},{deep:!0}),p(()=>F.pageSize,()=>{Z(0)});const te=()=>{if("undefined"!=typeof window){const e=document.querySelector(".sdkwork-api-list");if(e){F.searchable;e.clientHeight}}};return f(()=>{Z(0),c(()=>{te()}),"undefined"!=typeof window&&window.addEventListener("resize",te)}),u(()=>{"undefined"!=typeof window&&window.removeEventListener("resize",te)}),l({refresh:()=>Z(0),loadMore:()=>Z(C.value+1,!0),getData:()=>O.value,getSelectedItems:()=>$.value,clearSelected:()=>{$.value=[]},setSelectedItems:e=>{$.value=e}}),(l,o)=>{const r=a,n=t;return B(),h("div",{class:v(["sdkwork-api-list",I.value])},[b(N)&&!b(U)?(B(),g(i,y(S({key:0},{empty:!0})),{empty:w(()=>[k(l.$slots,"empty",y(x({empty:!0})),void 0,!0)]),_:3},16)):(B(),g(n,{key:1,modelValue:j.value,"onUpdate:modelValue":o[1]||(o[1]=e=>j.value=e),onRefresh:A},{default:w(()=>[L(r,{loading:b(U),"onUpdate:loading":o[0]||(o[0]=e=>_(U)?U.value=e:null),finished:!b(q),"finished-text":"没有更多了",onLoad:T,"immediate-check":!1,offset:300},{header:w(()=>[k(l.$slots,"header",{},()=>[e.searchable?(B(),g(s,{key:0,searchable:e.searchable,onSearch:J},null,8,["searchable"])):D("",!0)],!0)]),footer:w(()=>[k(l.$slots,"footer",{},void 0,!0)]),default:w(()=>[(B(!0),h(M,null,z(b(O),(t,a)=>{return B(),h("div",{key:Y(t,a)},[L(d,{item:t,index:a,selectable:e.selectable,deletable:e.deletable,"is-selected":(o=t,$.value.some(e=>Y(e,-1)===Y(o,-1))),"item-key":Y(t,a),"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,"theme-mode":e.themeMode,"show-border-bottom":e.showBorderBottom,"border-bottom-left-offset":e.borderBottomLeftOffset,onSelect:X,onDelete:ee},{default:w(({item:e,index:t,selected:a})=>[k(l.$slots,"default",{item:e,index:t,selected:a},void 0,!0)]),_:3},8,["item","index","selectable","deletable","is-selected","item-key","item-title-field","item-description-field","theme-mode","show-border-bottom","border-bottom-left-offset"])]);var o}),128))]),_:3},8,["loading","finished"])]),_:3},8,["modelValue"]))],2)}}}),[["__scopeId","data-v-21417d6d"]]);export{F as S};
