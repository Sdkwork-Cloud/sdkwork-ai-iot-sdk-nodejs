import{k as e,a,r as o,c as l,w as t,j as i,b as s,n,q as r,l as c,t as u,v as d}from"./vue-vendor-905d75e5.js";import{c as v,W as m,X as p,y as g,a5 as f,n as h,C as w,a4 as b,a3 as y,L as x,Z as C,N as S,t as z,a6 as O,r as k,aa as P,q as I,U as R,V as U,z as j,P as Z,H as B,I as X,J as Y,ai as F,x as L,aj as V,ak as D,w as A,ah as T,ae as H,p as N,F as W,D as $,ad as M}from"./index-34815b62.js";import{S as E,a as q}from"./index-8c878aea.js";import{I as J}from"./index-89cf3eae.js";const G=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),K=v("image-preview")[1];var Q=e({props:{src:String,show:Boolean,active:Number,minZoom:f(h),maxZoom:f(h),rootWidth:f(Number),rootHeight:f(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean},emits:["scale","close","longPress"],setup(e,{emit:s,slots:n}){const r=a({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),c=m(),u=o(),d=o(),v=o(!1),f=o(!1);let h=0;const z=l(()=>{const{scale:e,moveX:a,moveY:o,moving:l,zooming:t,initializing:i}=r,s={transitionDuration:t||l||i?"0s":".3s"};return(1!==e||f.value)&&(s.transform=`matrix(${e}, 0, 0, ${e}, ${a}, ${o})`),s}),O=l(()=>{if(r.imageRatio){const{rootWidth:a,rootHeight:o}=e,l=v.value?o/r.imageRatio:a;return Math.max(0,(r.scale*l-a)/2)}return 0}),k=l(()=>{if(r.imageRatio){const{rootWidth:a,rootHeight:o}=e,l=v.value?o:a*r.imageRatio;return Math.max(0,(r.scale*l-o)/2)}return 0}),P=(a,o)=>{var l;if((a=b(a,+e.minZoom,+e.maxZoom+1))!==r.scale){const t=a/r.scale;if(r.scale=a,o){const e=C(null==(l=u.value)?void 0:l.$el),a={x:.5*e.width,y:.5*e.height},i=r.moveX-(o.x-e.left-a.x)*(t-1),s=r.moveY-(o.y-e.top-a.y)*(t-1);r.moveX=b(i,-O.value,O.value),r.moveY=b(s,-k.value,k.value)}else r.moveX=0,r.moveY=f.value?h:0;s("scale",{scale:a,index:e.active})}},I=()=>{P(1)};let R,U,j,Z,B,X,Y,F,L=!1;const V=a=>{const{touches:o}=a;if(R=o.length,2===R&&e.disableZoom)return;const{offsetX:l}=c;c.start(a),U=r.moveX,j=r.moveY,F=Date.now(),L=!1,r.moving=1===R&&(1!==r.scale||f.value),r.zooming=2===R&&!l.value,r.zooming&&(Z=r.scale,B=G(o))},D=a=>{var o;const l=null==(o=d.value)?void 0:o.$el;if(!l)return;const t=l.firstElementChild,i=a.target===l,n=null==t?void 0:t.contains(a.target);!e.closeOnClickImage&&n||!e.closeOnClickOverlay&&i||s("close")},A=a=>{if(R>1)return;const o=Date.now()-F;c.isTap.value&&(o<250?e.doubleScale?Y?(clearTimeout(Y),Y=null,(()=>{const e=r.scale>1?1:2;P(e,2===e||f.value?{x:c.startX.value,y:c.startY.value}:void 0)})()):Y=setTimeout(()=>{D(a),Y=null},250):D(a):o>S&&s("longPress"))},T=a=>{let o=!1;if((r.moving||r.zooming)&&(o=!0,r.moving&&U===r.moveX&&j===r.moveY&&(o=!1),!a.touches.length)){r.zooming&&(r.moveX=b(r.moveX,-O.value,O.value),r.moveY=b(r.moveY,-k.value,k.value),r.zooming=!1),r.moving=!1,U=0,j=0,Z=1,r.scale<1&&I();const a=+e.maxZoom;r.scale>a&&P(a,X)}w(a,o),A(a),c.reset()},H=()=>{const{rootWidth:a,rootHeight:o}=e,l=o/a,{imageRatio:t}=r;v.value=r.imageRatio>l&&t<2.6,f.value=r.imageRatio>l&&t>=2.6,f.value&&(h=(t*a-o)/2,r.moveY=h,r.initializing=!0,y(()=>{r.initializing=!1})),I()},N=e=>{const{naturalWidth:a,naturalHeight:o}=e.target;r.imageRatio=o/a,H()};return t(()=>e.active,I),t(()=>e.show,e=>{e||I()}),t(()=>[e.rootWidth,e.rootHeight],H),p("touchmove",a=>{const{touches:o}=a;if(c.move(a),r.moving){const{deltaX:o,deltaY:l}=c,t=o.value+U,i=l.value+j;if((e.vertical?c.isVertical()&&Math.abs(i)>k.value:c.isHorizontal()&&Math.abs(t)>O.value)&&!L)return void(r.moving=!1);L=!0,w(a,!0),r.moveX=b(t,-O.value,O.value),r.moveY=b(i,-k.value,k.value)}if(r.zooming&&(w(a,!0),2===o.length)){const e=G(o),a=Z*e/B;X=(e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}))(o),P(a,X)}},{target:l(()=>{var e;return null==(e=d.value)?void 0:e.$el})}),g({resetScale:I}),()=>{const a={loading:()=>i(x,{type:"spinner"},null)};return i(E,{ref:d,class:K("swipe-item"),onTouchstartPassive:V,onTouchend:T,onTouchcancel:T},{default:()=>[n.image?i("div",{class:K("image-wrap")},[n.image({src:e.src,onLoad:N,style:z.value})]):i(J,{ref:u,src:e.src,fit:"contain",class:K("image",{vertical:v.value}),style:z.value,onLoad:N},a)]})}}});const[_,ee]=v("image-preview"),ae=["show","teleport","transition","overlayStyle","closeOnPopstate"];var oe=e({name:_,props:{show:Boolean,loop:z,images:O(),minZoom:k(1/3),maxZoom:k(3),overlay:z,vertical:Boolean,closeable:Boolean,showIndex:z,className:P,closeIcon:I("clear"),transition:String,beforeClose:Function,doubleScale:z,overlayClass:P,overlayStyle:Object,swipeDuration:k(300),startPosition:k(0),showIndicators:Boolean,closeOnPopstate:z,closeOnClickImage:z,closeOnClickOverlay:z,closeIconPosition:I("top-right"),teleport:[String,Object]},emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:l,slots:c}){const u=o(),d=o(),v=a({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),m=()=>{if(u.value){const e=C(u.value.$el);v.rootWidth=e.width,v.rootHeight=e.height,u.value.resize()}},p=e=>l("scale",e),f=e=>l("update:show",e),h=()=>{Y(e.beforeClose,{args:[v.active],done:()=>f(!1)})},w=e=>{e!==v.active&&(v.active=e,l("change",e))},b=()=>{if(e.showIndex)return i("div",{class:ee("index")},[c.index?c.index({index:v.active}):`${v.active+1} / ${e.images.length}`])},y=()=>{if(c.cover)return i("div",{class:ee("cover")},[c.cover()])},x=()=>{v.disableZoom=!0},S=()=>{v.disableZoom=!1},z=()=>{if(e.closeable)return i(X,{role:"button",name:e.closeIcon,class:[ee("close-icon",e.closeIconPosition),B],onClick:h},null)},O=()=>l("closed"),k=(e,a)=>{var o;return null==(o=u.value)?void 0:o.swipeTo(e,a)};return g({resetScale:()=>{var e;null==(e=d.value)||e.resetScale()},swipeTo:k}),s(m),t([R,U],m),t(()=>e.startPosition,e=>w(+e)),t(()=>e.show,a=>{const{images:o,startPosition:t}=e;a?(w(+t),n(()=>{m(),k(+t,{immediate:!0})})):l("close",{index:v.active,url:o[v.active]})}),()=>i(Z,r({class:[ee(),e.className],overlayClass:[ee("overlay"),e.overlayClass],onClosed:O,"onUpdate:show":f},j(e,ae)),{default:()=>[z(),i(q,{ref:u,lazyRender:!0,loop:e.loop,class:ee("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:w,onDragEnd:S,onDragStart:x},{default:()=>[e.images.map((a,o)=>i(Q,{ref:e=>{o===v.active&&(d.value=e)},src:a,show:e.show,active:v.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:v.rootWidth,rootHeight:v.rootHeight,disableZoom:v.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:p,onClose:h,onLongPress:()=>l("longPress",{index:o})},{image:c.image}))]}),b(),y()]})}});let le;const te={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};const ie=(e,a=0)=>{if(F)return le||({instance:le}=V({setup(){const{state:e,toggle:a}=D(),o=()=>{e.images=[]};return()=>i(oe,r(e,{onClosed:o,"onUpdate:show":a}),null)}})),e=Array.isArray(e)?{images:e,startPosition:a}:e,le.open(L({},te,e)),le};A(oe);const[se,ne,re]=v("uploader");function ce(e,a){return new Promise(o=>{if("file"===a)return void o();const l=new FileReader;l.onload=e=>{o(e.target.result)},"dataUrl"===a?l.readAsDataURL(e):"text"===a&&l.readAsText(e)})}function ue(e,a){return T(e).some(e=>!!e.file&&(H(a)?a(e.file):e.file.size>+a))}const de=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i;function ve(e){return!!e.isImage||(e.file&&e.file.type?0===e.file.type.indexOf("image"):e.url?(a=e.url,de.test(a)):"string"==typeof e.content&&0===e.content.indexOf("data:image"));var a}var me=e({props:{name:h,item:f(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:a,slots:o}){const l=()=>{const{status:a,message:o}=e.item;if("uploading"===a||"failed"===a){const e="failed"===a?i(X,{name:"close",class:ne("mask-icon")},null):i(x,{class:ne("loading")},null),l=W(o)&&""!==o;return i("div",{class:ne("mask")},[e,l&&i("div",{class:ne("mask-message")},[o])])}},t=o=>{const{name:l,item:t,index:i,beforeDelete:s}=e;o.stopPropagation(),Y(s,{args:[t,{name:l,index:i}],done:()=>a("delete")})},s=()=>a("preview"),n=()=>a("reupload"),r=()=>{if(e.deletable&&"uploading"!==e.item.status){const e=o["preview-delete"];return i("div",{role:"button",class:ne("preview-delete",{shadow:!e}),tabindex:0,"aria-label":re("delete"),onClick:t},[e?e():i(X,{name:"cross",class:ne("preview-delete-icon")},null)])}},c=()=>{if(o["preview-cover"]){const{index:a,item:l}=e;return i("div",{class:ne("preview-cover")},[o["preview-cover"](L({index:a},l))])}},u=()=>{const{item:a,lazyLoad:o,imageFit:l,previewSize:t,reupload:r}=e;return ve(a)?i(J,{fit:l,src:a.objectUrl||a.content||a.url,class:ne("preview-image"),width:Array.isArray(t)?t[0]:t,height:Array.isArray(t)?t[1]:t,lazyLoad:o,onClick:r?n:s},{default:c}):i("div",{class:ne("file"),style:N(e.previewSize)},[i(X,{class:ne("file-icon"),name:"description"},null),i("div",{class:[ne("file-name"),"van-ellipsis"]},[a.file?a.file.name:a.url]),c()])};return()=>i("div",{class:ne("preview")},[u(),l(),r()])}});var pe=e({name:se,props:{name:k(""),accept:I("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:k(1/0),imageFit:I("cover"),resultType:I("dataUrl"),uploadIcon:I("photograph"),uploadText:String,deletable:z,reupload:Boolean,afterRead:Function,showUpload:z,modelValue:O(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:z,previewOptions:Object,previewFullImage:z,maxSize:{type:[Number,String,Function],default:1/0}},emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:l,slots:t}){const s=o(),v=[],m=o(-1),p=o(!1),f=(a=e.modelValue.length)=>({name:e.name,index:a}),h=()=>{s.value&&(s.value.value="")},w=o=>{if(h(),ue(o,e.maxSize)){if(!Array.isArray(o))return void l("oversize",o,f());{const a=function(e,a){const o=[],l=[];return e.forEach(e=>{ue(e,a)?l.push(e):o.push(e)}),{valid:o,invalid:l}}(o,e.maxSize);if(o=a.valid,l("oversize",a.invalid,f()),!o.length)return}}if(o=a(o),m.value>-1){const a=[...e.modelValue];a.splice(m.value,1,o),l("update:modelValue",a),m.value=-1}else l("update:modelValue",[...e.modelValue,...T(o)]);e.afterRead&&e.afterRead(o,f())},b=a=>{const{maxCount:o,modelValue:l,resultType:t}=e;if(Array.isArray(a)){const e=+o-l.length;a.length>e&&(a=a.slice(0,e)),Promise.all(a.map(e=>ce(e,t))).then(e=>{const o=a.map((a,o)=>{const l={file:a,status:"",message:"",objectUrl:URL.createObjectURL(a)};return e[o]&&(l.content=e[o]),l});w(o)})}else ce(a,t).then(e=>{const o={file:a,status:"",message:"",objectUrl:URL.createObjectURL(a)};e&&(o.content=e),w(o)})},y=a=>{const{files:o}=a.target;if(e.disabled||!o||!o.length)return;const l=1===o.length?o[0]:[].slice.call(o);if(e.beforeRead){const a=e.beforeRead(l,f());if(!a)return void h();if(M(a))return void a.then(e=>{b(e||l)}).catch(h)}b(l)};let x;const C=()=>l("closePreview"),S=e=>{p.value=!0,m.value=e,n(()=>R())},z=()=>{p.value||(m.value=-1),p.value=!1},O=(a,o)=>{const s=["imageFit","deletable","reupload","previewSize","beforeDelete"],n=L(j(e,s),j(a,s,!0));return i(me,r({item:a,index:o,onClick:()=>l(e.reupload?"clickReupload":"clickPreview",a,f(o)),onDelete:()=>((a,o)=>{const t=e.modelValue.slice(0);t.splice(o,1),l("update:modelValue",t),l("delete",a,f(o))})(a,o),onPreview:()=>(a=>{if(e.previewFullImage){const o=e.modelValue.filter(ve),l=o.map(e=>(e.objectUrl&&!e.url&&"failed"!==e.status&&(e.url=e.objectUrl,v.push(e.url)),e.url)).filter(Boolean);x=ie(L({images:l,startPosition:o.indexOf(a),onClose:C},e.previewOptions))}})(a),onReupload:()=>S(o)},j(e,["name","lazyLoad"]),n),j(t,["preview-cover","preview-delete"]))},k=()=>{if(e.previewImage)return e.modelValue.map(O)},P=e=>l("clickUpload",e),I=()=>{const a=e.modelValue.length<+e.maxCount,o=e.readonly?null:i("input",{ref:s,type:"file",class:ne("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&-1===m.value,disabled:e.disabled,onChange:y,onClick:z},null);return t.default?u(i("div",{class:ne("input-wrapper"),onClick:P},[t.default(),o]),[[d,a]]):u(i("div",{class:ne("upload",{readonly:e.readonly}),style:N(e.previewSize),onClick:P},[i(X,{name:e.uploadIcon,class:ne("upload-icon")},null),e.uploadText&&i("span",{class:ne("upload-text")},[e.uploadText]),o]),[[d,e.showUpload&&a]])},R=()=>{s.value&&!e.disabled&&s.value.click()};return c(()=>{v.forEach(e=>URL.revokeObjectURL(e))}),g({chooseFile:R,reuploadFile:S,closeImagePreview:()=>{x&&x.close()}}),$(()=>e.modelValue),()=>i("div",{class:ne()},[i("div",{class:ne("wrapper",{disabled:e.disabled})},[k(),I()])])}});const ge=A(pe);export{ge as U};
