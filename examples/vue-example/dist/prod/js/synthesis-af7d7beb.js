import{_ as e,a}from"./sdkwork-cell-group-c8f6555d.js";import{v as l,s as t,I as o,B as s,r as u,_ as r}from"./index-5affcab4.js";/* empty css              */import{_ as i,a as d}from"./sdkwork-collapse-item-faedb3e0.js";import{_ as m}from"./sdkwork-popup-6e1ec418.js";/* empty css              *//* empty css              */import{P as n}from"./index-0a8ae520.js";/* empty css              *//* empty css              */import{S as v}from"./sdkwork-voice-speaker-category-list-popup-6a918502.js";import{k as c,r as p,a as h,c as f,w as k,Q as y,R as x,S as g,j,a0 as w,X as _,$ as V,Z as b,a4 as U,U as C}from"./vue-vendor-a2672387.js";import{F as M}from"./index-dee6a080.js";import"./sdkwork-icon-2d6efb98.js";import"./utils-vendor-b5712723.js";import"./index-44056be1.js";import"./sdkwork-pull-refresh-9d6db096.js";import"./index-e159e7ef.js";import"./shared-1cf0c357.js";import"./sdkwork-search-bar-4d747e22.js";import"./index-ccee2c65.js";import"./use-id-82312033.js";import"./ListItem-783a2127.js";import"./LoadingSection-0e2448c2.js";import"./LoadMoreSection-49ddad4b.js";import"./sdkwork-voice-clone-2a1489b7.js";/* empty css              */import"./index-5d6825eb.js";import"./ImagePreview-084463df.js";import"./index-63936d32.js";import"./index-4fcf5799.js";import"./index-fa879ae6.js";import"./function-call-e02e5da4.js";const S={class:"text-input-section"},P={class:"text-field-wrapper"},B={class:"char-count-bottom"},z={class:"voice-selector"},A={key:0,class:"selected-voice"},T={key:1,class:"placeholder"},I={class:"slider-wrapper"},E={class:"slider-value"},F={class:"slider-wrapper"},$={class:"slider-value"},L={class:"slider-wrapper"},D={class:"slider-value"},G={class:"format-value"},H={class:"bottom-action-bar"},K=r(c({__name:"sdkwork-voice-synthesis",props:{themeMode:{default:"auto"},defaultText:{default:""},defaultSpeaker:{},showAdvancedParams:{type:Boolean,default:!0}},emits:["start","complete","error","speaker-change"],setup(r,{emit:c}){const{currentTheme:K,isDarkMode:N}=l(),Q=r,R=c,W=p(Q.defaultText),X=p(Q.defaultSpeaker||null),Z=p(!1),J=p(!1),O=p(Q.showAdvancedParams?["params"]:[]),Y=p(!1),q=p(!1),ee=p(null),ae=h({speed:1,volume:80,pitch:0,format:"mp3"}),le=[{text:"MP3",value:"mp3"},{text:"WAV",value:"wav"},{text:"PCM",value:"pcm"}],te=p([ae.format]),oe=p(""),se=f(()=>`theme-${K.value}`),ue=f(()=>"auto"===Q.themeMode?K.value:Q.themeMode),re=f(()=>"100%"),ie=f(()=>W.value.trim().length>0&&null!==X.value);k(()=>Q.defaultText,e=>{e&&!W.value&&(W.value=e)}),k(()=>Q.defaultSpeaker,e=>{e&&!X.value&&(X.value=e)});const de=()=>{W.value.trim()?W.value.length>1e3?oe.value="文本长度不能超过1000个字符":oe.value="":oe.value="请输入合成文本"},me=e=>{const a=le.find(a=>a.value===e);return a?a.text:"MP3"},ne=e=>{X.value=e,Z.value=!1,R("speaker-change",e),t(`已选择发音人: ${e.displayName||e.name}`)},ve=e=>{Array.isArray(e)?te.value=e:e&&"object"==typeof e&&e.selectedValues&&(te.value=e.selectedValues)},ce=e=>{let a=e;Array.isArray(e)?a=e[0]:e&&"object"==typeof e&&e.selectedValues&&(a=e.selectedValues[0]),ae.format=a,J.value=!1},pe=async()=>{if(X.value&&W.value.trim()){Y.value=!0;try{const e=W.value.length>50?W.value.substring(0,50)+"...":W.value,a=await ye(e,X.value,ae);ee.value&&a&&(ee.value.src=a,await ee.value.play())}catch(e){console.error("试听失败:",e),t("试听失败，请重试")}finally{Y.value=!1}}else t("请先选择发音人和输入文本")},he=async()=>{if(ie.value){q.value=!0;try{const e={text:W.value,speaker:X.value,params:{...ae}};R("start",e);const a=await xe(e);R("complete",a),t("合成完成"),ee.value&&a.audioUrl&&(ee.value.src=a.audioUrl,await ee.value.play())}catch(e){console.error("合成失败:",e),R("error",e),t("合成失败，请重试")}finally{q.value=!1}}else t("请完善合成信息")},fe=()=>{console.log("音频播放结束")},ke=e=>{console.error("音频播放错误:",e),t("音频播放失败")},ye=async(e,a,l)=>(await new Promise(e=>setTimeout(e,1e3)),"https://example.com/preview-audio.mp3"),xe=async e=>(await new Promise(e=>setTimeout(e,2e3)),{audioUrl:"https://example.com/synthesis-result.mp3",duration:10,fileSize:102400});return(l,t)=>{const r=M,c=e,p=o,h=a,f=s,k=u,K=n,N=m,Q=i,R=d;return y(),x("div",{class:_(["voice-synthesis",se.value])},[g("div",S,[j(c,{"theme-mode":ue.value},{default:w(()=>[g("div",P,[j(r,{modelValue:W.value,"onUpdate:modelValue":t[0]||(t[0]=e=>W.value=e),label:"合成文本","label-align":"top",type:"textarea",placeholder:"请输入要合成的文本内容",autosize:{minHeight:100,maxHeight:200},maxlength:1e3,"error-message":oe.value,onBlur:de},null,8,["modelValue","error-message"]),g("div",B,[g("span",{class:_(["char-count",{error:W.value.length>1e3}])},V(W.value.length)+"/1000 ",3)])])]),_:1},8,["theme-mode"])]),j(c,{class:"voice-section","theme-mode":ue.value},{default:w(()=>[j(h,{title:"发音人",center:"","is-link":"",onClick:t[1]||(t[1]=e=>Z.value=!0),"theme-mode":ue.value},{value:w(()=>[g("div",z,[j(p,{name:"music",class:"voice-icon"}),X.value?(y(),x("span",A,V(X.value.displayName||X.value.name),1)):(y(),x("span",T,"请选择发音人"))])]),_:1},8,["theme-mode"]),X.value?(y(),b(h,{key:0,title:"试听",center:"","theme-mode":ue.value},{value:w(()=>[j(f,{type:"primary",size:"small",onClick:pe,loading:Y.value,disabled:!W.value.trim()},{default:w(()=>[...t[11]||(t[11]=[U(" 试听 ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["theme-mode"])):C("",!0)]),_:1},8,["theme-mode"]),j(R,{modelValue:O.value,"onUpdate:modelValue":t[8]||(t[8]=e=>O.value=e),class:"params-section","theme-mode":ue.value},{default:w(()=>[j(Q,{title:"高级参数设置",name:"params","theme-mode":ue.value},{default:w(()=>[j(h,{title:"语速",center:"","theme-mode":ue.value},{value:w(()=>[g("div",I,[j(k,{modelValue:ae.speed,"onUpdate:modelValue":t[2]||(t[2]=e=>ae.speed=e),min:.5,max:2,step:.1,"bar-height":"4px","active-color":"#1989fa"},null,8,["modelValue"]),g("span",E,V(ae.speed.toFixed(1))+"x",1)])]),_:1},8,["theme-mode"]),j(h,{title:"音量",center:"","theme-mode":ue.value},{value:w(()=>[g("div",F,[j(k,{modelValue:ae.volume,"onUpdate:modelValue":t[3]||(t[3]=e=>ae.volume=e),min:0,max:100,step:1,"bar-height":"4px","active-color":"#1989fa"},null,8,["modelValue"]),g("span",$,V(ae.volume)+"%",1)])]),_:1},8,["theme-mode"]),j(h,{title:"音调",center:"","theme-mode":ue.value},{value:w(()=>[g("div",L,[j(k,{modelValue:ae.pitch,"onUpdate:modelValue":t[4]||(t[4]=e=>ae.pitch=e),min:-10,max:10,step:1,"bar-height":"4px","active-color":"#1989fa"},null,8,["modelValue"]),g("span",D,V(ae.pitch>0?"+":"")+V(ae.pitch),1)])]),_:1},8,["theme-mode"]),j(h,{title:"音频格式",center:"","is-link":"",onClick:t[5]||(t[5]=e=>J.value=!0),"theme-mode":ue.value},{value:w(()=>[g("span",G,V(me(ae.format)),1)]),_:1},8,["theme-mode"]),j(N,{show:J.value,"onUpdate:show":t[7]||(t[7]=e=>J.value=e),position:"bottom",round:"","theme-mode":ue.value,closeable:!1},{default:w(()=>[j(K,{columns:le,"model-value":te.value,"onUpdate:modelValue":ve,onConfirm:ce,onCancel:t[6]||(t[6]=e=>J.value=!1),title:"选择音频格式"},null,8,["model-value"])]),_:1},8,["show","theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["modelValue","theme-mode"]),g("div",H,[j(f,{type:"primary",size:"large",block:"",loading:q.value,disabled:!ie.value,onClick:he,class:"synthesis-button"},{default:w(()=>[...t[12]||(t[12]=[U(" 开始合成 ",-1)])]),_:1},8,["loading","disabled"])]),j(v,{modelValue:Z.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Z.value=e),title:"选择发音人",height:re.value,"selected-speaker-id":X.value?.id,"theme-mode":ue.value,onConfirm:ne,onClose:t[10]||(t[10]=e=>Z.value=!1)},null,8,["modelValue","height","selected-speaker-id","theme-mode"]),g("audio",{ref_key:"audioPlayer",ref:ee,style:{display:"none"},onEnded:fe,onError:ke},null,544)],2)}}}),[["__scopeId","data-v-f40e67b7"]]),N={class:"voice-synthesis-page"},Q={key:0,class:"result-section"},R={class:"result-info"},W={class:"duration"},X={class:"file-size"},Z={class:"result-actions"},J=r(c({__name:"synthesis",setup(l){const o=p("auto"),u=p("欢迎使用语音合成功能，请输入您想要转换的文本内容。"),r=p(null),i=p(null),d=p(!1),m=p(null),n=e=>{console.log("合成开始:",e),i.value=null},v=e=>{console.log("合成完成:",e),i.value=e,t("语音合成完成")},c=e=>{console.error("合成错误:",e),t("合成失败，请重试")},h=e=>{console.log("发音人变更:",e),r.value=e},f=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},k=async()=>{if(i.value){d.value=!0;try{m.value||(m.value=new Audio),m.value.src=i.value.audioUrl,await m.value.play(),m.value.onended=()=>{d.value=!1},m.value.onerror=()=>{d.value=!1,t("播放失败")}}catch(e){console.error("播放失败:",e),d.value=!1,t("播放失败")}}},_=()=>{if(i.value)try{const e=document.createElement("a");e.href=i.value.audioUrl,e.download=`synthesis-result.${i.value.audioUrl.split(".").pop()||"mp3"}`,e.click(),t("开始下载")}catch(e){console.error("下载失败:",e),t("下载失败")}};return(l,t)=>{const m=a,p=s,b=e;return y(),x("div",N,[j(K,{"theme-mode":o.value,"default-text":u.value,"default-speaker":r.value,"show-advanced-params":!0,onStart:n,onComplete:v,onError:c,onSpeakerChange:h},null,8,["theme-mode","default-text","default-speaker"]),i.value?(y(),x("div",Q,[j(b,{"theme-mode":o.value},{default:w(()=>[j(m,{title:"合成结果","theme-mode":o.value},{value:w(()=>[g("div",R,[g("span",W,"时长: "+V(i.value.duration)+"秒",1),g("span",X,"大小: "+V(f(i.value.fileSize)),1)])]),_:1},8,["theme-mode"]),j(m,{title:"操作","theme-mode":o.value},{value:w(()=>[g("div",Z,[j(p,{type:"primary",size:"small",onClick:k,loading:d.value},{default:w(()=>[...t[0]||(t[0]=[U(" 播放 ",-1)])]),_:1},8,["loading"]),j(p,{type:"default",size:"small",onClick:_},{default:w(()=>[...t[1]||(t[1]=[U(" 下载 ",-1)])]),_:1})])]),_:1},8,["theme-mode"])]),_:1},8,["theme-mode"])])):C("",!0)])}}}),[["__scopeId","data-v-e6ff516a"]]);export{J as default};
