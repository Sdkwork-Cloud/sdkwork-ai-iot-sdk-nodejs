import{S as e}from"./sdkwork-page-container-VUGI9Via.js";import{a as l,_ as a}from"./sdkwork-cell-group-VLV2jidw.js";import{_ as t}from"./sdkwork-navbar-DG9_hzWm.js";import{_ as o}from"./sdkwork-popup-BvExtb7p.js";import{d as u,_ as i,s}from"./index-DS3FT4GI.js";import{k as d,r as n,f as p,w as r,P as c,Q as v,S as m,W as f,R as w,F as h,Y as k,Z as g,u as y,$ as b,V as U,j as V,a0 as A}from"./vue-vendor-CnVaDBlt.js";import"./sdkwork-icon-JBBTW6q4.js";import"./utils-vendor-WEzSe-CR.js";const C={class:"sdkwork-uploader-audio"},$={class:"upload-content"},x={key:0,class:"audio-list"},_={class:"audio-player"},M=["onClick","disabled"],L={class:"audio-info"},j={class:"audio-name"},I={class:"audio-details"},P={class:"audio-size"},S={key:0,class:"audio-duration"},z={class:"audio-format"},R={key:0,class:"audio-waveform"},B={key:1,class:"upload-progress"},G={class:"progress-bar"},O={class:"progress-text"},W={class:"audio-actions"},E={class:"status-icons"},F={key:0,class:"success-icon"},D={key:1,class:"error-icon"},T={class:"action-buttons"},N=["onClick"],q=["onClick"],K={key:1,class:"empty-state"},Q={class:"upload-icon"},Y={class:"upload-text"},Z={class:"upload-title"},H={class:"upload-subtitle"},J={key:0,class:"upload-actions"},X=["disabled"],ee=i(d({__name:"sdkwork-uploader-audio",props:{modelValue:{default:()=>[]},accept:{default:"audio/*"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autoUpload:{type:Boolean,default:!0},maxSize:{default:52428800},maxCount:{default:10},maxDuration:{default:600},title:{default:"点击或拖拽音频到此处"},subtitle:{default:"支持 MP3、WAV、OGG、AAC 等格式"},bucket:{default:void 0},scene:{default:"audio"},metadata:{default:()=>({})},contentType:{default:"audio/mpeg"},acl:{default:"private"}},emits:["update:modelValue","upload-start","upload-progress","upload-success","upload-error","upload-complete","audio-add","audio-remove","audio-clear","audio-play","audio-pause","audio-ended","audio-metadata"],setup(e,{expose:l,emit:a}){const t=e,o=a,i=n(),s=n(!1),d=n(),A=n(""),ee=n([]),le=p(()=>ee.value.filter(e=>"uploading"===e.status).length),ae=p(()=>ee.value.length<t.maxCount),te=p(()=>ee.value.slice(0,t.maxCount));r(()=>t.modelValue,e=>{if(e&&e.length>0){const l=ee.value.map(e=>oe(e.file)),a=e.filter(e=>!l.includes(oe(e)));a.length>0&&ce(a)}},{immediate:!0});const oe=e=>`${e.name}-${e.size}-${e.lastModified}`,ue=e=>{const l=e.name.split(".").pop()?.toUpperCase()||"";return{mp3:"MP3",wav:"WAV",ogg:"OGG",aac:"AAC",flac:"FLAC",m4a:"M4A",wma:"WMA"}[l.toLowerCase()]||l},ie=async e=>{const l=await(e=>new Promise(l=>{l(URL.createObjectURL(e))}))(e);let a;try{const l=await(e=>new Promise((l,a)=>{const t=URL.createObjectURL(e),o=new Audio;o.onloadedmetadata=()=>{const e={duration:o.duration};URL.revokeObjectURL(t),l(e)},o.onerror=()=>{URL.revokeObjectURL(t),a(new Error("无法获取音频元数据"))},o.src=t}))(e);a=l.duration}catch(t){}return{id:oe(e),file:e,name:e.name,size:e.size,previewUrl:l,duration:a,status:"pending",progress:0}},se=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},de=()=>{!t.disabled&&ae.value&&i.value?.click()},ne=e=>{e.preventDefault(),!t.disabled&&ae.value&&(s.value=!0)},pe=e=>{e.preventDefault(),s.value=!1},re=async e=>{if(e.preventDefault(),s.value=!1,t.disabled||!ae.value)return;const l=e.dataTransfer?.files;l&&l.length>0&&await ce(Array.from(l))},ce=async e=>{if(0===e.length)return;const l=e.filter(e=>e.type.startsWith("audio/"));if(0===l.length)return void window.$message?.warning("请选择音频文件");const a=t.maxCount-ee.value.length,u=l.slice(0,a);if(0===u.length)return void window.$message?.warning(`最多只能上传 ${t.maxCount} 个音频`);const i=[],s=[];for(const o of u)o.size>t.maxSize?s.push(o):i.push(o);if(s.length>0&&window.$message?.warning(`以下音频文件超过 ${se(t.maxSize)} 限制: ${s.map(e=>e.name).join(", ")}`),0===i.length)return;const d=await Promise.all(i.map(ie));ee.value=[...ee.value,...d];const n=ee.value.map(e=>e.file);o("update:modelValue",n),o("audio-add",i),t.autoUpload&&fe()},ve=e=>{const l=ee.value.findIndex(l=>l.id===e);if(-1!==l){const e=ee.value[l];e.id===A.value&&ke(),"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),URL.revokeObjectURL(e.previewUrl),ee.value.splice(l,1);const a=ee.value.map(e=>e.file);o("update:modelValue",a),o("audio-remove",e.file)}},me=()=>{ke(),ee.value.forEach(e=>{"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),URL.revokeObjectURL(e.previewUrl)}),ee.value=[],o("update:modelValue",[]),o("audio-clear")},fe=()=>{ee.value.filter(e=>"pending"===e.status).forEach(we)},we=async e=>{if(window.$uploader){e.status="uploading",o("upload-start",e.file);try{const l={file:e.file,bucket:t.bucket||{name:"default-bucket"},name:e.name,scene:t.scene,metadata:t.metadata,contentType:t.contentType||"audio/mpeg",acl:t.acl},a=await window.$uploader.upload(l,l=>{e.progress=l.percentage,o("upload-progress",e.file,l.percentage)});e.uploadId=a;const u=await window.$uploader.wait(a);e.status="success",e.progress=100,o("upload-success",e.file,u);ee.value.every(e=>"success"===e.status||"error"===e.status)&&o("upload-complete",ee.value.map(e=>e.file))}catch(l){e.status="error",o("upload-error",e.file,l)}}},he=async e=>{d.value&&(A.value===e.id?(d.value.pause(),A.value="",o("audio-pause",e.file)):(A.value&&(d.value.pause(),o("audio-pause",ee.value.find(e=>e.id===A.value)?.file)),d.value.src=e.previewUrl,await d.value.play(),A.value=e.id,o("audio-play",e.file)))},ke=()=>{if(d.value){if(A.value){const e=ee.value.find(e=>e.id===A.value);e&&o("audio-pause",e.file)}d.value.pause(),d.value.currentTime=0,A.value=""}},ge=()=>{},ye=()=>{if(A.value){const e=ee.value.find(e=>e.id===A.value);e&&o("audio-ended",e.file),A.value=""}};return l({clearAudios:me,uploadAudios:fe,getAudioList:()=>ee.value.map(e=>({file:e.file,previewUrl:e.previewUrl,duration:e.duration,status:"success"===e.status?"uploaded":void 0})),playAudio:e=>{const l=ee.value.find(l=>l.file===e);l&&he(l)},pauseAudio:ke,removeAudio:ve}),(l,a)=>(v(),c("div",C,[m("div",{class:w(["upload-area",{"drag-over":s.value,disabled:e.disabled,"has-audios":ee.value.length>0}]),onClick:de,onDrop:re,onDragover:ne,onDragleave:pe},[m("div",$,[ee.value.length>0?(v(),c("div",x,[(v(!0),c(h,null,k(te.value,(e,l)=>{return v(),c("div",{key:e.id,class:w(["audio-item",{uploading:"uploading"===e.status,success:"success"===e.status,error:"error"===e.status,playing:e.id===A.value}])},[m("div",_,[m("button",{type:"button",class:"play-control",onClick:l=>he(e),disabled:"success"!==e.status},[e.id===A.value?(v(),g(y(u),{key:0,icon:"material-symbols:pause",width:"20",height:"20"})):(v(),g(y(u),{key:1,icon:"material-symbols:play-arrow",width:"20",height:"20"}))],8,M),m("div",L,[m("div",j,b(e.name),1),m("div",I,[m("span",P,b(se(e.size)),1),e.duration?(v(),c("span",S,b((a=e.duration,`${Math.floor(a/60)}:${Math.floor(a%60).toString().padStart(2,"0")}`)),1)):f("",!0),m("span",z,b(ue(e.file)),1)]),e.id===A.value?(v(),c("div",R,[(v(),c(h,null,k(20,e=>m("div",{key:e,class:"wave-bar",style:U({height:12*Math.random()+4+"px"})},null,4)),64))])):f("",!0),"uploading"===e.status?(v(),c("div",B,[m("div",G,[m("div",{class:"progress-fill",style:U({width:e.progress+"%"})},null,4)]),m("span",O,b(e.progress)+"%",1)])):f("",!0)]),m("div",W,[m("div",E,["success"===e.status?(v(),c("span",F,"✓")):f("",!0),"error"===e.status?(v(),c("span",D,"✗")):f("",!0)]),m("div",T,["uploading"===e.status?(v(),c("button",{key:0,type:"button",class:"cancel-btn",onClick:l=>(e=>{const l=ee.value.find(l=>l.id===e);l&&l.uploadId&&(window.$uploader?.cancel(l.uploadId),l.status="pending",l.progress=0,l.uploadId=void 0)})(e.id)}," 取消 ",8,N)):(v(),c("button",{key:1,type:"button",class:"remove-btn",onClick:l=>ve(e.id)}," 移除 ",8,q))])])])],2);var a}),128)),ae.value?(v(),c("div",{key:0,class:"add-more-btn",onClick:de},[...a[0]||(a[0]=[m("div",{class:"add-icon"},"+",-1),m("div",{class:"add-text"},"添加音频",-1)])])):f("",!0)])):(v(),c("div",K,[m("div",Q,[V(y(u),{icon:"material-symbols:audio-file",width:"48",height:"48"})]),m("div",Y,[m("p",Z,b(e.title),1),m("p",H,b(e.subtitle),1)])]))])],34),ee.value.length>0&&!e.autoUpload?(v(),c("div",J,[m("button",{type:"button",class:"upload-btn primary",disabled:le.value>0,onClick:fe},b(le.value>0?`上传中... (${le.value})`:"开始上传"),9,X),m("button",{type:"button",class:"upload-btn secondary",onClick:me}," 取消 ")])):f("",!0),m("audio",{ref_key:"audioPlayer",ref:d,onTimeupdate:ge,onEnded:ye},null,544)]))}}),[["__scopeId","data-v-46e09b4c"]]),le={class:"demo-content"},ae={class:"popup-content"},te={key:0,class:"audio-info"},oe={class:"popup-content"},ue={class:"popup-content"},ie={class:"popup-content"},se={key:0,class:"duration-info"},de={class:"popup-content"},ne={class:"popup-content"},pe={key:0,class:"format-info"},re={class:"popup-content"},ce={class:"popup-content"},ve={class:"popup-content"},me={class:"popup-content"},fe={class:"popup-content"},we=i(d({__name:"audio-upload-demo",setup(u){const i=n(!1),d=n(!1),p=n(!1),r=n(!1),w=n(!1),y=n(!1),U=n(!1),C=n(!1),$=n(!1),x=n(!1),_=n(!1),M=n([]),L=n([]),j=n([]),I=n([]),P=n([]),S=n([]),z=n([]),R=n([]),B=n([]),G=n([]),O=n([]),W=n([]),E=(e,l)=>{s(`音频上传成功: ${e.name}`)},F=e=>{s(`开始播放: ${e.name}`)},D=e=>{s(`暂停播放: ${e.name}`)},T=e=>{s(`播放结束: ${e.name}`)},N=(e,l)=>{l&&l.duration&&W.value.push({fileName:e.name,duration:l.duration})},q=(e,l)=>{s(`音频时长超出限制: ${e.name}`)},K=(e,l)=>{s(`音乐上传成功: ${e.name}`)},Q=(e,l)=>{s(`语音消息上传成功: ${e.name}`)},Y=(e,l)=>{s(`播客音频上传成功: ${e.name}`)};return(u,s)=>{const n=t,Z=l,H=a,J=e;return v(),g(J,{"safe-area":"",scrollable:"","theme-mode":"auto"},{header:A(()=>[V(n,{title:"音频上传组件演示","left-text":"返回","left-arrow":"",onClickLeft:s[0]||(s[0]=e=>u.$router.back())})]),default:A(()=>[m("div",le,[V(H,{title:"基础功能演示"},{default:A(()=>[V(Z,{title:"单个音频上传","is-link":"",onClick:s[1]||(s[1]=e=>i.value=!0)}),V(Z,{title:"多个音频上传","is-link":"",onClick:s[2]||(s[2]=e=>d.value=!0)}),V(Z,{title:"音频播放控制","is-link":"",onClick:s[3]||(s[3]=e=>p.value=!0)}),V(Z,{title:"音频时长检测","is-link":"",onClick:s[4]||(s[4]=e=>r.value=!0)})]),_:1}),V(H,{title:"高级功能演示"},{default:A(()=>[V(Z,{title:"波形显示效果","is-link":"",onClick:s[5]||(s[5]=e=>w.value=!0)}),V(Z,{title:"音频格式识别","is-link":"",onClick:s[6]||(s[6]=e=>y.value=!0)}),V(Z,{title:"音频时长限制","is-link":"",onClick:s[7]||(s[7]=e=>U.value=!0)}),V(Z,{title:"播放状态管理","is-link":"",onClick:s[8]||(s[8]=e=>C.value=!0)})]),_:1}),V(H,{title:"特殊场景演示"},{default:A(()=>[V(Z,{title:"音乐上传","is-link":"",onClick:s[9]||(s[9]=e=>$.value=!0)}),V(Z,{title:"语音消息上传","is-link":"",onClick:s[10]||(s[10]=e=>x.value=!0)}),V(Z,{title:"播客音频上传","is-link":"",onClick:s[11]||(s[11]=e=>_.value=!0)})]),_:1})]),V(o,{show:i.value,"onUpdate:show":s[13]||(s[13]=e=>i.value=e),position:"center",title:"单个音频上传",width:450},{default:A(()=>[m("div",ae,[V(ee,{modelValue:M.value,"onUpdate:modelValue":s[12]||(s[12]=e=>M.value=e),multiple:!1,"auto-upload":!0,title:"选择单个音频",subtitle:"支持MP3、WAV、OGG等格式",onUploadSuccess:E,onAudioPlay:F},null,8,["modelValue"]),M.value.length>0?(v(),c("div",te,[m("p",null,"已选择音频: "+b(M.value.length)+" 个",1)])):f("",!0)])]),_:1},8,["show"]),V(o,{show:d.value,"onUpdate:show":s[15]||(s[15]=e=>d.value=e),position:"center",title:"多个音频上传",width:550},{default:A(()=>[m("div",oe,[V(ee,{modelValue:L.value,"onUpdate:modelValue":s[14]||(s[14]=e=>L.value=e),multiple:!0,"auto-upload":!0,"max-count":5,"max-size":52428800,title:"选择多个音频",subtitle:"最多5个音频，每个最大50MB",onUploadSuccess:E},null,8,["modelValue"])])]),_:1},8,["show"]),V(o,{show:p.value,"onUpdate:show":s[17]||(s[17]=e=>p.value=e),position:"center",title:"音频播放控制",width:600},{default:A(()=>[m("div",ue,[V(ee,{modelValue:j.value,"onUpdate:modelValue":s[16]||(s[16]=e=>j.value=e),multiple:!0,"auto-upload":!1,title:"播放控制演示",subtitle:"支持播放、暂停、停止控制",onAudioPlay:F,onAudioPause:D,onAudioEnded:T},null,8,["modelValue"]),s[34]||(s[34]=m("div",{class:"play-control-info"},[m("h4",null,"播放控制功能:"),m("ul",null,[m("li",null,"点击播放按钮开始播放"),m("li",null,"播放时显示暂停按钮"),m("li",null,"支持播放状态管理")])],-1))])]),_:1},8,["show"]),V(o,{show:r.value,"onUpdate:show":s[19]||(s[19]=e=>r.value=e),position:"center",title:"音频时长检测",width:550},{default:A(()=>[m("div",ie,[V(ee,{modelValue:I.value,"onUpdate:modelValue":s[18]||(s[18]=e=>I.value=e),multiple:!0,"auto-upload":!1,title:"时长检测演示",subtitle:"自动检测音频时长信息",onAudioMetadata:N},null,8,["modelValue"]),W.value.length>0?(v(),c("div",se,[s[35]||(s[35]=m("h4",null,"音频时长:",-1)),(v(!0),c(h,null,k(W.value,e=>{return v(),c("div",{key:e.fileName,class:"duration-item"},[m("span",null,b(e.fileName),1),m("span",null,b((l=e.duration,`${Math.floor(l/60)}:${Math.floor(l%60).toString().padStart(2,"0")}`)),1)]);var l}),128))])):f("",!0)])]),_:1},8,["show"]),V(o,{show:w.value,"onUpdate:show":s[21]||(s[21]=e=>w.value=e),position:"center",title:"波形显示效果",width:600},{default:A(()=>[m("div",de,[V(ee,{modelValue:P.value,"onUpdate:modelValue":s[20]||(s[20]=e=>P.value=e),multiple:!0,"auto-upload":!1,title:"波形显示演示",subtitle:"播放时显示动态波形效果"},null,8,["modelValue"]),s[36]||(s[36]=m("div",{class:"waveform-info"},[m("h4",null,"波形显示功能:"),m("ul",null,[m("li",null,"播放时显示动态波形"),m("li",null,"增强音频播放体验"),m("li",null,"可视化音频播放状态")])],-1))])]),_:1},8,["show"]),V(o,{show:y.value,"onUpdate:show":s[23]||(s[23]=e=>y.value=e),position:"center",title:"音频格式识别",width:550},{default:A(()=>[m("div",ne,[V(ee,{modelValue:S.value,"onUpdate:modelValue":s[22]||(s[22]=e=>S.value=e),multiple:!0,"auto-upload":!1,title:"格式识别演示",subtitle:"自动识别音频文件格式"},null,8,["modelValue"]),S.value.length>0?(v(),c("div",pe,[...s[37]||(s[37]=[m("h4",null,"支持的音频格式:",-1),m("ul",null,[m("li",null,"MP3 - MPEG Audio Layer III"),m("li",null,"WAV - Waveform Audio File Format"),m("li",null,"OGG - Ogg Vorbis"),m("li",null,"AAC - Advanced Audio Coding"),m("li",null,"FLAC - Free Lossless Audio Codec"),m("li",null,"M4A - MPEG-4 Audio"),m("li",null,"WMA - Windows Media Audio")],-1)])])):f("",!0)])]),_:1},8,["show"]),V(o,{show:U.value,"onUpdate:show":s[25]||(s[25]=e=>U.value=e),position:"center",title:"音频时长限制",width:500},{default:A(()=>[m("div",re,[V(ee,{modelValue:z.value,"onUpdate:modelValue":s[24]||(s[24]=e=>z.value=e),multiple:!0,"auto-upload":!0,"max-duration":300,title:"时长限制演示",subtitle:"最大时长: 5分钟",onUploadError:q},null,8,["modelValue"]),s[38]||(s[38]=m("div",{class:"limit-info"},[m("p",null,"时长限制: 5分钟"),m("p",null,"超过限制的音频将被拒绝")],-1))])]),_:1},8,["show"]),V(o,{show:C.value,"onUpdate:show":s[27]||(s[27]=e=>C.value=e),position:"center",title:"播放状态管理",width:600},{default:A(()=>[m("div",ce,[V(ee,{modelValue:R.value,"onUpdate:modelValue":s[26]||(s[26]=e=>R.value=e),multiple:!0,"auto-upload":!1,title:"播放状态管理",subtitle:"管理多个音频的播放状态"},null,8,["modelValue"]),s[39]||(s[39]=m("div",{class:"playback-state-info"},[m("h4",null,"播放状态管理:"),m("ul",null,[m("li",null,"同时只能播放一个音频"),m("li",null,"播放状态自动切换"),m("li",null,"高亮显示当前播放项")])],-1))])]),_:1},8,["show"]),V(o,{show:$.value,"onUpdate:show":s[29]||(s[29]=e=>$.value=e),position:"center",title:"音乐上传",width:500},{default:A(()=>[m("div",ve,[V(ee,{modelValue:B.value,"onUpdate:modelValue":s[28]||(s[28]=e=>B.value=e),multiple:!0,"auto-upload":!0,"max-duration":600,"max-size":20971520,title:"音乐上传",subtitle:"最大时长: 10分钟，最大文件: 20MB",onUploadSuccess:K},null,8,["modelValue"]),s[40]||(s[40]=m("div",{class:"music-tips"},[m("p",null,"音乐上传要求:"),m("ul",null,[m("li",null,"支持主流音乐格式"),m("li",null,"音质清晰，无杂音"),m("li",null,"文件大小适中")])],-1))])]),_:1},8,["show"]),V(o,{show:x.value,"onUpdate:show":s[31]||(s[31]=e=>x.value=e),position:"center",title:"语音消息上传",width:500},{default:A(()=>[m("div",me,[V(ee,{modelValue:G.value,"onUpdate:modelValue":s[30]||(s[30]=e=>G.value=e),multiple:!0,"auto-upload":!0,"max-duration":60,"max-size":5242880,title:"语音消息上传",subtitle:"最大时长: 1分钟，最大文件: 5MB",onUploadSuccess:Q},null,8,["modelValue"]),s[41]||(s[41]=m("div",{class:"voice-message-tips"},[m("p",null,"语音消息要求:"),m("ul",null,[m("li",null,"时长不超过1分钟"),m("li",null,"声音清晰可辨"),m("li",null,"文件体积小")])],-1))])]),_:1},8,["show"]),V(o,{show:_.value,"onUpdate:show":s[33]||(s[33]=e=>_.value=e),position:"center",title:"播客音频上传",width:550},{default:A(()=>[m("div",fe,[V(ee,{modelValue:O.value,"onUpdate:modelValue":s[32]||(s[32]=e=>O.value=e),multiple:!0,"auto-upload":!0,"max-duration":3600,"max-size":104857600,title:"播客音频上传",subtitle:"最大时长: 60分钟，最大文件: 100MB",onUploadSuccess:Y},null,8,["modelValue"]),s[42]||(s[42]=m("div",{class:"podcast-tips"},[m("p",null,"播客音频要求:"),m("ul",null,[m("li",null,"时长可长达60分钟"),m("li",null,"音质清晰，内容完整"),m("li",null,"支持长时间播放")])],-1))])]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-e45d2dda"]]);export{we as default};
