import{S as e}from"./sdkwork-page-container-BRaEsQRK.js";import{k as a,f as t,r as o,w as l,P as s,Q as i,S as n,W as r,Z as d,j as c,$ as u,a1 as m,a0 as p,a4 as g,R as h,V as v,c as f,O as k}from"./vue-vendor-Caw1HGjZ.js";import{B as b,I as w,s as y,a as C,_ as x,u as V}from"./index-cvC_tnhK.js";/* empty css              */import{_ as j,a as _}from"./sdkwork-collapse-item-DrMoP02P.js";import{_ as M}from"./sdkwork-popup-Ci2GCqJ_.js";/* empty css              */import"./index-B94OLouJ.js";import{P as z}from"./index-CoT1pAjB.js";import{S as B}from"./index-BzNAqEYs.js";import{_ as I,a as A}from"./sdkwork-cell-group-DKtTeeiN.js";/* empty css              *//* empty css              */import{S as U}from"./sdkwork-voice-speaker-category-list-popup-Cr-BtClw.js";import{I as F}from"./index-CIBl8yxY.js";import{U as $}from"./sdkwork-voice-clone-Cy1om8uU.js";import{A as P}from"./agent-CvvD-ZQx.js";import{F as T}from"./index-BVWiadPR.js";import"./utils-vendor-WEzSe-CR.js";import"./index-Cq1eIEYb.js";import"./sdkwork-icon-BpWgxdDo.js";import"./sdkwork-pull-refresh-YNUaOfXh.js";import"./shared-De6c5qv7.js";import"./sdkwork-search-bar-DI1Gd5vW.js";import"./index-D-Jc6MLP.js";import"./use-id-BN10QhF_.js";import"./ListItem-BWehXlMA.js";import"./LoadingSection-O6xMALgJ.js";import"./LoadMoreSection-DY2vX0Rr.js";const H={class:"sdkwork-avatar"},S={key:0,class:"upload-overlay"},q={class:"progress-text"},G={class:"placeholder-text"},L={key:3,class:"avatar-actions"},O=x(a({__name:"sdkwork-avatar",props:{modelValue:{},src:{},size:{default:"40px"},uploadable:{type:Boolean,default:!0},showAiGenerate:{type:Boolean,default:!1},round:{type:Boolean,default:!0},text:{default:""},background:{default:"#f5f5f5"},disabled:{type:Boolean,default:!1},showClear:{type:Boolean,default:!1},uploadConfig:{}},emits:["update:modelValue","upload","upload-start","upload-progress","upload-complete","upload-error","aiGenerate","click","clear"],setup(e,{emit:a}){const f=e,k=a,x=t({get:()=>f.modelValue||f.src,set:e=>k("update:modelValue",e||"")}),V=o(!1),j=o(0),_=o(null),M=o(null),z=async e=>{let a=null;if(e instanceof File)a=e;else if(e&&e.file instanceof File)a=e.file;else if(e&&e.content&&e.content instanceof File)a=e.content;else if(Array.isArray(e)&&e.length>0){const t=e[0];t.file instanceof File?a=t.file:t.content instanceof File&&(a=t.content)}if(!a)return y("无效的文件格式"),!1;if(!a.type?.startsWith("image/"))return y("请上传图片文件"),!1;if(a.size>5242880)return y("图片大小不能超过5MB"),!1;const t=new FileReader;return t.onload=e=>{const a=e.target?.result;x.value=a},t.readAsDataURL(a),k("upload",a),await B(a),!0},B=async e=>{if(window.$uploader)try{V.value=!0,j.value=0,k("upload-start",e);const a=f.uploadConfig||{},t={file:e,bucket:a.bucket||{name:"public"},name:e.name,scene:"avatar",metadata:a.metadata||{},contentType:a.contentType||e.type,acl:a.acl||"public-read"},o=await window.$uploader.upload(t,e=>{j.value=e.percentage,k("upload-progress",e)});o.taskId&&(_.value=o.taskId),o.url&&o.url.startsWith("http")?(x.value=o.url,y("头像上传成功"),k("upload-complete",o)):y("头像上传完成，但URL无效")}catch(a){y("头像上传失败，请重试"),k("upload-error",a)}finally{V.value=!1,j.value=0}else y("上传器未初始化")},I=()=>{V.value&&window.$uploader&&(_.value?window.$uploader.cancel(_.value):window.$uploader.cancelAll(),V.value=!1,j.value=0,_.value=null,y("上传已取消"),x.value="")},A=()=>{C({title:"AI生成头像",message:"确定要使用AI生成头像吗？",showCancelButton:!0,confirmButtonText:"生成",cancelButtonText:"取消"}).then(()=>{k("aiGenerate"),y("正在生成头像...")})},U=()=>{!f.disabled&&x.value&&C({title:"清空头像",message:"确定要清空当前头像吗？",showCancelButton:!0,confirmButtonText:"清空",cancelButtonText:"取消"}).then(()=>{x.value="",y("头像已清空"),k("clear")})},P=()=>{f.disabled||!f.uploadable||V.value||setTimeout(()=>{if(M.value)M.value.chooseFile();else{const e=document.querySelector('.upload-btn input[type="file"]');e&&e.click()}},10),k("click")},T=t(()=>({width:"number"==typeof f.size?`${f.size}px`:f.size,height:"number"==typeof f.size?`${f.size}px`:f.size,backgroundColor:f.background}));return l(()=>f.src,e=>{f.modelValue||(x.value=e)}),l(()=>f.modelValue,e=>{x.value=e}),(a,t)=>{const o=b,l=w,f=F,k=$;return i(),s("div",H,[n("div",{class:"avatar-container",onClick:P},[V.value?(i(),s("div",S,[t[3]||(t[3]=n("div",{class:"loading-spinner"},null,-1)),n("div",q,u(j.value)+"%",1),c(o,{type:"danger",onClick:m(I,["stop"]),class:"cancel-btn"},{default:p(()=>[...t[2]||(t[2]=[g(" 取消 ",-1)])]),_:1})])):r("",!0),x.value?(i(),d(f,{key:1,src:x.value,width:e.size,height:e.size,fit:"cover",class:h([{disabled:e.disabled,round:e.round,square:!e.round,uploading:V.value},"avatar-image"])},{extra:p(()=>[e.showClear&&!V.value?(i(),s("div",{key:0,class:"clear-btn",onClick:m(U,["stop"])},[c(l,{name:"cross",size:"12",color:"#fff"})])):r("",!0)]),_:1},8,["src","width","height","class"])):(i(),s("div",{key:2,class:h(["avatar-placeholder",{round:e.round,square:!e.round,uploading:V.value}]),style:v(T.value)},[n("span",G,u(e.text),1)],6)),!e.uploadable&&!e.showAiGenerate||V.value?r("",!0):(i(),s("div",L,[e.uploadable?(i(),d(k,{key:0,disabled:e.disabled,"after-read":z,"max-count":1,"preview-image":!1,"show-upload":!1,accept:"image/*",class:"upload-btn",ref_key:"uploaderRef",ref:M,onClick:t[1]||(t[1]=m(()=>{},["stop"]))},{default:p(()=>[c(o,{type:"primary",disabled:e.disabled,class:"action-btn",onClick:t[0]||(t[0]=m(()=>{},["stop"]))},{default:p(()=>[...t[4]||(t[4]=[g(" 上传 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):r("",!0),e.showAiGenerate?(i(),d(o,{key:1,type:"success",disabled:e.disabled,onClick:A,class:"action-btn ai-generate-btn"},{default:p(()=>[...t[5]||(t[5]=[g(" AI生成 ",-1)])]),_:1},8,["disabled"])):r("",!0)]))])])}}}),[["__scopeId","data-v-24222b83"]]),R={class:"header-section"},D={class:"avatar-container"},W={class:"name-field-wrapper"},K={class:"char-count-bottom"},N={class:"prompt-field-wrapper"},E={class:"char-count-bottom"},Q={class:"char-count"},Z={class:"voice-selector"},J={key:0,class:"selected-voice"},X={key:1,class:"placeholder"},Y={class:"description-field-wrapper"},ee={class:"char-count-bottom"},ae={class:"welcome-field-wrapper"},te={class:"char-count-bottom"},oe={class:"char-count"},le={class:"permission-value"},se={class:"bottom-action-bar"},ie=x(a({__name:"sdkwork-agent-create",props:{themeMode:{default:"auto"}},emits:["agent-created","agent-canceled"],setup(e,{expose:a,emit:l}){const m=e,v=t(()=>"dark"===m.themeMode||"light"!==m.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),k=t(()=>v.value?"sdkwork-agent-create--dark":"sdkwork-agent-create--light"),C=o(!1),x=o(!1),V=o(!1),F=o([]),$=o(""),H=o(""),S=o(["view"]),q=new P,G=t(()=>"100%"),L=[{text:"查看",value:"view"},{text:"交互",value:"interact"},{text:"分享",value:"share"}],ie=o(""),ne=f({name:"",description:"",isPublic:!1,permissions:[],prompt:{content:""},greeting:"",baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),re=t(()=>ne.name.trim()&&ne.name.length<=20&&ne.description.length<=200),de=()=>{ne.name.trim()?ne.name.length>20?$.value="名称不能超过20个字符":$.value="":$.value="名称不能为空"},ce=e=>{ne.faceImage={url:ie.value,type:1,size:e.size},y("头像上传成功")},ue=()=>{},me=e=>{const a={id:e.id?.toString(),displayName:e.name,description:e.description,provider:"default",product:"default",model:"default",voice:e.name};ne.speechConfig={speakerConfig:{speaker:a}},x.value=!1,y(`已选择: ${e.name}`)},pe=e=>{if(!e||0===e.length)return"";const a=L.find(a=>a.value===e[0]);return a?a.text:""},ge=e=>{let a;a=Array.isArray(e)?e[0]:e&&"object"==typeof e?e:{text:e,value:e},ne.permissions=a.value||a,V.value=!1,y(`已选择: ${a.text||a}`)},he=async()=>{if(de(),!$.value&&ne.name.trim()){C.value=!0;try{ie.value&&!ne.faceImage&&(ne.faceImage={url:ie.value,type:1,size:0});const e={name:ne.name,description:ne.description,faceImage:ne.faceImage,faceVideo:ne.faceVideo,icon:ne.icon,tags:ne.tags,prompt:ne.prompt,greeting:ne.greeting,speechConfig:ne.speechConfig,isPublic:ne.isPublic,permissions:ne.permissions,baseConfig:ne.baseConfig,type:ne.type,status:ne.status,knowledgeConfig:ne.knowledgeConfig,memoryConfig:ne.memoryConfig,toolConfig:ne.toolConfig,chatOptions:ne.chatOptions};q.create(e),y("智能体创建成功")}catch(e){y("创建失败，请重试")}finally{C.value=!1}}else y("请完善基本信息")};return a({resetForm:()=>{ie.value="",Object.assign(ne,{name:"",description:"",faceImage:void 0,faceVideo:void 0,icon:void 0,tags:void 0,prompt:{content:""},greeting:"",speechConfig:void 0,isPublic:!1,permissions:[],baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),F.value=[]},getFormData:()=>ne,setFormData:e=>{Object.assign(ne,e)}}),(a,t)=>{const o=T,l=I,m=w,v=A,f=B,y=z,P=M,q=j,ve=_,fe=b;return i(),s("div",{class:h(["agent-create",k.value])},[n("div",R,[n("div",D,[c(O,{modelValue:ie.value,"onUpdate:modelValue":t[0]||(t[0]=e=>ie.value=e),size:80,uploadable:!0,"show-ai-generate":!1,round:!0,text:"头像","theme-mode":e.themeMode,onUpload:ce,onClick:ue,class:"avatar-uploader"},null,8,["modelValue","theme-mode"])]),c(l,{class:"name-section","theme-mode":e.themeMode},{default:p(()=>[n("div",W,[c(o,{modelValue:ne.name,"onUpdate:modelValue":t[1]||(t[1]=e=>ne.name=e),placeholder:"请输入智能体名称",maxlength:20,"error-message":$.value,size:"large",onBlur:de,center:""},null,8,["modelValue","error-message"]),n("div",K,[n("span",{class:h(["char-count",{error:ne.name.length>20}])},u(ne.name.length)+"/20 ",3)])])]),_:1},8,["theme-mode"])]),c(l,{class:"basic-info-section","theme-mode":e.themeMode},{default:p(()=>[n("div",N,[c(o,{modelValue:ne.prompt.content,"onUpdate:modelValue":t[2]||(t[2]=e=>ne.prompt.content=e),label:"提示词","label-align":"top",type:"textarea",placeholder:"请输入角色提示词",autosize:{minHeight:100,maxHeight:200},maxlength:1e3},null,8,["modelValue"]),n("div",E,[n("span",Q,u(ne.prompt.content?.length||0)+"/1000 ",1)])])]),_:1},8,["theme-mode"]),c(l,{class:"voice-section","theme-mode":e.themeMode},{default:p(()=>[c(v,{title:"发音人",center:"","is-link":"",onClick:t[3]||(t[3]=e=>x.value=!0),"theme-mode":e.themeMode},{value:p(()=>[n("div",Z,[c(m,{name:"music",class:"voice-icon"}),ne.speechConfig?.speakerConfig?.speaker?(i(),s("span",J,u(ne.speechConfig.speakerConfig.speaker.displayName),1)):(i(),s("span",X,"请选择发音人"))])]),_:1},8,["theme-mode"]),n("div",Y,[c(o,{modelValue:ne.description,"onUpdate:modelValue":t[4]||(t[4]=e=>ne.description=e),label:"描述","label-align":"top",type:"textarea",placeholder:"请输入智能体描述",maxlength:200,autosize:{minHeight:80,maxHeight:120},"error-message":H.value},null,8,["modelValue","error-message"]),n("div",ee,[n("span",{class:h(["char-count",{error:ne.description.length>200}])},u(ne.description.length)+"/200 ",3)])])]),_:1},8,["theme-mode"]),c(ve,{modelValue:F.value,"onUpdate:modelValue":t[11]||(t[11]=e=>F.value=e),class:"other-settings-section","theme-mode":e.themeMode},{default:p(()=>[c(q,{title:"其他设置",name:"other","theme-mode":e.themeMode},{default:p(()=>[n("div",ae,[c(o,{modelValue:ne.baseConfig.welcome,"onUpdate:modelValue":t[5]||(t[5]=e=>ne.baseConfig.welcome=e),label:"默认开场白","label-align":"top",type:"textarea",placeholder:"请输入默认开场白",autosize:{minHeight:80,maxHeight:120},maxlength:500},null,8,["modelValue"]),n("div",te,[n("span",oe,u(ne.baseConfig?.welcome?.length||0)+"/500 ",1)])]),c(l,{"theme-mode":e.themeMode},{default:p(()=>[c(v,{title:"公开智能体",center:"","theme-mode":e.themeMode},{value:p(()=>[c(f,{modelValue:ne.isPublic,"onUpdate:modelValue":t[6]||(t[6]=e=>ne.isPublic=e),size:"20"},null,8,["modelValue"])]),_:1},8,["theme-mode"]),ne.isPublic?(i(),d(v,{key:0,title:"权限设置",center:"","is-link":"",onClick:t[7]||(t[7]=e=>V.value=!0),"theme-mode":e.themeMode},{value:p(()=>[n("span",le,u(pe(ne.permissions)||"请选择权限"),1)]),_:1},8,["theme-mode"])):r("",!0),c(P,{show:V.value,"onUpdate:show":t[10]||(t[10]=e=>V.value=e),position:"bottom",round:"","theme-mode":e.themeMode},{default:p(()=>[c(y,{columns:L,modelValue:S.value,"onUpdate:modelValue":t[8]||(t[8]=e=>S.value=e),onConfirm:ge,onCancel:t[9]||(t[9]=e=>V.value=!1),title:"选择权限"},null,8,["modelValue"])]),_:1},8,["show","theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["modelValue","theme-mode"]),n("div",se,[c(fe,{type:"primary",size:"large",block:"",loading:C.value,disabled:!re.value,onClick:he,class:"create-button"},{default:p(()=>[...t[14]||(t[14]=[g(" 创建智能体 ",-1)])]),_:1},8,["loading","disabled"])]),c(U,{modelValue:x.value,"onUpdate:modelValue":t[12]||(t[12]=e=>x.value=e),title:"选择发音人",height:G.value,"selected-speaker-id":ne.speechConfig?.speakerConfig?.speaker?.id,"theme-mode":e.themeMode,onConfirm:me,onClose:t[13]||(t[13]=e=>x.value=!1)},null,8,["modelValue","height","selected-speaker-id","theme-mode"])],2)}}}),[["__scopeId","data-v-4243fd2e"]]),ne=x(a({__name:"create",setup(a){const l=k(),{t:s}=V(),n=o("auto");t(()=>"dark"===n.value||"light"!==n.value&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches));const r=e=>{y({message:s("agent.create.successMessage"),type:"success",duration:2e3}),setTimeout(()=>{l.push("/agent/list")},2e3)},u=()=>{y({message:s("agent.create.cancelMessage"),type:"fail",duration:1500}),setTimeout(()=>{l.back()},1500)};return(a,t)=>{const o=e;return i(),d(o,{class:"agent-create-page"},{default:p(()=>[c(ie,{onAgentCreated:r,onAgentCanceled:u,"theme-mode":n.value,class:"agent-create-component"},null,8,["theme-mode"])]),_:1})}}}),[["__scopeId","data-v-6e8fcb31"]]);export{ne as default};
