import{L as e,I as t,_ as s}from"./index-34815b62.js";import{F as n}from"./index-92d7bfa9.js";import{E as a}from"./index-3ae7521b.js";import{z as i,k as r,O as o,r as c,b as l,o as d,Q as g,Z as h,a0 as u,j as p,S as m,a4 as f}from"./vue-vendor-905d75e5.js";import{A as y}from"./agent-6e7e2348.js";import{u as w}from"./conversation-fd40c340.js";import{_ as A}from"./sdkwork-agent-list-c61d8d84.js";import{S as L}from"./sdkwork-page-container-ebfa2fb2.js";import{b as j}from"./route-block-83d24a4e.js";import"./utils-vendor-b5712723.js";import"./use-id-350fcd7b.js";import"./sdkwork-api-list-7d9e01ff.js";import"./index-8ec85bf4.js";import"./index-7b99c785.js";import"./use-tab-status-c1e0ad5e.js";import"./shared-f3996f0d.js";import"./sdkwork-search-bar-d9125bb7.js";import"./sdkwork-icon-79456167.js";import"./ListItem-b2f4f4bf.js";/* empty css              *//* empty css              *//* empty css              */import"./index-89cf3eae.js";import"./index-bb873dec.js";import"./Checker-98b4e961.js";const I=i("agent",{state:()=>({agents:[],selectedAgentId:null,ui:{searchQuery:"",isLoading:!1}}),getters:{selectedAgent:e=>e.selectedAgentId?e.agents.find(t=>t.id===e.selectedAgentId):null,filteredAgents:e=>{const t=e.ui.searchQuery.toLowerCase().trim();return t?e.agents.filter(e=>e.name?.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags?.tags?.some(e=>e.toLowerCase().includes(t))):e.agents},agentsByStatus:e=>{const t={active:[],inactive:[],draft:[]};return e.agents.forEach(e=>{switch(e.status){case"ACTIVE":t.active.push(e);break;case"INACTIVE":default:t.inactive.push(e);break;case"DRAFT":t.draft.push(e)}}),t}},actions:{setSearchQuery(e){this.ui.searchQuery=e},setLoading(e){this.ui.isLoading=e},selectAgent(e){this.selectedAgentId=e},async createAgent(e){try{this.setLoading(!0);const t=new y,s=await t.create(e);return this.agents.push(s),this.selectAgent(s.id?.toString()||null),s}catch(t){throw console.error("创建智能体失败:",t),t}finally{this.setLoading(!1)}},async updateAgent(e){try{this.setLoading(!0);const t=new y,s=await t.update(e),n=this.agents.findIndex(e=>e.id===s.id);return-1!==n&&(this.agents[n]=s),s}catch(t){throw console.error("更新智能体失败:",t),t}finally{this.setLoading(!1)}},async retrieveAgent(e){try{this.setLoading(!0);const t=new y,s=await t.retrieve(e),n=this.agents.findIndex(e=>e.id===s.id);return-1!==n?this.agents[n]=s:this.agents.push(s),s}catch(t){throw console.error("获取智能体详情失败:",t),t}finally{this.setLoading(!1)}},async deleteAgent(e){try{this.setLoading(!0);const t=new y,s=await t.delete(e);return s&&(this.agents=this.agents.filter(t=>t.id!==e),this.selectedAgentId===e.toString()&&this.selectAgent(null)),s}catch(t){throw console.error("删除智能体失败:",t),t}finally{this.setLoading(!1)}},async list(e,t){try{this.setLoading(!0);const s=new y;null==(t=t||{page:0,size:10}).page&&(t.page=0),null==t.size&&(t.size=10);const n=await s.listByPage(e,t);if(0===t?.page)this.agents=n.content||[];else{const e=new Set(this.agents.map(e=>e.id)),t=(n.content||[]).filter(t=>!e.has(t.id));this.agents.push(...t)}return n}catch(s){throw console.error("获取智能体列表失败:",s),s}finally{this.setLoading(!1)}},async listPublic(e,t){try{this.setLoading(!0);const s=new y;null==(t=t||{page:0,size:10}).page&&(t.page=0),null==t.size&&(t.size=10);const n=await s.listPublic(e,t);if(0===t?.page)this.agents=n.content||[];else{const e=new Set(this.agents.map(e=>e.id)),t=(n.content||[]).filter(t=>!e.has(t.id));this.agents.push(...t)}return n}catch(s){throw console.error("获取智能体列表失败:",s),s}finally{this.setLoading(!1)}},async toggleAgentStatus(e){try{const t=this.agents.find(t=>t.id===e);if(!t)throw new Error("智能体不存在");const s="ACTIVE"===t.status?"INACTIVE":"ACTIVE",n={...t,status:s};return await this.updateAgent(n)}catch(t){throw console.error("切换智能体状态失败:",t),t}},getAgentsByCategory(e){return this.agents.filter(t=>t.categoryId===e)},getAgentsByType(e){return this.agents.filter(t=>t.type===e)},clearAgents(){this.agents=[],this.selectAgent(null)},reset(){this.agents=[],this.selectedAgentId=null,this.ui.searchQuery="",this.ui.isLoading=!1}}}),v=r({__name:"agents",setup(s){const i=o(),r=I(),y=w(),j=c(),v=c({x:0,y:0}),x=()=>{const e=window.innerWidth,t=window.innerHeight;v.value={x:e-60-2,y:t-60-80}},b=async e=>{try{console.error("getAgentList:",e);return await r.listPublic({},e)}catch(t){return console.error("获取智能体列表失败:",t),{content:[],empty:!0,first:!0,last:!0,pageNumber:0,numberOfElements:0,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:0,totalPages:0}}},k=async e=>{try{const t=await y.open(e.id),s=t.uuid||t.id;i.push(`/chat/${s}?agentId=${e.id}&agentName=${encodeURIComponent(e.name||"")}`)}catch(t){console.error("创建会话失败:",t);const s=_();i.push(`/chat/${s}?agentId=${e.id}&agentName=${encodeURIComponent(e.name||"")}`)}},C=e=>{console.log("搜索智能体:",e)},z=e=>{console.log("智能体数据加载完成:",e)},E=()=>{i.push("/agent/create")},_=()=>window.$uuid();return l(()=>{console.log("智能体页面已加载"),x(),window.addEventListener("resize",x)}),d(()=>{window.removeEventListener("resize",x)}),(s,i)=>{const r=a,o=e,c=t,l=n;return g(),h(L,{"safe-area":"",scrollable:!1,"theme-mode":"auto"},{default:u(()=>[p(A,{api:b,params:{category:"all"},"page-size":10,searchable:!1,onClick:k,onSearch:C,onLoad:z,ref_key:"agentListRef",ref:j},{empty:u(()=>[p(r,{description:"暂无智能体",image:"search"},{description:u(()=>[...i[1]||(i[1]=[m("div",{class:"empty-description"},[m("p",null,"暂时没有找到智能体"),m("p",{class:"empty-tip"},"您可以尝试调整搜索条件")],-1)])]),_:1})]),loading:u(()=>[p(o,{size:"24px",vertical:""},{default:u(()=>[...i[2]||(i[2]=[f("加载智能体数据...",-1)])]),_:1})]),_:1},512),p(l,{offset:v.value,"onUpdate:offset":i[0]||(i[0]=e=>v.value=e),axis:"xy",magnetic:"x",class:"create-bubble",onClick:E},{default:u(()=>[p(c,{name:"plus",size:"24",color:"#fff"})]),_:1},8,["offset"])]),_:1})}}});"function"==typeof j&&j(v);const x=s(v,[["__scopeId","data-v-52fb1ddf"]]);export{x as default};
