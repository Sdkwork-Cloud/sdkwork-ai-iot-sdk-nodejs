import{k as e,Y as o,Z as a,H as t,W as i,n as s,$ as l,V as n,E as r,L as c,al as v,am as m,t as u,X as g,p as d,a5 as h,o as p,an as f,ao as w,T as x,P as b,a0 as y,I as C,af as O}from"./index-5affcab4.js";import{S as Z,a as X}from"./index-63936d32.js";import{I as Y}from"./index-4fcf5799.js";import{k as S,a as I,r as z,c as P,w as k,j as H,b as W,n as $,q as B}from"./vue-vendor-a2672387.js";const R=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),T=e("image-preview")[1];var j=S({props:{src:String,show:Boolean,active:Number,minZoom:i(s),maxZoom:i(s),rootWidth:i(Number),rootHeight:i(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean},emits:["scale","close","longPress"],setup(e,{emit:i,slots:s}){const u=I({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),g=o(),d=z(),h=z(),p=z(!1),f=z(!1);let w=0;const x=P(()=>{const{scale:e,moveX:o,moveY:a,moving:t,zooming:i,initializing:s}=u,l={transitionDuration:i||t||s?"0s":".3s"};return(1!==e||f.value)&&(l.transform=`matrix(${e}, 0, 0, ${e}, ${o}, ${a})`),l}),b=P(()=>{if(u.imageRatio){const{rootWidth:o,rootHeight:a}=e,t=p.value?a/u.imageRatio:o;return Math.max(0,(u.scale*t-o)/2)}return 0}),y=P(()=>{if(u.imageRatio){const{rootWidth:o,rootHeight:a}=e,t=p.value?a:o*u.imageRatio;return Math.max(0,(u.scale*t-a)/2)}return 0}),C=(o,a)=>{var t;if((o=n(o,+e.minZoom,+e.maxZoom+1))!==u.scale){const s=o/u.scale;if(u.scale=o,a){const e=v(null==(t=d.value)?void 0:t.$el),o={x:.5*e.width,y:.5*e.height},i=u.moveX-(a.x-e.left-o.x)*(s-1),l=u.moveY-(a.y-e.top-o.y)*(s-1);u.moveX=n(i,-b.value,b.value),u.moveY=n(l,-y.value,y.value)}else u.moveX=0,u.moveY=f.value?w:0;i("scale",{scale:o,index:e.active})}},O=()=>{C(1)};let X,S,W,$,B,j,D,M,N=!1;const L=o=>{const{touches:a}=o;if(X=a.length,2===X&&e.disableZoom)return;const{offsetX:t}=g;g.start(o),S=u.moveX,W=u.moveY,M=Date.now(),N=!1,u.moving=1===X&&(1!==u.scale||f.value),u.zooming=2===X&&!t.value,u.zooming&&($=u.scale,B=R(a))},E=o=>{var a;const t=null==(a=h.value)?void 0:a.$el;if(!t)return;const s=t.firstElementChild,l=o.target===t,n=null==s?void 0:s.contains(o.target);!e.closeOnClickImage&&n||!e.closeOnClickOverlay&&l||i("close")},q=o=>{if(X>1)return;const a=Date.now()-M;g.isTap.value&&(a<250?e.doubleScale?D?(clearTimeout(D),D=null,(()=>{const e=u.scale>1?1:2;C(e,2===e||f.value?{x:g.startX.value,y:g.startY.value}:void 0)})()):D=setTimeout(()=>{E(o),D=null},250):E(o):a>m&&i("longPress"))},V=o=>{let a=!1;if((u.moving||u.zooming)&&(a=!0,u.moving&&S===u.moveX&&W===u.moveY&&(a=!1),!o.touches.length)){u.zooming&&(u.moveX=n(u.moveX,-b.value,b.value),u.moveY=n(u.moveY,-y.value,y.value),u.zooming=!1),u.moving=!1,S=0,W=0,$=1,u.scale<1&&O();const o=+e.maxZoom;u.scale>o&&C(o,j)}l(o,a),q(o),g.reset()},F=()=>{const{rootWidth:o,rootHeight:a}=e,t=a/o,{imageRatio:i}=u;p.value=u.imageRatio>t&&i<2.6,f.value=u.imageRatio>t&&i>=2.6,f.value&&(w=(i*o-a)/2,u.moveY=w,u.initializing=!0,r(()=>{u.initializing=!1})),O()},U=e=>{const{naturalWidth:o,naturalHeight:a}=e.target;u.imageRatio=a/o,F()};return k(()=>e.active,O),k(()=>e.show,e=>{e||O()}),k(()=>[e.rootWidth,e.rootHeight],F),a("touchmove",o=>{const{touches:a}=o;if(g.move(o),u.moving){const{deltaX:a,deltaY:t}=g,i=a.value+S,s=t.value+W;if((e.vertical?g.isVertical()&&Math.abs(s)>y.value:g.isHorizontal()&&Math.abs(i)>b.value)&&!N)return void(u.moving=!1);N=!0,l(o,!0),u.moveX=n(i,-b.value,b.value),u.moveY=n(s,-y.value,y.value)}if(u.zooming&&(l(o,!0),2===a.length)){const e=R(a),o=$*e/B;j=(e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}))(a),C(o,j)}},{target:P(()=>{var e;return null==(e=h.value)?void 0:e.$el})}),t({resetScale:O}),()=>{const o={loading:()=>H(c,{type:"spinner"},null)};return H(Z,{ref:h,class:T("swipe-item"),onTouchstartPassive:L,onTouchend:V,onTouchcancel:V},{default:()=>[s.image?H("div",{class:T("image-wrap")},[s.image({src:e.src,onLoad:U,style:x.value})]):H(Y,{ref:d,src:e.src,fit:"contain",class:T("image",{vertical:p.value}),style:x.value,onLoad:U},o)]})}}});const[D,M]=e("image-preview"),N=["show","teleport","transition","overlayStyle","closeOnPopstate"];var L=S({name:D,props:{show:Boolean,loop:u,images:g(),minZoom:d(1/3),maxZoom:d(3),overlay:u,vertical:Boolean,closeable:Boolean,showIndex:u,className:h,closeIcon:p("clear"),transition:String,beforeClose:Function,doubleScale:u,overlayClass:h,overlayStyle:Object,swipeDuration:d(300),startPosition:d(0),showIndicators:Boolean,closeOnPopstate:u,closeOnClickImage:u,closeOnClickOverlay:u,closeIconPosition:p("top-right"),teleport:[String,Object]},emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:o,slots:a}){const i=z(),s=z(),l=I({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),n=()=>{if(i.value){const e=v(i.value.$el);l.rootWidth=e.width,l.rootHeight=e.height,i.value.resize()}},r=e=>o("scale",e),c=e=>o("update:show",e),m=()=>{O(e.beforeClose,{args:[l.active],done:()=>c(!1)})},u=e=>{e!==l.active&&(l.active=e,o("change",e))},g=()=>{if(e.showIndex)return H("div",{class:M("index")},[a.index?a.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},d=()=>{if(a.cover)return H("div",{class:M("cover")},[a.cover()])},h=()=>{l.disableZoom=!0},p=()=>{l.disableZoom=!1},Z=()=>{if(e.closeable)return H(C,{role:"button",name:e.closeIcon,class:[M("close-icon",e.closeIconPosition),y],onClick:m},null)},Y=()=>o("closed"),S=(e,o)=>{var a;return null==(a=i.value)?void 0:a.swipeTo(e,o)};return t({resetScale:()=>{var e;null==(e=s.value)||e.resetScale()},swipeTo:S}),W(n),k([f,w],n),k(()=>e.startPosition,e=>u(+e)),k(()=>e.show,a=>{const{images:t,startPosition:i}=e;a?(u(+i),$(()=>{n(),S(+i,{immediate:!0})})):o("close",{index:l.active,url:t[l.active]})}),()=>H(b,B({class:[M(),e.className],overlayClass:[M("overlay"),e.overlayClass],onClosed:Y,"onUpdate:show":c},x(e,N)),{default:()=>[Z(),H(X,{ref:i,lazyRender:!0,loop:e.loop,class:M("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:p,onDragStart:h},{default:()=>[e.images.map((t,i)=>H(j,{ref:e=>{i===l.active&&(s.value=e)},src:t,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:r,onClose:m,onLongPress:()=>o("longPress",{index:i})},{image:a.image}))]}),g(),d()]})}});export{L as s};
