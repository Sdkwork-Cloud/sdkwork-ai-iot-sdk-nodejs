import{m as e,O as o,Q as a,X as t,a4 as s,o as i,D as l,a3 as n,a2 as r,L as c,U as v,G as m,t as u,a5 as g,r as d,a9 as h,q as p,K as f,N as w,V as y,P as b,H as x,I as C,E as O,ah as Z,Z as I,ak as S,al as P,w as X}from"./index-2cafbb5e.js";import{k as Y,a as z,r as k,c as H,w as $,j as B,b as R,n as W,q as D}from"./vue-vendor-fce65f55.js";import{S as T,a as j}from"./index-4ce57344.js";import{I as N}from"./index-a5403cf2.js";const L=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),M=e("image-preview")[1];var q=Y({props:{src:String,show:Boolean,active:Number,minZoom:s(i),maxZoom:s(i),rootWidth:s(Number),rootHeight:s(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean},emits:["scale","close","longPress"],setup(e,{emit:s,slots:i}){const u=z({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),g=o(),d=k(),h=k(),p=k(!1),f=k(!1);let w=0;const y=H(()=>{const{scale:e,moveX:o,moveY:a,moving:t,zooming:s,initializing:i}=u,l={transitionDuration:s||t||i?"0s":".3s"};return(1!==e||f.value)&&(l.transform=`matrix(${e}, 0, 0, ${e}, ${o}, ${a})`),l}),b=H(()=>{if(u.imageRatio){const{rootWidth:o,rootHeight:a}=e,t=p.value?a/u.imageRatio:o;return Math.max(0,(u.scale*t-o)/2)}return 0}),x=H(()=>{if(u.imageRatio){const{rootWidth:o,rootHeight:a}=e,t=p.value?a:o*u.imageRatio;return Math.max(0,(u.scale*t-a)/2)}return 0}),C=(o,a)=>{var t;if((o=n(o,+e.minZoom,+e.maxZoom+1))!==u.scale){const i=o/u.scale;if(u.scale=o,a){const e=v(null==(t=d.value)?void 0:t.$el),o={x:.5*e.width,y:.5*e.height},s=u.moveX-(a.x-e.left-o.x)*(i-1),l=u.moveY-(a.y-e.top-o.y)*(i-1);u.moveX=n(s,-b.value,b.value),u.moveY=n(l,-x.value,x.value)}else u.moveX=0,u.moveY=f.value?w:0;s("scale",{scale:o,index:e.active})}},O=()=>{C(1)};let Z,I,S,P,X,Y,R,W,D=!1;const j=o=>{const{touches:a}=o;if(Z=a.length,2===Z&&e.disableZoom)return;const{offsetX:t}=g;g.start(o),I=u.moveX,S=u.moveY,W=Date.now(),D=!1,u.moving=1===Z&&(1!==u.scale||f.value),u.zooming=2===Z&&!t.value,u.zooming&&(P=u.scale,X=L(a))},q=o=>{var a;const t=null==(a=h.value)?void 0:a.$el;if(!t)return;const i=t.firstElementChild,l=o.target===t,n=null==i?void 0:i.contains(o.target);!e.closeOnClickImage&&n||!e.closeOnClickOverlay&&l||s("close")},E=o=>{if(Z>1)return;const a=Date.now()-W;g.isTap.value&&(a<250?e.doubleScale?R?(clearTimeout(R),R=null,(()=>{const e=u.scale>1?1:2;C(e,2===e||f.value?{x:g.startX.value,y:g.startY.value}:void 0)})()):R=setTimeout(()=>{q(o),R=null},250):q(o):a>m&&s("longPress"))},U=o=>{let a=!1;if((u.moving||u.zooming)&&(a=!0,u.moving&&I===u.moveX&&S===u.moveY&&(a=!1),!o.touches.length)){u.zooming&&(u.moveX=n(u.moveX,-b.value,b.value),u.moveY=n(u.moveY,-x.value,x.value),u.zooming=!1),u.moving=!1,I=0,S=0,P=1,u.scale<1&&O();const o=+e.maxZoom;u.scale>o&&C(o,Y)}l(o,a),E(o),g.reset()},A=()=>{const{rootWidth:o,rootHeight:a}=e,t=a/o,{imageRatio:s}=u;p.value=u.imageRatio>t&&s<2.6,f.value=u.imageRatio>t&&s>=2.6,f.value&&(w=(s*o-a)/2,u.moveY=w,u.initializing=!0,r(()=>{u.initializing=!1})),O()},V=e=>{const{naturalWidth:o,naturalHeight:a}=e.target;u.imageRatio=a/o,A()};return $(()=>e.active,O),$(()=>e.show,e=>{e||O()}),$(()=>[e.rootWidth,e.rootHeight],A),a("touchmove",o=>{const{touches:a}=o;if(g.move(o),u.moving){const{deltaX:a,deltaY:t}=g,s=a.value+I,i=t.value+S;if((e.vertical?g.isVertical()&&Math.abs(i)>x.value:g.isHorizontal()&&Math.abs(s)>b.value)&&!D)return void(u.moving=!1);D=!0,l(o,!0),u.moveX=n(s,-b.value,b.value),u.moveY=n(i,-x.value,x.value)}if(u.zooming&&(l(o,!0),2===a.length)){const e=L(a),o=P*e/X;Y=(e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}))(a),C(o,Y)}},{target:H(()=>{var e;return null==(e=h.value)?void 0:e.$el})}),t({resetScale:O}),()=>{const o={loading:()=>B(c,{type:"spinner"},null)};return B(T,{ref:h,class:M("swipe-item"),onTouchstartPassive:j,onTouchend:U,onTouchcancel:U},{default:()=>[i.image?B("div",{class:M("image-wrap")},[i.image({src:e.src,onLoad:V,style:y.value})]):B(N,{ref:d,src:e.src,fit:"contain",class:M("image",{vertical:p.value}),style:y.value,onLoad:V},o)]})}}});const[E,U]=e("image-preview"),A=["show","teleport","transition","overlayStyle","closeOnPopstate"];var V=Y({name:E,props:{show:Boolean,loop:u,images:g(),minZoom:d(1/3),maxZoom:d(3),overlay:u,vertical:Boolean,closeable:Boolean,showIndex:u,className:h,closeIcon:p("clear"),transition:String,beforeClose:Function,doubleScale:u,overlayClass:h,overlayStyle:Object,swipeDuration:d(300),startPosition:d(0),showIndicators:Boolean,closeOnPopstate:u,closeOnClickImage:u,closeOnClickOverlay:u,closeIconPosition:p("top-right"),teleport:[String,Object]},emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:o,slots:a}){const s=k(),i=k(),l=z({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),n=()=>{if(s.value){const e=v(s.value.$el);l.rootWidth=e.width,l.rootHeight=e.height,s.value.resize()}},r=e=>o("scale",e),c=e=>o("update:show",e),m=()=>{O(e.beforeClose,{args:[l.active],done:()=>c(!1)})},u=e=>{e!==l.active&&(l.active=e,o("change",e))},g=()=>{if(e.showIndex)return B("div",{class:U("index")},[a.index?a.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},d=()=>{if(a.cover)return B("div",{class:U("cover")},[a.cover()])},h=()=>{l.disableZoom=!0},p=()=>{l.disableZoom=!1},Z=()=>{if(e.closeable)return B(C,{role:"button",name:e.closeIcon,class:[U("close-icon",e.closeIconPosition),x],onClick:m},null)},I=()=>o("closed"),S=(e,o)=>{var a;return null==(a=s.value)?void 0:a.swipeTo(e,o)};return t({resetScale:()=>{var e;null==(e=i.value)||e.resetScale()},swipeTo:S}),R(n),$([f,w],n),$(()=>e.startPosition,e=>u(+e)),$(()=>e.show,a=>{const{images:t,startPosition:s}=e;a?(u(+s),W(()=>{n(),S(+s,{immediate:!0})})):o("close",{index:l.active,url:t[l.active]})}),()=>B(b,D({class:[U(),e.className],overlayClass:[U("overlay"),e.overlayClass],onClosed:I,"onUpdate:show":c},y(e,A)),{default:()=>[Z(),B(j,{ref:s,lazyRender:!0,loop:e.loop,class:U("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:p,onDragStart:h},{default:()=>[e.images.map((t,s)=>B(q,{ref:e=>{s===l.active&&(i.value=e)},src:t,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:r,onClose:m,onLongPress:()=>o("longPress",{index:s})},{image:a.image}))]}),g(),d()]})}});let F;const G={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};const K=(e,o=0)=>{if(Z)return F||({instance:F}=S({setup(){const{state:e,toggle:o}=P(),a=()=>{e.images=[]};return()=>B(V,D(e,{onClosed:a,"onUpdate:show":o}),null)}})),e=Array.isArray(e)?{images:e,startPosition:o}:e,F.open(I({},G,e)),F};X(V);export{K as s};
