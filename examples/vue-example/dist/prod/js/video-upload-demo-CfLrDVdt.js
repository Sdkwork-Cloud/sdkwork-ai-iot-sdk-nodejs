import{a as e,_ as l}from"./sdkwork-cell-group-DurwU7nI.js";import{_ as a}from"./sdkwork-navbar-DSprfJAN.js";import{_ as t}from"./sdkwork-popup-Cdx3K9nC.js";import{k as o,r as i,f as s,w as u,P as d,Q as n,S as r,W as p,R as c,F as v,Y as m,a1 as h,j as w,u as f,V as g,$ as k,Z as b,a0 as U}from"./vue-vendor-Caw1HGjZ.js";import{d as y,_ as V,s as x}from"./index-DvK_64jm.js";import{S as C}from"./sdkwork-page-container-CGxg83zK.js";import"./sdkwork-icon-BywEo3YW.js";import"./utils-vendor-WEzSe-CR.js";const $={class:"sdkwork-uploader-video"},M={class:"upload-content"},_={key:0,class:"video-previews"},L={class:"video-thumbnail"},j=["src","poster","onLoadedmetadata"],B={class:"video-overlay"},R=["onClick"],S={key:1,class:"upload-progress"},z={class:"progress-bar"},I={class:"progress-text"},O={key:2,class:"status-icons"},P={key:0,class:"success-icon"},D={key:1,class:"error-icon"},W={class:"action-buttons"},E=["onClick"],N=["onClick"],F={key:0,class:"video-duration"},H={class:"video-info"},T={class:"video-name"},A={class:"video-size"},G={key:0,class:"video-dimensions"},K={key:1,class:"video-duration-text"},Q={key:1,class:"empty-state"},Y={class:"upload-icon"},Z={class:"upload-text"},q={class:"upload-title"},J={class:"upload-subtitle"},X={key:0,class:"upload-actions"},ee=["disabled"],le=["src"],ae=V(o({__name:"sdkwork-uploader-video",props:{modelValue:{default:()=>[]},accept:{default:"video/*"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autoUpload:{type:Boolean,default:!0},maxSize:{default:524288e3},maxCount:{default:5},maxDuration:{default:600},maxWidth:{default:3840},maxHeight:{default:2160},title:{default:"点击或拖拽视频到此处"},subtitle:{default:"支持 MP4、AVI、MOV、WMV 等格式"},bucket:{default:void 0},scene:{default:"video"},metadata:{default:()=>({})},contentType:{default:"video/mp4"},acl:{default:"private"}},emits:["update:modelValue","upload-start","upload-progress","upload-success","upload-error","upload-complete","video-add","video-remove","video-clear","video-preview","video-metadata"],setup(e,{expose:l,emit:a}){const t=e,o=a,b=i(),U=i(!1),V=i(null),x=i([]),C=s(()=>x.value.filter(e=>"uploading"===e.status).length),ae=s(()=>x.value.length<t.maxCount),te=s(()=>x.value.slice(0,t.maxCount));u(()=>t.modelValue,e=>{if(e&&e.length>0){const l=x.value.map(e=>oe(e.file)),a=e.filter(e=>!l.includes(oe(e)));a.length>0&&ce(a)}},{immediate:!0});const oe=e=>`${e.name}-${e.size}-${e.lastModified}`,ie=async e=>{const l=await(e=>new Promise(l=>{l(URL.createObjectURL(e))}))(e);let a,t;try{t=await(e=>new Promise((l,a)=>{const t=URL.createObjectURL(e),o=document.createElement("video");o.onloadedmetadata=()=>{const e={duration:o.duration,width:o.videoWidth,height:o.videoHeight};URL.revokeObjectURL(t),l(e)},o.onerror=()=>{URL.revokeObjectURL(t),a(new Error("无法获取视频元数据"))},o.src=t}))(e),a=await((e,l=1)=>new Promise(a=>{const t=URL.createObjectURL(e),o=document.createElement("video"),i=document.createElement("canvas"),s=i.getContext("2d");o.onloadeddata=()=>{o.currentTime=Math.min(l,o.duration||1)},o.onseeked=()=>{i.width=o.videoWidth,i.height=o.videoHeight,s.drawImage(o,0,0);const e=i.toDataURL("image/jpeg",.8);URL.revokeObjectURL(t),a(e)},o.src=t}))(e)}catch(o){}return{id:oe(e),file:e,name:e.name,size:e.size,previewUrl:l,thumbnailUrl:a,duration:t?.duration,dimensions:t?{width:t.width,height:t.height}:void 0,status:"pending",progress:0}},se=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},ue=e=>{const l=Math.floor(e/3600),a=Math.floor(e%3600/60),t=Math.floor(e%60);return l>0?`${l}:${a.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${a}:${t.toString().padStart(2,"0")}`},de=()=>{!t.disabled&&ae.value&&b.value?.click()},ne=e=>{e.preventDefault(),!t.disabled&&ae.value&&(U.value=!0)},re=e=>{e.preventDefault(),U.value=!1},pe=async e=>{if(e.preventDefault(),U.value=!1,t.disabled||!ae.value)return;const l=e.dataTransfer?.files;l&&l.length>0&&await ce(Array.from(l))},ce=async e=>{if(0===e.length)return;const l=e.filter(e=>e.type.startsWith("video/"));if(0===l.length)return void window.$message?.warning("请选择视频文件");const a=t.maxCount-x.value.length,i=l.slice(0,a);if(0===i.length)return void window.$message?.warning(`最多只能上传 ${t.maxCount} 个视频`);const s=[],u=[];for(const o of i)o.size>t.maxSize?u.push(o):s.push(o);if(u.length>0&&window.$message?.warning(`以下视频文件超过 ${se(t.maxSize)} 限制: ${u.map(e=>e.name).join(", ")}`),0===s.length)return;const d=await Promise.all(s.map(ie));x.value=[...x.value,...d];const n=x.value.map(e=>e.file);o("update:modelValue",n),o("video-add",s),t.autoUpload&&he()},ve=e=>{const l=x.value.findIndex(l=>l.id===e);if(-1!==l){const e=x.value[l];"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),URL.revokeObjectURL(e.previewUrl),x.value.splice(l,1);const a=x.value.map(e=>e.file);o("update:modelValue",a),o("video-remove",e.file)}},me=()=>{x.value.forEach(e=>{"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),URL.revokeObjectURL(e.previewUrl)}),x.value=[],o("update:modelValue",[]),o("video-clear")},he=()=>{x.value.filter(e=>"pending"===e.status).forEach(we)},we=async e=>{if(window.$uploader){e.status="uploading",o("upload-start",e.file);try{const l={file:e.file,bucket:t.bucket||{name:"default-bucket"},name:e.name,scene:t.scene,metadata:t.metadata,contentType:t.contentType||"video/mp4",acl:t.acl},a=await window.$uploader.upload(l,l=>{e.progress=l.percentage,o("upload-progress",e.file,l.percentage)});e.uploadId=a;const i=await window.$uploader.wait(a);e.status="success",e.progress=100,o("upload-success",e.file,i);x.value.every(e=>"success"===e.status||"error"===e.status)&&o("upload-complete",x.value.map(e=>e.file))}catch(l){e.status="error",o("upload-error",e.file,l)}}},fe=()=>{V.value=null};return l({clearVideos:me,uploadVideos:he,getVideoList:()=>x.value.map(e=>({file:e.file,previewUrl:e.previewUrl,thumbnailUrl:e.thumbnailUrl,duration:e.duration,dimensions:e.dimensions,status:"success"===e.status?"uploaded":void 0})),removeVideo:ve}),(l,a)=>(n(),d("div",$,[r("div",{class:c(["upload-area",{"drag-over":U.value,disabled:e.disabled,"has-videos":x.value.length>0}]),onClick:de,onDrop:pe,onDragover:ne,onDragleave:re},[r("div",M,[x.value.length>0?(n(),d("div",_,[(n(!0),d(v,null,m(te.value,(e,l)=>(n(),d("div",{key:e.id,class:c(["video-preview",{uploading:"uploading"===e.status,success:"success"===e.status,error:"error"===e.status}])},[r("div",L,[r("video",{src:e.previewUrl,poster:e.thumbnailUrl,class:"preview-video",onLoadedmetadata:l=>((e,l)=>{const a=l.target,t=x.value.find(l=>l.id===e);if(t&&!t.duration){t.duration=a.duration,t.dimensions={width:a.videoWidth,height:a.videoHeight};const e={duration:a.duration,width:a.videoWidth,height:a.videoHeight};o("video-metadata",t.file,e)}})(e.id,l)},null,40,j),r("div",B,[e.duration?(n(),d("button",{key:0,type:"button",class:"play-btn",onClick:h(l=>(e=>{V.value=e})(e),["stop"])},[w(f(y),{icon:"material-symbols:play-arrow",width:"24",height:"24"})],8,R)):p("",!0),"uploading"===e.status?(n(),d("div",S,[r("div",z,[r("div",{class:"progress-fill",style:g({width:e.progress+"%"})},null,4)]),r("span",I,k(e.progress)+"%",1)])):(n(),d("div",O,["success"===e.status?(n(),d("span",P,"✓")):p("",!0),"error"===e.status?(n(),d("span",D,"✗")):p("",!0)])),r("div",W,["uploading"===e.status?(n(),d("button",{key:0,type:"button",class:"cancel-btn",onClick:h(l=>(e=>{const l=x.value.find(l=>l.id===e);l&&l.uploadId&&(window.$uploader?.cancel(l.uploadId),l.status="pending",l.progress=0,l.uploadId=void 0)})(e.id),["stop"])}," 取消 ",8,E)):(n(),d("button",{key:1,type:"button",class:"remove-btn",onClick:h(l=>ve(e.id),["stop"])}," 移除 ",8,N))])]),e.duration?(n(),d("div",F,k(ue(e.duration)),1)):p("",!0)]),r("div",H,[r("div",T,k(e.name),1),r("div",A,k(se(e.size)),1),e.dimensions?(n(),d("div",G,k(e.dimensions.width)+"×"+k(e.dimensions.height),1)):p("",!0),e.duration?(n(),d("div",K," 时长: "+k(ue(e.duration)),1)):p("",!0)])],2))),128)),ae.value?(n(),d("div",{key:0,class:"add-more-btn",onClick:de},[...a[1]||(a[1]=[r("div",{class:"add-icon"},"+",-1),r("div",{class:"add-text"},"添加视频",-1)])])):p("",!0)])):(n(),d("div",Q,[r("div",Y,[w(f(y),{icon:"material-symbols:video-library",width:"48",height:"48"})]),r("div",Z,[r("p",q,k(e.title),1),r("p",J,k(e.subtitle),1)])]))])],34),x.value.length>0&&!e.autoUpload?(n(),d("div",X,[r("button",{type:"button",class:"upload-btn primary",disabled:C.value>0,onClick:he},k(C.value>0?`上传中... (${C.value})`:"开始上传"),9,ee),r("button",{type:"button",class:"upload-btn secondary",onClick:me}," 取消 ")])):p("",!0),V.value?(n(),d("div",{key:1,class:"video-modal",onClick:fe},[r("div",{class:"modal-content",onClick:a[0]||(a[0]=h(()=>{},["stop"]))},[r("video",{src:V.value.previewUrl,controls:"",autoplay:"",class:"modal-video"},null,8,le),r("button",{type:"button",class:"close-btn",onClick:fe},"×")])])):p("",!0)]))}}),[["__scopeId","data-v-0061bc8c"]]),te={class:"demo-content"},oe={class:"popup-content"},ie={key:0,class:"video-info"},se={class:"popup-content"},ue={class:"popup-content"},de={key:0,class:"preview-info"},ne={class:"popup-content"},re={key:0,class:"duration-info"},pe={class:"popup-content"},ce={key:0,class:"dimension-info"},ve={class:"popup-content"},me={class:"popup-content"},he={class:"popup-content"},we={class:"popup-content"},fe={class:"popup-content"},ge={class:"popup-content"},ke=V(o({__name:"video-upload-demo",setup(o){const s=i(!1),u=i(!1),c=i(!1),h=i(!1),f=i(!1),g=i(!1),y=i(!1),V=i(!1),$=i(!1),M=i(!1),_=i(!1),L=i([]),j=i([]),B=i([]),R=i([]),S=i([]),z=i([]),I=i([]),O=i([]),P=i([]),D=i([]),W=i([]),E=i([]),N=i([]),F=(e,l)=>{x(`视频上传成功: ${e.name}`)},H=(e,l)=>{x(`生成预览: ${e.name}`)},T=(e,l)=>{},A=(e,l)=>{l&&l.duration&&E.value.push({fileName:e.name,duration:l.duration})},G=(e,l)=>{l&&l.width&&l.height&&N.value.push({fileName:e.name,width:l.width,height:l.height})},K=(e,l)=>{x(`视频时长超出限制: ${e.name}`)},Q=(e,l)=>{x(`短视频上传成功: ${e.name}`)},Y=(e,l)=>{x(`教学视频上传成功: ${e.name}`)},Z=(e,l)=>{x(`产品演示视频上传成功: ${e.name}`)},q=e=>{if(0===e)return"0 Bytes";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["Bytes","KB","MB","GB"][l]};return(o,i)=>{const x=a,J=e,X=l;return n(),b(C,{"safe-area":"",scrollable:"","theme-mode":"auto"},{header:U(()=>[w(x,{title:"视频上传组件演示","left-text":"返回","left-arrow":"",onClickLeft:i[0]||(i[0]=e=>o.$router.back())})]),default:U(()=>[r("div",te,[w(X,{title:"基础功能演示"},{default:U(()=>[w(J,{title:"单个视频上传","is-link":"",onClick:i[1]||(i[1]=e=>s.value=!0)}),w(J,{title:"多个视频上传","is-link":"",onClick:i[2]||(i[2]=e=>u.value=!0)}),w(J,{title:"视频预览功能","is-link":"",onClick:i[3]||(i[3]=e=>c.value=!0)}),w(J,{title:"视频时长检测","is-link":"",onClick:i[4]||(i[4]=e=>h.value=!0)})]),_:1}),w(X,{title:"高级功能演示"},{default:U(()=>[w(J,{title:"视频尺寸检测","is-link":"",onClick:i[5]||(i[5]=e=>f.value=!0)}),w(J,{title:"视频时长限制","is-link":"",onClick:i[6]||(i[6]=e=>g.value=!0)}),w(J,{title:"视频播放控制","is-link":"",onClick:i[7]||(i[7]=e=>y.value=!0)}),w(J,{title:"缩略图生成","is-link":"",onClick:i[8]||(i[8]=e=>V.value=!0)})]),_:1}),w(X,{title:"特殊场景演示"},{default:U(()=>[w(J,{title:"短视频上传","is-link":"",onClick:i[9]||(i[9]=e=>$.value=!0)}),w(J,{title:"教学视频上传","is-link":"",onClick:i[10]||(i[10]=e=>M.value=!0)}),w(J,{title:"产品演示视频","is-link":"",onClick:i[11]||(i[11]=e=>_.value=!0)})]),_:1})]),w(t,{show:s.value,"onUpdate:show":i[13]||(i[13]=e=>s.value=e),position:"center",title:"单个视频上传",width:450},{default:U(()=>[r("div",oe,[w(ae,{modelValue:L.value,"onUpdate:modelValue":i[12]||(i[12]=e=>L.value=e),multiple:!1,"auto-upload":!0,title:"选择单个视频",subtitle:"支持MP4、AVI、MOV等格式",onUploadSuccess:F,onVideoPreview:H},null,8,["modelValue"]),L.value.length>0?(n(),d("div",ie,[r("p",null,"已选择视频: "+k(L.value.length)+" 个",1)])):p("",!0)])]),_:1},8,["show"]),w(t,{show:u.value,"onUpdate:show":i[15]||(i[15]=e=>u.value=e),position:"center",title:"多个视频上传",width:550},{default:U(()=>[r("div",se,[w(ae,{modelValue:j.value,"onUpdate:modelValue":i[14]||(i[14]=e=>j.value=e),multiple:!0,"auto-upload":!0,"max-count":3,"max-size":209715200,title:"选择多个视频",subtitle:"最多3个视频，每个最大200MB",onUploadSuccess:F},null,8,["modelValue"])])]),_:1},8,["show"]),w(t,{show:c.value,"onUpdate:show":i[17]||(i[17]=e=>c.value=e),position:"center",title:"视频预览功能",width:600},{default:U(()=>[r("div",ue,[w(ae,{modelValue:B.value,"onUpdate:modelValue":i[16]||(i[16]=e=>B.value=e),multiple:!0,"auto-upload":!1,title:"视频预览演示",subtitle:"支持缩略图预览和播放功能",onVideoPreview:H,onVideoMetadata:T},null,8,["modelValue"]),B.value.length>0?(n(),d("div",de,[i[34]||(i[34]=r("h4",null,"预览信息:",-1)),(n(!0),d(v,null,m(B.value,e=>(n(),d("div",{key:e.name,class:"preview-item"},[r("span",null,k(e.name),1),r("span",null,k(q(e.size)),1)]))),128))])):p("",!0)])]),_:1},8,["show"]),w(t,{show:h.value,"onUpdate:show":i[19]||(i[19]=e=>h.value=e),position:"center",title:"视频时长检测",width:550},{default:U(()=>[r("div",ne,[w(ae,{modelValue:R.value,"onUpdate:modelValue":i[18]||(i[18]=e=>R.value=e),multiple:!0,"auto-upload":!1,title:"时长检测演示",subtitle:"自动检测视频时长信息",onVideoMetadata:A},null,8,["modelValue"]),E.value.length>0?(n(),d("div",re,[i[35]||(i[35]=r("h4",null,"视频时长:",-1)),(n(!0),d(v,null,m(E.value,e=>{return n(),d("div",{key:e.fileName,class:"duration-item"},[r("span",null,k(e.fileName),1),r("span",null,k((l=e.duration,`${Math.floor(l/60)}:${Math.floor(l%60).toString().padStart(2,"0")}`)),1)]);var l}),128))])):p("",!0)])]),_:1},8,["show"]),w(t,{show:f.value,"onUpdate:show":i[21]||(i[21]=e=>f.value=e),position:"center",title:"视频尺寸检测",width:550},{default:U(()=>[r("div",pe,[w(ae,{modelValue:S.value,"onUpdate:modelValue":i[20]||(i[20]=e=>S.value=e),multiple:!0,"auto-upload":!1,title:"尺寸检测演示",subtitle:"自动检测视频分辨率",onVideoMetadata:G},null,8,["modelValue"]),N.value.length>0?(n(),d("div",ce,[i[36]||(i[36]=r("h4",null,"视频分辨率:",-1)),(n(!0),d(v,null,m(N.value,e=>(n(),d("div",{key:e.fileName,class:"dimension-item"},[r("span",null,k(e.fileName),1),r("span",null,k(e.width)+"×"+k(e.height),1)]))),128))])):p("",!0)])]),_:1},8,["show"]),w(t,{show:g.value,"onUpdate:show":i[23]||(i[23]=e=>g.value=e),position:"center",title:"视频时长限制",width:500},{default:U(()=>[r("div",ve,[w(ae,{modelValue:z.value,"onUpdate:modelValue":i[22]||(i[22]=e=>z.value=e),multiple:!0,"auto-upload":!0,"max-duration":300,title:"时长限制演示",subtitle:"最大时长: 5分钟",onUploadError:K},null,8,["modelValue"]),i[37]||(i[37]=r("div",{class:"limit-info"},[r("p",null,"时长限制: 5分钟"),r("p",null,"超过限制的视频将被拒绝")],-1))])]),_:1},8,["show"]),w(t,{show:y.value,"onUpdate:show":i[25]||(i[25]=e=>y.value=e),position:"center",title:"视频播放控制",width:600},{default:U(()=>[r("div",me,[w(ae,{modelValue:I.value,"onUpdate:modelValue":i[24]||(i[24]=e=>I.value=e),multiple:!0,"auto-upload":!1,title:"播放控制演示",subtitle:"支持视频预览播放功能"},null,8,["modelValue"]),i[38]||(i[38]=r("div",{class:"play-info"},[r("p",null,"播放功能:"),r("ul",null,[r("li",null,"点击播放按钮预览视频"),r("li",null,"支持全屏播放模式"),r("li",null,"播放控制按钮")])],-1))])]),_:1},8,["show"]),w(t,{show:V.value,"onUpdate:show":i[27]||(i[27]=e=>V.value=e),position:"center",title:"缩略图生成",width:550},{default:U(()=>[r("div",he,[w(ae,{modelValue:O.value,"onUpdate:modelValue":i[26]||(i[26]=e=>O.value=e),multiple:!0,"auto-upload":!1,title:"缩略图生成演示",subtitle:"自动生成视频第一帧作为缩略图"},null,8,["modelValue"]),i[39]||(i[39]=r("div",{class:"thumbnail-info"},[r("p",null,"缩略图功能:"),r("ul",null,[r("li",null,"自动提取视频第一帧"),r("li",null,"生成预览缩略图"),r("li",null,"提升用户体验")])],-1))])]),_:1},8,["show"]),w(t,{show:$.value,"onUpdate:show":i[29]||(i[29]=e=>$.value=e),position:"center",title:"短视频上传",width:500},{default:U(()=>[r("div",we,[w(ae,{modelValue:P.value,"onUpdate:modelValue":i[28]||(i[28]=e=>P.value=e),multiple:!0,"auto-upload":!0,"max-duration":60,"max-size":52428800,title:"短视频上传",subtitle:"最大时长: 1分钟，最大文件: 50MB",onUploadSuccess:Q},null,8,["modelValue"]),i[40]||(i[40]=r("div",{class:"short-video-tips"},[r("p",null,"短视频要求:"),r("ul",null,[r("li",null,"时长不超过1分钟"),r("li",null,"文件大小不超过50MB"),r("li",null,"支持主流视频格式")])],-1))])]),_:1},8,["show"]),w(t,{show:M.value,"onUpdate:show":i[31]||(i[31]=e=>M.value=e),position:"center",title:"教学视频上传",width:550},{default:U(()=>[r("div",fe,[w(ae,{modelValue:D.value,"onUpdate:modelValue":i[30]||(i[30]=e=>D.value=e),multiple:!0,"auto-upload":!0,"max-duration":1800,"max-size":524288e3,title:"教学视频上传",subtitle:"最大时长: 30分钟，最大文件: 500MB",onUploadSuccess:Y},null,8,["modelValue"]),i[41]||(i[41]=r("div",{class:"teaching-tips"},[r("p",null,"教学视频要求:"),r("ul",null,[r("li",null,"时长不超过30分钟"),r("li",null,"清晰度建议720p以上"),r("li",null,"声音清晰，内容完整")])],-1))])]),_:1},8,["show"]),w(t,{show:_.value,"onUpdate:show":i[33]||(i[33]=e=>_.value=e),position:"center",title:"产品演示视频",width:600},{default:U(()=>[r("div",ge,[w(ae,{modelValue:W.value,"onUpdate:modelValue":i[32]||(i[32]=e=>W.value=e),multiple:!0,"auto-upload":!0,"max-duration":600,"max-size":209715200,title:"产品演示视频",subtitle:"最大时长: 10分钟，最大文件: 200MB",onUploadSuccess:Z},null,8,["modelValue"]),i[42]||(i[42]=r("div",{class:"product-video-tips"},[r("p",null,"产品演示视频要求:"),r("ul",null,[r("li",null,"展示产品功能特点"),r("li",null,"画面清晰，解说清楚"),r("li",null,"时长适中，突出重点")])],-1))])]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-73d813c2"]]);export{ke as default};
