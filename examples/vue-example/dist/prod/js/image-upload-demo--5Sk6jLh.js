import{a as e,_ as l}from"./sdkwork-cell-group-DwusYRIW.js";import{_ as a}from"./sdkwork-navbar-DKTz2rZK.js";import{_ as t}from"./sdkwork-popup-BUxzP8_R.js";import{k as o,a as s,f as i,w as u,P as n,Q as d,S as p,W as c,R as r,F as m,Y as v,V as g,$ as w,a1 as h,j as f,u as k,n as b,Z as U,a0 as y}from"./vue-vendor-BOogp7Xw.js";import{d as V,_ as x,s as C}from"./index-dgv0w5gS.js";import{S as _}from"./sdkwork-page-container-u9lrsiqQ.js";import"./sdkwork-icon-Cby-rH18.js";import"./utils-vendor-WEzSe-CR.js";const $={class:"sdkwork-uploader-image"},I={class:"upload-content"},j={key:0,class:"image-previews"},P=["src","alt"],B={class:"image-overlay"},z={key:0,class:"upload-progress"},L={class:"progress-bar"},M={class:"progress-text"},R={key:1,class:"status-icons"},G={key:0,class:"success-icon"},F={key:1,class:"error-icon"},S={class:"action-buttons"},D=["onClick"],N=["onClick"],O={class:"image-info"},E={class:"image-name"},T={class:"image-size"},W={key:0,class:"image-dimensions"},J={key:1,class:"empty-state"},q={class:"upload-icon"},K={class:"upload-text"},A={class:"upload-title"},H={class:"upload-subtitle"},Q={key:0,class:"upload-actions"},Y=["disabled"],Z=x(o({__name:"sdkwork-uploader-image",props:{modelValue:{default:()=>[]},accept:{default:"image/*"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autoUpload:{type:Boolean,default:!0},maxSize:{default:10485760},maxCount:{default:10},maxWidth:{default:1920},maxHeight:{default:1080},quality:{default:.8},title:{default:"点击或拖拽图片到此处"},subtitle:{default:"支持 JPG、PNG、GIF、WEBP 等格式"},bucket:{default:void 0},scene:{default:"image"},metadata:{default:()=>({})},contentType:{default:"image/jpeg"},acl:{default:"private"}},emits:["update:modelValue","upload-start","upload-progress","upload-success","upload-error","upload-complete","image-add","image-remove","image-clear","image-preview"],setup(e,{expose:l,emit:a}){const t=e,o=a;s();const U=s(!1),y=s([]),x=i(()=>y.value.filter(e=>"uploading"===e.status).length),C=i(()=>0===t.maxCount||y.value.length<t.maxCount),_=i(()=>t.multiple?y.value:y.value.slice(0,1));u(()=>t.modelValue,async e=>{if(e&&e.length>0){const l=y.value.map(e=>e.id),a=await Promise.all(e.filter(e=>!l.includes(Z(e))).map(e=>X(e)));y.value=[...y.value,...a],t.autoUpload&&b(()=>{ue()})}},{immediate:!0});const Z=e=>`${e.name}-${e.size}-${e.lastModified}`,X=async e=>{const l=await(e=>new Promise(l=>{l(URL.createObjectURL(e))}))(e),a=await(e=>new Promise(l=>{const a=new Image,t=URL.createObjectURL(e);a.onload=()=>{l({width:a.width,height:a.height}),URL.revokeObjectURL(t)},a.onerror=()=>{l({width:0,height:0}),URL.revokeObjectURL(t)},a.src=t}))(e);return{id:Z(e),file:e,name:e.name,size:e.size,previewUrl:l,dimensions:a,status:"pending",progress:0}},ee=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},le=async()=>{if(!t.disabled&&C.value)try{const e=await window.$files.chooseImage({count:t.multiple?t.maxCount:1,success:e=>{console.log("图片选择成功:",e)},fail:e=>{console.error("图片选择失败:",e)},complete:()=>{console.log("图片选择完成")}});e.tempFiles&&e.tempFiles.length>0&&await se(e.tempFiles)}catch(e){console.error("图片选择异常:",e)}},ae=e=>{e.preventDefault(),!t.disabled&&C.value&&(U.value=!0)},te=e=>{e.preventDefault(),U.value=!1},oe=async e=>{e.preventDefault(),U.value=!1,!t.disabled&&C.value&&e.dataTransfer?.files&&await se(Array.from(e.dataTransfer.files))},se=async e=>{if(0===e.length)return;const l=e.filter(e=>e.type.startsWith("image/"));if(0===l.length)return void window.$message?.warning("请选择图片文件");const a=0===t.maxCount?1/0:t.maxCount-y.value.length,s=l.slice(0,a);if(0===s.length)return void window.$message?.warning(`最多只能上传 ${t.maxCount} 张图片`);const i=[],u=[];for(const o of s)o.size>t.maxSize?u.push(o):i.push(o);if(u.length>0&&window.$message?.error(`以下图片超过最大限制 ${ee(t.maxSize)}: ${u.map(e=>e.name).join(", ")}`),0===i.length)return;const n=await Promise.all(i.map(e=>X(e)));y.value=[...y.value,...n];const d=y.value.map(e=>e.file);o("update:modelValue",d),o("image-add",i),n.forEach(e=>{o("image-preview",e.file,e.previewUrl)}),t.autoUpload&&ue()},ie=()=>{y.value.forEach(e=>{"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),URL.revokeObjectURL(e.previewUrl)}),y.value=[],o("update:modelValue",[]),o("image-clear")},ue=async()=>{const e=y.value.filter(e=>"pending"===e.status);if(0!==e.length){for(const l of e)await ne(l);o("upload-complete",y.value.map(e=>e.file))}},ne=async e=>{if(window.$uploader){e.status="uploading",e.progress=0,o("upload-start",e.file);try{const l={file:e.file,bucket:t.bucket||{name:"default-bucket"},name:e.name,scene:t.scene,metadata:t.metadata,contentType:t.contentType||"image/jpeg",acl:t.acl},a=await window.$uploader.upload(l,l=>{e.progress=l.percentage,o("upload-progress",e.file,l.percentage)});e.status="success",e.progress=100,o("upload-success",e.file,a)}catch(l){e.status="error",o("upload-error",e.file,l),console.error("Upload failed:",l)}}else console.error("Uploader not available")};return l({clearImages:()=>{ie()},uploadImages:()=>{ue()},getImageList:()=>y.value.map(e=>({file:e.file,previewUrl:e.previewUrl,dimensions:e.dimensions,status:e.status,progress:e.progress,response:"success"===e.status?"uploaded":void 0}))}),(l,a)=>(d(),n("div",$,[p("div",{class:r(["upload-area",{"drag-over":U.value,disabled:e.disabled,"has-images":y.value.length>0}]),onClick:le,onDrop:oe,onDragover:ae,onDragleave:te},[p("div",I,[y.value.length>0?(d(),n("div",j,[(d(!0),n(m,null,v(_.value,(e,l)=>(d(),n("div",{key:e.id,class:r(["image-preview",{uploading:"uploading"===e.status,success:"success"===e.status,error:"error"===e.status}])},[p("img",{src:e.previewUrl,alt:e.name,class:"preview-img"},null,8,P),p("div",B,["uploading"===e.status?(d(),n("div",z,[p("div",L,[p("div",{class:"progress-fill",style:g({width:e.progress+"%"})},null,4)]),p("span",M,w(e.progress)+"%",1)])):(d(),n("div",R,["success"===e.status?(d(),n("span",G,"✓")):c("",!0),"error"===e.status?(d(),n("span",F,"✗")):c("",!0)])),p("div",S,["uploading"===e.status?(d(),n("button",{key:0,type:"button",class:"cancel-btn",onClick:h(l=>(e=>{const l=y.value.find(l=>l.id===e);l&&l.uploadId&&(window.$uploader?.cancel(l.uploadId),l.status="pending",l.progress=0,l.uploadId=void 0)})(e.id),["stop"])}," 取消 ",8,D)):(d(),n("button",{key:1,type:"button",class:"remove-btn",onClick:h(l=>(e=>{const l=y.value.findIndex(l=>l.id===e);if(-1!==l){const e=y.value[l];"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),URL.revokeObjectURL(e.previewUrl),y.value.splice(l,1);const a=y.value.map(e=>e.file);o("update:modelValue",a),o("image-remove",e.file)}})(e.id),["stop"])}," 移除 ",8,N))])]),p("div",O,[p("div",E,w(e.name),1),p("div",T,w(ee(e.size)),1),e.dimensions?(d(),n("div",W,w(e.dimensions.width)+"×"+w(e.dimensions.height),1)):c("",!0)])],2))),128)),C.value?(d(),n("div",{key:0,class:"add-more-btn",onClick:le},[...a[0]||(a[0]=[p("div",{class:"add-icon"},"+",-1),p("div",{class:"add-text"},"添加图片",-1)])])):c("",!0)])):(d(),n("div",J,[p("div",q,[f(k(V),{icon:"material-symbols:image",width:"48",height:"48"})]),p("div",K,[p("p",A,w(e.title),1),p("p",H,w(e.subtitle),1)])]))])],34),y.value.length>0&&!e.autoUpload?(d(),n("div",Q,[p("button",{type:"button",class:"upload-btn primary",disabled:x.value>0,onClick:ue},w(x.value>0?`上传中... (${x.value})`:"开始上传"),9,Y),p("button",{type:"button",class:"upload-btn secondary",onClick:ie}," 取消 ")])):c("",!0)]))}}),[["__scopeId","data-v-a4b210f6"]]),X={class:"demo-content"},ee={class:"popup-content"},le={key:0,class:"image-info"},ae={class:"popup-content"},te={class:"popup-content"},oe={key:0,class:"preview-info"},se={class:"popup-content"},ie={key:0,class:"dimension-info"},ue={class:"popup-content"},ne={class:"popup-content"},de={class:"popup-content"},pe={class:"popup-content"},ce={class:"popup-content"},re={class:"popup-content"},me={class:"popup-content"},ve={key:0,class:"album-info"},ge=x(o({__name:"image-upload-demo",setup(o){const i=s(!1),u=s(!1),r=s(!1),g=s(!1),h=s(!1),k=s(!1),b=s(!1),V=s(!1),x=s(!1),$=s(!1),I=s(!1),j=s([]),P=s([]),B=s([]),z=s([]),L=s([]),M=s([]),R=s([]),G=s([]),F=s([]),S=s([]),D=s([]),N=s([]),O=(e,l)=>{C(`图片上传成功: ${e.name}`),console.log("图片上传响应:",l)},E=(e,l)=>{console.log("图片预览:",e.name,l),C(`生成预览: ${e.name}`)},T=(e,l)=>{console.log("图片尺寸检测:",e.name)},W=(e,l)=>{C(`质量压缩完成: ${e.name}`)},J=(e,l)=>{C(`图片尺寸超出限制: ${e.name}`)},q=(e,l)=>{C(`头像上传成功: ${e.name}`)},K=(e,l)=>{C(`产品图片上传成功: ${e.name}`)},A=e=>{C(`相册上传完成: ${e.length} 张图片`)},H=e=>{if(0===e)return"0 Bytes";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["Bytes","KB","MB","GB"][l]};return(o,s)=>{const C=a,Q=e,Y=l;return d(),U(_,{"safe-area":"",scrollable:"","theme-mode":"auto"},{header:y(()=>[f(C,{title:"图片上传组件演示","left-text":"返回","left-arrow":"",onClickLeft:s[0]||(s[0]=e=>o.$router.back())})]),default:y(()=>[p("div",X,[f(Y,{title:"基础功能演示"},{default:y(()=>[f(Q,{title:"单张图片上传","is-link":"",onClick:s[1]||(s[1]=e=>i.value=!0)}),f(Q,{title:"多张图片上传","is-link":"",onClick:s[2]||(s[2]=e=>u.value=!0)}),f(Q,{title:"图片预览功能","is-link":"",onClick:s[3]||(s[3]=e=>r.value=!0)}),f(Q,{title:"图片尺寸检测","is-link":"",onClick:s[4]||(s[4]=e=>g.value=!0)})]),_:1}),f(Y,{title:"高级功能演示"},{default:y(()=>[f(Q,{title:"图片质量压缩","is-link":"",onClick:s[5]||(s[5]=e=>h.value=!0)}),f(Q,{title:"图片尺寸限制","is-link":"",onClick:s[6]||(s[6]=e=>k.value=!0)}),f(Q,{title:"网格布局展示","is-link":"",onClick:s[7]||(s[7]=e=>b.value=!0)}),f(Q,{title:"自定义图片格式","is-link":"",onClick:s[8]||(s[8]=e=>V.value=!0)})]),_:1}),f(Y,{title:"特殊场景演示"},{default:y(()=>[f(Q,{title:"头像上传","is-link":"",onClick:s[9]||(s[9]=e=>x.value=!0)}),f(Q,{title:"产品图片上传","is-link":"",onClick:s[10]||(s[10]=e=>$.value=!0)}),f(Q,{title:"相册批量上传","is-link":"",onClick:s[11]||(s[11]=e=>I.value=!0)})]),_:1})]),f(t,{show:i.value,"onUpdate:show":s[13]||(s[13]=e=>i.value=e),position:"center",title:"单张图片上传",width:400},{default:y(()=>[p("div",ee,[f(Z,{modelValue:j.value,"onUpdate:modelValue":s[12]||(s[12]=e=>j.value=e),multiple:!1,"auto-upload":!0,title:"选择单张图片",subtitle:"支持JPG、PNG、GIF、WEBP格式",onUploadSuccess:O,onImagePreview:E},null,8,["modelValue"]),j.value.length>0?(d(),n("div",le,[p("p",null,"已选择图片: "+w(j.value.length)+" 张",1)])):c("",!0)])]),_:1},8,["show"]),f(t,{show:u.value,"onUpdate:show":s[15]||(s[15]=e=>u.value=e),position:"center",title:"多张图片上传",width:500},{default:y(()=>[p("div",ae,[f(Z,{modelValue:P.value,"onUpdate:modelValue":s[14]||(s[14]=e=>P.value=e),multiple:!0,"auto-upload":!0,"max-count":6,"max-size":5242880,title:"选择多张图片",subtitle:"最多6张图片，每张最大5MB",onUploadSuccess:O},null,8,["modelValue"])])]),_:1},8,["show"]),f(t,{show:r.value,"onUpdate:show":s[17]||(s[17]=e=>r.value=e),position:"center",title:"图片预览功能",width:550},{default:y(()=>[p("div",te,[f(Z,{modelValue:B.value,"onUpdate:modelValue":s[16]||(s[16]=e=>B.value=e),multiple:!0,"auto-upload":!1,"show-list":!0,title:"图片预览演示",subtitle:"支持缩略图预览和尺寸显示",onImagePreview:E},null,8,["modelValue"]),B.value.length>0?(d(),n("div",oe,[s[34]||(s[34]=p("h4",null,"预览信息:",-1)),(d(!0),n(m,null,v(B.value,e=>(d(),n("div",{key:e.name,class:"preview-item"},[p("span",null,w(e.name),1),p("span",null,w(H(e.size)),1)]))),128))])):c("",!0)])]),_:1},8,["show"]),f(t,{show:g.value,"onUpdate:show":s[19]||(s[19]=e=>g.value=e),position:"center",title:"图片尺寸检测",width:500},{default:y(()=>[p("div",se,[f(Z,{modelValue:z.value,"onUpdate:modelValue":s[18]||(s[18]=e=>z.value=e),multiple:!0,"auto-upload":!1,title:"尺寸检测演示",subtitle:"自动检测图片宽度和高度",onImagePreview:T},null,8,["modelValue"]),N.value.length>0?(d(),n("div",ie,[s[35]||(s[35]=p("h4",null,"图片尺寸:",-1)),(d(!0),n(m,null,v(N.value,e=>(d(),n("div",{key:e.fileName,class:"dimension-item"},[p("span",null,w(e.fileName),1),p("span",null,w(e.width)+"×"+w(e.height),1)]))),128))])):c("",!0)])]),_:1},8,["show"]),f(t,{show:h.value,"onUpdate:show":s[21]||(s[21]=e=>h.value=e),position:"center",title:"图片质量压缩",width:500},{default:y(()=>[p("div",ue,[f(Z,{modelValue:L.value,"onUpdate:modelValue":s[20]||(s[20]=e=>L.value=e),multiple:!0,"auto-upload":!0,quality:.6,title:"质量压缩演示",subtitle:"图片质量压缩至60%",onUploadSuccess:W},null,8,["modelValue"]),s[36]||(s[36]=p("div",{class:"quality-info"},[p("p",null,"压缩质量: 60%"),p("p",null,"适用于需要减小文件大小的场景")],-1))])]),_:1},8,["show"]),f(t,{show:k.value,"onUpdate:show":s[23]||(s[23]=e=>k.value=e),position:"center",title:"图片尺寸限制",width:500},{default:y(()=>[p("div",ne,[f(Z,{modelValue:M.value,"onUpdate:modelValue":s[22]||(s[22]=e=>M.value=e),multiple:!0,"auto-upload":!0,"max-width":2e3,"max-height":2e3,title:"尺寸限制演示",subtitle:"最大尺寸: 2000×2000像素",onUploadError:J},null,8,["modelValue"])])]),_:1},8,["show"]),f(t,{show:b.value,"onUpdate:show":s[25]||(s[25]=e=>b.value=e),position:"center",title:"网格布局展示",width:600},{default:y(()=>[p("div",de,[f(Z,{modelValue:R.value,"onUpdate:modelValue":s[24]||(s[24]=e=>R.value=e),multiple:!0,"auto-upload":!1,"show-list":!0,title:"网格布局演示",subtitle:"图片以网格形式排列展示"},null,8,["modelValue"]),s[37]||(s[37]=p("div",{class:"grid-info"},[p("p",null,"当前布局: 响应式网格布局"),p("p",null,"支持不同屏幕尺寸的自适应")],-1))])]),_:1},8,["show"]),f(t,{show:V.value,"onUpdate:show":s[27]||(s[27]=e=>V.value=e),position:"center",title:"自定义图片格式",width:500},{default:y(()=>[p("div",pe,[f(Z,{modelValue:G.value,"onUpdate:modelValue":s[26]||(s[26]=e=>G.value=e),multiple:!0,"auto-upload":!0,accept:"image/jpeg,image/png",title:"自定义格式演示",subtitle:"仅支持JPG和PNG格式"},null,8,["modelValue"]),s[38]||(s[38]=p("div",{class:"format-info"},[p("p",null,"支持格式: JPG, PNG"),p("p",null,"其他格式将被过滤")],-1))])]),_:1},8,["show"]),f(t,{show:x.value,"onUpdate:show":s[29]||(s[29]=e=>x.value=e),position:"center",title:"头像上传",width:400},{default:y(()=>[p("div",ce,[f(Z,{modelValue:F.value,"onUpdate:modelValue":s[28]||(s[28]=e=>F.value=e),multiple:!1,"auto-upload":!0,"max-size":2097152,"max-width":500,"max-height":500,title:"上传头像",subtitle:"建议尺寸: 200×200像素",onUploadSuccess:q},null,8,["modelValue"]),s[39]||(s[39]=p("div",{class:"avatar-tips"},[p("p",null,"头像上传要求:"),p("ul",null,[p("li",null,"正方形图片"),p("li",null,"建议尺寸: 200×200"),p("li",null,"最大文件: 2MB")])],-1))])]),_:1},8,["show"]),f(t,{show:$.value,"onUpdate:show":s[31]||(s[31]=e=>$.value=e),position:"center",title:"产品图片上传",width:550},{default:y(()=>[p("div",re,[f(Z,{modelValue:S.value,"onUpdate:modelValue":s[30]||(s[30]=e=>S.value=e),multiple:!0,"auto-upload":!0,"max-count":5,"max-size":10485760,title:"产品图片上传",subtitle:"最多5张产品图片",onUploadSuccess:K},null,8,["modelValue"]),s[40]||(s[40]=p("div",{class:"product-tips"},[p("p",null,"产品图片要求:"),p("ul",null,[p("li",null,"支持多角度展示"),p("li",null,"建议尺寸: 800×600以上"),p("li",null,"清晰度高，背景简洁")])],-1))])]),_:1},8,["show"]),f(t,{show:I.value,"onUpdate:show":s[33]||(s[33]=e=>I.value=e),position:"center",title:"相册批量上传",width:600},{default:y(()=>[p("div",me,[f(Z,{modelValue:D.value,"onUpdate:modelValue":s[32]||(s[32]=e=>D.value=e),multiple:!0,"auto-upload":!0,"max-count":20,"max-size":20971520,title:"相册批量上传",subtitle:"最多20张图片，支持批量操作",onUploadComplete:A},null,8,["modelValue"]),D.value.length>0?(d(),n("div",ve,[p("p",null,"已选择 "+w(D.value.length)+" 张图片",1),s[41]||(s[41]=p("p",null,"支持批量上传和管理",-1))])):c("",!0)])]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-98efaada"]]);export{ge as default};
