import{z as e,k as t,f as s,P as a,Q as i,S as n,U as l,j as o,W as d,a0 as r,R as c,a1 as g,$ as u,r as h,b as p,Z as m,a4 as f}from"./vue-vendor-Caw1HGjZ.js";import{I as w,B as y,_ as v,L as k}from"./index-C74AGTg6.js";import{A as b}from"./agent-DnxM7mYf.js";import{E as A}from"./index-BAcatGqB.js";import{S}from"./sdkwork-api-list-ZZL3NDwK.js";/* empty css              *//* empty css              *//* empty css              */import{I as L}from"./index-Dr9h4a37.js";import{C as I}from"./index-BeKnOcG_.js";const x=e("agent",{state:()=>({agents:[],selectedAgentId:null,ui:{searchQuery:"",isLoading:!1}}),getters:{selectedAgent:e=>e.selectedAgentId?e.agents.find(t=>t.id===e.selectedAgentId):null,filteredAgents:e=>{const t=e.ui.searchQuery.toLowerCase().trim();return t?e.agents.filter(e=>e.name?.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags?.tags?.some(e=>e.toLowerCase().includes(t))):e.agents},agentsByStatus:e=>{const t={active:[],inactive:[],draft:[]};return e.agents.forEach(e=>{switch(e.status){case"ACTIVE":t.active.push(e);break;case"INACTIVE":default:t.inactive.push(e);break;case"DRAFT":t.draft.push(e)}}),t}},actions:{setSearchQuery(e){this.ui.searchQuery=e},setLoading(e){this.ui.isLoading=e},selectAgent(e){this.selectedAgentId=e},async createAgent(e){try{this.setLoading(!0);const t=new b,s=await t.create(e);return this.agents.push(s),this.selectAgent(s.id?.toString()||null),s}catch(t){throw t}finally{this.setLoading(!1)}},async updateAgent(e){try{this.setLoading(!0);const t=new b,s=await t.update(e),a=this.agents.findIndex(e=>e.id===s.id);return-1!==a&&(this.agents[a]=s),s}catch(t){throw t}finally{this.setLoading(!1)}},async retrieveAgent(e){try{this.setLoading(!0);const t=new b,s=await t.retrieve(e),a=this.agents.findIndex(e=>e.id===s.id);return-1!==a?this.agents[a]=s:this.agents.push(s),s}catch(t){throw t}finally{this.setLoading(!1)}},async deleteAgent(e){try{this.setLoading(!0);const t=new b,s=await t.delete(e);return s&&(this.agents=this.agents.filter(t=>t.id!==e),this.selectedAgentId===e.toString()&&this.selectAgent(null)),s}catch(t){throw t}finally{this.setLoading(!1)}},async list(e,t){try{this.setLoading(!0);const s=new b;null==(t=t||{page:0,size:10}).page&&(t.page=0),null==t.size&&(t.size=10);const a=await s.listByPage(e,t);if(0===t?.page)this.agents=a.content||[];else{const e=new Set(this.agents.map(e=>e.id)),t=(a.content||[]).filter(t=>!e.has(t.id));this.agents.push(...t)}return a}catch(s){throw s}finally{this.setLoading(!1)}},async listPublic(e,t){try{this.setLoading(!0);const s=new b;null==(t=t||{page:0,size:10}).page&&(t.page=0),null==t.size&&(t.size=10);const a=await s.listPublic(e,t);if(0===t?.page)this.agents=a.content||[];else{const e=new Set(this.agents.map(e=>e.id)),t=(a.content||[]).filter(t=>!e.has(t.id));this.agents.push(...t)}return a}catch(s){throw s}finally{this.setLoading(!1)}},async toggleAgentStatus(e){try{const t=this.agents.find(t=>t.id===e);if(!t)throw new Error("智能体不存在");const s="ACTIVE"===t.status?"INACTIVE":"ACTIVE",a={...t,status:s};return await this.updateAgent(a)}catch(t){throw t}},getAgentsByCategory(e){return this.agents.filter(t=>t.categoryId===e)},getAgentsByType(e){return this.agents.filter(t=>t.type===e)},clearAgents(){this.agents=[],this.selectAgent(null)},reset(){this.agents=[],this.selectedAgentId=null,this.ui.searchQuery="",this.ui.isLoading=!1}}}),B={class:"sdkwork-agents-list-item__content"},z={class:"default-agent-item"},C={class:"agent-avatar"},_={class:"avatar-placeholder"},j={key:0,class:"selection-checkbox"},M={class:"agent-info"},$={class:"agent-header"},T={class:"agent-name"},D={class:"agent-description"},E={class:"agent-footer"},N={class:"time-info"},Q={class:"time-text"},V={class:"usage-info"},F={class:"count-text"},P={class:"action-section"},U={key:0,class:"delete-section"},R={class:"agent-action"},K=v(t({__name:"sdkwork-agents-list-item",props:{agent:{},index:{},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},showBorderBottom:{type:Boolean,default:!0},themeMode:{default:"auto"}},emits:["click","select","delete"],setup(e,{expose:t,emit:h}){const p=e,m=h,f=s(()=>"dark"===p.themeMode||"light"!==p.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),v=s(()=>f.value?"sdkwork-agents-list-item--dark":"sdkwork-agents-list-item--light"),k=e=>{p.selectable&&m("select",p.agent)},b=()=>{p.disabled||(p.selectable?k(p.isSelected):m("click",p.agent))},A=()=>{p.deletable&&m("delete",p.agent)},S=e=>{const t=window.$date.parse(e),s=(new Date).getTime()-t.getTime();return s<6e4?"刚刚更新":s<36e5?`${Math.floor(s/6e4)}分钟前`:s<864e5?`${Math.floor(s/36e5)}小时前`:s<6048e5?`${Math.floor(s/864e5)}天前`:t.toLocaleDateString()};return t({getName:()=>p.agent.name,getDescription:()=>p.agent.description,getUsageCount:()=>p.agent.usageCount,formatLastUpdate:S,isSelected:()=>p.isSelected}),(t,s)=>{const h=w,p=L,m=I,f=y;return i(),a("div",{class:c(["sdkwork-agents-list-item",[{"sdkwork-agents-list-item--selected":e.isSelected,"sdkwork-agents-list-item--selectable":e.selectable,"sdkwork-agents-list-item--deletable":e.deletable,"sdkwork-agents-list-item--disabled":e.disabled,"sdkwork-agents-list-item--border-bottom":e.showBorderBottom},v.value]]),onClick:b},[n("div",B,[l(t.$slots,"default",{agent:e.agent,index:e.index,selected:e.isSelected},()=>[n("div",z,[n("div",C,[o(p,{src:e.agent.faceImage?.url,width:"48",height:"48",radius:"8",fit:"cover",alt:e.agent.name},{error:r(()=>[n("div",_,[o(h,{name:"user-circle-o",size:"24"})])]),_:1},8,["src","alt"]),n("div",{class:c(["status-indicator",`status-${e.agent.status}`])},null,2),e.selectable?(i(),a("div",j,[o(m,{"model-value":e.isSelected,"onUpdate:modelValue":k,onClick:s[0]||(s[0]=g(()=>{},["stop"]))},null,8,["model-value"])])):d("",!0)]),n("div",M,[n("div",$,[n("div",T,u(e.agent.name),1)]),n("div",D,u(e.agent.description||"暂无描述"),1),n("div",E,[n("div",N,[o(h,{name:"clock-o",size:"12"}),n("span",Q,u(S(e.agent.updatedAt)),1)]),n("div",V,[o(h,{name:"play-circle",size:"12"}),n("span",F,u(e.agent.usageCount)+"次使用",1)])])]),n("div",P,[e.deletable?(i(),a("div",U,[o(f,{type:"danger",round:"",onClick:g(A,["stop"]),class:"delete-button"},{default:r(()=>[o(h,{name:"delete",size:"14"})]),_:1})])):d("",!0),n("div",R,[o(h,{name:"arrow",size:"16"})])])])],!0)])],2)}}}),[["__scopeId","data-v-7af63f9f"]]),O=v(t({__name:"sdkwork-agent-list",props:{api:{},params:{default:()=>({})},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1},pageSize:{default:10},agentKey:{default:"id"},agentNameField:{default:"name"},agentDescriptionField:{default:"description"}},emits:["select","delete","click","search","load"],setup(e,{expose:t,emit:a}){const d=e,c=a,g=h(),u=h(!1);p(()=>{(()=>{const e=navigator.userAgent.toLowerCase();u.value=/micromessenger/.test(e)})()});const w=s(()=>({pageNumber:0,pageSize:d.pageSize,filters:d.params})),y=e=>{c("select",e)},v=e=>{c("delete",e)},b=e=>{c("search",e)},L=e=>{c("load",e)},I=e=>{c("select",e)},x=e=>{c("click",e)};return t({refresh:()=>g.value?.refresh(),loadMore:()=>g.value?.loadMore(),getAgents:()=>g.value?.getData()||[],getSelectedAgents:()=>g.value?.getSelectedItems()||[],clearSelected:()=>g.value?.clearSelected(),setSelectedAgents:e=>g.value?.setSelectedItems(e)}),(t,s)=>{const a=A,d=k;return i(),m(S,{api:e.api,params:w.value,selectable:e.selectable,deletable:e.deletable,searchable:e.searchable,"page-size":e.pageSize,"item-key":e.agentKey,"item-title-field":e.agentNameField,"item-description-field":e.agentDescriptionField,"left-spacing":0,"right-spacing":0,onSelect:y,onDelete:v,onSearch:b,onLoad:L,ref_key:"apiListRef",ref:g,showBorderBottom:"",borderBottomLeftOffset:70},{default:r(({item:e,index:t,selected:s})=>[o(K,{agent:e,"is-selected":s,"show-border-bottom":!0,onClick:x,onSelect:I},null,8,["agent","is-selected"])]),empty:r(()=>[l(t.$slots,"empty",{},()=>[o(a,{description:"暂无智能体",image:"search"},{description:r(()=>[...s[0]||(s[0]=[n("div",{class:"empty-description"},[n("p",null,"暂时没有智能体"),n("p",{class:"empty-tip"},"您可以创建新的智能体或调整搜索条件")],-1)])]),_:1})],!0)]),loading:r(()=>[l(t.$slots,"loading",{},()=>[o(d,{size:"24px",vertical:""},{default:r(()=>[...s[1]||(s[1]=[f("加载智能体数据...",-1)])]),_:1})],!0)]),header:r(()=>[l(t.$slots,"header",{},void 0,!0)]),footer:r(()=>[l(t.$slots,"footer",{},void 0,!0)]),_:3},8,["api","params","selectable","deletable","searchable","page-size","item-key","item-title-field","item-description-field"])}}}),[["__scopeId","data-v-4cbb9c59"]]);export{O as _,x as u};
