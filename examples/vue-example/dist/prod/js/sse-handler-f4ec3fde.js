import{M as t,o as e,aY as n,j as o}from"./index-34815b62.js";import{M as s}from"./chat-a822f911.js";import"./vue-vendor-905d75e5.js";import"./utils-vendor-b5712723.js";import"./conversation-fd40c340.js";import"./sdkwork_stream_player-bba47a70.js";class a{agentChatManager;constructor(){this.agentChatManager=t.create(e.AgentChatManager)}async stop(t,e){const n=await this.agentChatManager.stop(t,e);return null==n||null==n.data?Promise.reject(new Error("data error!")):n.data}async create(t,e,n){const o=await this.agentChatManager.create(t,e,n);if(t.stream)return o;return o.data}async resumeStream(t,e,n){const o=await this.agentChatManager.resumeStream(t,e,n);if(t.stream)return o;return o.data}}class c{name="SseMessageHandler";connectionState;eventEmitter;eventAdapter;config;constructor(t,e,o){this.config=t,this.eventEmitter=e,this.eventAdapter=o,this.connectionState={state:n.DISCONNECTED,connected:!1}}async initialize(){try{await this.setupSseConnection(),this.setupEventListeners(),this.updateConnectionState({state:n.CONNECTED,connected:!0})}catch(t){throw this.eventEmitter.emit(this.eventAdapter.adaptErrorOccurred(t)),t}}disconnect(){this.updateConnectionState({state:n.DISCONNECTED,connected:!1})}startListening(){console.log("SSE开始监听")}stopListening(){console.log("SSE停止监听")}async send(t,e){console.log("SSE发送消息:",t);const n=new a;let c;c="string"==typeof t?{messages:[{role:o.ChatCompletionRole.user,content:t}],stream:!0}:s.toCompletionParam(t);const i=await n.create(c,{conversationId:e.conversation_id,id:e.agent_id});for await(const o of i)this.eventEmitter.emit(this.eventAdapter.adaptMessageChunkReceived({chunk:o,channelMsgId:o.id,id:o.id}))}sendAudioStream(t,e,n){console.log("SSE发送音频流")}sendHello(t,e){console.log("SSE发送Hello消息:",t)}sendEvent(t,e){console.log("SSE发送事件:",t,e)}sendProtocol(t){console.log("SSE发送协议:",t)}getConnectionState(){return this.connectionState}isConnected(){return this.connectionState.connected}onEvent(t,e){console.log("SSE注册事件监听器:",t)}onMessage(t){console.log("SSE注册消息监听器")}onAudioStream(t){console.log("SSE注册音频流监听器")}onData(t){console.log("SSE注册数据监听器")}onToolCall(t){console.log("SSE注册工具调用监听器")}offData(t){console.log("SSE移除数据监听器")}offEvent(t,e){console.log("SSE移除事件监听器:",t)}onError(t){console.log("SSE注册错误监听器")}offError(t){console.log("SSE移除错误监听器")}async destroy(){this.disconnect(),console.log("SSE处理器已销毁")}async reconnect(){console.log("SSE重新连接..."),this.disconnect(),await this.initialize()}enter(t){console.log("SSE进入聊天:",t.chatContext)}exit(t){console.log("SSE退出聊天:",t.chatContext)}abort(t){console.log("SSE中断聊天")}async setupSseConnection(){console.log("设置SSE连接")}setupEventListeners(){console.log("设置SSE事件监听器")}updateConnectionState(t){this.connectionState=t,this.eventEmitter.emit(this.eventAdapter.adaptConnectionChange(t))}}export{c as SseMessageHandler};
