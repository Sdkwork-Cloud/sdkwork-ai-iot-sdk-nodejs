import{aO as e,t as a,q as l,n as o,v as t,c as s,D as i,ab as r,E as n,I as u,b as d,a1 as c,G as f,w as h}from"./index-Cw3XK0oB.js";import{u as p}from"./use-refs-D3gLi3Li.js";import{k as v,r as m,f as b,j as g}from"./vue-vendor-CnVaDBlt.js";const[y,x]=s("rate");const w=h(v({name:y,props:{size:o,icon:l("star"),color:String,count:t(5),gutter:o,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:l("star-o"),allowHalf:Boolean,voidColor:String,touchable:a,iconPrefix:String,modelValue:e(0),disabledColor:String},emits:["change","update:modelValue"],setup(e,{emit:a}){const l=i(),[o,t]=p(),s=m(),h=b(()=>e.readonly||e.disabled),v=b(()=>h.value||!e.touchable),y=b(()=>Array(+e.count).fill("").map((a,l)=>function(e,a,l,o){if(e>=a)return{status:"full",value:1};if(e+.5>=a&&l&&!o)return{status:"half",value:.5};if(e+1>=a&&l&&o){const l=10**10;return{status:"half",value:Math.round((e-a+1)*l)/l}}return{status:"void",value:0}}(e.modelValue,l+1,e.allowHalf,e.readonly)));let w,E,V=Number.MAX_SAFE_INTEGER,z=Number.MIN_SAFE_INTEGER;const H=()=>{E=f(s);const a=o.value.map(f);w=[],a.forEach((a,l)=>{V=Math.min(a.top,V),z=Math.max(a.top,z),e.allowHalf?w.push({score:l+.5,left:a.left,top:a.top,height:a.height},{score:l+1,left:a.left+a.width/2,top:a.top,height:a.height}):w.push({score:l+1,left:a.left,top:a.top,height:a.height})})},I=(a,l)=>{for(let e=w.length-1;e>0;e--)if(l>=E.top&&l<=E.bottom){if(a>w[e].left&&l>=w[e].top&&l<=w[e].top+w[e].height)return w[e].score}else{const o=l<E.top?V:z;if(a>w[e].left&&w[e].top===o)return w[e].score}return e.allowHalf?.5:1},P=l=>{h.value||l===e.modelValue||(a("update:modelValue",l),a("change",l))},S=e=>{v.value||(l.start(e),H())},C=(a,o)=>{const{icon:s,size:i,color:r,count:n,gutter:c,voidIcon:f,disabled:h,voidColor:p,allowHalf:v,iconPrefix:m,disabledColor:b}=e,y=o+1,w="full"===a.status,E="void"===a.status,V=v&&a.value>0&&a.value<1;let z;c&&y!==+n&&(z={paddingRight:d(c)});return g("div",{key:o,ref:t(o),role:"radio",style:z,class:x("item"),tabindex:h?void 0:0,"aria-setsize":n,"aria-posinset":y,"aria-checked":!E,onClick:a=>{H();let o=v?I(a.clientX,a.clientY):y;e.clearable&&l.isTap.value&&o===e.modelValue&&(o=0),P(o)}},[g(u,{size:i,name:w?s:f,class:x("icon",{disabled:h,full:w}),color:h?b:w?r:p,classPrefix:m},null),V&&g(u,{size:i,style:{width:a.value+"em"},name:E?f:s,class:x("icon",["half",{disabled:h,full:!E}]),color:h?b:E?p:r,classPrefix:m},null)])};return r(()=>e.modelValue),n("touchmove",e=>{if(!v.value&&(l.move(e),l.isHorizontal()&&!l.isTap.value)){const{clientX:a,clientY:l}=e.touches[0];c(e),P(I(a,l))}},{target:s}),()=>g("div",{ref:s,role:"radiogroup",class:x({readonly:e.readonly,disabled:e.disabled}),tabindex:e.disabled?void 0:0,"aria-disabled":e.disabled,"aria-readonly":e.readonly,onTouchstartPassive:S},[y.value.map(C)])}}));export{w as R};
