import{c as e,t as a,r as t,n as i,E as l,T as s,U as o,D as n,C as r,$ as u,a0 as v,F as c,Z as h,a1 as p,a2 as d,a3 as f,w as g,W as w}from"./index-B1-5rbib.js";import{k as m,r as x,c as b,f as y,w as C,b as $,d as S,a as z,l as M,j as T,n as k}from"./vue-vendor-Caw1HGjZ.js";const[D,E]=e("swipe"),I={loop:a,width:i,height:i,vertical:Boolean,autoplay:t(0),duration:t(500),touchable:a,lazyRender:Boolean,initialSwipe:t(0),indicatorColor:String,showIndicators:a,stopPropagation:a},O=Symbol(D);const X=g(m({name:D,props:I,emits:["change","dragStart","dragEnd"],setup(e,{emit:a,slots:t}){const i=x(),g=x(),w=b({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let m=!1;const D=l(),{children:I,linkChildren:X}=s(O),Y=y(()=>I.length),j=y(()=>w[e.vertical?"height":"width"]),P=y(()=>e.vertical?D.deltaY.value:D.deltaX.value),B=y(()=>{if(w.rect){return(e.vertical?w.rect.height:w.rect.width)-j.value*Y.value}return 0}),F=y(()=>j.value?Math.ceil(Math.abs(B.value)/j.value):Y.value),R=y(()=>Y.value*j.value),W=y(()=>(w.active+Y.value)%Y.value),A=y(()=>{const a=e.vertical?"vertical":"horizontal";return D.direction.value===a}),H=y(()=>{const a={transitionDuration:`${w.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+w.offset.toFixed(2)}px)`};if(j.value){const t=e.vertical?"height":"width",i=e.vertical?"width":"height";a[t]=`${R.value}px`,a[i]=e[i]?`${e[i]}px`:""}return a}),U=(a,t=0)=>{let i=a*j.value;e.loop||(i=Math.min(i,-B.value));let l=t-i;return e.loop||(l=f(l,B.value,0)),l},Z=({pace:t=0,offset:i=0,emitChange:l})=>{if(Y.value<=1)return;const{active:s}=w,o=(a=>{const{active:t}=w;return a?e.loop?f(t+a,-1,Y.value):f(t+a,0,F.value):t})(t),n=U(o,i);if(e.loop){if(I[0]&&n!==B.value){const e=n<B.value;I[0].setOffset(e?R.value:0)}if(I[Y.value-1]&&0!==n){const e=n>0;I[Y.value-1].setOffset(e?-R.value:0)}}w.active=o,w.offset=n,l&&o!==s&&a("change",W.value)},q=()=>{w.swiping=!0,w.active<=-1?Z({pace:Y.value}):w.active>=Y.value&&Z({pace:-Y.value})},G=()=>{q(),D.reset(),h(()=>{w.swiping=!1,Z({pace:1,emitChange:!0})})};let J;const K=()=>clearTimeout(J),L=()=>{K(),+e.autoplay>0&&Y.value>1&&(J=setTimeout(()=>{G(),L()},+e.autoplay))},N=(a=+e.initialSwipe)=>{if(!i.value)return;const t=()=>{var t,l;if(!p(i)){const a={width:i.value.offsetWidth,height:i.value.offsetHeight};w.rect=a,w.width=+(null!=(t=e.width)?t:a.width),w.height=+(null!=(l=e.height)?l:a.height)}Y.value&&-1===(a=Math.min(Y.value-1,a))&&(a=Y.value-1),w.active=a,w.swiping=!0,w.offset=U(a),I.forEach(e=>{e.setOffset(0)}),L()};p(i)?k().then(t):t()},Q=()=>N(w.active);let V;const _=a=>{!e.touchable||a.touches.length>1||(D.start(a),m=!1,V=Date.now(),K(),q())},ee=()=>{if(!e.touchable||!w.swiping)return;const t=Date.now()-V,i=P.value/t;if((Math.abs(i)>.25||Math.abs(P.value)>j.value/2)&&A.value){const a=e.vertical?D.offsetY.value:D.offsetX.value;let t=0;t=e.loop?a>0?P.value>0?-1:1:0:-Math[P.value>0?"ceil":"floor"](P.value/j.value),Z({pace:t,emitChange:!0})}else P.value&&Z({pace:0});m=!1,w.swiping=!1,a("dragEnd",{index:W.value}),L()},ae=(a,t)=>{const i=t===W.value,l=i?{backgroundColor:e.indicatorColor}:void 0;return T("i",{style:l,class:E("indicator",{active:i})},null)};return o({prev:()=>{q(),D.reset(),h(()=>{w.swiping=!1,Z({pace:-1,emitChange:!0})})},next:G,state:w,resize:Q,swipeTo:(a,t={})=>{q(),D.reset(),h(()=>{let i;i=e.loop&&a===Y.value?0===w.active?0:a:a%Y.value,t.immediate?h(()=>{w.swiping=!1}):w.swiping=!1,Z({pace:i-w.active,emitChange:!0})})}}),X({size:j,props:e,count:Y,activeIndicator:W}),C(()=>e.initialSwipe,e=>N(+e)),C(Y,()=>N(w.active)),C(()=>e.autoplay,L),C([n,r,()=>e.width,()=>e.height],Q),C(u(),e=>{"visible"===e?L():K()}),$(N),S(()=>N(w.active)),v(()=>N(w.active)),z(K),M(K),c("touchmove",t=>{if(e.touchable&&w.swiping&&(D.move(t),A.value)){!e.loop&&(0===w.active&&P.value>0||w.active===Y.value-1&&P.value<0)||(d(t,e.stopPropagation),Z({offset:P.value}),m||(a("dragStart",{index:W.value}),m=!0))}},{target:g}),()=>{var a;return T("div",{ref:i,class:E()},[T("div",{ref:g,style:H.value,class:E("track",{vertical:e.vertical}),onTouchstartPassive:_,onTouchend:ee,onTouchcancel:ee},[null==(a=t.default)?void 0:a.call(t)]),t.indicator?t.indicator({active:W.value,total:Y.value}):e.showIndicators&&Y.value>1?T("div",{class:E("indicators",{vertical:e.vertical})},[Array(Y.value).fill("").map(ae)]):void 0])}}})),[Y,j]=e("swipe-item");const P=g(m({name:Y,setup(e,{slots:a}){let t;const i=b({offset:0,inited:!1,mounted:!1}),{parent:l,index:s}=w(O);if(!l)return;const n=y(()=>{const e={},{vertical:a}=l.props;return l.size.value&&(e[a?"height":"width"]=`${l.size.value}px`),i.offset&&(e.transform=`translate${a?"Y":"X"}(${i.offset}px)`),e}),r=y(()=>{const{loop:e,lazyRender:a}=l.props;if(!a||t)return!0;if(!i.mounted)return!1;const o=l.activeIndicator.value,n=l.count.value-1,r=0===o&&e?n:o-1,u=o===n&&e?0:o+1;return t=s.value===o||s.value===r||s.value===u,t});return $(()=>{k(()=>{i.mounted=!0})}),o({setOffset:e=>{i.offset=e}}),()=>{var e;return T("div",{class:j(),style:n.value},[r.value?null==(e=a.default)?void 0:e.call(a):null])}}}));export{X as S,P as a};
