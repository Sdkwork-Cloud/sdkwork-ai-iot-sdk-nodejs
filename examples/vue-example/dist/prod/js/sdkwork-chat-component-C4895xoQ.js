import{S as e}from"./sdkwork-page-container-BGwWri5J.js";import{k as a,r as t,P as o,Q as n,S as i,W as l,u as s,j as c,w as r,s as d,a8 as u,n as v,b as m,o as p,f as g,T as h,a0 as y,R as f,F as k,Y as w,$ as b,V as E,Z as C,U as _,v as S,a3 as I,O as T}from"./vue-vendor-CnVaDBlt.js";import{d as D,_ as x,i as A,j as M,l as B,A as R,s as O}from"./index-lnKdqbPs.js";import{_ as N}from"./app-header-BEBNJPI5.js";import{u as F,M as L,a as P}from"./chat-DFKG83Wm.js";import{u as U}from"./conversation-ELJPpu2X.js";import{_ as K}from"./sdkwork-chat-message-list-BvP2HySJ.js";import{N as j}from"./index-CsVtsH8F.js";import{_ as $,S as V}from"./sdkwork-subtitles-hTshrJdj.js";var z=(e=>(e.SEND_MESSAGE="send-message",e.SEND_VOICE="send-voice",e.SEND_FILE="send-file",e.SEND_IMAGE="send-image",e.SEND_VIDEO="send-video",e.SEND_RTC_REQUEST="send-rtc-request",e.SEND_LOCATION="send-location",e.INPUT_FOCUS="input-focus",e.INPUT_BLUR="input-blur",e.TEXT_CHANGE="text-change",e.UPLOAD_PROGRESS="upload-progress",e.KEY_DOWN="key-down",e.KEY_UP="key-up",e.KEY_PRESS="key-press",e.INPUT="input",e.COMPOSITION_START="composition-start",e.COMPOSITION_UPDATE="composition-update",e.COMPOSITION_END="composition-end",e.SCROLL="scroll",e.SCROLL_TOP="scroll-top",e.SCROLL_BOTTOM="scroll-bottom",e.KEYBOARD_SHOW="keyboard-show",e.KEYBOARD_HIDE="keyboard-hide",e.PASTE="paste",e.CUT="cut",e.COPY="copy",e.SELECTION_CHANGE="selection-change",e))(z||{});const H={class:"chat-input-tool-panel"},G={class:"tool-section"},Y={class:"tool-grid"},W=["disabled"],X={class:"tool-icon-wrapper"},q={key:0,class:"loading-spinner"},Q=["disabled"],Z={class:"tool-icon-wrapper"},J={key:0,class:"loading-spinner"},ee=["disabled"],ae={class:"tool-icon-wrapper"},te={key:0,class:"loading-spinner"},oe=["disabled"],ne={class:"tool-icon-wrapper"},ie={key:0,class:"loading-spinner"},le=x(a({__name:"chat-input-tool-panel",props:{enableCamera:{type:Boolean,default:!0},targetUserId:{default:""},conversationId:{}},emits:["select-tool","send-image","send-file","send-video","send-rtc-request","send-location","take-photo"],setup(e,{emit:a}){const r=e,d=a,u="image",v="file",m="camera",p="video",g="location",h="voice-call",y="video-call",f=t({}),k=e=>{d("select-tool",e)},w=async e=>{const a={image:"chooseImage",file:"chooseFile",video:"chooseVideo"};try{f.value[e]=!0;return await window.$files[a[e]]({count:1,success:e=>e.tempFiles&&e.tempFiles[0]?e.tempFiles[0]:null,fail:a=>{throw new Error(`ÈÄâÊã©${e}Â§±Ë¥•: ${a.message||a}`)}})}catch(t){return null}finally{f.value[e]=!1}},b=(e,a)=>{if(e.size>10485760)return!1;switch(a){case"image":return e.type.startsWith("image/");case"video":return e.type.startsWith("video/");case"file":return!0;default:return!1}},E={async image(){k(u);const e=await w("image");e&&b(e,"image")&&d("send-image",e)},async file(){k(v);const e=await w("file");e&&b(e,"file")&&d("send-file",e)},async video(){k(p);const e=await w("video");e&&b(e,"video")&&d("send-video",e)},camera(){k(m),d("take-photo")},async location(){if(k(g),navigator.geolocation)try{f.value.location=!0;const e=await new Promise((e,a)=>{navigator.geolocation.getCurrentPosition(e,a,{timeout:1e4,enableHighAccuracy:!0})}),{latitude:a,longitude:t}=e.coords;d("send-location",a,t)}catch(e){}finally{f.value.location=!1}},voiceCall(){k(h),d("send-rtc-request","voice",r.targetUserId)},videoCall(){k(y),d("send-rtc-request","video",r.targetUserId)}},{image:C,file:_,video:S,camera:I,location:T,voiceCall:x,videoCall:A}=E;return(a,t)=>(n(),o("div",H,[i("div",G,[t[14]||(t[14]=i("h4",{class:"section-title"},"Â∏∏Áî®Â∑•ÂÖ∑",-1)),i("div",Y,[i("button",{class:"tool-item",onClick:t[0]||(t[0]=(...e)=>s(C)&&s(C)(...e)),disabled:f.value.image},[i("div",X,[c(s(D),{icon:"mdi:image",width:"28",height:"28",class:"tool-icon"}),f.value.image?(n(),o("div",q)):l("",!0)]),t[7]||(t[7]=i("div",{class:"tool-label"},"ÂõæÁâá",-1))],8,W),i("button",{class:"tool-item",onClick:t[1]||(t[1]=(...e)=>s(_)&&s(_)(...e)),disabled:f.value.file},[i("div",Z,[c(s(D),{icon:"mdi:file-document-outline",width:"28",height:"28",class:"tool-icon"}),f.value.file?(n(),o("div",J)):l("",!0)]),t[8]||(t[8]=i("div",{class:"tool-label"},"Êñá‰ª∂",-1))],8,Q),e.enableCamera?(n(),o("button",{key:0,class:"tool-item",onClick:t[2]||(t[2]=(...e)=>s(I)&&s(I)(...e))},[c(s(D),{icon:"mdi:camera",width:"28",height:"28",class:"tool-icon"}),t[9]||(t[9]=i("div",{class:"tool-label"},"Áõ∏Êú∫",-1))])):l("",!0),i("button",{class:"tool-item",onClick:t[3]||(t[3]=(...e)=>s(S)&&s(S)(...e)),disabled:f.value.video},[i("div",ae,[c(s(D),{icon:"mdi:video",width:"28",height:"28",class:"tool-icon"}),f.value.video?(n(),o("div",te)):l("",!0)]),t[10]||(t[10]=i("div",{class:"tool-label"},"ËßÜÈ¢ë",-1))],8,ee),i("button",{class:"tool-item",onClick:t[4]||(t[4]=(...e)=>s(T)&&s(T)(...e)),disabled:f.value.location},[i("div",ne,[c(s(D),{icon:"mdi:map-marker",width:"28",height:"28",class:"tool-icon"}),f.value.location?(n(),o("div",ie)):l("",!0)]),t[11]||(t[11]=i("div",{class:"tool-label"},"‰ΩçÁΩÆ",-1))],8,oe),i("button",{class:"tool-item",onClick:t[5]||(t[5]=(...e)=>s(x)&&s(x)(...e))},[c(s(D),{icon:"mdi:microphone",width:"28",height:"28",class:"tool-icon"}),t[12]||(t[12]=i("div",{class:"tool-label"},"ËØ≠Èü≥ÈÄöËØù",-1))]),i("button",{class:"tool-item",onClick:t[6]||(t[6]=(...e)=>s(A)&&s(A)(...e))},[c(s(D),{icon:"mdi:video",width:"28",height:"28",class:"tool-icon"}),t[13]||(t[13]=i("div",{class:"tool-label"},"ËßÜÈ¢ëÈÄöËØù",-1))])])])]))}}),[["__scopeId","data-v-99a43ef4"]]),se={class:"chat-input-text-area"},ce=["placeholder","maxlength"],re={class:"input-actions"},de=x(a({__name:"chat-input-text-area",props:{placeholder:{default:"ËæìÂÖ•Ê∂àÊÅØ..."},maxLength:{default:1e3},enableEmoji:{type:Boolean,default:!0},modelValue:{default:""}},emits:["update:modelValue","text-change","keydown","keyup","keypress","focus","blur","toggle-emoji-panel","input-event","composition-start","composition-update","composition-end","scroll","paste","cut","copy","selection-change"],setup(e,{expose:a,emit:m}){const p=e,g=m,h=t(p.modelValue),y=t();r(()=>p.modelValue,e=>{h.value=e,R()});const f=e=>{g("update:modelValue",h.value),g("text-change",h.value),g("input-event",e),R()},k=e=>{g("keydown",e)},w=e=>{g("keyup",e)},b=e=>{g("keypress",e)},E=()=>{g("focus"),document.addEventListener("selectionchange",B)},C=()=>{g("blur"),document.removeEventListener("selectionchange",B)},_=e=>{g("composition-start",e)},S=e=>{g("composition-update",e)},I=e=>{g("composition-end",e)},T=e=>{g("scroll",e)},x=e=>{g("paste",e)},A=e=>{g("cut",e)},M=e=>{g("copy",e)},B=()=>{const e=y.value;e&&document.activeElement===e&&g("selection-change")},R=()=>{v(()=>{const e=y.value;e&&(e.style.height="24px",e.scrollHeight>24&&(e.style.height=Math.min(e.scrollHeight,120)+"px"))})};return a({focus:()=>y.value?.focus(),clear:()=>{h.value="",g("update:modelValue",""),R()}}),(a,t)=>(n(),o("div",se,[d(i("textarea",{ref_key:"textInputRef",ref:y,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),placeholder:e.placeholder,maxlength:e.maxLength,class:"text-input",onInput:f,onKeydown:k,onKeyup:w,onKeypress:b,onFocus:E,onBlur:C,onCompositionstart:_,onCompositionupdate:S,onCompositionend:I,onScroll:T,onPaste:x,onCut:A,onCopy:M},null,40,ce),[[u,h.value]]),i("div",re,[e.enableEmoji?(n(),o("button",{key:0,class:"emoji-button",onClick:t[1]||(t[1]=e=>a.$emit("toggle-emoji-panel"))},[c(s(D),{icon:"mdi:emoticon-happy-outline",width:"18",height:"18",class:"emoji-icon"})])):l("",!0)])]))}}),[["__scopeId","data-v-58e2963e"]]),ue={class:"chat-input-voice"},ve={key:0,class:"recording-overlay"},me={class:"recording-glass"},pe={class:"audio-visualizer"},ge={key:0,class:"wave-container"},he={class:"recording-time"},ye={class:"time-digits"},fe={class:"recording-controls"},ke={key:0,class:"error-message"},we={class:"voice-input"},be=["disabled"],Ee={class:"button-content"},Ce={class:"record-icon"},_e={class:"record-text"},Se=x(a({__name:"chat-input-voice",props:{disabled:{type:Boolean,default:!1},maxDuration:{default:60},minDuration:{default:1}},emits:["start-recording","stop-recording","recording-error","recording-cancelled","recording-timeout"],setup(e,{expose:a,emit:d}){const u=e,v=d,C=A(),_=t(!1),S=t(!1),I=t(0),T=t(!1);t(null),t(null),r(()=>C.currentState,(e,a)=>{"error"===e&&C.errorMessage&&v("recording-error",C.errorMessage),"stopped"!==e&&"idle"!==e||(T.value=!1,S.value=!1,I.value=0),"recording"===e&&"idle"===a&&(S.value=!1)}),r(()=>C.currentDuration,e=>{u.maxDuration>0&&e>=u.maxDuration&&C.isRecording&&F()}),r(()=>u.maxDuration,e=>{C.updateConfig({maxDuration:e})}),m(()=>{_.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>0||navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>0,_.value&&document.addEventListener("touchmove",x,{passive:!1}),C.updateConfig({maxDuration:u.maxDuration})}),p(()=>{_.value&&document.removeEventListener("touchmove",x),C.cleanup()});const x=e=>{if(!C.isRecording||!T.value)return;const a=e.touches[0],t=document.querySelector(".control-button.cancel-button"),o=document.querySelector(".control-button.finish-button"),n=t?.getBoundingClientRect(),i=n&&a.clientX>=n.left&&a.clientX<=n.right&&a.clientY>=n.top&&a.clientY<=n.bottom,l=o?.getBoundingClientRect(),s=l&&a.clientX>=l.left&&a.clientX<=l.right&&a.clientY>=l.top&&a.clientY<=l.bottom;i?(t?.classList.add("highlight"),o?.classList.remove("highlight"),!S.value&&navigator.vibrate&&navigator.vibrate(30),S.value=!0):s?(o?.classList.add("highlight"),t?.classList.remove("highlight"),S.value=!1):(t?.classList.remove("highlight"),o?.classList.remove("highlight"),S.value=!1),e.preventDefault()},M=g(()=>{const e=C.currentDuration,a=Math.floor(e/60);return`${a>0?`${a}:`:""}${(e%60).toString().padStart(2,"0")}`}),B=g(()=>C.currentDuration<u.minDuration);g(()=>u.maxDuration>0&&C.currentDuration>=u.maxDuration);const R=async e=>{if(e.preventDefault(),"touchstart"===e.type&&"ontouchstart"in window&&(e.stopPropagation(),I.value=Date.now(),T.value=!0),!u.disabled&&!C.isRecording&&"initializing"!==C.currentState){C.clearError(),S.value=!1;try{await C.startRecording({}),v("start-recording"),_.value&&navigator.vibrate&&navigator.vibrate(50)}catch(a){const e=a instanceof Error?a.message:"ÂΩïÈü≥ÂêØÂä®Â§±Ë¥•";v("recording-error",e),T.value=!1}}},O=async e=>{if(e.preventDefault(),"touchend"===e.type&&"ontouchstart"in window){if(e.stopPropagation(),S.value)return void N(e);if(Date.now()-I.value<200)return void(T.value=!1)}if(C.isRecording)if(B.value)N(e);else try{const e=await C.stopRecording();e&&e.data&&(v("stop-recording",e.data,e.duration),_.value&&navigator.vibrate&&navigator.vibrate([50,30,50]))}catch(a){const e=a instanceof Error?a.message:"ÂΩïÈü≥ÂÅúÊ≠¢Â§±Ë¥•";v("recording-error",e)}finally{T.value=!1}},N=e=>{e.preventDefault(),"touchcancel"===e.type&&"ontouchstart"in window&&e.stopPropagation(),C.isRecording&&(C.cancelRecording(),v("recording-cancelled"),_.value&&navigator.vibrate&&navigator.vibrate(100))},F=()=>{C.isRecording&&(O(new Event("timeout")),v("recording-timeout"))};return a({startRecording:async()=>R(new Event("programmatic")),stopRecording:async()=>O(new Event("programmatic")),cancelRecording:()=>{N(new Event("programmatic"))},isRecording:()=>C.isRecording,getRecordingDuration:()=>C.currentDuration}),(e,a)=>(n(),o("div",ue,[c(h,{name:"fade"},{default:y(()=>[s(C).isRecording?(n(),o("div",ve,[i("div",me,[i("div",pe,[c(s(D),{icon:"mdi:microphone",width:"64",height:"64",class:f(["recording-icon",{pulsing:s(C).isRecording}])},null,8,["class"]),s(C).isRecording?(n(),o("div",ge,[(n(),o(k,null,w(8,e=>i("div",{key:e,class:"wave-bar",style:E({animationDelay:.1*(e-1)+"s"})},null,4)),64))])):l("",!0)]),i("div",he,[i("span",ye,b(M.value),1),a[0]||(a[0]=i("span",{class:"time-unit"},"Áßí",-1))]),i("div",fe,[i("button",{class:"control-button finish-button",onClick:O,onTouchend:O},[c(s(D),{icon:"mdi:send-circle",width:"24",height:"24"})],32),i("button",{class:"control-button cancel-button",onClick:N,onTouchend:N},[c(s(D),{icon:"mdi:close-circle",width:"24",height:"24"})],32)])])])):l("",!0)]),_:1}),s(C).errorMessage?(n(),o("div",ke,b(s(C).errorMessage),1)):l("",!0),i("div",we,[i("button",{class:f(["voice-record-button",{disabled:u.disabled,"mobile-device":_.value,recording:s(C).isRecording}]),onMousedown:R,onMouseup:O,onTouchstart:R,onTouchend:O,disabled:u.disabled},[i("div",Ee,[i("span",Ce,[c(s(D),{icon:"mdi:microphone",width:"24",height:"24"})]),i("span",_e,b(u.disabled?"ËØ≠Èü≥ËæìÂÖ•":C.isRecording?"ÊùæÂºÄÂèëÈÄÅ":"Êåâ‰ΩèËØ¥ËØù"),1)])],42,be)])]))}}),[["__scopeId","data-v-f9f52cfd"]]),Ie=["disabled"],Te=x(a({__name:"chat-input-send-button",props:{canSend:{type:Boolean,default:!1}},emits:["send"],setup:(e,{emit:a})=>(a,t)=>(n(),o("button",{class:"chat-input-send-button",disabled:!e.canSend,onClick:t[0]||(t[0]=e=>a.$emit("send"))},[c(s(D),{icon:"mdi:send",width:"24",height:"24",class:"send-icon"})],8,Ie))}),[["__scopeId","data-v-601990e8"]]),De={class:"chat-input-emoji-panel"},xe={class:"emoji-categories"},Ae=["onClick"],Me={class:"emoji-grid"},Be=["onClick"],Re=x(a({__name:"chat-input-emoji-panel",emits:["select-emoji"],setup(e,{emit:a}){const l=t("Ë°®ÊÉÖ"),s=["Ë°®ÊÉÖ","‰∫∫Áâ©","Âä®Áâ©","È£üÁâ©","Ê¥ªÂä®","Á¨¶Âè∑"],c={"Ë°®ÊÉÖ":["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","üòÇ","ü§£","üòä","üòá"],"‰∫∫Áâ©":["üë∂","üëß","üë¶","üë©","üë®","üëµ","üë¥","üëÆ","üë∑","üíÇ"],"Âä®Áâ©":["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ"],"È£üÁâ©":["üçé","üçê","üçä","üçã","üçå","üçâ","üçá","üçì","üçà","üçí"],"Ê¥ªÂä®":["‚öΩ","üèÄ","üèà","‚öæ","üéæ","üèê","üèâ","üé±","üèì","üè∏"],"Á¨¶Âè∑":["‚ù§Ô∏è","üíõ","üíö","üíô","üíú","üñ§","üíî","‚ù£Ô∏è","üíï","üíû"]},r=g(()=>c[l.value]||[]);return(e,a)=>(n(),o("div",De,[i("div",xe,[(n(),o(k,null,w(s,e=>i("button",{key:e,class:f(["category-button",{active:l.value===e}]),onClick:a=>l.value=e},b(e),11,Ae)),64))]),i("div",Me,[(n(!0),o(k,null,w(r.value,a=>(n(),o("button",{key:a,class:"emoji-item",onClick:t=>e.$emit("select-emoji",a)},b(a),9,Be))),128))])]))}}),[["__scopeId","data-v-14e37487"]]),Oe={class:"chat-input"},Ne={class:"input-area flex flex-row items-center"},Fe={class:"input-left"},Le={class:"input-main"},Pe={class:"input-right"},Ue={class:"bottom-panels"},Ke={key:0,class:"tool-panel"},je=x(a({__name:"sdkwork-chat-input",props:{placeholder:{default:"ËæìÂÖ•Ê∂àÊÅØ..."},maxLength:{default:1e3},disabled:{type:Boolean,default:!1},enableVoice:{type:Boolean,default:!0},enableEmoji:{type:Boolean,default:!0},enableFileUpload:{type:Boolean,default:!0},enableCamera:{type:Boolean,default:!0},currentUserId:{},conversationId:{},allowedFileTypes:{default:()=>["image/*","video/*","audio/*",".pdf",".doc",".docx"]},allowMultipleFiles:{type:Boolean,default:!1}},emits:["chat-input-event","send"],setup(e,{emit:a}){const r=e,d=a,u=M(),v=U(),h=F(),y=t(""),k=t(!1),w=t(!1),b=t(!1),E=t(!1),_=t(0),S=t(0),I=t(!1),T=t(0),x=g(()=>y.value.trim().length>0||E.value),A=(e,a,t)=>{const o={type:e,payload:a,timestamp:Date.now(),metadata:t};d("chat-input-event",o)},O=()=>{const e=v.currentConversation,a=h.lastMessage;return{conversation_id:e?.id||r.conversationId||"",user_id:u.currentUser?.id,knowledge_base_id:e?.knowledgeBaseId||"",agent_id:e?.agentId||"",datasource_id:e?.dataSourceId||"",parent_message_id:a?.id,save_audio:!1}},N=e=>{y.value=e,A(z.TEXT_CHANGE,{text:e})},P=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ne()),A(z.KEY_DOWN,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},K=e=>{A(z.KEY_UP,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},j=e=>{A(z.KEY_PRESS,{key:e.key,code:e.code,keyCode:e.keyCode,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,event:e})},$=e=>{A(z.INPUT,{value:y.value,inputType:e.inputType,data:e.data,event:e})},V=e=>{A(z.COMPOSITION_START,{data:e.data,event:e})},H=e=>{A(z.COMPOSITION_UPDATE,{data:e.data,event:e})},G=e=>{A(z.COMPOSITION_END,{data:e.data,event:e})},Y=e=>{const a=e.target,t=a.scrollTop,o=a.scrollHeight,n=a.clientHeight,i=t>(S.value||0)?"down":"up";S.value=t,A(z.SCROLL,{scrollTop:t,scrollHeight:o,clientHeight:n,scrollDirection:i,event:e}),0===t&&A(z.SCROLL_TOP,{scrollTop:t,scrollHeight:o,clientHeight:n,event:e}),t+n>=o-10&&A(z.SCROLL_BOTTOM,{scrollTop:t,scrollHeight:o,clientHeight:n,event:e})},W=e=>{const a=e.clipboardData?.getData("text")||"";A(z.PASTE,{data:a,type:"paste",event:e})},X=e=>{const a=e.clipboardData?.getData("text")||"";A(z.CUT,{data:a,type:"cut",event:e})},q=e=>{const a=e.clipboardData?.getData("text")||"";A(z.COPY,{data:a,type:"copy",event:e})},Q=()=>{const e=document.querySelector(".text-input");e&&A(z.SELECTION_CHANGE,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,selectedText:e.value.substring(e.selectionStart,e.selectionEnd)})},Z=()=>{if("undefined"==typeof window)return;const e=window.innerHeight,a=document.documentElement.clientHeight,t=e<a-100;t!==I.value&&(I.value=t,T.value=Math.max(0,a-e),A(t?z.KEYBOARD_SHOW:z.KEYBOARD_HIDE,{keyboardHeight:T.value,viewportHeight:e,isVisible:t}))},J=()=>{Z()};m(()=>{window.addEventListener("resize",J),Z()}),p(()=>{window.removeEventListener("resize",J)});const ee=()=>{k.value=!k.value,w.value=!1},ae=()=>{b.value=!b.value,k.value=!1,w.value=!1},te=()=>{w.value=!w.value,k.value=!1},oe=e=>{y.value+=e,A(z.TEXT_CHANGE,{text:y.value})},ne=async()=>{if(!x.value)return;const e=y.value.trim();if(e)try{const a={messageType:B.MessageType.TEXT,context:O()},t=L.createTextMessage({content:e},a);d("send",t),A(z.SEND_MESSAGE,{message:{senderId:u.currentUser?.id||"",receiverId:"",content:e,type:B.MessageType.TEXT}}),y.value="",A(z.TEXT_CHANGE,{text:""})}catch(a){}},ie=()=>{E.value=!0,_.value=Date.now()},se=async(e,a)=>{if(E.value){E.value=!1;try{const o={messageType:B.MessageType.AUDIO,context:O()};let n;try{const t=await re(e,"audio/wav");n=L.createAudioMessageByUrl({url:t,duration:a,format:B.AudioFormat.wav},{...o})}catch(t){n=L.createAudioMessage({file:e,duration:a,format:B.AudioFormat.wav},{...o})}d("send",n),A(z.SEND_VOICE,{data:e,duration:a})}catch(o){}}},ce=e=>{},re=async(e,a)=>{if(!window.$uploader)throw new Error("‰∏ä‰º†Âô®Êú™ÂàùÂßãÂåñÔºåËØ∑Á°Æ‰øùwindow.$uploader = createUploader()Â∑≤ÊâßË°å");const{fileToUpload:t,fileName:o,fileSize:n,detectedFormat:i}=await ue(e,a),l=ve(a,t.type),s={file:t,name:o,scene:"chat-message",contentType:l,acl:"public-read",metadata:{uploadTime:Date.now().toString(),source:"chat-input",conversationId:r.conversationId||"unknown",originalMimeType:a,detectedFormat:i}};try{return(await window.$uploader.upload(s,e=>{A(z.UPLOAD_PROGRESS,{fileName:o,format:i,progress:e.percentage,loaded:e.loaded,total:e.total,contentType:l})})).url}catch(c){throw new Error(`Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•: ${c instanceof Error?c.message:"Êú™Áü•ÈîôËØØ"}`)}},ue=async(e,a)=>{let t,o,n,i="unknown";if(e instanceof File)t=e,o=e.name,n=e.size,i=me(o)||pe(e.type);else if(e instanceof Blob){if(i=R.detectAudioFormat(e)||pe(e.type),"pcm"===i||"audio/pcm"===e.type){const a=await R.blobToArrayBuffer(e);t=R.pcmToWav(a,16e3,1,16),i="wav"}else t=e;o=`audio_${Date.now()}.${i}`,n=t.size}else t=new Blob([e],{type:a||"application/octet-stream"}),o=`file_${Date.now()}.dat`,n=t.size,i=pe(a)||"binary";return{fileToUpload:t,fileName:o,fileSize:n,detectedFormat:i}},ve=(e,a)=>e&&"application/octet-stream"!==e?e:a&&"application/octet-stream"!==a?a:"application/octet-stream",me=e=>{const a=e.match(/\.([a-zA-Z0-9]+)$/);return a?a[1].toLowerCase():null},pe=e=>{if(!e)return null;return{"audio/wav":"wav","audio/mp3":"mp3","audio/mpeg":"mp3","audio/ogg":"ogg","audio/flac":"flac","image/jpeg":"jpg","image/png":"png","image/gif":"gif","video/mp4":"mp4","application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx"}[e]||null},ge=async e=>{try{const a=await re(e),t={messageType:B.MessageType.FILE,context:O()},o=L.createFileMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(z.SEND_FILE,{file:e,fileType:"file"})}catch(a){}},he=async e=>{try{const a=await re(e),t={messageType:B.MessageType.IMAGE,context:O()},o=L.createImageMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(z.SEND_IMAGE,{file:e,fileType:"image"})}catch(a){}},ye=async e=>{try{const a=await re(e),t={messageType:B.MessageType.VIDEO,context:O()},o=L.createVideoMessageByUrl({url:a,name:e.name,size:e.size},t);d("send",o),A(z.SEND_VIDEO,{file:e,fileType:"video"})}catch(a){}};return(a,t)=>(n(),o("div",Oe,[i("div",Ne,[i("div",Fe,[e.enableVoice?(n(),o("button",{key:0,class:"tool-button",onClick:ae},[b.value?(n(),C(s(D),{key:0,icon:"mdi:microphone",width:"18",height:"18",class:"voice-active-icon"})):(n(),C(s(D),{key:1,icon:"mdi:microphone-outline",width:"18",height:"18",class:"voice-icon"}))])):l("",!0)]),i("div",Le,[b.value?(n(),C(Se,{key:1,onStartRecording:ie,onStopRecording:se})):(n(),C(de,{key:0,modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),placeholder:e.placeholder,"max-length":e.maxLength,"enable-emoji":e.enableEmoji,onTextChange:N,onKeydown:P,onKeyup:K,onKeypress:j,onFocus:t[1]||(t[1]=()=>A(s(z).INPUT_FOCUS)),onBlur:t[2]||(t[2]=()=>A(s(z).INPUT_BLUR)),onInputEvent:$,onCompositionStart:V,onCompositionUpdate:H,onCompositionEnd:G,onScroll:Y,onPaste:W,onCut:X,onCopy:q,onSelectionChange:Q,onToggleEmojiPanel:te},null,8,["modelValue","placeholder","max-length","enable-emoji"]))]),i("div",Pe,[i("button",{class:f(["tool-button",{active:k.value}]),onClick:ee},[c(s(D),{icon:"mdi:plus",width:"18",height:"18",class:"tool-icon"})],2),b.value?l("",!0):(n(),C(Te,{key:0,"can-send":x.value,onSend:ne},null,8,["can-send"]))])]),i("div",Ue,[k.value?(n(),o("div",Ke,[c(le,{onSelectTool:ce,onSendImage:he,onSendFile:ge,onSendVideo:ye,onSendRtcRequest:t[3]||(t[3]=(e,a)=>A(s(z).SEND_RTC_REQUEST,{type:e,targetUserId:a})),onSendLocation:t[4]||(t[4]=(e,a,t)=>A(s(z).SEND_LOCATION,{latitude:e,longitude:a,address:t}))})])):l("",!0),w.value&&e.enableEmoji?(n(),C(Re,{key:1,onSelectEmoji:oe})):l("",!0)])]))}}),[["__scopeId","data-v-d6fd7c6c"]]),$e={class:"sdkwork-chat"},Ve={class:"chat-header"},ze={class:"chat-body"},He={class:"chat-footer"},Ge=x(a({__name:"sdkwork-chat-component-text",props:{currentUser:{},receiver:{},conversationId:{},showBackButton:{type:Boolean,default:!0},interlocutorStatus:{default:"Âú®Á∫ø"},showAvatar:{type:Boolean,default:!1},config:{default:()=>({showTimestamp:!0,showReadStatus:!0,enableRevoke:!0,enableFileUpload:!0,maxFileSize:10,allowedFileTypes:["image/*","video/*","audio/*",".pdf",".doc",".docx"],placeholder:"ËæìÂÖ•Ê∂àÊÅØ...",maxLength:1e3})}},emits:["send-message","upload-file","load-more","message-click","back","refresh"],setup(e,{emit:a}){const l=e,s=a,r=P(),d=F(),u=t(),h=()=>{s("back")},y=()=>{},f=g(()=>d.messages.map(e=>({...e,isOwn:e.senderId===l.currentUser.id}))),k=async e=>{try{await r.sendMessage(e),s("send-message",e)}catch(a){}finally{v(()=>{u.value?.scrollToBottom()})}},w=async e=>{try{return await s("upload-file",e)}catch(a){throw a}},b=async()=>{try{l.conversationId&&(await d.loadMoreMessages({conversationId:l.conversationId,page:1,size:20}),s("load-more"))}catch(e){}},E=e=>{s("message-click",e)},C=e=>{const{type:a,message:t}=e.detail;"MESSAGE_RECEIVED"!==a&&"MESSAGE_STREAM_UPDATE"!==a||v(()=>{u.value?.scrollToBottom()})},S=e=>{v(()=>{u.value?.scrollToBottom()})},I=e=>{v(()=>{u.value?.scrollToBottom()})};return m(()=>{window.addEventListener("sdk:message",C)}),p(()=>{window.removeEventListener("sdk:message",C)}),(a,t)=>{const l=j,s=K,r=je;return n(),o("div",$e,[i("div",Ve,[_(a.$slots,"header",{},()=>[c(l,{title:e.receiver?.nickname||"ËÅäÂ§©ÂØπË±°","left-arrow":e.showBackButton,onClickLeft:h,onClickRight:y},null,8,["title","left-arrow"])],!0)]),i("div",ze,[c(s,{ref_key:"messageListRef",ref:u,messages:f.value,"current-user-id":e.currentUser.id,"current-user":e.currentUser,receiver:e.receiver,"show-avatar":e.showAvatar,"conversation-id":e.conversationId,onLoadMore:b,onMessageClick:E},null,8,["messages","current-user-id","current-user","receiver","show-avatar","conversation-id"])]),i("div",He,[c(r,{placeholder:e.config?.placeholder||"ËæìÂÖ•Ê∂àÊÅØ...","max-length":e.config?.maxLength||1e3,"support-file":e.config?.enableFileUpload,"support-image":e.config?.enableFileUpload,"support-voice":!0,onSend:k,onUploadFile:w,onKeydown:S,onFocus:I},null,8,["placeholder","max-length","support-file","support-image"])])])}}}),[["__scopeId","data-v-86a1e55f"]]),Ye={class:"chat-background"},We={class:"background-toggle-top-left"},Xe={key:0,class:"background-menu"},qe={class:"background-options"},Qe=["onClick"],Ze={class:"bg-name"},Je=x(a({__name:"voice-chat-background",props:{selectedBackground:{},backgroundOptions:{}},emits:["update:selectedBackground","background-change"],setup(e,{emit:a}){const r=a,d=t(!1),u=()=>{d.value=!d.value};return(a,t)=>(n(),o("div",Ye,[i("div",We,[i("div",{class:f(["background-toggle-btn",{active:d.value}]),onClick:u},[c(s(D),{icon:"mingcute:palette-fill",width:"20",height:"20"})],2)]),d.value?(n(),o("div",Xe,[i("div",qe,[(n(!0),o(k,null,w(e.backgroundOptions,a=>(n(),o("div",{class:f(["background-option",{active:e.selectedBackground===a.id}]),key:a.id,onClick:e=>{return t=a.id,r("update:selectedBackground",t),r("background-change",t),d.value=!1,void O("ËÉåÊôØÂ∑≤Êõ¥Êç¢");var t},style:E({background:a.gradient})},[i("span",Ze,b(a.name),1)],14,Qe))),128))])])):l("",!0)]))}}),[["__scopeId","data-v-c9a37ad5"]]),ea={class:"chat-avatar"},aa={class:"caller-info"},ta={class:"caller-avatar"},oa={key:0,class:"default-avatar-icon"},na=["src"],ia={key:2,class:"particles-container"},la={key:3,class:"ai-badge"},sa={class:"caller-name"},ca=x(a({__name:"voice-chat-avatar",props:{callerName:{},callerAvatar:{},isSpeaking:{type:Boolean,default:!1},speakStateText:{default:"Á©∫Èó≤"}},setup(e){const a=e,d=t("mdi:account-circle"),u=t(!1),v=t(a.callerAvatar),g=()=>{u.value=!0},h=()=>{a.callerName.includes("AI")||a.callerName.includes("Âä©Êâã")?d.value="mdi:robot":a.callerName.includes("ÂÆ¢Êúç")?d.value="mdi:headset":a.callerName.includes("ÁÆ°ÁêÜÂëò")?d.value="mdi:shield-account":d.value="mdi:account-circle"},y=t([]),C=t([.3,.5,.7,.9,.7,.5,.3,.1]);let _;const S=()=>{a.isSpeaking?C.value=C.value.map(()=>.6*Math.random()+.4):C.value=C.value.map(e=>Math.max(.1,.8*e))};return m(()=>{_=setInterval(S,200),a.callerAvatar||(u.value=!0),h(),r(()=>a.isSpeaking,e=>{e&&(()=>{y.value=[];for(let e=0;e<12;e++){const a=e/12*Math.PI*2,t=70+30*Math.random(),o=50+Math.cos(a)*t,n=50+Math.sin(a)*t;y.value.push({id:e,style:{left:`${o}%`,top:`${n}%`,animationDelay:.2*e+"s",backgroundColor:`hsl(${360*Math.random()}, 70%, 60%)`}})}})()},{immediate:!0}),r(()=>a.callerName,()=>{h()})}),p(()=>{clearInterval(_)}),(a,t)=>(n(),o("div",ea,[i("div",aa,[i("div",ta,[i("div",{class:f(["avatar-container",{"speaking-active":e.isSpeaking}])},[i("div",{class:f(["tech-halo",{active:e.isSpeaking}])},[...t[0]||(t[0]=[i("div",{class:"halo-ring halo-1"},null,-1),i("div",{class:"halo-ring halo-2"},null,-1),i("div",{class:"halo-ring halo-3"},null,-1)])],2),u.value?(n(),o("div",oa,[c(s(D),{icon:d.value,width:"80",height:"80"},null,8,["icon"])])):(n(),o("img",{key:1,src:v.value,alt:"ÂØπÊñπÂ§¥ÂÉè",class:"avatar-image",onError:g},null,40,na)),e.isSpeaking?(n(),o("div",ia,[(n(!0),o(k,null,w(y.value,e=>(n(),o("div",{class:"particle",key:e.id,style:E(e.style)},null,4))),128))])):l("",!0),e.callerName.includes("AI")?(n(),o("div",la,[...t[1]||(t[1]=[i("span",null,"ü§ñ AI",-1)])])):l("",!0)],2)]),i("div",sa,b(e.callerName),1),i("div",{class:f(["status-text",{active:e.isSpeaking}])},b(e.speakStateText),3)])]))}}),[["__scopeId","data-v-c81cb500"]]),ra={class:"voice-call-controls",key:"voice-chat-call-controls"},da={class:"controls-container"},ua={class:"control-button hangup"},va=x(a({__name:"voice-chat-call-controls",props:{selectedBackground:{default:"default"}},emits:["microphone-toggle","speaker-toggle","camera-toggle","call-end"],setup(e,{emit:a}){const l=e,d=t(!0),u=t(!0),v=t(!0),m=a,p=g(()=>{switch(l.selectedBackground){case"blue":default:return{primary:"#2196F3",secondary:"#03A9F4",accent:"#00BCD4",active:"#0077FF",hover:"#0066CC",hangup:"#FF3B30"};case"purple":return{primary:"#9C27B0",secondary:"#BA68C8",accent:"#E1BEE7",active:"#8E24AA",hover:"#7B1FA2",hangup:"#FF3B30"};case"green":return{primary:"#4CAF50",secondary:"#66BB6A",accent:"#81C784",active:"#43A047",hover:"#388E3C",hangup:"#FF3B30"};case"orange":return{primary:"#FF9800",secondary:"#FFB74D",accent:"#FFCC80",active:"#FB8C00",hover:"#F57C00",hangup:"#FF3B30"}}}),h=e=>{const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?`${parseInt(a[1],16)}, ${parseInt(a[2],16)}, ${parseInt(a[3],16)}`:"33, 150, 243"};r(()=>l.selectedBackground,()=>{const e=p.value,a=document.documentElement;a.style.setProperty("--primary",e.primary),a.style.setProperty("--secondary",e.secondary),a.style.setProperty("--accent",e.accent),a.style.setProperty("--active",e.active),a.style.setProperty("--hover",e.hover),a.style.setProperty("--hangup",e.hangup);const t=h(e.primary),o=h(e.secondary),n=h(e.accent),i=h(e.active);a.style.setProperty("--primary-rgb",t),a.style.setProperty("--secondary-rgb",o),a.style.setProperty("--accent-rgb",n),a.style.setProperty("--active-rgb",i)},{immediate:!0});const y=()=>{d.value=!d.value,m("microphone-toggle",d.value)},k=()=>{u.value=!u.value,m("speaker-toggle",u.value)},w=()=>{v.value=!v.value,m("camera-toggle",v.value)},b=()=>{m("call-end")};return(e,a)=>(n(),o("div",ra,[i("div",da,[i("div",{class:"control-item",onClick:y},[i("div",{class:f(["control-button",{active:d.value}])},[c(s(D),{icon:d.value?"mingcute:mic-fill":"mingcute:mic-off-fill",class:"control-icon"},null,8,["icon"])],2)]),i("div",{class:"control-item",onClick:k},[i("div",{class:f(["control-button",{active:u.value}])},[c(s(D),{icon:u.value?"mingcute:volume-fill":"mingcute:volume-off-fill",class:"control-icon"},null,8,["icon"])],2)]),i("div",{class:"control-item",onClick:w},[i("div",{class:f(["control-button",{active:v.value}])},[c(s(D),{icon:v.value?"mingcute:camera-2-ai-fill":"mingcute:camera-2-off-line",class:"control-icon"},null,8,["icon"])],2)]),i("div",{class:"control-item",onClick:b},[i("div",ua,[c(s(D),{icon:"mingcute:close-line",class:"control-icon"})])])])]))}}),[["__scopeId","data-v-edd88ec0"]]),ma={class:"voice-call-container"},pa={class:"top-time-display"},ga={class:"call-duration"},ha={class:"subtitles-toggle-top-right"},ya=x(a({__name:"sdkwork-chat-component-voice",props:{conversationId:{},enableWave:{type:Boolean,default:!0}},emits:["mode-change"],setup(e,{emit:a}){const r=a,u=e,v=t("connecting"),h=t(!0),y=t(!0),k=t(!1),w=g(()=>"SPEAKING"===H.value),_=t(null),I=t("00:00"),T=t(null),x=g(()=>u.enableWave??!0);let M,B;const R=t(!1),N=t(),F=t([{speaker:"AIÂä©Êâã",text:"ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÊâãÔºåÂæàÈ´òÂÖ¥‰∏∫ÊÇ®ÊúçÂä°„ÄÇ",time:"10:00"},{speaker:"Áî®Êà∑",text:"‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∫õÂÖ≥‰∫é‰∫ßÂìÅÁöÑÈóÆÈ¢ò„ÄÇ",time:"10:02"},{speaker:"AIÂä©Êâã",text:"ÂΩìÁÑ∂ÂèØ‰ª•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÔºü",time:"10:03"},{speaker:"Áî®Êà∑",text:"Ëøô‰∏™‰∫ßÂìÅÁöÑÂäüËÉΩÊúâÂì™‰∫õÁâπÁÇπÔºü",time:"10:05"},{speaker:"AIÂä©Êâã",text:"Êàë‰ª¨ÁöÑ‰∫ßÂìÅÂÖ∑ÊúâÊô∫ËÉΩÂØπËØù„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÂ§öËØ≠Ë®ÄÊîØÊåÅÁ≠âÂÖàËøõÂäüËÉΩ„ÄÇ",time:"10:06"}]);t(""),t(0);const L=t(0),U=t("AIÂä©Êâã"),K=t(""),j=t("default"),z=t([{id:"default",name:"ÈªòËÆ§",gradient:"linear-gradient(135deg, #007AFF 0%, #0056CC 100%)"},{id:"ocean",name:"Êµ∑Ê¥ã",gradient:"linear-gradient(135deg, #00B4DB 0%, #0083B0 100%)"},{id:"sunset",name:"Êó•ËêΩ",gradient:"linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%)"},{id:"forest",name:"Ê£ÆÊûó",gradient:"linear-gradient(135deg, #00D2FF 0%, #3A7BD5 100%)"},{id:"purple",name:"Á¥´Ëâ≤",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"green",name:"ÁªøËâ≤",gradient:"linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%)"}]),H=g(()=>X.speakState),G=g(()=>{const e=z.value.find(e=>e.id===j.value);return{background:e?.gradient||"linear-gradient(135deg, #007AFF 0%, #0056CC 100%)"}}),Y=g(()=>{switch(v.value){case"connecting":return"ËøûÊé•‰∏≠...";case"connected":return"ÈÄöËØù‰∏≠";case"ended":return"ÈÄöËØùÁªìÊùü";default:return"Êú™Áü•Áä∂ÊÄÅ"}}),W=g(()=>{switch(H.value){case"SPEAKING":return"ËØ¥ËØù‰∏≠";case"LISTENING":return"ËÅÜÂê¨‰∏≠";case"IDLE":return"Á©∫Èó≤";default:return"Êú™Áü•Áä∂ÊÄÅ"}}),X=P(),q=e=>{X.setSpeakState(e)},Q=A(),Z=()=>{R.value=!R.value,O(R.value?"Â≠óÂπïÂ∑≤ÂºÄÂêØ":"Â≠óÂπïÂ∑≤ÂÖ≥Èó≠"),R.value&&J()},J=()=>{L.value=Date.now(),N.value&&N.value.clearDynamicSubtitles(),N.value&&N.value.startPlayback()},ee=(e,a)=>{if(!R.value||!N.value)return;const t=Date.now()-L.value,o=t+5e3,n=`${a}Ôºö${e}`;N.value.addDynamicSubtitle(n,t,o,!0)},ae=(e,a)=>{},te=async e=>{if(h.value=e,e)try{q("LISTENING"),await Q.startRecording({realtime:!0,waveContainer:T.value}),X.startVoiceListening(),O("È∫¶ÂÖãÈ£éÂ∑≤ÂºÄÂêØ")}catch(a){O("ÂºÄÂêØÈ∫¶ÂÖãÈ£éÂ§±Ë¥•")}else try{await Q.pauseRecording(),X.stopVoiceListening(),q("IDLE"),O("È∫¶ÂÖãÈ£éÂ∑≤ÈùôÈü≥")}catch(a){O("ÂÖ≥Èó≠È∫¶ÂÖãÈ£éÂ§±Ë¥•")}},oe=e=>{y.value=e,O(e?"Êâ¨Â£∞Âô®Â∑≤ÂºÄÂêØ":"Êâ¨Â£∞Âô®Â∑≤ÈùôÈü≥")},ne=e=>{k.value=e,O(e?"ÊëÑÂÉèÂ§¥Â∑≤ÂºÄÂêØ":"ÊëÑÂÉèÂ§¥Â∑≤ÂÖ≥Èó≠")},ie=()=>{v.value="ended",q("IDLE"),O("ÈÄöËØùÂ∑≤ÁªìÊùü"),setTimeout(()=>{r("mode-change","text")},1e3)},le=e=>{j.value=e,O("ËÉåÊôØÂ∑≤Êõ¥Êç¢")},se=e=>{},ce=()=>{if(_.value&&"connected"===v.value){const e=new Date,a=Math.floor((e.getTime()-_.value.getTime())/1e3),t=Math.floor(a/60).toString().padStart(2,"0"),o=(a%60).toString().padStart(2,"0");I.value=`${t}:${o}`}};return m(async()=>{(()=>{const e=e=>{e.detail&&"AUDIO_STREAM_RECEIVED"===e.detail.type&&q("SPEAKING")},a=e=>{e.detail&&"MESSAGE_RECEIVED"===e.detail.type&&"assistant"===e.detail.message.role&&F.value.push({speaker:"AIÂä©Êâã",text:e.detail.message.content,time:(new Date).toLocaleTimeString("zh-CN",{hour12:!1})})};window.addEventListener("sdk:audioStream",e),window.addEventListener("sdk:message",a)})();try{X.isInitialized||(await X.initialize(),O("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÊàêÂäü")),await X.enterVoiceRoom({enableWave:u.enableWave??!0,waveContainer:T.value,sampleRate:16e3,format:"pcm",realtime:!0,hello:{send:!0}}),O("ËØ≠Èü≥ÊàøÈó¥Â∑≤Âª∫Á´ã")}catch(e){O("ËÅäÂ§©Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊ®°Âºè")}setTimeout(()=>{v.value="connected",_.value=new Date,O("ÈÄöËØùÂ∑≤ËøûÊé•")},2e3),M=setInterval(ce,1e3),B=setInterval(()=>{const e=Math.random();if(e>.7){if(q("SPEAKING"),R.value){const e=["ÊÇ®Â•ΩÔºÅÊàëÊòØAIÂä©ÊâãÔºåÂæàÈ´òÂÖ¥‰∏∫ÊÇ®ÊúçÂä°„ÄÇ","ÂΩìÁÑ∂ÂèØ‰ª•ÔºåËØ∑ÂëäËØâÊàëÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÔºü","Êàë‰ª¨ÁöÑ‰∫ßÂìÅÂÖ∑ÊúâÊô∫ËÉΩÂØπËØù„ÄÅËØ≠Èü≥ËØÜÂà´„ÄÅÂ§öËØ≠Ë®ÄÊîØÊåÅÁ≠âÂÖàËøõÂäüËÉΩ„ÄÇ","ÊÇ®ËøòÊúâÂÖ∂‰ªñÈóÆÈ¢òÈúÄË¶ÅÂí®ËØ¢ÂêóÔºü","ÊÑüË∞¢ÊÇ®ÁöÑ‰ΩøÁî®ÔºåÁ•ùÊÇ®ÁîüÊ¥ªÊÑâÂø´ÔºÅ"],a=e[Math.floor(Math.random()*e.length)];ee(a,"AIÂä©Êâã")}}else if(e>.4){if(q("LISTENING"),R.value){const e=["‰Ω†Â•ΩÔºåÊàëÊÉ≥Âí®ËØ¢‰∏Ä‰∫õÂÖ≥‰∫é‰∫ßÂìÅÁöÑÈóÆÈ¢ò„ÄÇ","Ëøô‰∏™‰∫ßÂìÅÁöÑÂäüËÉΩÊúâÂì™‰∫õÁâπÁÇπÔºü","‰ª∑Ê†ºÊòØÂ§öÂ∞ëÔºü","Â¶Ç‰Ωï‰ΩøÁî®Ëøô‰∏™‰∫ßÂìÅÔºü","Ë∞¢Ë∞¢‰Ω†ÁöÑËß£Á≠îÔºÅ"],a=e[Math.floor(Math.random()*e.length)];ee(a,"Áî®Êà∑")}}else q("IDLE")},5e3)}),p(async()=>{M&&(clearInterval(M),M=void 0),B&&(clearInterval(B),B=void 0);try{await X.exitVoiceRoom()}catch(e){}Q.destroyRecorder()}),(e,a)=>(n(),o("div",{class:"chat-voice-mode",style:E(G.value)},[i("div",ma,[i("div",pa,[i("div",ga,b(I.value),1),i("div",{class:f(["call-status",v.value])},b(Y.value),3)]),c(Je,{"selected-background":j.value,"background-options":z.value,"onUpdate:selectedBackground":le,onBackgroundChange:se},null,8,["selected-background","background-options"]),i("div",ha,[i("div",{class:f(["subtitles-toggle-btn",{active:R.value}]),onClick:Z},[c(s(D),{icon:R.value?"mingcute:subtitle-fill":"mingcute:subtitle-line",width:"20",height:"20"},null,8,["icon"])],2)]),c(ca,{"caller-name":U.value,"caller-avatar":K.value,"is-speaking":w.value,"speak-state-text":W.value},null,8,["caller-name","caller-avatar","is-speaking","speak-state-text"]),d(i("div",{ref_key:"waveContainerRef",ref:T,class:"wave-container"},null,512),[[S,x.value]]),R.value?(n(),C($,{key:0,ref_key:"subtitlesRef",ref:N,"display-mode":s(V).LINE,"line-count":5,"show-controls":!1,position:"center","font-size":14,"font-color":"#ffffff","background-color":"rgba(0, 0, 0, 0.6)","show-background":!0,"auto-scroll":!0,onEntryChange:ae},null,8,["display-mode"])):l("",!0),c(va,{onMicrophoneToggle:te,onSpeakerToggle:oe,onCameraToggle:ne,onCallEnd:ie})])],4))}}),[["__scopeId","data-v-9e3b09a8"]]),fa={class:"mode-switch"},ka={class:"mode-switch",style:{"margin-left":"10px"}},wa=x(a({__name:"sdkwork-chat-component",props:{conversationId:{},defaultMode:{default:"text"}},emits:["mode-change","back"],setup(a,{emit:t}){const o=a,d=t,u=I(),v=T(),h=P(),f=M(),k=U(),w=g(()=>h.currentChatMode),b=g(()=>{if(o.conversationId)return o.conversationId;const e=u.params.id;return Array.isArray(e)?e[0]:e||""}),E=()=>{if(o.defaultMode)return o.defaultMode;return"voice"===u.query.mode?"voice":"text"},_=g(()=>f.currentUser||{id:"user1",name:"ÂΩìÂâçÁî®Êà∑",avatar:"https://via.placeholder.com/40",online:!0}),S=g(()=>k.currentConversation),x=g(()=>"voice"===w.value?"ËØ≠Èü≥ÈÄöËØù":S.value?.title||"ÂØπËØùËØ¶ÊÉÖ"),A=async()=>{try{await h.switchChatMode("voice"),O("ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°Âºè")}catch(e){O("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•")}},B=()=>{d("back")},R=()=>{v.push(`/chat/profile/${S.value?.agentId||0}`)},F=async e=>{try{await h.switchChatMode(e),d("mode-change",e)}catch(a){O("ÂàáÊç¢Ê®°ÂºèÂ§±Ë¥•")}};return r(b,async e=>{if(e)try{await k.switchConversation(e)}catch(a){O("Âä†ËΩΩ‰ºöËØùÊï∞ÊçÆÂ§±Ë¥•")}},{immediate:!0}),m(async()=>{if(!k.isInitialized)try{await k.initialize()}catch(e){}try{await h.initialize();const e=E();await h.enterChat({mode:e})}catch(e){}"voice"===E()&&O("Â∑≤ËøõÂÖ•ËØ≠Èü≥ÈÄöËØùÊ®°Âºè")}),p(async()=>{try{await h.exitChat()}catch(e){}}),(a,t)=>{const o=e;return n(),C(o,null,{default:y(()=>["voice"===w.value?(n(),C(ya,{key:0,"conversation-id":b.value,onModeChange:F},null,8,["conversation-id"])):(n(),C(Ge,{key:1,"conversation-id":b.value,"current-user":_.value,onModeChange:F},{header:y(()=>["text"===w.value?(n(),C(N,{key:0,title:x.value,"show-back":!0,"custom-right":!0,onLeftClick:B},{right:y(()=>[i("div",fa,[c(s(D),{icon:"mingcute:phone-fill",width:"20",height:"20",class:"mode-switch-icon",onClick:A,title:"ÂàáÊç¢Âà∞ËØ≠Èü≥Ê®°Âºè"})]),i("div",ka,[c(s(D),{icon:"mingcute:more-1-fill",width:"16",height:"16",onClick:R})])]),_:1},8,["title"])):l("",!0)]),_:1},8,["conversation-id","current-user"]))]),_:1})}}}),[["__scopeId","data-v-06e91933"]]);export{wa as S};
