import{S as t}from"./sdkwork-icon-JBBTW6q4.js";import{_ as e}from"./sdkwork-popup-BvExtb7p.js";import{y as s,k as r,r as i,f as n,w as a,P as l,Q as o,V as c,S as u,W as d,R as m,$ as h,j as p,F as y,Y as g,Z as v,a0 as f,s as T,a8 as b,a4 as E,ab as S,aa as C,a1 as k,b as D,o as w}from"./vue-vendor-CnVaDBlt.js";import{_ as A}from"./index-DS3FT4GI.js";var _=(t=>(t.SRT="srt",t.VTT="vtt",t.SSA="ssa",t.ASS="ass",t.MP4="mp4",t.LRC="lrc",t.KAR="kar",t.ID3="id3",t.OTHER="other",t))(_||{}),x=(t=>(t.PLAYER="player",t.STREAM="stream",t))(x||{}),L=(t=>(t.LOAD_START="loadStart",t.LOAD_COMPLETE="loadComplete",t.LOAD_ERROR="loadError",t.DISPLAY_CHANGE="displayChange",t.STREAM_ADDED="streamAdded",t.SYNC_START="syncStart",t.SYNC_STOP="syncStop",t.CLEARED="cleared",t))(L||{});class P{async parseFile(t){return this.parse(t)}}class M extends P{async parse(t){if(!t||""===t.trim())throw new Error("歌词内容不能为空");const e={format:_.LRC,entries:[]},s=[],r=t.split(/\r?\n/);let i=1;for(const n of r)if(n&&""!==n.trim()){const t=this.parseLine(n,i);t&&(s.push(t),i++)}return e.entries=s,e}parseLine(t,e){if(/\[([a-zA-Z]+):(.*)\]/.test(t))return null;const s=/\[(\d{2}):(\d{2})[.:](\d{2,3})\]/,r=t.match(s);if(r){const i={sequence:e},n=parseInt(r[1],10),a=parseInt(r[2],10);let l=parseInt(r[3],10);2===r[3].length&&(l*=10);const o=6e4*n+1e3*a+l;i.startTime=o,i.endTime=o+5e3;const c=t.replace(s,"").trim();return i.text=c,i.texts=[c],i}return null}}class R{async writeFile(t,e){await this.generate(t)}}class O extends R{async generate(t){if(!t)throw new Error("Subtitles对象不能为空");const e=t.entries;if(!e||0===e.length)return"";let s="";for(const r of e)r&&(s+=this.formatEntry(r)+"\n");return s}formatEntry(t){let e="";return e+="["+this.formatTime(t.startTime)+"]",t.text&&(e+=t.text),e}formatTime(t=0){const e=Math.floor(t/1e3),s=t%1e3,r=Math.floor(e/60),i=e%60;return s%10==0?`${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}.${Math.floor(s/10).toString().padStart(2,"0")}`:`${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}.${s.toString().padStart(3,"0")}`}}class H extends P{async parse(t){if(!t||""===t.trim())throw new Error("字幕内容不能为空");const e={format:_.SRT,entries:[]},s=[],r=t.trim().split(/\n\s*\n/);for(const i of r)if(i&&""!==i.trim()){const t=this.parseBlock(i);t&&s.push(t)}return e.entries=s,e}parseBlock(t){const e=t.split(/\n/);if(e.length<3)return null;try{const t={sequence:parseInt(e[0].trim(),10)},s=e[1].trim().split("--\x3e");s.length>=2&&(t.startTime=this.parseTime(s[0].trim()),t.endTime=this.parseTime(s[1].trim()));let r="";const i=[];for(let n=2;n<e.length;n++){const t=e[n].trim();t&&(r.length>0&&(r+="\n"),r+=t,i.push(t))}return t.text=r,t.texts=i,t}catch(s){return null}}parseTime(t){try{const e=t.split(/[:,]/);if(e.length>=3){const t=parseInt(e[0],10),s=parseInt(e[1],10),r=parseInt(e[2],10);return 36e5*t+6e4*s+1e3*r+(e.length>3?parseInt(e[3],10):0)}}catch(e){}return 0}}class I extends R{async generate(t){if(!t)throw new Error("Subtitles对象不能为空");const e=t.entries;if(!e||0===e.length)return"";let s="";for(let r=0;r<e.length;r++){const t=e[r];t&&(s+=this.formatEntry(t,r+1),s+="\n\n")}return s}formatEntry(t,e){let s="";s+=e+"\n";if(s+=`${this.formatTime(t.startTime||0)} --\x3e ${this.formatTime(t.endTime||0)}\n`,t.texts&&t.texts.length>0)for(const r of t.texts)s+=r+"\n";else t.text&&(s+=t.text+"\n");return s.trim()}formatTime(t){const e=Math.floor(t/1e3),s=t%1e3,r=Math.floor(e/3600),i=Math.floor(e%3600/60),n=e%60;return`${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")},${s.toString().padStart(3,"0")}`}}class N{static createParser(t){switch(t){case _.LRC:case _.KAR:case _.ID3:return new M;case _.SRT:return new H;default:throw new Error(`Unsupported subtitle format: ${t}`)}}static createGenerator(t){switch(t){case _.LRC:case _.KAR:case _.ID3:return new O;case _.SRT:return new I;default:throw new Error(`Unsupported subtitle format: ${t}`)}}}class B{subtitles=null;streamEntries=[];currentEntry=null;lastSyncTime=0;syncIntervalId=null;eventListeners=new Map;displayChangeCallbacks=new Set;mode;playerConfig;streamConfig;constructor(t={}){this.mode=t.mode||x.PLAYER,this.playerConfig={syncInterval:100,preloadTime:200,delayTime:0,smoothTransition:!0,maxCachedEntries:1e3,...t.playerConfig},this.streamConfig={displayDuration:5e3,maxDisplayCount:3,autoClearExpired:!0,expireThreshold:1e4,allowOverwrite:!1,...t.streamConfig},this.initializeEventSystem()}initializeEventSystem(){Object.values(L).forEach(t=>{this.eventListeners.set(t,new Set)})}async loadFromUrl(t){this.emit(L.LOAD_START,this.createDisplayEvent(null,0));try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const s=await e.text();return this.loadFromString(s)}catch(e){throw this.emit(L.LOAD_ERROR,this.createDisplayEvent(null,0)),e}}async loadFromFile(t){return new Promise((e,s)=>{const r=new FileReader;r.onload=t=>{const r=t.target?.result;this.loadFromString(r).then(e).catch(s)},r.onerror=()=>{s(new Error("文件读取失败"))},r.readAsText(t,"utf-8")})}async loadFromBlob(t){const e=new File([t],"subtitle",{type:t.type});return this.loadFromFile(e)}async loadFromString(t){const e=this.detectFormat(t),s=N.createParser(e),r=await s.parse(t);return this.setSubtitles(r),this.emit(L.LOAD_COMPLETE,this.createDisplayEvent(null,0)),r}addStreamSubtitle(t,e,s){const r={sequence:this.streamEntries.length+1,startTime:e,endTime:s,text:t};return this.mode===x.STREAM?this.handleStreamModeSubtitle(r):this.handlePlayerModeSubtitle(r),this.streamEntries.push(r),this.streamEntries.length>this.playerConfig.maxCachedEntries&&this.streamEntries.shift(),this.emit(L.STREAM_ADDED,this.createDisplayEvent(r,e)),r}handleStreamModeSubtitle(t){if(this.currentEntry=t,this.emitDisplayChange(t,t.startTime||0,!0),this.streamConfig.autoClearExpired){const e=t.endTime||(t.startTime||0)+this.streamConfig.displayDuration;setTimeout(()=>{this.currentEntry===t&&(this.currentEntry=null,this.emitDisplayChange(null,Date.now(),!0))},e-(t.startTime||0))}}handlePlayerModeSubtitle(t){}startSync(){this.stopSync(),this.emit(L.SYNC_START,this.createDisplayEvent(null,0)),this.mode===x.PLAYER&&(this.syncIntervalId=setInterval(()=>{this.lastSyncTime>0&&this.updatePlaybackTime(this.lastSyncTime)},this.playerConfig.syncInterval))}stopSync(){this.syncIntervalId&&(clearInterval(this.syncIntervalId),this.syncIntervalId=null),this.emit(L.SYNC_STOP,this.createDisplayEvent(null,0))}updatePlaybackTime(t){return this.lastSyncTime=t,this.mode===x.PLAYER?this.handlePlayerModeTimeUpdate(t):this.handleStreamModeTimeUpdate(t)}handlePlayerModeTimeUpdate(t){const e=[...this.subtitles?.entries||[],...this.streamEntries].sort((t,e)=>(t.startTime||0)-(e.startTime||0));let s=null;for(const r of e){const e=r.startTime||0,i=r.endTime||e+1e3,n=e-this.playerConfig.preloadTime,a=i+this.playerConfig.delayTime;if(t>=n&&t<=a){s=r;break}}return s!==this.currentEntry&&(this.currentEntry=s,this.emitDisplayChange(s,t,!0)),s}handleStreamModeTimeUpdate(t){const e=this.streamEntries.filter(e=>{const s=e.startTime||0,r=e.endTime||s+this.streamConfig.displayDuration;return t>=s&&t<=r}),s=e.length>0?e[e.length-1]:null;return s!==this.currentEntry&&(this.currentEntry=s,this.emitDisplayChange(s,t,!0)),s}getCurrentSubtitle(){return this.currentEntry}clear(){this.subtitles=null,this.streamEntries=[],this.currentEntry=null,this.lastSyncTime=0,this.emit(L.CLEARED,this.createDisplayEvent(null,0))}async export(t){if(!this.subtitles&&0===this.streamEntries.length)throw new Error("没有可导出的字幕内容");const e={entries:[...this.subtitles?.entries||[],...this.streamEntries].sort((t,e)=>(t.startTime||0)-(e.startTime||0)),format:t,language:this.subtitles?.language||"zh-CN",duration:this.subtitles?.duration},s=N.createGenerator(t);return await s.generate(e)}onDisplayChange(t){this.displayChangeCallbacks.add(t)}offDisplayChange(t){this.displayChangeCallbacks.delete(t)}on(t,e){const s=this.eventListeners.get(t);s&&s.add(e)}off(t,e){const s=this.eventListeners.get(t);s&&s.delete(e)}setSubtitles(t){this.subtitles=t,this.currentEntry=null,this.lastSyncTime=0}emitDisplayChange(t,e,s){const r=this.createDisplayEvent(t,e,s);this.displayChangeCallbacks.forEach(t=>{try{t(r)}catch(e){}}),this.emit(L.DISPLAY_CHANGE,r)}emit(t,e){const s=this.eventListeners.get(t);s&&s.forEach(t=>{try{t(e)}catch(s){}})}createDisplayEvent(t,e,s=!1){const r=t?.startTime||0,i=t?.endTime||e,n=Math.max(i-r,1),a=Math.max(e-r,0);return{entry:t,currentTime:e,isNew:s,progress:Math.min(a/n,1)}}detectFormat(t){return t.includes("WEBVTT")?_.VTT:t.match(/\d{2}:\d{2}:\d{2},\d{3}/)?_.SRT:t.match(/\[\d{2}:\d{2}\.\d{2}\]/)?_.LRC:_.OTHER}getMode(){return this.mode}switchMode(t){this.mode!==t&&(this.stopSync(),this.mode=t,this.currentEntry=null,this.lastSyncTime=0,t===x.PLAYER&&this.startSync())}getStats(){return{mode:this.mode,totalEntries:this.subtitles?.entries?.length||0,streamEntries:this.streamEntries.length,currentTime:this.lastSyncTime,currentSubtitle:this.currentEntry}}}class U{static createPlayerHandler(t){return new B({mode:x.PLAYER,playerConfig:t})}static createStreamHandler(t){return new B({mode:x.STREAM,streamConfig:t})}static createHandlerForScenario(t){switch(t){case"video":return this.createPlayerHandler({syncInterval:100,preloadTime:200,smoothTransition:!0});case"music":return this.createPlayerHandler({syncInterval:50,preloadTime:100,smoothTransition:!1});case"speech":return this.createStreamHandler({displayDuration:3e3,maxDisplayCount:1,autoClearExpired:!0});case"ai":return this.createStreamHandler({displayDuration:5e3,maxDisplayCount:3,autoClearExpired:!0,allowOverwrite:!0});default:return this.createPlayerHandler()}}}var F=(t=>(t.FULLSCREEN="fullscreen",t.CARD="card",t.LINE="line",t))(F||{}),V=(t=>(t.IDLE="idle",t.LOADING="loading",t.LOADED="loaded",t.PLAYING="playing",t.PAUSED="paused",t.ERROR="error",t))(V||{}),$=(t=>(t.LOAD_START="loadStart",t.LOAD_COMPLETE="loadComplete",t.LOAD_ERROR="loadError",t.ENTRY_CHANGE="entryChange",t.MODE_CHANGE="modeChange",t.PLAYBACK_STATE_CHANGE="playbackStateChange",t.CONTENT_UPDATE="contentUpdate",t))($||{});const z={displayMode:F.CARD,lineCount:3,fontSize:16,fontColor:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",showBackground:!0,position:"bottom",autoScroll:!0,scrollSpeed:1};V.IDLE;const Y=s("subtitles",{state:()=>({config:{...z},currentState:V.IDLE,errorMessage:"",currentSubtitles:null,dynamicEntries:[],currentEntry:null,currentTime:0,totalDuration:0,isPlaying:!1,settingDialogVisible:!1,subtitleListVisible:!1,_eventListeners:new Map,_syncTimer:null,_subtitlesHandler:null}),getters:{isIdle:t=>t.currentState===V.IDLE,isLoading:t=>t.currentState===V.LOADING,isLoaded:t=>t.currentState===V.LOADED,isPlayingState:t=>t.currentState===V.PLAYING,isPaused:t=>t.currentState===V.PAUSED,isError:t=>t.currentState===V.ERROR,hasSubtitles:t=>null!==t.currentSubtitles,hasDynamicEntries:t=>t.dynamicEntries.length>0,totalEntries:t=>(t.currentSubtitles?.entries?.length||0)+t.dynamicEntries.length,currentEntryText:t=>t.currentEntry?.text||"",progressPercentage:t=>0===t.totalDuration?0:t.currentTime/t.totalDuration*100,timeRemaining:t=>0===t.totalDuration?0:Math.max(0,t.totalDuration-t.currentTime),isFullscreenMode:t=>t.config.displayMode===F.FULLSCREEN,isCardMode:t=>t.config.displayMode===F.CARD,isLineMode:t=>t.config.displayMode===F.LINE,displayLineCount:t=>t.config.lineCount||3},actions:{updateConfig(t){Object.assign(this.config,t),this.emit($.MODE_CHANGE,{currentTime:this.currentTime})},resetConfig(){this.config={...z}},switchDisplayMode(t,e){this.config.displayMode=t,e&&Object.assign(this.config,e),this.emit($.MODE_CHANGE,{currentTime:this.currentTime})},async loadFromString(t,e){this.currentState=V.LOADING,this.errorMessage="",this.emit($.LOAD_START,{currentTime:this.currentTime});try{this._subtitlesHandler||(this._subtitlesHandler=U.createPlayerHandler(),this._subtitlesHandler.onDisplayChange(t=>{this.currentEntry=t.entry,this.currentTime=t.currentTime,this.emit($.ENTRY_CHANGE,{currentEntry:t.entry,currentTime:t.currentTime})}));const e=await this._subtitlesHandler.loadFromString(t);this.currentSubtitles=e,this.totalDuration=e.duration?1e3*e.duration:0,this.currentState=V.LOADED,this.emit($.LOAD_COMPLETE,{currentTime:this.currentTime})}catch(s){throw this.currentState=V.ERROR,this.errorMessage=s instanceof Error?s.message:"字幕加载失败",this.emit($.LOAD_ERROR,{error:this.errorMessage,currentTime:this.currentTime}),s}},async loadFromUrl(t,e){this.currentState=V.LOADING,this.errorMessage="",this.emit($.LOAD_START,{currentTime:this.currentTime});try{this._subtitlesHandler||(this._subtitlesHandler=U.createPlayerHandler(),this._subtitlesHandler.onDisplayChange(t=>{this.currentEntry=t.entry,this.currentTime=t.currentTime,this.emit($.ENTRY_CHANGE,{currentEntry:t.entry,currentTime:t.currentTime})}));const e=await this._subtitlesHandler.loadFromUrl(t);this.currentSubtitles=e,this.totalDuration=e.duration?1e3*e.duration:0,this.currentState=V.LOADED,this.emit($.LOAD_COMPLETE,{currentTime:this.currentTime})}catch(s){throw this.currentState=V.ERROR,this.errorMessage=s instanceof Error?s.message:"字幕加载失败",this.emit($.LOAD_ERROR,{error:this.errorMessage,currentTime:this.currentTime}),s}},loadFromObject(t){this.currentSubtitles=t,this.totalDuration=t.duration?1e3*t.duration:0,this.currentState=V.LOADED,this.emit($.LOAD_COMPLETE,{currentTime:this.currentTime})},clearSubtitles(){this.currentSubtitles=null,this.dynamicEntries=[],this.currentEntry=null,this.currentTime=0,this.totalDuration=0,this.currentState=V.IDLE,this._subtitlesHandler&&this._subtitlesHandler.clear(),this.emit($.CONTENT_UPDATE,{currentTime:this.currentTime})},addDynamicSubtitle(t){const e={sequence:this.dynamicEntries.length+1,startTime:t.startTime,endTime:t.endTime,text:t.text};return this.dynamicEntries.push(e),this.isPlayingState&&this._subtitlesHandler&&this._subtitlesHandler.addStreamSubtitle(t.text,t.startTime,t.endTime),this.emit($.CONTENT_UPDATE,{currentTime:this.currentTime,data:{entry:e,isDynamic:!0}}),e},addDynamicSubtitles(t){return t.map(t=>this.addDynamicSubtitle(t))},clearDynamicSubtitles(){this.dynamicEntries=[],this.emit($.CONTENT_UPDATE,{currentTime:this.currentTime})},startPlayback(){this._subtitlesHandler&&(this._subtitlesHandler.startSync(),this.currentState=V.PLAYING,this.isPlaying=!0,this.emit($.PLAYBACK_STATE_CHANGE,{currentTime:this.currentTime}))},stopPlayback(){this._subtitlesHandler&&(this._subtitlesHandler.stopSync(),this.currentState=V.IDLE,this.isPlaying=!1,this.currentTime=0,this.emit($.PLAYBACK_STATE_CHANGE,{currentTime:this.currentTime}))},pausePlayback(){this._subtitlesHandler&&this.isPlayingState&&(this.currentState=V.PAUSED,this.isPlaying=!1,this.emit($.PLAYBACK_STATE_CHANGE,{currentTime:this.currentTime}))},resumePlayback(){this._subtitlesHandler&&this.currentState===V.PAUSED&&(this.currentState=V.PLAYING,this.isPlaying=!0,this.emit($.PLAYBACK_STATE_CHANGE,{currentTime:this.currentTime}))},seekTo(t){this.currentTime=t,this._subtitlesHandler&&this._subtitlesHandler.updatePlaybackTime(t),this.emit($.ENTRY_CHANGE,{currentTime:t})},updatePlaybackTime(t){this.currentTime=t,this._subtitlesHandler&&this._subtitlesHandler.updatePlaybackTime(t)},on(t,e){this._eventListeners.has(t)||this._eventListeners.set(t,[]),this._eventListeners.get(t).push(e)},off(t,e){const s=this._eventListeners.get(t);if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}},emit(t,e){const s=this._eventListeners.get(t);if(s){const r={type:t,currentEntry:this.currentEntry,currentTime:this.currentTime,error:this.errorMessage,...e};s.forEach(t=>{try{t(r)}catch(e){}})}},showSettings(){this.settingDialogVisible=!0},hideSettings(){this.settingDialogVisible=!1},showSubtitleList(){this.subtitleListVisible=!0},hideSubtitleList(){this.subtitleListVisible=!1},getStats(){return{totalEntries:this.totalEntries,dynamicEntries:this.dynamicEntries.length,currentTime:this.currentTime,totalDuration:this.totalDuration,state:this.currentState}},async exportSubtitles(t){if(!this._subtitlesHandler)throw new Error("字幕处理器未初始化");return await this._subtitlesHandler.export(t)}}}),G={key:1,class:"no-subtitle"},j={key:0,class:"progress-indicator"},q={class:"progress-bar"},K=A(r({__name:"fullscreen-display",props:{currentEntry:{},config:{},currentTime:{},showEmptyState:{type:Boolean,default:!0}},emits:["click"],setup(e,{emit:s}){const r=e,y=i(!1),g=i(!1),v=i(""),f=n(()=>({"--font-size":2*r.config.fontSize+"px","--font-color":r.config.fontColor,"--background-color":r.config.backgroundColor})),T=n(()=>({fontSize:"var(--font-size)",color:"var(--font-color)",backgroundColor:r.config.showBackground?"var(--background-color)":"transparent",padding:r.config.showBackground?"20px 30px":"0",borderRadius:r.config.showBackground?"12px":"0"})),b=n(()=>({fontSize:"var(--font-size)",color:"var(--font-color)",textShadow:r.config.showBackground?"none":"0 2px 4px rgba(0, 0, 0, 0.8)"})),E=n(()=>{if(!(r.currentEntry&&r.currentEntry.startTime&&r.currentEntry.endTime&&r.currentTime))return 0;const t=r.currentEntry.endTime-r.currentEntry.startTime,e=r.currentTime-r.currentEntry.startTime;return Math.min(100,Math.max(0,e/t*100))});return a(()=>r.currentEntry,(t,e)=>{if(t!==e){const s=`${t?.startTime}-${t?.endTime}`;s!==v.value&&(y.value=!0,g.value=!1,setTimeout(()=>{y.value=!1},300),e&&(g.value=!0,setTimeout(()=>{g.value=!1},300)),v.value=s||"")}},{immediate:!0}),(s,r)=>{const i=t;return o(),l("div",{class:"fullscreen-display",style:c(f.value),onClick:r[0]||(r[0]=t=>s.$emit("click"))},[u("div",{class:"subtitle-content",style:c(T.value)},[e.currentEntry?(o(),l("div",{key:0,class:m(["subtitle-text",{"animate-in":y.value,"animate-out":g.value}]),style:c(b.value)},h(e.currentEntry.text),7)):e.showEmptyState?(o(),l("div",G,[p(i,{icon:"mdi:subtitles-outline",class:"no-subtitle-icon"}),r[1]||(r[1]=u("span",{class:"no-subtitle-text"},"暂无字幕",-1))])):d("",!0)],4),e.currentEntry?(o(),l("div",j,[u("div",q,[u("div",{class:"progress-fill",style:c({width:E.value+"%"})},null,4)])])):d("",!0)],4)}}}),[["__scopeId","data-v-d55e3510"]]),W={class:"card-content"},Z={key:0,class:"time-info"},Q={class:"time-text"},J={class:"time-text"},X={key:0,class:"card-progress"},tt={key:1,class:"no-subtitle-card"},et=A(r({__name:"card-display",props:{currentEntry:{},config:{},currentTime:{},showEmptyState:{type:Boolean,default:!0}},setup(e){const s=e,r=i(!1),y=i(!1),g=i(""),v=n(()=>({"--font-size":`${s.config.fontSize}px`,"--font-color":s.config.fontColor,"--background-color":s.config.backgroundColor,"--card-padding":"16px 20px"})),f=n(()=>({background:s.config.showBackground?"var(--background-color)":"rgba(0, 0, 0, 0.8)",border:s.config.showBackground?"none":"1px solid rgba(255, 255, 255, 0.2)",backdropFilter:s.config.showBackground?"none":"blur(10px)"})),T=n(()=>({fontSize:"var(--font-size)",color:"var(--font-color)",lineHeight:"1.5"})),b=n(()=>{if(!(s.currentEntry&&s.currentEntry.startTime&&s.currentEntry.endTime&&s.currentTime))return 0;const t=s.currentEntry.endTime-s.currentEntry.startTime,e=s.currentTime-s.currentEntry.startTime;return Math.min(100,Math.max(0,e/t*100))}),E=t=>{const e=Math.floor(t/1e3),s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`};return a(()=>s.currentEntry,(t,e)=>{if(t!==e){const s=`${t?.startTime}-${t?.endTime}`;s!==g.value&&(r.value=!0,y.value=!1,setTimeout(()=>{r.value=!1},300),e&&(y.value=!0,setTimeout(()=>{y.value=!1},300)),g.value=s||"")}},{immediate:!0}),(s,i)=>{const n=t;return o(),l("div",{class:"card-display",style:c(v.value)},[e.currentEntry?(o(),l("div",{key:0,class:m(["subtitle-card",{"animate-in":r.value,"animate-out":y.value}]),style:c(f.value)},[u("div",W,[u("div",{class:"subtitle-text",style:c(T.value)},h(e.currentEntry.text),5),(o(),l("div",Z,[u("span",Q,h(E(e.currentEntry.startTime||0)),1),i[0]||(i[0]=u("div",{class:"time-separator"},null,-1)),u("span",J,h(E(e.currentEntry.endTime||0)),1)]))]),(o(),l("div",X,[u("div",{class:"progress-fill",style:c({width:b.value+"%"})},null,4)]))],6)):e.showEmptyState?(o(),l("div",tt,[p(n,{icon:"mdi:subtitles-outline",class:"no-subtitle-icon"}),i[1]||(i[1]=u("span",{class:"no-subtitle-text"},"暂无字幕",-1))])):d("",!0)],4)}}}),[["__scopeId","data-v-dedabcf7"]]),st={class:"line-content"},rt={class:"line-text"},it={key:0,class:"line-progress"},nt={key:0,class:"no-subtitle-lines"},at=A(r({__name:"line-display",props:{currentEntry:{},config:{},currentTime:{},showEmptyState:{type:Boolean,default:!0}},setup(e){const s=e,r=i([]),v=i([]),f=n(()=>({"--font-size":`${s.config.fontSize}px`,"--font-color":s.config.fontColor,"--background-color":s.config.backgroundColor,"--line-height":1.8*s.config.fontSize+"px","--line-spacing":"8px"})),T=n(()=>({fontSize:"var(--font-size)",color:"var(--font-color)",height:"var(--line-height)",lineHeight:"var(--line-height)"})),b=n(()=>{if(!(s.currentEntry&&s.currentEntry.startTime&&s.currentEntry.endTime&&s.currentTime))return 0;const t=s.currentEntry.endTime-s.currentEntry.startTime,e=s.currentTime-s.currentEntry.startTime;return Math.min(100,Math.max(0,e/t*100))}),E=t=>0===t&&!!s.currentEntry,S=t=>t>0&&t<r.value.length-1,C=t=>t===r.value.length-1&&r.value.length>1,k=()=>{if(!s.currentEntry)return void setTimeout(()=>{r.value=[],v.value=[]},300);v.value.some(t=>t.startTime===s.currentEntry?.startTime&&t.endTime===s.currentEntry?.endTime)||(v.value.unshift(s.currentEntry),v.value.length>2*s.config.lineCount&&(v.value=v.value.slice(0,2*s.config.lineCount)));const t=[];t.push({text:s.currentEntry.text||"",startTime:s.currentEntry.startTime,endTime:s.currentEntry.endTime});v.value.slice(1,s.config.lineCount).forEach(e=>{t.push({text:e.text||"",startTime:e.startTime,endTime:e.endTime})}),r.value=t.slice(0,s.config.lineCount)};return a(()=>s.currentEntry,t=>{k()},{immediate:!0}),a(()=>s.config.lineCount,()=>{k()}),(s,i)=>{const n=t;return o(),l("div",{class:"line-display",style:c(f.value)},[u("div",{class:"lines-container",style:c({"--line-count":e.config.lineCount})},[(o(!0),l(y,null,g(r.value,(t,e)=>(o(),l("div",{key:e,class:m(["subtitle-line",{active:E(e),previous:S(e),next:C(e)}]),style:c(T.value)},[u("div",st,[u("span",rt,h(t.text),1),E(e)?(o(),l("div",it,[u("div",{class:"line-progress-fill",style:c({width:b.value+"%"})},null,4)])):d("",!0)])],6))),128))],4),0===r.value.length&&e.showEmptyState?(o(),l("div",nt,[p(n,{icon:"mdi:subtitles-outline",class:"no-subtitle-icon"}),i[0]||(i[0]=u("span",{class:"no-subtitle-text"},"暂无字幕",-1))])):d("",!0)],4)}}}),[["__scopeId","data-v-f537d48b"]]),lt={class:"settings-dialog"},ot={class:"setting-section"},ct={class:"mode-options"},ut=["onClick"],dt={class:"mode-label"},mt={class:"setting-section"},ht={class:"setting-group"},pt={class:"slider-container"},yt={class:"slider-value"},gt={class:"setting-group"},vt={class:"color-picker-container"},ft={class:"color-value"},Tt={class:"setting-section"},bt={class:"setting-group"},Et={class:"setting-label"},St={key:0,class:"setting-group"},Ct={class:"color-picker-container"},kt={class:"color-value"},Dt={key:1,class:"setting-group"},wt={class:"slider-container"},At={class:"slider-value"},_t={key:0,class:"setting-section"},xt={class:"setting-group"},Lt={class:"slider-container"},Pt={class:"slider-value"},Mt={class:"setting-section"},Rt={class:"position-options"},Ot=["onClick"],Ht={class:"position-label"},It={class:"setting-section"},Nt=A(r({__name:"settings-dialog",props:{modelValue:{type:Boolean},config:{}},emits:["update:modelValue","update-config"],setup(s,{emit:r}){const C=s,k=r,D=[{value:"fullscreen",label:"全屏模式",icon:"mdi:fullscreen"},{value:"card",label:"卡片模式",icon:"mdi:card-text-outline"},{value:"line",label:"行模式",icon:"mdi:format-list-bulleted"}],w=[{value:"top",label:"顶部",icon:"mdi:arrow-up"},{value:"center",label:"居中",icon:"mdi:arrow-all"},{value:"bottom",label:"底部",icon:"mdi:arrow-down"}],A=i({...C.config}),_=n({get:()=>{const t=A.value.backgroundColor?.match(/rgba?\([^)]+,\s*([\d.]+)\)/);return t?Math.round(100*parseFloat(t[1])):70},set:t=>{const e=t/100;A.value.backgroundColor=A.value.backgroundColor.replace(/rgba?\([^)]+,\s*[\d.]+\)/,`rgba(0, 0, 0, ${e})`)}}),x=n(()=>({background:A.value.showBackground?A.value.backgroundColor:"transparent",padding:A.value.showBackground?"20px":"0",borderRadius:A.value.showBackground?"8px":"0"})),L=n(()=>({fontSize:`${A.value.fontSize}px`,color:A.value.fontColor,textAlign:"center"})),P=t=>{k("update:modelValue",t)};a(()=>C.config,t=>{A.value={...t}},{deep:!0});const M=()=>{k("update-config",{...A.value}),k("update:modelValue",!1)},R=()=>{A.value={displayMode:"card",lineCount:3,fontSize:16,fontColor:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",showBackground:!0,position:"bottom",autoScroll:!0,scrollSpeed:1}},O=()=>{k("update:modelValue",!1)};return(r,i)=>{const n=t,a=e;return o(),v(a,{visible:s.modelValue,title:"字幕设置",width:"500px","show-close":!0,"onUpdate:visible":P,onClose:O},{default:f(()=>[u("div",lt,[u("div",ot,[i[6]||(i[6]=u("h3",{class:"section-title"},"显示模式",-1)),u("div",ct,[(o(),l(y,null,g(D,t=>u("div",{key:t.value,class:m(["mode-option",{active:A.value.displayMode===t.value}]),onClick:e=>A.value.displayMode=t.value},[p(n,{icon:t.icon,class:"mode-icon"},null,8,["icon"]),u("span",dt,h(t.label),1)],10,ut)),64))])]),u("div",mt,[i[9]||(i[9]=u("h3",{class:"section-title"},"字体设置",-1)),u("div",ht,[i[7]||(i[7]=u("label",{class:"setting-label"},"字体大小",-1)),u("div",pt,[T(u("input",{type:"range","onUpdate:modelValue":i[0]||(i[0]=t=>A.value.fontSize=t),min:"12",max:"48",step:"2",class:"slider"},null,512),[[b,A.value.fontSize]]),u("span",yt,h(A.value.fontSize)+"px",1)])]),u("div",gt,[i[8]||(i[8]=u("label",{class:"setting-label"},"字体颜色",-1)),u("div",vt,[T(u("input",{type:"color","onUpdate:modelValue":i[1]||(i[1]=t=>A.value.fontColor=t),class:"color-picker"},null,512),[[b,A.value.fontColor]]),u("span",ft,h(A.value.fontColor),1)])])]),u("div",Tt,[i[13]||(i[13]=u("h3",{class:"section-title"},"背景设置",-1)),u("div",bt,[u("label",Et,[T(u("input",{type:"checkbox","onUpdate:modelValue":i[2]||(i[2]=t=>A.value.showBackground=t),class:"checkbox"},null,512),[[S,A.value.showBackground]]),i[10]||(i[10]=E(" 显示背景 ",-1))])]),A.value.showBackground?(o(),l("div",St,[i[11]||(i[11]=u("label",{class:"setting-label"},"背景颜色",-1)),u("div",Ct,[T(u("input",{type:"color","onUpdate:modelValue":i[3]||(i[3]=t=>A.value.backgroundColor=t),class:"color-picker"},null,512),[[b,A.value.backgroundColor]]),u("span",kt,h(A.value.backgroundColor),1)])])):d("",!0),A.value.showBackground?(o(),l("div",Dt,[i[12]||(i[12]=u("label",{class:"setting-label"},"背景透明度",-1)),u("div",wt,[T(u("input",{type:"range","onUpdate:modelValue":i[4]||(i[4]=t=>_.value=t),min:"0",max:"100",step:"10",class:"slider"},null,512),[[b,_.value]]),u("span",At,h(_.value)+"%",1)])])):d("",!0)]),"line"===A.value.displayMode?(o(),l("div",_t,[i[15]||(i[15]=u("h3",{class:"section-title"},"行模式设置",-1)),u("div",xt,[i[14]||(i[14]=u("label",{class:"setting-label"},"显示行数",-1)),u("div",Lt,[T(u("input",{type:"range","onUpdate:modelValue":i[5]||(i[5]=t=>A.value.lineCount=t),min:"1",max:"10",step:"1",class:"slider"},null,512),[[b,A.value.lineCount]]),u("span",Pt,h(A.value.lineCount)+" 行",1)])])])):d("",!0),u("div",Mt,[i[16]||(i[16]=u("h3",{class:"section-title"},"位置设置",-1)),u("div",Rt,[(o(),l(y,null,g(w,t=>u("div",{key:t.value,class:m(["position-option",{active:A.value.position===t.value}]),onClick:e=>A.value.position=t.value},[p(n,{icon:t.icon,class:"position-icon"},null,8,["icon"]),u("span",Ht,h(t.label),1)],10,Ot)),64))])]),u("div",It,[i[17]||(i[17]=u("h3",{class:"section-title"},"预览",-1)),u("div",{class:"preview-container",style:c(x.value)},[u("div",{class:"preview-subtitle",style:c(L.value)}," 这是一条预览字幕 ",4)],4)]),u("div",{class:"dialog-actions"},[u("button",{class:"btn btn-secondary",onClick:R},"重置"),u("button",{class:"btn btn-primary",onClick:M},"应用"),u("button",{class:"btn btn-default",onClick:O},"取消")])])]),_:1},8,["visible"])}}}),[["__scopeId","data-v-3b752c51"]]),Bt={class:"subtitle-list-dialog"},Ut={class:"dialog-header"},Ft={class:"search-container"},Vt={class:"filter-container"},$t={class:"subtitle-list-container"},zt={key:0,class:"empty-state"},Yt={key:1,class:"subtitle-list"},Gt=["onClick"],jt={class:"entry-time"},qt={class:"time-start"},Kt={class:"time-end"},Wt={class:"entry-content"},Zt={class:"entry-text"},Qt={key:0,class:"entry-badge"},Jt={class:"entry-actions"},Xt={class:"dialog-footer"},te={class:"stats-info"},ee={class:"stat-item"},se={class:"stat-item"},re={class:"stat-item"},ie=A(r({__name:"subtitle-list-dialog",props:{modelValue:{type:Boolean},subtitles:{},currentTime:{}},emits:["update:modelValue","seek-to"],setup(s,{emit:r}){const c=s,E=r,S=i(""),D=i("all"),w=n(()=>{const t=[];return c.subtitles?.entries&&t.push(...c.subtitles.entries.map((t,e)=>({...t,sequence:e+1,isDynamic:!1}))),t.sort((t,e)=>(t.startTime||0)-(e.startTime||0))}),A=n(()=>{let t=w.value;if(S.value){const e=S.value.toLowerCase();t=t.filter(t=>t.text?.toLowerCase().includes(e))}if("current"===D.value){const e=c.currentTime;t=t.filter(t=>Math.abs((t.startTime||0)-e)<3e4)}else"dynamic"===D.value&&(t=t.filter(t=>t.isDynamic));return t}),_=n(()=>w.value.length),x=n(()=>w.value.filter(t=>t.isDynamic).length),L=n(()=>c.subtitles?.entries?c.subtitles.entries.findIndex(t=>c.currentTime>=(t.startTime||0)&&c.currentTime<=(t.endTime||0)):-1),P=t=>L.value===(t.sequence?t.sequence-1:-1),M=t=>c.currentTime>=(t.startTime||0)&&c.currentTime<=(t.endTime||0),R=t=>!!t.isDynamic,O=t=>`${t.sequence}-${t.startTime}-${t.endTime}`,H=t=>{const e=Math.floor(t/1e3),s=Math.floor(e/60),r=e%60,i=Math.floor(t%1e3/10);return`${s.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}.${i.toString().padStart(2,"0")}`},I=t=>{void 0!==t.startTime&&E("seek-to",t.startTime)},N=t=>{E("update:modelValue",t)},B=()=>{E("update:modelValue",!1)};return a(()=>c.modelValue,t=>{t&&(S.value="",D.value="all")}),(r,i)=>{const n=t,a=e;return o(),v(a,{visible:s.modelValue,title:"字幕列表",width:"600px",height:"400px","show-close":!0,"onUpdate:visible":N,onClose:B},{default:f(()=>[u("div",Bt,[u("div",Ut,[u("div",Ft,[p(n,{icon:"mdi:magnify",class:"search-icon"}),T(u("input",{"onUpdate:modelValue":i[0]||(i[0]=t=>S.value=t),type:"text",placeholder:"搜索字幕内容...",class:"search-input"},null,512),[[b,S.value]])]),u("div",Vt,[T(u("select",{"onUpdate:modelValue":i[1]||(i[1]=t=>D.value=t),class:"filter-select"},[...i[2]||(i[2]=[u("option",{value:"all"},"全部字幕",-1),u("option",{value:"current"},"当前附近",-1),u("option",{value:"dynamic"},"动态字幕",-1)])],512),[[C,D.value]])])]),u("div",$t,[0===A.value.length?(o(),l("div",zt,[p(n,{icon:"mdi:subtitles-outline",class:"empty-icon"}),i[3]||(i[3]=u("p",{class:"empty-text"},"暂无字幕内容",-1))])):(o(),l("div",Yt,[(o(!0),l(y,null,g(A.value,t=>(o(),l("div",{key:O(t),class:m(["subtitle-item",{active:P(t),playing:M(t),dynamic:R(t)}]),onClick:e=>I(t)},[u("div",jt,[u("span",qt,h(H(t.startTime||0)),1),i[4]||(i[4]=u("span",{class:"time-separator"},"→",-1)),u("span",Kt,h(H(t.endTime||0)),1)]),u("div",Wt,[u("div",Zt,h(t.text),1),R(t)?(o(),l("div",Qt,[...i[5]||(i[5]=[u("span",{class:"badge dynamic-badge"},"动态",-1)])])):d("",!0)]),u("div",Jt,[P(t)?(o(),v(n,{key:0,icon:"mdi:play",class:"action-icon playing-icon"})):(o(),v(n,{key:1,icon:"mdi:play-circle-outline",class:"action-icon",onClick:k(e=>I(t),["stop"])},null,8,["onClick"]))])],10,Gt))),128))]))]),u("div",Xt,[u("div",te,[u("span",ee," 总计: "+h(_.value)+" 条 ",1),u("span",se," 动态: "+h(x.value)+" 条 ",1),u("span",re," 当前: "+h(L.value+1),1)])])])]),_:1},8,["visible"])}}}),[["__scopeId","data-v-5fadbdd5"]]),ne={key:0,class:"subtitles-controls"},ae={class:"control-group"},le=A(r({__name:"sdkwork-subtitles",props:{content:{},url:{},subtitles:{},format:{},displayMode:{default:F.CARD},lineCount:{default:3},fontSize:{default:16},fontColor:{default:"#ffffff"},backgroundColor:{default:"rgba(0, 0, 0, 0.7)"},showBackground:{type:Boolean,default:!0},position:{default:"bottom"},autoScroll:{type:Boolean,default:!0},scrollSpeed:{default:1},currentTime:{},isPlaying:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0},duration:{},showEmptyState:{type:Boolean,default:!0}},emits:["load-start","load-complete","load-error","entry-change","mode-change","playback-state-change","content-update","fullscreen-change","seek-to"],setup(s,{expose:r,emit:c}){const h=s,y=c,g=Y(),T=i(!1),b=i(!1),E=i(!1),S=n(()=>({displayMode:h.displayMode,lineCount:h.lineCount,fontSize:h.fontSize,fontColor:h.fontColor,backgroundColor:h.backgroundColor,showBackground:h.showBackground,position:h.position,autoScroll:h.autoScroll,scrollSpeed:h.scrollSpeed})),C=n(()=>({[`position-${h.position}`]:!0,"has-controls":h.showControls})),k=n(()=>({[`mode-${S.value.displayMode}`]:!0})),A=n(()=>g.currentEntry),_=n(()=>g.currentSubtitles),x=n(()=>g.currentTime),L=async t=>{if(t)try{await g.loadFromString(t,{format:h.format,duration:h.duration})}catch(e){}},P=async t=>{if(t)try{await g.loadFromUrl(t,{format:h.format,duration:h.duration})}catch(e){}},M=t=>{t&&g.loadFromObject(t)},R=(t,e)=>{g.switchDisplayMode(t,e)},O=()=>{const t="fullscreen"===S.value.displayMode?F.CARD:F.FULLSCREEN;R(t),T.value="fullscreen"===t,y("fullscreen-change","fullscreen"===t)},H=t=>{g.updateConfig(t)},I=t=>{g.seekTo(t),y("seek-to",t)},N=()=>{"fullscreen"===S.value.displayMode&&O()};return a(()=>h.content,L),a(()=>h.url,P),a(()=>h.subtitles,M),a(()=>h.currentTime,t=>{void 0!==t&&g.updatePlaybackTime(t)}),a(()=>h.isPlaying,t=>{t?g.startPlayback():g.pausePlayback()}),r({loadFromString:L,loadFromUrl:P,loadFromObject:M,clearSubtitles:g.clearSubtitles,addDynamicSubtitle:(t,e,s,r=!1)=>{g.addDynamicSubtitle({text:t,startTime:e,endTime:s,isFinal:r})},addDynamicSubtitles:t=>{g.addDynamicSubtitles(t.map(t=>({...t,isFinal:!1})))},clearDynamicSubtitles:()=>{g.clearDynamicSubtitles()},startPlayback:g.startPlayback,stopPlayback:g.stopPlayback,pausePlayback:g.pausePlayback,resumePlayback:g.resumePlayback,seekTo:g.seekTo,updatePlaybackTime:g.updatePlaybackTime,switchDisplayMode:R,toggleFullscreen:O,updateConfig:g.updateConfig,resetConfig:g.resetConfig,getStats:g.getStats,exportSubtitles:g.exportSubtitles,on:g.on,off:g.off}),D(()=>{g.on($.LOAD_START,t=>{y("load-start",t.currentTime||0)}),g.on($.LOAD_COMPLETE,t=>{y("load-complete",t.currentTime||0)}),g.on($.LOAD_ERROR,t=>{y("load-error",t.error||"未知错误",t.currentTime||0)}),g.on($.ENTRY_CHANGE,t=>{y("entry-change",t.currentEntry||null,t.currentTime||0)}),g.on($.MODE_CHANGE,t=>{y("mode-change",t.currentTime||0)}),g.on($.PLAYBACK_STATE_CHANGE,t=>{y("playback-state-change",t.currentTime||0)}),g.on($.CONTENT_UPDATE,t=>{y("content-update",t.currentTime||0)}),h.content?L(h.content):h.url?P(h.url):h.subtitles&&M(h.subtitles)}),w(()=>{g.stopPlayback()}),(r,i)=>{const n=e,a=t;return o(),l("div",{class:m(["sdkwork-subtitles",C.value])},[u("div",{class:m(["subtitles-container",k.value])},["fullscreen"===S.value.displayMode?(o(),v(n,{key:0,visible:T.value,"onUpdate:visible":i[0]||(i[0]=t=>T.value=t),overlay:!1,position:"center",class:"fullscreen-subtitles"},{default:f(()=>[p(K,{"current-entry":A.value,config:S.value,"current-time":x.value,"show-empty-state":s.showEmptyState,onClick:N},null,8,["current-entry","config","current-time","show-empty-state"])]),_:1},8,["visible"])):"card"===S.value.displayMode?(o(),v(et,{key:1,"current-entry":A.value,config:S.value,"current-time":x.value,"show-empty-state":s.showEmptyState},null,8,["current-entry","config","current-time","show-empty-state"])):"line"===S.value.displayMode?(o(),v(at,{key:2,"current-entry":A.value,config:S.value,"current-time":x.value,"show-empty-state":s.showEmptyState},null,8,["current-entry","config","current-time","show-empty-state"])):d("",!0)],2),s.showControls?(o(),l("div",ne,[u("div",ae,[p(a,{icon:"mdi:cog",class:"control-icon",onClick:i[1]||(i[1]=t=>b.value=!0)}),p(a,{icon:"mdi:format-list-bulleted",class:"control-icon",onClick:i[2]||(i[2]=t=>E.value=!0)}),p(a,{icon:"fullscreen"===S.value.displayMode?"mdi:fullscreen-exit":"mdi:fullscreen",class:"control-icon",onClick:O},null,8,["icon"])])])):d("",!0),p(Nt,{modelValue:b.value,"onUpdate:modelValue":i[3]||(i[3]=t=>b.value=t),config:S.value,onUpdateConfig:H},null,8,["modelValue","config"]),p(ie,{modelValue:E.value,"onUpdate:modelValue":i[4]||(i[4]=t=>E.value=t),subtitles:_.value,"current-time":x.value,onSeekTo:I},null,8,["modelValue","subtitles","current-time"])],2)}}}),[["__scopeId","data-v-4c8a3d3e"]]);export{F as S,le as _,_ as a};
