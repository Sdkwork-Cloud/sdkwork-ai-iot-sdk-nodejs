import{I as e,_ as t,L as s}from"./index-mGUiS-yG.js";import{E as o}from"./index-BAHb5bKQ.js";import{k as a,f as i,P as r,Q as n,R as l,S as d,j as c,W as m,a0 as p,a4 as v,Z as u,$ as g,a as h,U as f,O as k,r as b}from"./vue-vendor-B1RsE4Tz.js";import{u as y}from"./conversation-B-eIgQr2.js";import{S as w}from"./sdkwork-api-list-D3THvzYz.js";import{I as S}from"./index-wXuWqSXL.js";import{S as _}from"./sdkwork-page-container-DqaCEpSi.js";import{b as C}from"./route-block-B_A1xBdJ.js";import"./utils-vendor-WEzSe-CR.js";import"sdkwork-ai-iot-sdk";import"./use-id-CKFvKg0a.js";import"./index-z7NB4-1J.js";import"./index-71u4jA4R.js";import"./use-tab-status-CHnze7eF.js";import"./shared-BHV4AZq-.js";import"./sdkwork-search-bar-BbOdLEF5.js";import"./sdkwork-icon-0ITLYrI-.js";import"./ListItem-DTjFzhTd.js";/* empty css              */const j={class:"sdkwork-conversation-list-item__avatar"},z={class:"avatar-placeholder"},B={key:0,class:"online-indicator"},x={class:"sdkwork-conversation-list-item__content"},I={class:"conversation-header"},M={class:"conversation-title"},N={class:"conversation-time"},L={class:"conversation-preview"},D={class:"last-message"},$={key:0,class:"message-content"},T={key:1,class:"no-message"},E={key:0,class:"unread-badge"},F=t(a({__name:"sdkwork-conversation-list-item",props:{conversation:{},disabled:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},showBorderBottom:{type:Boolean,default:!0},themeMode:{default:"auto"}},emits:["click","select"],setup(t,{expose:s,emit:o}){const a=t,h=o,f=i(()=>"dark"===a.themeMode||"light"!==a.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),k=i(()=>f.value?"sdkwork-conversation-list-item--dark":"sdkwork-conversation-list-item--light"),b=()=>{a.disabled||h("click",a.conversation)},y=e=>{const t=window.$date.parse(e),s=(new Date).getTime()-t.getTime(),o=Math.floor(s/864e5);return 0===o?t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):1===o?"昨天":o<7?`${o}天前`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},w=e=>e.length<=30?e:e.substring(0,30)+"...";return s({getTitle:()=>a.conversation.title,getUnreadCount:()=>a.conversation.unreadCount||0,isPinned:()=>a.conversation.pinned,formatTime:y,truncateMessage:w}),(s,o)=>{const a=e,i=S;return n(),r("div",{class:l(["sdkwork-conversation-list-item",[{"sdkwork-conversation-list-item--selected":t.isSelected,"sdkwork-conversation-list-item--pinned":t.conversation.pinned,"sdkwork-conversation-list-item--unread":(t.conversation.unreadCount||0)>0,"sdkwork-conversation-list-item--disabled":t.disabled,"sdkwork-conversation-list-item--border-bottom":t.showBorderBottom},k.value]]),onClick:b},[d("div",j,[c(i,{src:t.conversation.avatar,width:"44",height:"44",radius:"4",fit:"cover"},{error:p(()=>[d("div",z,[c(a,{name:"chat-o",size:"18"})])]),_:1},8,["src"]),t.conversation.online?(n(),r("div",B)):m("",!0)]),d("div",x,[d("div",I,[d("div",M,[v(g(t.conversation.title)+" ",1),t.conversation.pinned?(n(),u(a,{key:0,name:"pin",class:"pin-icon"})):m("",!0)]),d("div",N,g(y(t.conversation.updatedAt||t.conversation.createdAt||"")),1)]),d("div",L,[d("div",D,[t.conversation.lastMessageId?(n(),r("span",$,g(w(t.conversation.lastMessageId?.toString()||"")),1)):(n(),r("span",T,"暂无消息"))]),(t.conversation.unreadCount||0)>0?(n(),r("div",E,g((t.conversation.unreadCount||0)>99?"99+":t.conversation.unreadCount),1)):m("",!0)])])],2)}}}),[["__scopeId","data-v-0b6b8730"]]),O={class:"sdkwork-conversation-list"},P=t(a({__name:"sdkwork-conversation-list",props:{api:{},params:{default:()=>({})},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1},pageSize:{default:10},itemKey:{default:"id"},itemTitleField:{default:"title"},itemDescriptionField:{default:"description"}},emits:["select","delete","archive","pin","mute","search","load","click","context-menu"],setup(e,{expose:t,emit:a}){const l=e,m=a,u=h(),g=i(()=>({pageNumber:0,pageSize:l.pageSize,filters:l.params})),k=e=>{m("select",e)},b=e=>{m("delete",e)},y=e=>{m("search",e)},S=e=>{m("load",e)},_=e=>{m("select",e)},C=e=>{m("click",e)};return t({refresh:()=>u.value?.refresh(),loadMore:()=>u.value?.loadMore(),getData:()=>u.value?.getData()||[],getSelectedItems:()=>u.value?.getSelectedItems()||[],clearSelected:()=>u.value?.clearSelected(),setSelectedItems:e=>u.value?.setSelectedItems(e)}),(t,a)=>{const i=o,l=s;return n(),r("div",O,[c(w,{api:e.api,params:g.value,selectable:e.selectable,deletable:e.deletable,searchable:e.searchable,"page-size":e.pageSize,"item-key":e.itemKey,"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,"left-spacing":0,"right-spacing":0,onSelect:k,onDelete:b,onSearch:y,onLoad:S,ref_key:"apiListRef",ref:u,showBorderBottom:"",borderBottomLeftOffset:60},{default:p(({item:e,index:t,selected:s})=>[c(F,{conversation:e,"is-selected":s,"show-border-bottom":!0,onClick:C,onSelect:_},null,8,["conversation","is-selected"])]),empty:p(()=>[f(t.$slots,"empty",{},()=>[c(i,{description:"暂无聊天会话",image:"search"},{description:p(()=>[...a[0]||(a[0]=[d("div",{class:"empty-description"},[d("p",null,"暂时没有聊天会话"),d("p",{class:"empty-tip"},"您可以开始新的对话或调整搜索条件")],-1)])]),_:1})],!0)]),loading:p(()=>[f(t.$slots,"loading",{},()=>[c(l,{size:"24px",vertical:""},{default:p(()=>[...a[1]||(a[1]=[v("加载会话数据...",-1)])]),_:1})],!0)]),header:p(()=>[f(t.$slots,"header",{},void 0,!0)]),footer:p(()=>[f(t.$slots,"footer",{},void 0,!0)]),_:3},8,["api","params","selectable","deletable","searchable","page-size","item-key","item-title-field","item-description-field"])])}}}),[["__scopeId","data-v-bb158ad7"]]),R=a({__name:"home",setup(e){const t=k(),a=y(),i=h(),r=b({status:void 0,keyword:"",agentId:"",pinned:void 0,muted:void 0}),l=async e=>{try{return console.log("getConversationList:",e),await a.loadMoreConversations(e.pageNumber||0,e.pageSize||10),{content:a.sortedConversations,empty:0===a.sortedConversations.length,first:0===(e.pageNumber||0),last:a.sortedConversations.length<(e.pageSize||10),pageNumber:e.pageNumber||0,numberOfElements:a.sortedConversations.length,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:a.sortedConversations.length,totalPages:Math.ceil(a.sortedConversations.length/(e.pageSize||10))}}catch(t){return console.error("获取会话列表失败:",t),{content:[],empty:!0,first:!0,last:!0,pageNumber:e.pageNumber||0,numberOfElements:0,pageSize:e.pageSize||10,sort:{empty:!0,sorted:!1,unsorted:!0,orders:[]},totalElements:0,totalPages:0}}},m=async e=>{try{console.log("选择会话:",e),await a.switchConversation(e.id);const s=e.uuid||e.id;t.push(`/chat/${s}`)}catch(s){console.error("选择会话失败:",s)}},g=async e=>{try{console.log("删除会话:",e),await a.deleteConversation(e.id),console.log("会话删除成功")}catch(t){console.error("删除会话失败:",t)}},f=e=>{console.log("搜索会话:",e)},w=e=>{console.log("会话数据加载完成:",e)};return(e,t)=>{const a=o,h=s;return n(),u(_,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:p(()=>[c(P,{api:l,params:r,selectable:!1,deletable:!1,searchable:!1,"pageNumber-size":10,onSelect:m,onDelete:g,onSearch:f,onLoad:w,ref_key:"conversationListRef",ref:i},{empty:p(()=>[c(a,{description:"暂无聊天会话",image:"search"},{description:p(()=>[...t[0]||(t[0]=[d("div",{class:"empty-description"},[d("p",null,"暂时没有聊天会话"),d("p",{class:"empty-tip"},"您可以开始新的对话")],-1)])]),_:1})]),loading:p(()=>[c(h,{size:"24px",vertical:""},{default:p(()=>[...t[1]||(t[1]=[v("加载会话数据...",-1)])]),_:1})]),_:1},8,["params"])]),_:1})}}});"function"==typeof C&&C(R);const A=t(R,[["__scopeId","data-v-13ba55e5"]]);export{A as default};
