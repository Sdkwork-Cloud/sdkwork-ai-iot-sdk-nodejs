import{D as e,u as t,E as i,S as l}from"./shared-DSXEP7p_.js";import{L as o}from"./ListItem-BwLXeDxh.js";import{k as a,P as r,Q as s,S as n,$ as d,M as f,r as u,b as c,l as m,ah as p,ai as v,d as y,G as h,w as S,f as b,n as g,o as z,R as k,Z as w,u as B,ac as x,m as T,a0 as E,U as C,ad as O,j as R,W as F}from"./vue-vendor-BAnrfl1G.js";import{_ as M}from"./index-TwMLNQLv.js";const $={class:"loading-indicator"},D={class:"loading-content"},H={class:"loading-text"},L=M(a({__name:"LoadingIndicator",props:{text:{default:"刷新中..."}},setup:e=>(t,i)=>(s(),r("div",$,[n("div",D,[i[0]||(i[0]=n("div",{class:"loading-icon"},"↻",-1)),n("div",H,d(e.text),1)])]))}),[["__scopeId","data-v-41c5aa1b"]]),j={class:"load-more-indicator"},V={class:"load-more-content"},_={key:0,class:"loading-icon"},A={key:1,class:"load-more-text"},I=M(a({__name:"LoadMoreIndicator",props:{loading:{type:Boolean,default:!1},text:{default:"加载更多..."}},setup:e=>(t,i)=>(s(),r("div",j,[n("div",V,[e.loading?(s(),r("div",_,"↻")):(s(),r("div",A,d(e.text),1))])]))}),[["__scopeId","data-v-1dbd3045"]]);const G=function(e,t,i){const{attrs:l,on:o,...a}=t;let r={};return o&&Object.entries(o).forEach(e=>{const[t,i]=e;r[`on${t[0].toUpperCase()+t.slice(1)}`]=i}),f(e,{...l,...r,...a},i)};const K=function(e,t,i){const{attrs:l,on:o,...a}=t;let r={};return o&&Object.entries(o).forEach(e=>{const[t,i]=e;r[`on${t[0].toUpperCase()+t.slice(1)}`]=i}),f(e,{...l,...r,...a},{default:()=>i})};const N=function(e,t){var i;return null==(i=e.$slots)?void 0:i[t]};function P(...e){let t="";return e.forEach(e=>{"string"==typeof e?t+=e+";":Array.isArray(e)?t+=P(...e):"object"==typeof e&&Object.entries(e).forEach(([e,i])=>{i&&(t+=`${e}:${i};`)})}),t}const U=a({name:"ObserverItem",props:{resizeObserver:{type:ResizeObserver,require:!0},id:{type:[String,Number],require:!0}},setup:e=>(e=>{const t=u(null);return c(()=>{e.resizeObserver&&t.value&&e.resizeObserver.observe(t.value)}),m(()=>{e.resizeObserver&&t.value&&e.resizeObserver.unobserve(t.value)}),{itemRefEl:t}})(e),render(){var e;const{id:t}=this;return G("div",{ref:"itemRefEl",attrs:{"data-id":t}},[null==(e=N(this,"default"))?void 0:e()])}}),q={itemGap:0,fixed:!1,buffer:0,bufferTop:0,bufferBottom:0,scrollDistance:0,horizontal:!1,fixSelection:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""};function Q(e,t){const i=new Proxy(e,{get(e,t){var i;return null!=(i=Reflect.get(e,t))?i:Reflect.get(q,t)}}),l=u(null),o=u(null),a=u(null),r=u(null),s=u(null),n=u(null),d=new Map,f=u(0);let b="backward",g=!1,z=!1,k=!1,w=null;const B=p({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),x=p({views:0,offset:0,listTotalSize:0,virtualSize:0,inViewBegin:0,inViewEnd:0,renderBegin:0,renderEnd:0,bufferTop:0,bufferBottom:0});function T(){const e=i.horizontal?"scrollLeft":"scrollTop";return l.value?l.value[e]:0}function E(){return x.listTotalSize+B.headerSize+B.footerSize+B.stickyHeaderSize+B.stickyFooterSize}function C(e){var t;return i.fixed?i.minSize+i.itemGap:null!=(t=d.get(String(e)))?t:i.minSize+i.itemGap}function O(e,t){d.set(String(e),t)}function R(e){var t,l;if(i.fixed)return{top:(i.minSize+i.itemGap)*e,current:i.minSize+i.itemGap,bottom:(i.minSize+i.itemGap)*(e+1)};const{itemKey:o}=i;let a=B.headerSize;for(let s=0;s<=e-1;s+=1){a+=C(null==(t=i.list[s])?void 0:t[o])}const r=C(null==(l=i.list[e])?void 0:l[o]);return{top:a,current:r,bottom:a+r}}function F(e){k=!0;const t=i.horizontal?"scrollLeft":"scrollTop";l.value&&(l.value[t]=e)}async function M(e){if(e<0)return;if(e>=i.list.length-1)return void $();let{top:t}=R(e);F(t);const l=()=>{const{top:i}=R(e);if(F(i),t!==i)return t=i,void(w=l);w=null};w=l}async function $(){let e=0;!function t(){e+=1,F(E()),setTimeout(()=>{e>10||Math.abs(Math.round(x.offset+B.clientSize)-Math.round(E()))>2&&t()},3)}()}function D(e){var l;e<x.inViewBegin&&(g=!0),x.inViewBegin=e,x.inViewEnd=Math.min(e+x.views,i.list.length-1),null==(l=null==t?void 0:t.rangeUpdate)||l.call(t,x.inViewBegin,x.inViewEnd)}function H(){var e,t;const{views:l,offset:o,inViewBegin:a}=x,{itemKey:r}=i,s=o-B.headerSize;let n=a,d=x.virtualSize+K(x.renderBegin,x.inViewBegin);if(s<0)D(0);else{if("forward"===b){if(s>=d)return;for(let t=n-1;t>=0;t-=1){const l=C(null==(e=i.list[t])?void 0:e[r]);if(d-=l,d<=s&&s<d+l){n=t;break}}}if("backward"===b){if(s<=d)return;for(let e=n;e<=i.list.length-1;e+=1){const l=C(null==(t=i.list[e])?void 0:t[r]);if(d<=s&&s<d+l){n=e;break}d+=l}g=!1}n!==x.inViewBegin&&D(n)}}function L(e){var l;null==(l=null==t?void 0:t.scroll)||l.call(t,e);const o=T();o!==x.offset&&(b=o<x.offset?"forward":"backward",x.offset=o,H(),function(){var e,l;const o=Math.max(i.scrollDistance,2);if("forward"===b)x.offset-o<=0&&(null==(e=null==t?void 0:t.toTop)||e.call(t,i.list[0]));else if("backward"===b){const e=Math.round(x.offset+B.clientSize);Math.round(E()-e)<=o&&(null==(l=null==t?void 0:t.toBottom)||l.call(t,i.list[i.list.length-1]))}}())}function j(){!function(){const e=Math.ceil(B.clientSize/(i.minSize+i.itemGap))+1;x.views=e}(),D(x.inViewBegin)}function V(){var e;if(i.fixed)return void(x.listTotalSize=(i.minSize+i.itemGap)*i.list.length);const{itemKey:t}=i;let l=0;for(let o=0;o<=i.list.length-1;o+=1)l+=C(null==(e=i.list[o])?void 0:e[t]);x.listTotalSize=l}function _(){x.offset=0,x.listTotalSize=0,x.virtualSize=0,x.inViewBegin=0,x.inViewEnd=0,x.renderBegin=0,x.renderEnd=0,d.clear(),A()}function A(){f.value+=1}let I;"undefined"!=typeof ResizeObserver&&(I=new ResizeObserver(e=>{var l;let o=0;for(const a of e){const e=a.target.dataset.id;if(e){const r=C(e);let s=0;if(a.borderBoxSize){const e=Array.isArray(a.borderBoxSize)?a.borderBoxSize[0]:a.borderBoxSize;s=i.horizontal?e.inlineSize:e.blockSize}else s=i.horizontal?a.contentRect.width:a.contentRect.height;"client"===e?(B.clientSize=s,j()):"header"===e?B.headerSize=s:"footer"===e?B.footerSize=s:"stickyHeader"===e?B.stickyHeaderSize=s:"stickyFooter"===e?B.stickyFooterSize=s:r!==s&&(O(e,s),o+=s-r,null==(l=null==t?void 0:t.itemResize)||l.call(t,e,s))}}x.listTotalSize+=o,w&&w(),!g&&!z||0===o||k||(g=!1,z=!1,F(x.offset+o)),k=!1}));const G=()=>{var e;let t=0;const l=x.renderBegin;for(let o=0;o<l;o++)t+=C(null==(e=i.list[o])?void 0:e[i.itemKey]);x.virtualSize=t};function K(e,t){var l;const o=Math.min(e,t),a=Math.max(e,t);let r=0;for(let s=o;s<a;s+=1)r+=C(null==(l=i.list[s])?void 0:l[i.itemKey]);return r}v(()=>{i.bufferTop?x.bufferTop=i.bufferTop:x.bufferTop=i.buffer,i.bufferBottom?x.bufferBottom=i.bufferBottom:x.bufferBottom=i.buffer}),c(()=>{l.value&&(l.value.addEventListener("scroll",L),null==I||I.observe(l.value)),s.value&&(null==I||I.observe(s.value)),n.value&&(null==I||I.observe(n.value)),a.value&&(null==I||I.observe(a.value)),r.value&&(null==I||I.observe(r.value)),i.start?M(i.start):i.offset&&F(i.offset)}),m(()=>{l.value&&(l.value.removeEventListener("scroll",L),null==I||I.unobserve(l.value),B.clientSize=0),s.value&&(null==I||I.unobserve(s.value),B.stickyHeaderSize=0),n.value&&(null==I||I.unobserve(n.value),B.stickyFooterSize=0),a.value&&(null==I||I.unobserve(a.value),B.headerSize=0),r.value&&(null==I||I.unobserve(r.value),B.footerSize=0)}),y(()=>{F(x.offset)});const N=h([]);return S(()=>[x.inViewBegin,x.inViewEnd,f.value],(e,t)=>{if(e&&t){const[t]=e,l=x.renderBegin;let o=t,a=x.inViewEnd;if(o=Math.max(0,o-x.bufferTop),a=Math.min(a+x.bufferBottom,i.list.length-1>0?i.list.length-1:0),null==i?void 0:i.renderControl){const{begin:e,end:l}=i.renderControl(t,x.inViewEnd);o=e,a=l}x.renderBegin=o,x.renderEnd=a,o>l?x.virtualSize+=K(o,l):x.virtualSize-=K(o,l),N.value=i.list.slice(x.renderBegin,x.renderEnd+1)}},{immediate:!0}),S(()=>i.list.length,()=>{i.list.length<=0?_():(V(),D(x.inViewBegin),G(),A())},{immediate:!0}),{props:i,renderList:N,clientRefEl:l,listRefEl:o,headerRefEl:a,footerRefEl:r,stickyHeaderRefEl:s,stickyFooterRefEl:n,reactiveData:x,slotSize:B,sizesMap:d,resizeObserver:I,getReactiveData:function(){return x},getOffset:T,getSlotSize:function(){return B.headerSize+B.footerSize+B.stickyHeaderSize+B.stickyFooterSize},reset:_,scrollToIndex:M,manualRender:function(e,t){const l=x.renderBegin;x.renderBegin=e,x.renderEnd=t,e>l?x.virtualSize+=K(e,l):x.virtualSize-=K(e,l),N.value=i.list.slice(x.renderBegin,x.renderEnd+1),G()},scrollIntoView:async function(e){var t;const{top:l,bottom:o}=R(e),a=T(),r=T()+B.clientSize,s=C(null==(t=i.list[e])?void 0:t[i.itemKey]);l<a&&a<o&&s<B.clientSize?F(l):l+B.stickyHeaderSize<r&&r<o+B.stickyHeaderSize&&s<B.clientSize?F(o-B.clientSize+B.stickyHeaderSize):(l+B.stickyHeaderSize>=r||o<=a)&&M(e)},scrollToTop:async function(){let e=0;!function t(){e+=1,F(0),setTimeout(()=>{var o;if(e>10)return;const a=i.horizontal?"scrollLeft":"scrollTop";0!==(null==(o=null==l?void 0:l.value)?void 0:o[a])&&t()},3)}()},scrollToBottom:$,scrollToOffset:F,getItemSize:C,deleteItemSize:function(e){d.delete(String(e))},deletedList2Top:function(e){V();let t=0;e.forEach(e=>{t+=C(e[i.itemKey])}),G(),F(x.offset-t),H()},addedList2Top:function(e){V();let t=0;e.forEach(e=>{t+=C(e[i.itemKey])}),G(),F(x.offset+t),z=!0,k=!1,H()},getItemPosByIndex:R,forceUpdate:A}}const W=a({name:"VirtList",emits:{scroll:e=>e,toTop:e=>e,toBottom:e=>e,itemResize:(e,t)=>!0,rangeUpdate:(e,t)=>!0},props:{list:{type:Array,default:()=>[]},itemKey:{type:[String,Number],required:!0},minSize:{type:Number,default:20,required:!0},itemGap:{type:Number,default:0},renderControl:{type:Function,default:void 0},fixed:{type:Boolean,default:!1},buffer:{type:Number,default:0},bufferTop:{type:Number,default:0},bufferBottom:{type:Number,default:0},scrollDistance:{type:Number,default:0},horizontal:{type:Boolean,default:!1},start:{type:Number,default:0},offset:{type:Number,default:0},listStyle:{type:[String,Array,Object],default:""},listClass:{type:[String,Array,Object],default:""},itemStyle:{type:[String,Array,Object,Function],default:""},itemClass:{type:[String,Array,Object,Function],default:""},headerClass:{type:[String,Array,Object],default:""},headerStyle:{type:[String,Array,Object],default:""},footerClass:{type:[String,Array,Object],default:""},footerStyle:{type:[String,Array,Object],default:""},stickyHeaderClass:{type:[String,Array,Object],default:""},stickyHeaderStyle:{type:[String,Array,Object],default:""},stickyFooterClass:{type:[String,Array,Object],default:""},stickyFooterStyle:{type:[String,Array,Object],default:""}},setup:(e,t)=>Q(e,{scroll:e=>{t.emit("scroll",e)},toTop:e=>{t.emit("toTop",e)},toBottom:e=>{t.emit("toBottom",e)},itemResize:(e,i)=>{t.emit("itemResize",e,i)},rangeUpdate:(e,i)=>{t.emit("rangeUpdate",e,i)}}),render(){const{renderList:e,reactiveData:t,resizeObserver:i}=this,{itemGap:l,itemKey:o,horizontal:a,listStyle:r,listClass:s,itemStyle:n,itemClass:d,headerClass:f,headerStyle:u,footerClass:c,footerStyle:m,stickyHeaderClass:p,stickyHeaderStyle:v,stickyFooterClass:y,stickyFooterStyle:h}=this.props,{listTotalSize:S,virtualSize:b,renderBegin:g}=t;return G("div",{ref:"clientRefEl",class:"virt-list__client",style:"width: 100%; height: 100%; overflow: auto;",attrs:{"data-id":"client"}},[(()=>{var e;return N(this,"stickyHeader")?G("div",{key:"slot-sticky-header",class:p,style:P("position: sticky; z-index: 10;",a?"left: 0":"top: 0;",v),ref:"stickyHeaderRefEl",attrs:{"data-id":"stickyHeader"}},[null==(e=N(this,"stickyHeader"))?void 0:e()]):null})(),(()=>{var e;return N(this,"header")?G("div",{key:"slot-header",class:f,style:u,ref:"headerRefEl",attrs:{"data-id":"header"}},[null==(e=N(this,"header"))?void 0:e()]):null})(),(()=>{var t,f;const u=[];for(let a=0;a<e.length;a+=1){const r=e[a];u.push(K(U,{key:r[o],class:"function"==typeof d?d(r,a):d,style:P(l>0?`padding: ${l/2}px 0;`:"","function"==typeof n?n(r,a):n),attrs:{id:r[o],resizeObserver:i}},null==(t=N(this,"default"))?void 0:t({itemData:r,index:g+a})))}if(0===u.length&&N(this,"empty")){const e=this.slotSize.clientSize-this.getSlotSize();u.push(G("div",{key:`slot-empty-${e}`,style:`height: ${e}px`},[null==(f=N(this,"empty"))?void 0:f()]))}return G("div",{ref:"listRefEl",class:s,style:a?`will-change: width; min-width: ${S}px; display: flex; ${r}`:`will-change: height; min-height: ${S}px; ${r}`},[G("div",{style:a?`width: ${b}px; will-change: width;`:`height: ${b}px; will-change: height;`}),u])})(),(()=>{var e;return N(this,"footer")?G("div",{key:"slot-footer",class:c,style:m,ref:"footerRefEl",attrs:{"data-id":"footer"}},[null==(e=N(this,"footer"))?void 0:e()]):null})(),(()=>{var e;return N(this,"stickyFooter")?G("div",{key:"slot-sticky-footer",class:y,style:P("position: sticky; z-index: 10;",a?"right: 0":"bottom: 0;",h),ref:"stickyFooterRefEl",attrs:{"data-id":"stickyFooter"}},[null==(e=N(this,"stickyFooter"))?void 0:e()]):null})()])}}),Z=M(a({__name:"sdkwork-api-list",props:{api:{type:Function,default:void 0},service:{default:void 0},params:{default:()=>({})},pageableParams:{default:()=>({})},selectable:{type:Boolean,default:e.selectable},deletable:{type:Boolean,default:e.deletable},searchable:{type:Boolean,default:e.searchable},pageSize:{default:e.pageSize},itemKey:{default:e.itemKey},itemTitleField:{default:e.itemTitleField},itemDescriptionField:{default:e.itemDescriptionField},topSpacing:{default:e.topSpacing},leftSpacing:{default:e.leftSpacing},rightSpacing:{default:e.rightSpacing},showBorderBottom:{type:Boolean,default:e.showBorderBottom},borderBottomLeftOffset:{default:e.borderBottomLeftOffset},showNoMoreData:{type:Boolean,default:e.showNoMoreData},themeMode:{default:e.themeMode},minSize:{default:e.minSize},itemGap:{default:e.itemGap},fixed:{type:Boolean,default:e.fixed},buffer:{default:e.buffer},bufferTop:{default:void 0},bufferBottom:{default:void 0},horizontal:{type:Boolean,default:e.horizontal},scrollDistance:{default:e.scrollDistance},fixSelection:{type:Boolean,default:e.fixSelection},start:{default:e.start},offset:{default:e.offset},listStyle:{default:e.listStyle},listClass:{default:e.listClass},itemStyle:{default:e.itemStyle},itemClass:{default:e.itemClass},renderControl:{type:Function,default:void 0}},emits:["select","delete","search","reach-top","reach-bottom","scroll","item-resize","range-update","load"],setup(e,{expose:a,emit:n}){const d=e,f=n,m=u([]),p=u(!1),v=u(!1);u(!1),u(0),u(0);const y=b(()=>"dark"===d.themeMode||"light"!==d.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),h=b(()=>y.value?"dark-mode":"light-mode"),M=()=>{f("reach-top"),N.value||(p.value=!0,N.value=!0,te())},$=()=>{f("reach-bottom"),U.value&&!P.value&&(v.value=!0,V())},D=e=>{f("scroll",e)},H=e=>{f("item-resize",e)},j=e=>{f("range-update",e)},V=async()=>{U.value&&!P.value&&await ee(A.value+1,!0)},{dataList:_,currentPage:A,totalElements:G,totalPages:K,loading:N,loadingMore:P,hasMore:U,isEmpty:q,loadData:Q}=t({api:d.api,service:d.service,params:d.params,pageableParams:d.pageableParams,pageSize:d.pageSize,autoLoad:!1}),Z=b(()=>"number"==typeof d.topSpacing?`${d.topSpacing}px`:d.topSpacing),J=b(()=>"number"==typeof d.leftSpacing?`${d.leftSpacing}px`:d.leftSpacing),X=b(()=>"number"==typeof d.rightSpacing?`${d.rightSpacing}px`:d.rightSpacing);b(()=>({paddingTop:Z.value,paddingLeft:J.value,paddingRight:X.value}));const Y=(e,t)=>e[d.itemKey]||t,ee=async(e=0,t=!1)=>{try{await Q(e,t),N.value=!1,(_.value.length>0||0===e)&&f("load",{content:_.value,number:A.value,totalElements:G.value,totalPages:K.value,last:!U.value})}catch(i){N.value=!1}},te=async()=>{try{N.value=!0,await ee(0)}catch(e){N.value=!1}},ie=e=>{f("search",e),ee(0)},le=e=>{if(d.selectable){const t=m.value.findIndex(t=>Y(t,-1)===Y(e,-1));t>-1?m.value.splice(t,1):m.value.push(e)}f("select",e)},oe=e=>{f("delete",e)};S(()=>d.params,()=>{ee(0)},{deep:!0}),S(()=>d.pageSize,()=>{ee(0)});const ae=()=>{if("undefined"!=typeof window){const e=document.querySelector(".sdkwork-api-list");if(e){d.searchable;e.clientHeight}}};return c(()=>{ee(0),g(()=>{ae()}),"undefined"!=typeof window&&window.addEventListener("resize",ae)}),z(()=>{"undefined"!=typeof window&&window.removeEventListener("resize",ae)}),a({refresh:()=>ee(0),loadMore:()=>ee(A.value+1,!0),getData:()=>_.value,getSelectedItems:()=>m.value,clearSelected:()=>{m.value=[]},setSelectedItems:e=>{m.value=e}}),(t,a)=>(s(),r("div",{class:k(["sdkwork-api-list",h.value])},[B(q)&&!B(N)?(s(),w(i,x(T({key:0},{empty:!0})),{empty:E(()=>[C(t.$slots,"empty",x(O({empty:!0})),void 0,!0)]),_:3},16)):(s(),w(B(W),{key:1,list:B(_),itemKey:e.itemKey,minSize:e.minSize,itemGap:e.itemGap,fixed:e.fixed,buffer:e.buffer,bufferTop:e.bufferTop,bufferBottom:e.bufferBottom,horizontal:e.horizontal,scrollDistance:e.scrollDistance,fixSelection:e.fixSelection,start:e.start,offset:e.offset,listStyle:e.listStyle,listClass:e.listClass,itemStyle:e.itemStyle,itemClass:e.itemClass,renderControl:e.renderControl,onToTop:M,onToBottom:$,onScroll:D,onItemResize:H,onRangeUpdate:j},{header:E(()=>[C(t.$slots,"header",{},()=>[B(N)&&p.value?(s(),w(L,{key:0,text:"刷新中..."})):F("",!0),e.searchable?(s(),w(l,{key:1,searchable:e.searchable,onSearch:ie},null,8,["searchable"])):F("",!0)],!0)]),footer:E(()=>[C(t.$slots,"footer",{},void 0,!0),v.value?(s(),w(I,{key:0,loading:B(P),text:"加载更多..."},null,8,["loading"])):F("",!0)]),"sticky-header":E(()=>[C(t.$slots,"sticky-header",{},void 0,!0)]),"sticky-footer":E(()=>[C(t.$slots,"sticky-footer",{},void 0,!0)]),default:E(({itemData:i,index:l})=>{return[R(o,{item:i,index:l,selectable:e.selectable,deletable:e.deletable,"is-selected":(a=i,m.value.some(e=>Y(e,-1)===Y(a,-1))),"item-key":Y(i,l),"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,"theme-mode":e.themeMode,"show-border-bottom":e.showBorderBottom,"border-bottom-left-offset":e.borderBottomLeftOffset,onSelect:le,onDelete:oe},{default:E(({item:e,index:i,selected:l})=>[C(t.$slots,"default",{item:e,index:i,selected:l},void 0,!0)]),_:3},8,["item","index","selectable","deletable","is-selected","item-key","item-title-field","item-description-field","theme-mode","show-border-bottom","border-bottom-left-offset"])];var a}),_:3},8,["list","itemKey","minSize","itemGap","fixed","buffer","bufferTop","bufferBottom","horizontal","scrollDistance","fixSelection","start","offset","listStyle","listClass","itemStyle","itemClass","renderControl"]))],2))}}),[["__scopeId","data-v-f32226b8"]]);export{Z as S};
