import{D as e,u as t,S as i}from"./shared-Bto_oBGe.js";import{L as l}from"./ListItem-B4uOKkVc.js";import{k as o,P as a,Q as r,S as s,$ as n,M as d,r as f,b as u,l as c,ah as m,ai as p,d as v,C as y,w as h,f as S,n as b,o as g,R as z,j as k,u as w,a0 as B,U as x,Z as T,W as E}from"./vue-vendor-CnVaDBlt.js";import{_ as C}from"./index-Cw3XK0oB.js";const O={class:"loading-indicator"},R={class:"loading-content"},F={class:"loading-text"},M=C(o({__name:"LoadingIndicator",props:{text:{default:"刷新中..."}},setup:e=>(t,i)=>(r(),a("div",O,[s("div",R,[i[0]||(i[0]=s("div",{class:"loading-icon"},"↻",-1)),s("div",F,n(e.text),1)])]))}),[["__scopeId","data-v-41c5aa1b"]]),$={class:"load-more-indicator"},D={class:"load-more-content"},H={key:0,class:"loading-icon"},L={key:1,class:"load-more-text"},j=C(o({__name:"LoadMoreIndicator",props:{loading:{type:Boolean,default:!1},text:{default:"加载更多..."}},setup:e=>(t,i)=>(r(),a("div",$,[s("div",D,[e.loading?(r(),a("div",H,"↻")):(r(),a("div",L,n(e.text),1))])]))}),[["__scopeId","data-v-1dbd3045"]]);const V=function(e,t,i){const{attrs:l,on:o,...a}=t;let r={};return o&&Object.entries(o).forEach(e=>{const[t,i]=e;r[`on${t[0].toUpperCase()+t.slice(1)}`]=i}),d(e,{...l,...r,...a},i)};const A=function(e,t,i){const{attrs:l,on:o,...a}=t;let r={};return o&&Object.entries(o).forEach(e=>{const[t,i]=e;r[`on${t[0].toUpperCase()+t.slice(1)}`]=i}),d(e,{...l,...r,...a},{default:()=>i})};const I=function(e,t){var i;return null==(i=e.$slots)?void 0:i[t]};function _(...e){let t="";return e.forEach(e=>{"string"==typeof e?t+=e+";":Array.isArray(e)?t+=_(...e):"object"==typeof e&&Object.entries(e).forEach(([e,i])=>{i&&(t+=`${e}:${i};`)})}),t}const K=o({name:"ObserverItem",props:{resizeObserver:{type:ResizeObserver,require:!0},id:{type:[String,Number],require:!0}},setup:e=>(e=>{const t=f(null);return u(()=>{e.resizeObserver&&t.value&&e.resizeObserver.observe(t.value)}),c(()=>{e.resizeObserver&&t.value&&e.resizeObserver.unobserve(t.value)}),{itemRefEl:t}})(e),render(){var e;const{id:t}=this;return V("div",{ref:"itemRefEl",attrs:{"data-id":t}},[null==(e=I(this,"default"))?void 0:e()])}}),G={itemGap:0,fixed:!1,buffer:0,bufferTop:0,bufferBottom:0,scrollDistance:0,horizontal:!1,fixSelection:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""};function N(e,t){const i=new Proxy(e,{get(e,t){var i;return null!=(i=Reflect.get(e,t))?i:Reflect.get(G,t)}}),l=f(null),o=f(null),a=f(null),r=f(null),s=f(null),n=f(null),d=new Map,S=f(0);let b="backward",g=!1,z=!1,k=!1,w=null;const B=m({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),x=m({views:0,offset:0,listTotalSize:0,virtualSize:0,inViewBegin:0,inViewEnd:0,renderBegin:0,renderEnd:0,bufferTop:0,bufferBottom:0});function T(){const e=i.horizontal?"scrollLeft":"scrollTop";return l.value?l.value[e]:0}function E(){return x.listTotalSize+B.headerSize+B.footerSize+B.stickyHeaderSize+B.stickyFooterSize}function C(e){var t;return i.fixed?i.minSize+i.itemGap:null!=(t=d.get(String(e)))?t:i.minSize+i.itemGap}function O(e,t){d.set(String(e),t)}function R(e){var t,l;if(i.fixed)return{top:(i.minSize+i.itemGap)*e,current:i.minSize+i.itemGap,bottom:(i.minSize+i.itemGap)*(e+1)};const{itemKey:o}=i;let a=B.headerSize;for(let s=0;s<=e-1;s+=1){a+=C(null==(t=i.list[s])?void 0:t[o])}const r=C(null==(l=i.list[e])?void 0:l[o]);return{top:a,current:r,bottom:a+r}}function F(e){k=!0;const t=i.horizontal?"scrollLeft":"scrollTop";l.value&&(l.value[t]=e)}async function M(e){if(e<0)return;if(e>=i.list.length-1)return void $();let{top:t}=R(e);F(t);const l=()=>{const{top:i}=R(e);if(F(i),t!==i)return t=i,void(w=l);w=null};w=l}async function $(){let e=0;!function t(){e+=1,F(E()),setTimeout(()=>{e>10||Math.abs(Math.round(x.offset+B.clientSize)-Math.round(E()))>2&&t()},3)}()}function D(e){var l;e<x.inViewBegin&&(g=!0),x.inViewBegin=e,x.inViewEnd=Math.min(e+x.views,i.list.length-1),null==(l=null==t?void 0:t.rangeUpdate)||l.call(t,x.inViewBegin,x.inViewEnd)}function H(){var e,t;const{views:l,offset:o,inViewBegin:a}=x,{itemKey:r}=i,s=o-B.headerSize;let n=a,d=x.virtualSize+N(x.renderBegin,x.inViewBegin);if(s<0)D(0);else{if("forward"===b){if(s>=d)return;for(let t=n-1;t>=0;t-=1){const l=C(null==(e=i.list[t])?void 0:e[r]);if(d-=l,d<=s&&s<d+l){n=t;break}}}if("backward"===b){if(s<=d)return;for(let e=n;e<=i.list.length-1;e+=1){const l=C(null==(t=i.list[e])?void 0:t[r]);if(d<=s&&s<d+l){n=e;break}d+=l}g=!1}n!==x.inViewBegin&&D(n)}}function L(e){var l;null==(l=null==t?void 0:t.scroll)||l.call(t,e);const o=T();o!==x.offset&&(b=o<x.offset?"forward":"backward",x.offset=o,H(),function(){var e,l;const o=Math.max(i.scrollDistance,2);if("forward"===b)x.offset-o<=0&&(null==(e=null==t?void 0:t.toTop)||e.call(t,i.list[0]));else if("backward"===b){const e=Math.round(x.offset+B.clientSize);Math.round(E()-e)<=o&&(null==(l=null==t?void 0:t.toBottom)||l.call(t,i.list[i.list.length-1]))}}())}function j(){!function(){const e=Math.ceil(B.clientSize/(i.minSize+i.itemGap))+1;x.views=e}(),D(x.inViewBegin)}function V(){var e;if(i.fixed)return void(x.listTotalSize=(i.minSize+i.itemGap)*i.list.length);const{itemKey:t}=i;let l=0;for(let o=0;o<=i.list.length-1;o+=1)l+=C(null==(e=i.list[o])?void 0:e[t]);x.listTotalSize=l}function A(){x.offset=0,x.listTotalSize=0,x.virtualSize=0,x.inViewBegin=0,x.inViewEnd=0,x.renderBegin=0,x.renderEnd=0,d.clear(),I()}function I(){S.value+=1}let _;"undefined"!=typeof ResizeObserver&&(_=new ResizeObserver(e=>{var l;let o=0;for(const a of e){const e=a.target.dataset.id;if(e){const r=C(e);let s=0;if(a.borderBoxSize){const e=Array.isArray(a.borderBoxSize)?a.borderBoxSize[0]:a.borderBoxSize;s=i.horizontal?e.inlineSize:e.blockSize}else s=i.horizontal?a.contentRect.width:a.contentRect.height;"client"===e?(B.clientSize=s,j()):"header"===e?B.headerSize=s:"footer"===e?B.footerSize=s:"stickyHeader"===e?B.stickyHeaderSize=s:"stickyFooter"===e?B.stickyFooterSize=s:r!==s&&(O(e,s),o+=s-r,null==(l=null==t?void 0:t.itemResize)||l.call(t,e,s))}}x.listTotalSize+=o,w&&w(),!g&&!z||0===o||k||(g=!1,z=!1,F(x.offset+o)),k=!1}));const K=()=>{var e;let t=0;const l=x.renderBegin;for(let o=0;o<l;o++)t+=C(null==(e=i.list[o])?void 0:e[i.itemKey]);x.virtualSize=t};function N(e,t){var l;const o=Math.min(e,t),a=Math.max(e,t);let r=0;for(let s=o;s<a;s+=1)r+=C(null==(l=i.list[s])?void 0:l[i.itemKey]);return r}p(()=>{i.bufferTop?x.bufferTop=i.bufferTop:x.bufferTop=i.buffer,i.bufferBottom?x.bufferBottom=i.bufferBottom:x.bufferBottom=i.buffer}),u(()=>{l.value&&(l.value.addEventListener("scroll",L),null==_||_.observe(l.value)),s.value&&(null==_||_.observe(s.value)),n.value&&(null==_||_.observe(n.value)),a.value&&(null==_||_.observe(a.value)),r.value&&(null==_||_.observe(r.value)),i.start?M(i.start):i.offset&&F(i.offset)}),c(()=>{l.value&&(l.value.removeEventListener("scroll",L),null==_||_.unobserve(l.value),B.clientSize=0),s.value&&(null==_||_.unobserve(s.value),B.stickyHeaderSize=0),n.value&&(null==_||_.unobserve(n.value),B.stickyFooterSize=0),a.value&&(null==_||_.unobserve(a.value),B.headerSize=0),r.value&&(null==_||_.unobserve(r.value),B.footerSize=0)}),v(()=>{F(x.offset)});const P=y([]);return h(()=>[x.inViewBegin,x.inViewEnd,S.value],(e,t)=>{if(e&&t){const[t]=e,l=x.renderBegin;let o=t,a=x.inViewEnd;if(o=Math.max(0,o-x.bufferTop),a=Math.min(a+x.bufferBottom,i.list.length-1>0?i.list.length-1:0),null==i?void 0:i.renderControl){const{begin:e,end:l}=i.renderControl(t,x.inViewEnd);o=e,a=l}x.renderBegin=o,x.renderEnd=a,o>l?x.virtualSize+=N(o,l):x.virtualSize-=N(o,l),P.value=i.list.slice(x.renderBegin,x.renderEnd+1)}},{immediate:!0}),h(()=>i.list.length,()=>{i.list.length<=0?A():(V(),D(x.inViewBegin),K(),I())},{immediate:!0}),{props:i,renderList:P,clientRefEl:l,listRefEl:o,headerRefEl:a,footerRefEl:r,stickyHeaderRefEl:s,stickyFooterRefEl:n,reactiveData:x,slotSize:B,sizesMap:d,resizeObserver:_,getReactiveData:function(){return x},getOffset:T,getSlotSize:function(){return B.headerSize+B.footerSize+B.stickyHeaderSize+B.stickyFooterSize},reset:A,scrollToIndex:M,manualRender:function(e,t){const l=x.renderBegin;x.renderBegin=e,x.renderEnd=t,e>l?x.virtualSize+=N(e,l):x.virtualSize-=N(e,l),P.value=i.list.slice(x.renderBegin,x.renderEnd+1),K()},scrollIntoView:async function(e){var t;const{top:l,bottom:o}=R(e),a=T(),r=T()+B.clientSize,s=C(null==(t=i.list[e])?void 0:t[i.itemKey]);l<a&&a<o&&s<B.clientSize?F(l):l+B.stickyHeaderSize<r&&r<o+B.stickyHeaderSize&&s<B.clientSize?F(o-B.clientSize+B.stickyHeaderSize):(l+B.stickyHeaderSize>=r||o<=a)&&M(e)},scrollToTop:async function(){let e=0;!function t(){e+=1,F(0),setTimeout(()=>{var o;if(e>10)return;const a=i.horizontal?"scrollLeft":"scrollTop";0!==(null==(o=null==l?void 0:l.value)?void 0:o[a])&&t()},3)}()},scrollToBottom:$,scrollToOffset:F,getItemSize:C,deleteItemSize:function(e){d.delete(String(e))},deletedList2Top:function(e){V();let t=0;e.forEach(e=>{t+=C(e[i.itemKey])}),K(),F(x.offset-t),H()},addedList2Top:function(e){V();let t=0;e.forEach(e=>{t+=C(e[i.itemKey])}),K(),F(x.offset+t),z=!0,k=!1,H()},getItemPosByIndex:R,forceUpdate:I}}const P=o({name:"VirtList",emits:{scroll:e=>e,toTop:e=>e,toBottom:e=>e,itemResize:(e,t)=>!0,rangeUpdate:(e,t)=>!0},props:{list:{type:Array,default:()=>[]},itemKey:{type:[String,Number],required:!0},minSize:{type:Number,default:20,required:!0},itemGap:{type:Number,default:0},renderControl:{type:Function,default:void 0},fixed:{type:Boolean,default:!1},buffer:{type:Number,default:0},bufferTop:{type:Number,default:0},bufferBottom:{type:Number,default:0},scrollDistance:{type:Number,default:0},horizontal:{type:Boolean,default:!1},start:{type:Number,default:0},offset:{type:Number,default:0},listStyle:{type:[String,Array,Object],default:""},listClass:{type:[String,Array,Object],default:""},itemStyle:{type:[String,Array,Object,Function],default:""},itemClass:{type:[String,Array,Object,Function],default:""},headerClass:{type:[String,Array,Object],default:""},headerStyle:{type:[String,Array,Object],default:""},footerClass:{type:[String,Array,Object],default:""},footerStyle:{type:[String,Array,Object],default:""},stickyHeaderClass:{type:[String,Array,Object],default:""},stickyHeaderStyle:{type:[String,Array,Object],default:""},stickyFooterClass:{type:[String,Array,Object],default:""},stickyFooterStyle:{type:[String,Array,Object],default:""}},setup:(e,t)=>N(e,{scroll:e=>{t.emit("scroll",e)},toTop:e=>{t.emit("toTop",e)},toBottom:e=>{t.emit("toBottom",e)},itemResize:(e,i)=>{t.emit("itemResize",e,i)},rangeUpdate:(e,i)=>{t.emit("rangeUpdate",e,i)}}),render(){const{renderList:e,reactiveData:t,resizeObserver:i}=this,{itemGap:l,itemKey:o,horizontal:a,listStyle:r,listClass:s,itemStyle:n,itemClass:d,headerClass:f,headerStyle:u,footerClass:c,footerStyle:m,stickyHeaderClass:p,stickyHeaderStyle:v,stickyFooterClass:y,stickyFooterStyle:h}=this.props,{listTotalSize:S,virtualSize:b,renderBegin:g}=t;return V("div",{ref:"clientRefEl",class:"virt-list__client",style:"width: 100%; height: 100%; overflow: auto;",attrs:{"data-id":"client"}},[(()=>{var e;return I(this,"stickyHeader")?V("div",{key:"slot-sticky-header",class:p,style:_("position: sticky; z-index: 10;",a?"left: 0":"top: 0;",v),ref:"stickyHeaderRefEl",attrs:{"data-id":"stickyHeader"}},[null==(e=I(this,"stickyHeader"))?void 0:e()]):null})(),(()=>{var e;return I(this,"header")?V("div",{key:"slot-header",class:f,style:u,ref:"headerRefEl",attrs:{"data-id":"header"}},[null==(e=I(this,"header"))?void 0:e()]):null})(),(()=>{var t,f;const u=[];for(let a=0;a<e.length;a+=1){const r=e[a];u.push(A(K,{key:r[o],class:"function"==typeof d?d(r,a):d,style:_(l>0?`padding: ${l/2}px 0;`:"","function"==typeof n?n(r,a):n),attrs:{id:r[o],resizeObserver:i}},null==(t=I(this,"default"))?void 0:t({itemData:r,index:g+a})))}if(0===u.length&&I(this,"empty")){const e=this.slotSize.clientSize-this.getSlotSize();u.push(V("div",{key:`slot-empty-${e}`,style:`height: ${e}px`},[null==(f=I(this,"empty"))?void 0:f()]))}return V("div",{ref:"listRefEl",class:s,style:a?`will-change: width; min-width: ${S}px; display: flex; ${r}`:`will-change: height; min-height: ${S}px; ${r}`},[V("div",{style:a?`width: ${b}px; will-change: width;`:`height: ${b}px; will-change: height;`}),u])})(),(()=>{var e;return I(this,"footer")?V("div",{key:"slot-footer",class:c,style:m,ref:"footerRefEl",attrs:{"data-id":"footer"}},[null==(e=I(this,"footer"))?void 0:e()]):null})(),(()=>{var e;return I(this,"stickyFooter")?V("div",{key:"slot-sticky-footer",class:y,style:_("position: sticky; z-index: 10;",a?"right: 0":"bottom: 0;",h),ref:"stickyFooterRefEl",attrs:{"data-id":"stickyFooter"}},[null==(e=I(this,"stickyFooter"))?void 0:e()]):null})()])}}),U=C(o({__name:"sdkwork-api-list",props:{api:{type:Function,default:void 0},service:{default:void 0},params:{default:()=>({})},pageableParams:{default:()=>({})},selectable:{type:Boolean,default:e.selectable},deletable:{type:Boolean,default:e.deletable},searchable:{type:Boolean,default:e.searchable},pageSize:{default:e.pageSize},itemKey:{default:e.itemKey},itemTitleField:{default:e.itemTitleField},itemDescriptionField:{default:e.itemDescriptionField},topSpacing:{default:e.topSpacing},leftSpacing:{default:e.leftSpacing},rightSpacing:{default:e.rightSpacing},showBorderBottom:{type:Boolean,default:e.showBorderBottom},borderBottomLeftOffset:{default:e.borderBottomLeftOffset},showNoMoreData:{type:Boolean,default:e.showNoMoreData},themeMode:{default:e.themeMode},minSize:{default:e.minSize},itemGap:{default:e.itemGap},fixed:{type:Boolean,default:e.fixed},buffer:{default:e.buffer},bufferTop:{default:void 0},bufferBottom:{default:void 0},horizontal:{type:Boolean,default:e.horizontal},scrollDistance:{default:e.scrollDistance},fixSelection:{type:Boolean,default:e.fixSelection},start:{default:e.start},offset:{default:e.offset},listStyle:{default:e.listStyle},listClass:{default:e.listClass},itemStyle:{default:e.itemStyle},itemClass:{default:e.itemClass},renderControl:{type:Function,default:void 0}},emits:["select","delete","search","reach-top","reach-bottom","scroll","item-resize","range-update","load"],setup(e,{expose:o,emit:s}){const n=e,d=s,c=f([]),m=f(!1),p=f(!1);f(!1),f(0),f(0);const v=S(()=>"dark"===n.themeMode||"light"!==n.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),y=S(()=>v.value?"dark-mode":"light-mode"),C=()=>{d("reach-top"),I.value||(m.value=!0,I.value=!0,Z())},O=()=>{d("reach-bottom"),K.value&&!_.value&&(p.value=!0,D())},R=e=>{d("scroll",e)},F=e=>{d("item-resize",e)},$=e=>{d("range-update",e)},D=async()=>{K.value&&!_.value&&await W(L.value+1,!0)},{dataList:H,currentPage:L,totalElements:V,totalPages:A,loading:I,loadingMore:_,hasMore:K,loadData:G}=t({api:n.api,service:n.service,params:n.params,pageableParams:n.pageableParams,pageSize:n.pageSize,autoLoad:!1}),N=S(()=>"number"==typeof n.topSpacing?`${n.topSpacing}px`:n.topSpacing),U=S(()=>"number"==typeof n.leftSpacing?`${n.leftSpacing}px`:n.leftSpacing),q=S(()=>"number"==typeof n.rightSpacing?`${n.rightSpacing}px`:n.rightSpacing);S(()=>({paddingTop:N.value,paddingLeft:U.value,paddingRight:q.value}));const Q=(e,t)=>e[n.itemKey]||t,W=async(e=0,t=!1)=>{try{await G(e,t),I.value=!1,(H.value.length>0||0===e)&&d("load",{content:H.value,number:L.value,totalElements:V.value,totalPages:A.value,last:!K.value})}catch(i){I.value=!1}},Z=async()=>{try{I.value=!0,await W(0)}catch(e){I.value=!1}},J=e=>{d("search",e),W(0)},X=e=>{if(n.selectable){const t=c.value.findIndex(t=>Q(t,-1)===Q(e,-1));t>-1?c.value.splice(t,1):c.value.push(e)}d("select",e)},Y=e=>{d("delete",e)};h(()=>n.params,()=>{W(0)},{deep:!0}),h(()=>n.pageSize,()=>{W(0)});const ee=()=>{if("undefined"!=typeof window){const e=document.querySelector(".sdkwork-api-list");if(e){n.searchable;e.clientHeight}}};return u(()=>{W(0),b(()=>{ee()}),"undefined"!=typeof window&&window.addEventListener("resize",ee)}),g(()=>{"undefined"!=typeof window&&window.removeEventListener("resize",ee)}),o({refresh:()=>W(0),loadMore:()=>W(L.value+1,!0),getData:()=>H.value,getSelectedItems:()=>c.value,clearSelected:()=>{c.value=[]},setSelectedItems:e=>{c.value=e}}),(t,o)=>(r(),a("div",{class:z(["sdkwork-api-list",y.value])},[k(w(P),{list:w(H),itemKey:e.itemKey,minSize:e.minSize,itemGap:e.itemGap,fixed:e.fixed,buffer:e.buffer,bufferTop:e.bufferTop,bufferBottom:e.bufferBottom,horizontal:e.horizontal,scrollDistance:e.scrollDistance,fixSelection:e.fixSelection,start:e.start,offset:e.offset,listStyle:e.listStyle,listClass:e.listClass,itemStyle:e.itemStyle,itemClass:e.itemClass,renderControl:e.renderControl,onToTop:C,onToBottom:O,onScroll:R,onItemResize:F,onRangeUpdate:$},{header:B(()=>[x(t.$slots,"header",{},()=>[w(I)&&m.value?(r(),T(M,{key:0,text:"刷新中..."})):E("",!0),e.searchable?(r(),T(i,{key:1,searchable:e.searchable,onSearch:J},null,8,["searchable"])):E("",!0)],!0)]),footer:B(()=>[x(t.$slots,"footer",{},void 0,!0),p.value?(r(),T(j,{key:0,loading:w(_),text:"加载更多..."},null,8,["loading"])):E("",!0)]),"sticky-header":B(()=>[x(t.$slots,"sticky-header",{},void 0,!0)]),"sticky-footer":B(()=>[x(t.$slots,"sticky-footer",{},void 0,!0)]),default:B(({itemData:i,index:o})=>{return[k(l,{item:i,index:o,selectable:e.selectable,deletable:e.deletable,"is-selected":(a=i,c.value.some(e=>Q(e,-1)===Q(a,-1))),"item-key":Q(i,o),"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,"theme-mode":e.themeMode,"show-border-bottom":e.showBorderBottom,"border-bottom-left-offset":e.borderBottomLeftOffset,onSelect:X,onDelete:Y},{default:B(({item:e,index:i,selected:l})=>[x(t.$slots,"default",{item:e,index:i,selected:l},void 0,!0)]),_:3},8,["item","index","selectable","deletable","is-selected","item-key","item-title-field","item-description-field","theme-mode","show-border-bottom","border-bottom-left-offset"])];var a}),_:3},8,["list","itemKey","minSize","itemGap","fixed","buffer","bufferTop","bufferBottom","horizontal","scrollDistance","fixSelection","start","offset","listStyle","listClass","itemStyle","itemClass","renderControl"])],2))}}),[["__scopeId","data-v-baaa9f26"]]);export{U as S};
