import{ConnectionStateEnum as t}from"sdkwork-ai-iot-sdk";import{M as e,o,j as n}from"./index-mGUiS-yG.js";import{M as s}from"./chat-BDy_niQo.js";import"./vue-vendor-B1RsE4Tz.js";import"./utils-vendor-WEzSe-CR.js";import"./conversation-B-eIgQr2.js";import"./sdkwork_stream_player-jdQRpzp4.js";class a{agentChatManager;constructor(){this.agentChatManager=e.create(o.AgentChatManager)}async stop(t,e){const o=await this.agentChatManager.stop(t,e);return null==o||null==o.data?Promise.reject(new Error("data error!")):o.data}async create(t,e,o){const n=await this.agentChatManager.create(t,e,o);if(t.stream)return n;return n.data}async resumeStream(t,e,o){const n=await this.agentChatManager.resumeStream(t,e,o);if(t.stream)return n;return n.data}}class r{name="SseMessageHandler";connectionState;eventEmitter;eventAdapter;config;constructor(e,o,n){this.config=e,this.eventEmitter=o,this.eventAdapter=n,this.connectionState={state:t.DISCONNECTED,connected:!1}}async initialize(){try{await this.setupSseConnection(),this.setupEventListeners(),this.updateConnectionState({state:t.CONNECTED,connected:!0})}catch(e){throw this.eventEmitter.emit(this.eventAdapter.adaptErrorOccurred(e)),e}}disconnect(){this.updateConnectionState({state:t.DISCONNECTED,connected:!1})}startListening(){console.log("SSE开始监听")}stopListening(){console.log("SSE停止监听")}async send(t,e){console.log("SSE发送消息:",t);const o=new a;let r;r="string"==typeof t?{messages:[{role:n.ChatCompletionRole.user,content:t}],stream:!0}:s.toCompletionParam(t);const i=await o.create(r,{conversationId:e.conversation_id,id:e.agent_id});for await(const n of i)this.eventEmitter.emit(this.eventAdapter.adaptMessageChunkReceived({chunk:n,channelMsgId:n.id,id:n.id}))}sendAudioStream(t,e,o){console.log("SSE发送音频流")}sendHello(t,e){console.log("SSE发送Hello消息:",t)}sendEvent(t,e){console.log("SSE发送事件:",t,e)}sendProtocol(t){console.log("SSE发送协议:",t)}getConnectionState(){return this.connectionState}isConnected(){return this.connectionState.connected}onEvent(t,e){console.log("SSE注册事件监听器:",t)}onMessage(t){console.log("SSE注册消息监听器")}onAudioStream(t){console.log("SSE注册音频流监听器")}onData(t){console.log("SSE注册数据监听器")}onToolCall(t){console.log("SSE注册工具调用监听器")}offData(t){console.log("SSE移除数据监听器")}offEvent(t,e){console.log("SSE移除事件监听器:",t)}onError(t){console.log("SSE注册错误监听器")}offError(t){console.log("SSE移除错误监听器")}async destroy(){this.disconnect(),console.log("SSE处理器已销毁")}async reconnect(){console.log("SSE重新连接..."),this.disconnect(),await this.initialize()}enter(t){console.log("SSE进入聊天:",t.chatContext)}exit(t){console.log("SSE退出聊天:",t.chatContext)}abort(t){console.log("SSE中断聊天")}async setupSseConnection(){console.log("设置SSE连接")}setupEventListeners(){console.log("设置SSE事件监听器")}updateConnectionState(t){this.connectionState=t,this.eventEmitter.emit(this.eventAdapter.adaptConnectionChange(t))}}export{r as SseMessageHandler};
