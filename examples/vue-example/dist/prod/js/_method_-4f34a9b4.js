import{S as a}from"./sdkwork-page-container-ebfa2fb2.js";import{k as s,r as o,c as t,b as e,Q as l,R as i,S as r,F as n,Y as c,V as u,X as h,$ as d,U as p,O as m,a3 as v,w as g,Z as f,a0 as k,_ as w}from"./vue-vendor-905d75e5.js";import{S as y}from"./sdkwork-auth-login-245ac531.js";import{h as A,_}from"./index-34815b62.js";import"./index-d9bf0347.js";import"./index-a966f53b.js";import"./use-id-350fcd7b.js";import"./index-bb873dec.js";import"./Checker-98b4e961.js";import"./index-64c6c799.js";import"./utils-vendor-b5712723.js";const b={class:"sdkwork-auth-oauth-login"},j={class:"oauth-platforms"},O=["onClick"],x={class:"platform-icon"},C={class:"platform-name"},S={key:0,class:"platform-loading"},L={class:"oauth-options"},R={key:0,class:"oauth-error"},E={key:1,class:"oauth-config-hint"},F=_(s({__name:"sdkwork-auth-oauth-login",props:{showAccountLogin:{type:Boolean,default:!0},showRegister:{type:Boolean,default:!0},redirectUri:{},compact:{type:Boolean,default:!1}},emits:["oauth-started","oauth-success","oauth-error","switch-to-account","switch-to-register"],setup(a,{expose:s,emit:m}){const v=a,g=m,f=A(),k=o(null),w=o(""),y=t(()=>f.getOAuthPlatforms());return s({handleOAuthCallback:async(a,s)=>{try{k.value=s,w.value="",await f.handleOAuthCallback(a,s),g("oauth-success",s)}catch(o){const a=o instanceof Error?o.message:"OAuth2回调处理失败";w.value=a,g("oauth-error",a),console.error("OAuth2回调处理失败:",o)}finally{k.value=null}},clearError:()=>{w.value=""}}),e(()=>{console.log("OAuth2登录组件已加载，可用平台:",y.value.map(a=>a.displayName))}),(s,o)=>(l(),i("div",b,[o[7]||(o[7]=r("div",{class:"oauth-header"},[r("h2",{class:"oauth-title"},"第三方登录"),r("p",{class:"oauth-subtitle"},"选择您喜欢的登录方式")],-1)),r("div",j,[(l(!0),i(n,null,c(y.value,a=>(l(),i("div",{key:a.provider,class:"oauth-platform-item",style:u({"--platform-color":a.color}),onClick:s=>(async a=>{try{k.value=a,w.value="",g("oauth-started",a),f.authorizeOAuth({provider:a,redirectUri:v.redirectUri}),g("oauth-success",a)}catch(s){const a=s instanceof Error?s.message:"OAuth2登录失败";w.value=a,g("oauth-error",a),console.error("OAuth2登录失败:",s)}finally{k.value=null}})(a.provider)},[r("div",x,[r("i",{class:h(a.icon)},null,2)]),r("span",C,d(a.displayName),1),k.value===a.provider?(l(),i("div",S,[...o[2]||(o[2]=[r("i",{class:"i-mdi-loading animate-spin"},null,-1)])])):p("",!0)],12,O))),128))]),o[8]||(o[8]=r("div",{class:"oauth-divider"},[r("span",{class:"divider-text"},"或")],-1)),r("div",L,[a.showAccountLogin?(l(),i("button",{key:0,class:"oauth-option-btn",onClick:o[0]||(o[0]=a=>s.$emit("switch-to-account"))},[...o[3]||(o[3]=[r("i",{class:"i-mdi-account"},null,-1),r("span",null,"账号密码登录",-1)])])):p("",!0),a.showRegister?(l(),i("button",{key:1,class:"oauth-option-btn",onClick:o[1]||(o[1]=a=>s.$emit("switch-to-register"))},[...o[4]||(o[4]=[r("i",{class:"i-mdi-account-plus"},null,-1),r("span",null,"注册新账号",-1)])])):p("",!0)]),w.value?(l(),i("div",R,[o[5]||(o[5]=r("i",{class:"i-mdi-alert-circle"},null,-1)),r("span",null,d(w.value),1)])):p("",!0),y.value.length?p("",!0):(l(),i("div",E,[...o[6]||(o[6]=[r("div",{class:"config-hint-content"},[r("i",{class:"i-mdi-cog"}),r("div",{class:"hint-text"},[r("p",null,"未配置OAuth2平台"),r("p",{class:"hint-detail"},"请在环境变量中配置相应的CLIENT_ID")])],-1)])]))]))}}),[["__scopeId","data-v-286cf236"]]),I=_(s({__name:"[method]",setup(s){const o={account:y,oauth:F},e=m(),i=v(),r=t(()=>{const a=i.params.method;return a&&a in o?a:"account"}),n=t(()=>o[r.value]),c=a=>{console.log("登录成功:",a),e.push("/")},u=a=>{console.error("登录失败:",a)},h=()=>{e.push("/auth/register")},d=()=>{e.push("/auth/forgot-password")},p=()=>{e.push("/login/account")};return g(()=>i.params.method,a=>{console.log("登录方法已切换:",a)}),(s,o)=>{const t=a;return l(),f(t,{"safe-area":"",scrollable:"","theme-mode":"auto"},{default:k(()=>[(l(),f(w(n.value),{onLoginSuccess:c,onLoginFailed:u,onRegisterClick:h,onForgotPassword:d,onSwitchToAccount:p,onSwitchToRegister:h},null,32))]),_:1})}}}),[["__scopeId","data-v-6b0a3a08"]]);export{I as default};
