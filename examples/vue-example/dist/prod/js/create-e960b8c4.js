import{S as e}from"./sdkwork-page-container-ebfa2fb2.js";import{k as a,c as o,r as t,w as l,Q as s,R as i,S as n,$ as r,j as d,a0 as c,a4 as u,a1 as m,U as p,Z as g,X as h,V as v,a as f,O as k}from"./vue-vendor-905d75e5.js";import{s as b,a as w,B as y,I as x,_ as C,u as V}from"./index-34815b62.js";/* empty css              */import{_ as j,a as _}from"./sdkwork-collapse-item-4f5db70a.js";import{_ as M}from"./sdkwork-popup-2839b588.js";/* empty css              *//* empty css              */import{P as z}from"./index-e4d82c91.js";import{S as I}from"./index-224bf927.js";import{_ as B,a as A}from"./sdkwork-cell-group-f9040361.js";/* empty css              *//* empty css              */import{S as U}from"./sdkwork-voice-speaker-category-list-popup-26672839.js";import{I as F}from"./index-89cf3eae.js";import{U as P}from"./index-0b87abd1.js";import{A as $}from"./agent-6e7e2348.js";import{F as H}from"./index-d9bf0347.js";import"./utils-vendor-b5712723.js";import"./index-a966f53b.js";import"./sdkwork-icon-79456167.js";import"./sdkwork-pull-refresh-bd126f9c.js";import"./index-8ec85bf4.js";import"./shared-f3996f0d.js";import"./sdkwork-search-bar-d9125bb7.js";import"./index-3ae7521b.js";import"./use-id-350fcd7b.js";import"./ListItem-b2f4f4bf.js";import"./LoadingSection-50beb699.js";import"./LoadMoreSection-8eb45153.js";import"./sdkwork-voice-clone-f3949dc2.js";import"./index-8c878aea.js";const S={class:"sdkwork-avatar"},T={key:0,class:"upload-overlay"},L={class:"progress-text"},R={class:"placeholder-text"},q={key:3,class:"avatar-actions"},G=C(a({__name:"sdkwork-avatar",props:{modelValue:{},src:{},size:{default:"40px"},uploadable:{type:Boolean,default:!0},showAiGenerate:{type:Boolean,default:!1},round:{type:Boolean,default:!0},text:{default:""},background:{default:"#f5f5f5"},disabled:{type:Boolean,default:!1},showClear:{type:Boolean,default:!1},uploadConfig:{}},emits:["update:modelValue","upload","upload-start","upload-progress","upload-complete","upload-error","aiGenerate","click","clear"],setup(e,{emit:a}){const f=e,k=a,C=o({get:()=>f.modelValue||f.src,set:e=>k("update:modelValue",e||"")}),V=t(!1),j=t(0),_=t(null),M=t(null),z=async e=>{let a=null;if(e instanceof File)a=e;else if(e&&e.file instanceof File)a=e.file;else if(e&&e.content&&e.content instanceof File)a=e.content;else if(Array.isArray(e)&&e.length>0){const o=e[0];o.file instanceof File?a=o.file:o.content instanceof File&&(a=o.content)}if(!a)return b("无效的文件格式"),!1;if(!a.type?.startsWith("image/"))return b("请上传图片文件"),!1;if(a.size>5242880)return b("图片大小不能超过5MB"),!1;const o=new FileReader;return o.onload=e=>{const a=e.target?.result;C.value=a},o.readAsDataURL(a),k("upload",a),await I(a),!0},I=async e=>{if(window.$uploader)try{V.value=!0,j.value=0,k("upload-start",e);const a=f.uploadConfig||{},o={file:e,bucket:a.bucket||{name:"public"},name:e.name,scene:"avatar",metadata:a.metadata||{},contentType:a.contentType||e.type,acl:a.acl||"public-read"},t=await window.$uploader.upload(o,e=>{j.value=e.percentage,k("upload-progress",e)});t.taskId&&(_.value=t.taskId),t.url&&t.url.startsWith("http")?(C.value=t.url,b("头像上传成功"),k("upload-complete",t)):(console.warn("上传返回的URL无效，保持本地预览:",t.url),b("头像上传完成，但URL无效"))}catch(a){console.error("头像上传失败:",a),b("头像上传失败，请重试"),k("upload-error",a)}finally{V.value=!1,j.value=0}else b("上传器未初始化")},B=()=>{V.value&&window.$uploader&&(_.value?window.$uploader.cancel(_.value):window.$uploader.cancelAll(),V.value=!1,j.value=0,_.value=null,b("上传已取消"),C.value="")},A=()=>{w({title:"AI生成头像",message:"确定要使用AI生成头像吗？",showCancelButton:!0,confirmButtonText:"生成",cancelButtonText:"取消"}).then(()=>{k("aiGenerate"),b("正在生成头像...")})},U=()=>{!f.disabled&&C.value&&w({title:"清空头像",message:"确定要清空当前头像吗？",showCancelButton:!0,confirmButtonText:"清空",cancelButtonText:"取消"}).then(()=>{C.value="",b("头像已清空"),k("clear")})},$=()=>{f.disabled||!f.uploadable||V.value||setTimeout(()=>{if(M.value)M.value.chooseFile();else{const e=document.querySelector('.upload-btn input[type="file"]');e&&e.click()}},10),k("click")},H=o(()=>({width:"number"==typeof f.size?`${f.size}px`:f.size,height:"number"==typeof f.size?`${f.size}px`:f.size,backgroundColor:f.background}));return l(()=>f.src,e=>{f.modelValue||(C.value=e)}),l(()=>f.modelValue,e=>{C.value=e}),(a,o)=>{const t=y,l=x,f=F,k=P;return s(),i("div",S,[n("div",{class:"avatar-container",onClick:$},[V.value?(s(),i("div",T,[o[3]||(o[3]=n("div",{class:"loading-spinner"},null,-1)),n("div",L,r(j.value)+"%",1),d(t,{type:"danger",onClick:m(B,["stop"]),class:"cancel-btn"},{default:c(()=>[...o[2]||(o[2]=[u(" 取消 ",-1)])]),_:1})])):p("",!0),C.value?(s(),g(f,{key:1,src:C.value,width:e.size,height:e.size,fit:"cover",class:h([{disabled:e.disabled,round:e.round,square:!e.round,uploading:V.value},"avatar-image"])},{extra:c(()=>[e.showClear&&!V.value?(s(),i("div",{key:0,class:"clear-btn",onClick:m(U,["stop"])},[d(l,{name:"cross",size:"12",color:"#fff"})])):p("",!0)]),_:1},8,["src","width","height","class"])):(s(),i("div",{key:2,class:h(["avatar-placeholder",{round:e.round,square:!e.round,uploading:V.value}]),style:v(H.value)},[n("span",R,r(e.text),1)],6)),!e.uploadable&&!e.showAiGenerate||V.value?p("",!0):(s(),i("div",q,[e.uploadable?(s(),g(k,{key:0,disabled:e.disabled,"after-read":z,"max-count":1,"preview-image":!1,"show-upload":!1,accept:"image/*",class:"upload-btn",ref_key:"uploaderRef",ref:M,onClick:o[1]||(o[1]=m(()=>{},["stop"]))},{default:c(()=>[d(t,{type:"primary",disabled:e.disabled,class:"action-btn",onClick:o[0]||(o[0]=m(()=>{},["stop"]))},{default:c(()=>[...o[4]||(o[4]=[u(" 上传 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):p("",!0),e.showAiGenerate?(s(),g(t,{key:1,type:"success",disabled:e.disabled,onClick:A,class:"action-btn ai-generate-btn"},{default:c(()=>[...o[5]||(o[5]=[u(" AI生成 ",-1)])]),_:1},8,["disabled"])):p("",!0)]))])])}}}),[["__scopeId","data-v-24222b83"]]),O={class:"header-section"},D={class:"avatar-container"},K={class:"name-field-wrapper"},N={class:"char-count-bottom"},Q={class:"prompt-field-wrapper"},W={class:"char-count-bottom"},E={class:"char-count"},J={class:"voice-selector"},X={key:0,class:"selected-voice"},Z={key:1,class:"placeholder"},Y={class:"description-field-wrapper"},ee={class:"char-count-bottom"},ae={class:"welcome-field-wrapper"},oe={class:"char-count-bottom"},te={class:"char-count"},le={class:"permission-value"},se={class:"bottom-action-bar"},ie=C(a({__name:"sdkwork-agent-create",props:{themeMode:{default:"auto"}},emits:["agent-created","agent-canceled"],setup(e,{expose:a,emit:l}){const m=e,v=o(()=>"dark"===m.themeMode||"light"!==m.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),k=o(()=>v.value?"sdkwork-agent-create--dark":"sdkwork-agent-create--light"),w=t(!1),C=t(!1),V=t(!1),F=t([]),P=t(""),S=t(""),T=t(["view"]),L=new $,R=o(()=>"100%"),q=[{text:"查看",value:"view"},{text:"交互",value:"interact"},{text:"分享",value:"share"}],ie=t(""),ne=f({name:"",description:"",isPublic:!1,permissions:[],prompt:{content:""},greeting:"",baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),re=o(()=>ne.name.trim()&&ne.name.length<=20&&ne.description.length<=200),de=()=>{ne.name.trim()?ne.name.length>20?P.value="名称不能超过20个字符":P.value="":P.value="名称不能为空"},ce=e=>{console.log("头像上传:",e),ne.faceImage={url:ie.value,type:1,size:e.size},b("头像上传成功")},ue=()=>{console.log("头像被点击")},me=e=>{const a={id:e.id?.toString(),displayName:e.name,description:e.description,provider:"default",product:"default",model:"default",voice:e.name};ne.speechConfig={speakerConfig:{speaker:a}},C.value=!1,b(`已选择: ${e.name}`)},pe=e=>{if(!e||0===e.length)return"";const a=q.find(a=>a.value===e[0]);return a?a.text:""},ge=e=>{let a;console.log("Picker返回的值:",e),a=Array.isArray(e)?e[0]:e&&"object"==typeof e?e:{text:e,value:e},ne.permissions=a.value||a,V.value=!1,b(`已选择: ${a.text||a}`)},he=async()=>{if(de(),!P.value&&ne.name.trim()){w.value=!0;try{ie.value&&!ne.faceImage&&(ne.faceImage={url:ie.value,type:1,size:0});const e={name:ne.name,description:ne.description,faceImage:ne.faceImage,faceVideo:ne.faceVideo,icon:ne.icon,tags:ne.tags,prompt:ne.prompt,greeting:ne.greeting,speechConfig:ne.speechConfig,isPublic:ne.isPublic,permissions:ne.permissions,baseConfig:ne.baseConfig,type:ne.type,status:ne.status,knowledgeConfig:ne.knowledgeConfig,memoryConfig:ne.memoryConfig,toolConfig:ne.toolConfig,chatOptions:ne.chatOptions};L.create(e),b("智能体创建成功"),console.log("智能体创建成功，提交的数据:",e)}catch(e){console.error("智能体创建失败:",e),b("创建失败，请重试")}finally{w.value=!1}}else b("请完善基本信息")};return a({resetForm:()=>{ie.value="",Object.assign(ne,{name:"",description:"",faceImage:void 0,faceVideo:void 0,icon:void 0,tags:void 0,prompt:{content:""},greeting:"",speechConfig:void 0,isPublic:!1,permissions:[],baseConfig:{welcome:"",questions:[],saveFiles:!1,enableMemory:!1,maxHistoryMessages:50,useKnowledgeBase:!1,properties:{}}}),F.value=[]},getFormData:()=>ne,setFormData:e=>{Object.assign(ne,e)}}),(a,o)=>{const t=H,l=B,m=x,v=A,f=I,b=z,$=M,L=j,ve=_,fe=y;return s(),i("div",{class:h(["agent-create",k.value])},[n("div",O,[n("div",D,[d(G,{modelValue:ie.value,"onUpdate:modelValue":o[0]||(o[0]=e=>ie.value=e),size:80,uploadable:!0,"show-ai-generate":!1,round:!0,text:"头像","theme-mode":e.themeMode,onUpload:ce,onClick:ue,class:"avatar-uploader"},null,8,["modelValue","theme-mode"])]),d(l,{class:"name-section","theme-mode":e.themeMode},{default:c(()=>[n("div",K,[d(t,{modelValue:ne.name,"onUpdate:modelValue":o[1]||(o[1]=e=>ne.name=e),placeholder:"请输入智能体名称",maxlength:20,"error-message":P.value,size:"large",onBlur:de,center:""},null,8,["modelValue","error-message"]),n("div",N,[n("span",{class:h(["char-count",{error:ne.name.length>20}])},r(ne.name.length)+"/20 ",3)])])]),_:1},8,["theme-mode"])]),d(l,{class:"basic-info-section","theme-mode":e.themeMode},{default:c(()=>[n("div",Q,[d(t,{modelValue:ne.prompt.content,"onUpdate:modelValue":o[2]||(o[2]=e=>ne.prompt.content=e),label:"提示词","label-align":"top",type:"textarea",placeholder:"请输入角色提示词",autosize:{minHeight:100,maxHeight:200},maxlength:1e3},null,8,["modelValue"]),n("div",W,[n("span",E,r(ne.prompt.content?.length||0)+"/1000 ",1)])])]),_:1},8,["theme-mode"]),d(l,{class:"voice-section","theme-mode":e.themeMode},{default:c(()=>[d(v,{title:"发音人",center:"","is-link":"",onClick:o[3]||(o[3]=e=>C.value=!0),"theme-mode":e.themeMode},{value:c(()=>[n("div",J,[d(m,{name:"music",class:"voice-icon"}),ne.speechConfig?.speakerConfig?.speaker?(s(),i("span",X,r(ne.speechConfig.speakerConfig.speaker.displayName),1)):(s(),i("span",Z,"请选择发音人"))])]),_:1},8,["theme-mode"]),n("div",Y,[d(t,{modelValue:ne.description,"onUpdate:modelValue":o[4]||(o[4]=e=>ne.description=e),label:"描述","label-align":"top",type:"textarea",placeholder:"请输入智能体描述",maxlength:200,autosize:{minHeight:80,maxHeight:120},"error-message":S.value},null,8,["modelValue","error-message"]),n("div",ee,[n("span",{class:h(["char-count",{error:ne.description.length>200}])},r(ne.description.length)+"/200 ",3)])])]),_:1},8,["theme-mode"]),d(ve,{modelValue:F.value,"onUpdate:modelValue":o[11]||(o[11]=e=>F.value=e),class:"other-settings-section","theme-mode":e.themeMode},{default:c(()=>[d(L,{title:"其他设置",name:"other","theme-mode":e.themeMode},{default:c(()=>[n("div",ae,[d(t,{modelValue:ne.baseConfig.welcome,"onUpdate:modelValue":o[5]||(o[5]=e=>ne.baseConfig.welcome=e),label:"默认开场白","label-align":"top",type:"textarea",placeholder:"请输入默认开场白",autosize:{minHeight:80,maxHeight:120},maxlength:500},null,8,["modelValue"]),n("div",oe,[n("span",te,r(ne.baseConfig?.welcome?.length||0)+"/500 ",1)])]),d(l,{"theme-mode":e.themeMode},{default:c(()=>[d(v,{title:"公开智能体",center:"","theme-mode":e.themeMode},{value:c(()=>[d(f,{modelValue:ne.isPublic,"onUpdate:modelValue":o[6]||(o[6]=e=>ne.isPublic=e),size:"20"},null,8,["modelValue"])]),_:1},8,["theme-mode"]),ne.isPublic?(s(),g(v,{key:0,title:"权限设置",center:"","is-link":"",onClick:o[7]||(o[7]=e=>V.value=!0),"theme-mode":e.themeMode},{value:c(()=>[n("span",le,r(pe(ne.permissions)||"请选择权限"),1)]),_:1},8,["theme-mode"])):p("",!0),d($,{show:V.value,"onUpdate:show":o[10]||(o[10]=e=>V.value=e),position:"bottom",round:"","theme-mode":e.themeMode},{default:c(()=>[d(b,{columns:q,modelValue:T.value,"onUpdate:modelValue":o[8]||(o[8]=e=>T.value=e),onConfirm:ge,onCancel:o[9]||(o[9]=e=>V.value=!1),title:"选择权限"},null,8,["modelValue"])]),_:1},8,["show","theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["theme-mode"])]),_:1},8,["modelValue","theme-mode"]),n("div",se,[d(fe,{type:"primary",size:"large",block:"",loading:w.value,disabled:!re.value,onClick:he,class:"create-button"},{default:c(()=>[...o[14]||(o[14]=[u(" 创建智能体 ",-1)])]),_:1},8,["loading","disabled"])]),d(U,{modelValue:C.value,"onUpdate:modelValue":o[12]||(o[12]=e=>C.value=e),title:"选择发音人",height:R.value,"selected-speaker-id":ne.speechConfig?.speakerConfig?.speaker?.id,"theme-mode":e.themeMode,onConfirm:me,onClose:o[13]||(o[13]=e=>C.value=!1)},null,8,["modelValue","height","selected-speaker-id","theme-mode"])],2)}}}),[["__scopeId","data-v-4243fd2e"]]),ne=C(a({__name:"create",setup(a){const l=k(),{t:i}=V(),n=t("auto");o(()=>"dark"===n.value||"light"!==n.value&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches));const r=e=>{console.log("智能体创建成功:",e),b({message:i("agent.create.successMessage"),type:"success",duration:2e3}),setTimeout(()=>{l.push("/agent/list")},2e3)},u=()=>{console.log("智能体创建取消"),b({message:i("agent.create.cancelMessage"),type:"fail",duration:1500}),setTimeout(()=>{l.back()},1500)};return(a,o)=>{const t=e;return s(),g(t,{class:"agent-create-page"},{default:c(()=>[d(ie,{onAgentCreated:r,onAgentCanceled:u,"theme-mode":n.value,class:"agent-create-component"},null,8,["theme-mode"])]),_:1})}}}),[["__scopeId","data-v-6e8fcb31"]]);export{ne as default};
