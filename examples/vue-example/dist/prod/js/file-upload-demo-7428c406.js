import{d as e,_ as l,s as a,B as t}from"./index-34815b62.js";/* empty css              */import{a as o,_ as s}from"./sdkwork-cell-group-f9040361.js";import{_ as u}from"./sdkwork-navbar-2524f49d.js";import{_ as i}from"./sdkwork-popup-2839b588.js";import{k as n,r as d,c as p,w as c,Q as r,R as v,S as m,j as f,u as h,$ as w,X as k,U as g,F as b,Y as y,V as U,n as V,Z as C,a0 as _,a4 as x}from"./vue-vendor-905d75e5.js";import{S as $}from"./sdkwork-page-container-ebfa2fb2.js";import"./utils-vendor-b5712723.js";import"./sdkwork-icon-79456167.js";const F={class:"sdkwork-uploader-file"},j={class:"upload-content"},I={class:"upload-icon"},z={class:"upload-text"},B={class:"upload-title"},S={class:"upload-subtitle"},D={key:0,class:"file-list"},E={class:"file-list-header"},M={class:"file-items"},T={class:"file-info"},N={class:"file-icon"},A={class:"file-details"},R={class:"file-name"},L={class:"file-size"},P={class:"file-actions"},q={key:0,class:"upload-progress"},G={class:"progress-bar"},H={class:"progress-text"},K={key:1,class:"status-icons"},Q={key:0,class:"success-icon"},W={key:1,class:"error-icon"},X={class:"action-buttons"},Y=["onClick"],Z=["onClick"],J={key:1,class:"upload-actions"},O=["disabled"],ee=l(n({__name:"sdkwork-uploader-file",props:{modelValue:{default:()=>[]},accept:{default:"*/*"},multiple:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},autoUpload:{type:Boolean,default:!0},maxSize:{default:104857600},maxCount:{default:10},title:{default:"点击或拖拽文件到此处"},subtitle:{default:"支持所有文件类型"},bucket:{default:void 0},scene:{default:"default"},metadata:{default:()=>({})},contentType:{default:"application/octet-stream"},acl:{default:"private"}},emits:["update:modelValue","upload-start","upload-progress","upload-success","upload-error","upload-complete","file-add","file-remove","file-clear"],setup(l,{expose:a,emit:t}){const o=l,s=t;d();const u=d(!1),i=d([]),n=p(()=>i.value.filter(e=>"uploading"===e.status).length),C=p(()=>0===o.maxCount||i.value.length<o.maxCount);c(()=>o.modelValue,e=>{if(e&&e.length>0){const l=i.value.map(e=>e.id),a=e.filter(e=>!l.includes(_(e))).map(e=>x(e));i.value=[...i.value,...a],o.autoUpload&&V(()=>{ue()})}},{immediate:!0});const _=e=>`${e.name}-${e.size}-${e.lastModified}`,x=e=>({id:_(e),file:e,name:e.name,size:e.size,status:"pending",progress:0}),$=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},ee=async()=>{if(!o.disabled&&C.value)try{const e=await window.$files.chooseFile({count:o.multiple?o.maxCount:1,success:e=>{console.log("文件选择成功:",e)},fail:e=>{console.error("文件选择失败:",e)},complete:()=>{console.log("文件选择完成")}});e.tempFiles&&e.tempFiles.length>0&&oe(e.tempFiles)}catch(e){console.error("文件选择异常:",e)}},le=e=>{e.preventDefault(),!o.disabled&&C.value&&(u.value=!0)},ae=e=>{e.preventDefault(),u.value=!1},te=e=>{e.preventDefault(),u.value=!1,!o.disabled&&C.value&&e.dataTransfer?.files&&oe(Array.from(e.dataTransfer.files))},oe=e=>{if(0===e.length)return;const l=0===o.maxCount?1/0:o.maxCount-i.value.length,a=e.slice(0,l);if(0===a.length)return void window.$message?.warning(`最多只能上传 ${o.maxCount} 个文件`);const t=[],u=[];if(a.forEach(e=>{e.size>o.maxSize?u.push(e):t.push(e)}),u.length>0&&window.$message?.error(`以下文件超过最大限制 ${$(o.maxSize)}: ${u.map(e=>e.name).join(", ")}`),0===t.length)return;const n=t.map(e=>x(e));i.value=[...i.value,...n];const d=i.value.map(e=>e.file);s("update:modelValue",d),s("file-add",t),o.autoUpload&&ue()},se=()=>{i.value.forEach(e=>{"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId)}),i.value=[],s("update:modelValue",[]),s("file-clear")},ue=async()=>{const e=i.value.filter(e=>"pending"===e.status);if(0!==e.length){for(const l of e)await ie(l);s("upload-complete",i.value.map(e=>e.file))}},ie=async e=>{if(window.$uploader){e.status="uploading",e.progress=0,s("upload-start",e.file);try{const l={file:e.file,bucket:o.bucket||{name:"default-bucket"},name:e.name,scene:o.scene,metadata:o.metadata,contentType:o.contentType,acl:o.acl},a=await window.$uploader.upload(l,l=>{e.progress=l.percentage,s("upload-progress",e.file,l.percentage)});e.status="success",e.progress=100,s("upload-success",e.file,a)}catch(l){e.status="error",s("upload-error",e.file,l),console.error("Upload failed:",l)}}else console.error("Uploader not available")};return a({clearFiles:()=>{se()},uploadFiles:()=>{ue()},getFileList:()=>i.value.map(e=>({file:e.file,status:e.status,progress:e.progress,response:"success"===e.status?"uploaded":void 0}))}),(a,t)=>(r(),v("div",F,[m("div",{class:k(["upload-area",{"drag-over":u.value,disabled:l.disabled}]),onClick:ee,onDrop:te,onDragover:le,onDragleave:ae},[m("div",j,[m("div",I,[f(h(e),{icon:"material-symbols:cloud-upload",width:"48",height:"48"})]),m("div",z,[m("p",B,w(l.title),1),m("p",S,w(l.subtitle),1)])])],34),i.value.length>0?(r(),v("div",D,[m("div",E,[m("span",null,"已选择文件 ("+w(i.value.length)+")",1),i.value.length>1?(r(),v("button",{key:0,type:"button",class:"clear-all-btn",onClick:se}," 清空全部 ")):g("",!0)]),m("div",M,[(r(!0),v(b,null,y(i.value,l=>(r(),v("div",{key:l.id,class:k(["file-item",{uploading:"uploading"===l.status,success:"success"===l.status,error:"error"===l.status}])},[m("div",T,[m("div",N,[f(h(e),{icon:"material-symbols:description",width:"24",height:"24"})]),m("div",A,[m("div",R,w(l.name),1),m("div",L,w($(l.size)),1)])]),m("div",P,["uploading"===l.status?(r(),v("div",q,[m("div",G,[m("div",{class:"progress-fill",style:U({width:l.progress+"%"})},null,4)]),m("span",H,w(l.progress)+"%",1)])):(r(),v("div",K,["success"===l.status?(r(),v("span",Q,"✓")):g("",!0),"error"===l.status?(r(),v("span",W,"✗")):g("",!0)])),m("div",X,["uploading"===l.status?(r(),v("button",{key:0,type:"button",class:"cancel-btn",onClick:e=>(e=>{const l=i.value.find(l=>l.id===e);l&&l.uploadId&&(window.$uploader?.cancel(l.uploadId),l.status="pending",l.progress=0,l.uploadId=void 0)})(l.id)}," 取消 ",8,Y)):(r(),v("button",{key:1,type:"button",class:"remove-btn",onClick:e=>(e=>{const l=i.value.findIndex(l=>l.id===e);if(-1!==l){const e=i.value[l];"uploading"===e.status&&e.uploadId&&window.$uploader?.cancel(e.uploadId),i.value.splice(l,1);const a=i.value.map(e=>e.file);s("update:modelValue",a),s("file-remove",e.file)}})(l.id)}," 移除 ",8,Z))])])],2))),128))])])):g("",!0),i.value.length>0&&!l.autoUpload?(r(),v("div",J,[m("button",{type:"button",class:"upload-btn primary",disabled:n.value>0,onClick:ue},w(n.value>0?`上传中... (${n.value})`:"开始上传"),9,O),m("button",{type:"button",class:"upload-btn secondary",onClick:se}," 取消 ")])):g("",!0)]))}}),[["__scopeId","data-v-720d47d1"]]),le={class:"demo-content"},ae={class:"popup-content"},te={key:0,class:"file-info"},oe={class:"popup-content"},se={key:0,class:"file-info"},ue={class:"popup-content"},ie={class:"popup-content"},ne={key:0,class:"upload-actions"},de={class:"popup-content"},pe={class:"popup-content"},ce={class:"popup-content"},re={class:"popup-content"},ve={class:"popup-content"},me={key:0,class:"progress-info"},fe={class:"popup-content"},he={class:"status-info"},we={class:"popup-content"},ke={class:"ops-info"},ge=l(n({__name:"file-upload-demo",setup(e){const l=d(!1),n=d(!1),p=d(!1),c=d(!1),h=d(!1),k=d(!1),U=d(!1),V=d(!1),F=d(!1),j=d(!1),I=d(!1),z=d([]),B=d([]),S=d([]),D=d([]),E=d([]),M=d([]),T=d([]),N=d([]),A=d([]),R=d([]),L=d([]),P=d(),q=d([]),G=d("等待上传"),H=d([]),K=(e,l)=>{a(`单文件上传成功: ${e.name}`),console.log("上传响应:",l)},Q=(e,l)=>{a(`多文件上传成功: ${e.name}`)},W=(e,l)=>{a(`上传失败: ${e.name}`),console.error("上传错误:",l)},X=(e,l)=>{a(`文件过大: ${e.name}`)},Y=e=>{a(`添加了 ${e.length} 个文件`)},Z=(e,l)=>{const a=q.value.findIndex(l=>l.fileName===e.name);-1!==a?q.value[a].progress=l:q.value.push({fileName:e.name,progress:l})},J=e=>{G.value=`开始上传: ${e.name}`,H.value.push(`开始上传: ${e.name}`)},O=(e,l)=>{G.value=`上传成功: ${e.name}`,H.value.push(`上传成功: ${e.name}`)},ge=e=>{G.value="所有文件上传完成",H.value.push("所有文件上传完成")},be=e=>{H.value.push(`移除文件: ${e.name}`)},ye=()=>{H.value.push("清空所有文件")},Ue=()=>{P.value&&(P.value.uploadFiles(),a("开始手动上传"))},Ve=()=>{P.value&&(P.value.clearFiles(),a("已清空文件"))},Ce=()=>{a("切换禁用状态")};return(e,a)=>{const d=u,_e=o,xe=s,$e=t;return r(),C($,{"safe-area":"",scrollable:"","theme-mode":"auto"},{header:_(()=>[f(d,{title:"通用文件上传组件演示","left-text":"返回","left-arrow":"",onClickLeft:a[0]||(a[0]=l=>e.$router.back())})]),default:_(()=>[m("div",le,[f(xe,{title:"基础功能演示"},{default:_(()=>[f(_e,{title:"单文件上传","is-link":"",onClick:a[1]||(a[1]=e=>l.value=!0)}),f(_e,{title:"多文件上传","is-link":"",onClick:a[2]||(a[2]=e=>n.value=!0)}),f(_e,{title:"拖拽上传","is-link":"",onClick:a[3]||(a[3]=e=>p.value=!0)}),f(_e,{title:"手动上传","is-link":"",onClick:a[4]||(a[4]=e=>c.value=!0)})]),_:1}),f(xe,{title:"高级功能演示"},{default:_(()=>[f(_e,{title:"文件大小限制","is-link":"",onClick:a[5]||(a[5]=e=>h.value=!0)}),f(_e,{title:"文件数量限制","is-link":"",onClick:a[6]||(a[6]=e=>k.value=!0)}),f(_e,{title:"自定义文件类型","is-link":"",onClick:a[7]||(a[7]=e=>U.value=!0)}),f(_e,{title:"禁用状态","is-link":"",onClick:a[8]||(a[8]=e=>V.value=!0)})]),_:1}),f(xe,{title:"事件监听演示"},{default:_(()=>[f(_e,{title:"上传进度监听","is-link":"",onClick:a[9]||(a[9]=e=>F.value=!0)}),f(_e,{title:"上传状态监听","is-link":"",onClick:a[10]||(a[10]=e=>j.value=!0)}),f(_e,{title:"文件操作监听","is-link":"",onClick:a[11]||(a[11]=e=>I.value=!0)})]),_:1})]),f(i,{show:l.value,"onUpdate:show":a[13]||(a[13]=e=>l.value=e),position:"center",title:"单文件上传",width:400},{default:_(()=>[m("div",ae,[f(ee,{modelValue:z.value,"onUpdate:modelValue":a[12]||(a[12]=e=>z.value=e),multiple:!1,"auto-upload":!0,title:"选择单个文件",subtitle:"支持所有文件类型",onUploadSuccess:K,onUploadError:W},null,8,["modelValue"]),z.value.length>0?(r(),v("div",te,[m("p",null,"已选择文件: "+w(z.value.length)+" 个",1)])):g("",!0)])]),_:1},8,["show"]),f(i,{show:n.value,"onUpdate:show":a[15]||(a[15]=e=>n.value=e),position:"center",title:"多文件上传",width:500},{default:_(()=>[m("div",oe,[f(ee,{modelValue:B.value,"onUpdate:modelValue":a[14]||(a[14]=e=>B.value=e),multiple:!0,"auto-upload":!0,"max-count":5,title:"选择多个文件",subtitle:"最多选择5个文件",onUploadSuccess:Q,onUploadError:W},null,8,["modelValue"]),B.value.length>0?(r(),v("div",se,[m("p",null,"已选择文件: "+w(B.value.length)+" 个",1)])):g("",!0)])]),_:1},8,["show"]),f(i,{show:p.value,"onUpdate:show":a[17]||(a[17]=e=>p.value=e),position:"center",title:"拖拽上传",width:450},{default:_(()=>[m("div",ue,[f(ee,{modelValue:S.value,"onUpdate:modelValue":a[16]||(a[16]=e=>S.value=e),multiple:!0,"auto-upload":!0,title:"拖拽文件到此处",subtitle:"支持拖拽上传文件",onFileAdd:Y},null,8,["modelValue"])])]),_:1},8,["show"]),f(i,{show:c.value,"onUpdate:show":a[19]||(a[19]=e=>c.value=e),position:"center",title:"手动上传",width:480},{default:_(()=>[m("div",ie,[f(ee,{ref_key:"manualUploaderRef",ref:P,modelValue:D.value,"onUpdate:modelValue":a[18]||(a[18]=e=>D.value=e),multiple:!0,"auto-upload":!1,title:"手动控制上传",subtitle:"选择文件后手动触发上传"},null,8,["modelValue"]),D.value.length>0?(r(),v("div",ne,[f($e,{type:"primary",block:"",onClick:Ue},{default:_(()=>[...a[34]||(a[34]=[x("开始上传",-1)])]),_:1}),f($e,{type:"default",block:"",onClick:Ve},{default:_(()=>[...a[35]||(a[35]=[x("清空文件",-1)])]),_:1})])):g("",!0)])]),_:1},8,["show"]),f(i,{show:h.value,"onUpdate:show":a[21]||(a[21]=e=>h.value=e),position:"center",title:"文件大小限制",width:450},{default:_(()=>[m("div",de,[f(ee,{modelValue:E.value,"onUpdate:modelValue":a[20]||(a[20]=e=>E.value=e),multiple:!0,"auto-upload":!0,"max-size":10485760,title:"文件大小限制",subtitle:"最大文件大小: 10MB",onUploadError:X},null,8,["modelValue"])])]),_:1},8,["show"]),f(i,{show:k.value,"onUpdate:show":a[23]||(a[23]=e=>k.value=e),position:"center",title:"文件数量限制",width:450},{default:_(()=>[m("div",pe,[f(ee,{modelValue:M.value,"onUpdate:modelValue":a[22]||(a[22]=e=>M.value=e),multiple:!0,"auto-upload":!0,"max-count":3,title:"文件数量限制",subtitle:"最多上传3个文件"},null,8,["modelValue"])])]),_:1},8,["show"]),f(i,{show:U.value,"onUpdate:show":a[25]||(a[25]=e=>U.value=e),position:"center",title:"自定义文件类型",width:450},{default:_(()=>[m("div",ce,[f(ee,{modelValue:T.value,"onUpdate:modelValue":a[24]||(a[24]=e=>T.value=e),multiple:!0,"auto-upload":!0,accept:".pdf,.doc,.docx,.xls,.xlsx",title:"文档文件上传",subtitle:"仅支持PDF、Word、Excel文档"},null,8,["modelValue"])])]),_:1},8,["show"]),f(i,{show:V.value,"onUpdate:show":a[27]||(a[27]=e=>V.value=e),position:"center",title:"禁用状态",width:400},{default:_(()=>[m("div",re,[f(ee,{modelValue:N.value,"onUpdate:modelValue":a[26]||(a[26]=e=>N.value=e),multiple:!0,"auto-upload":!0,disabled:!0,title:"禁用状态",subtitle:"上传组件已被禁用"},null,8,["modelValue"]),f($e,{type:"primary",block:"",onClick:Ce},{default:_(()=>[...a[36]||(a[36]=[x("切换禁用状态",-1)])]),_:1})])]),_:1},8,["show"]),f(i,{show:F.value,"onUpdate:show":a[29]||(a[29]=e=>F.value=e),position:"center",title:"上传进度监听",width:500},{default:_(()=>[m("div",ve,[f(ee,{modelValue:A.value,"onUpdate:modelValue":a[28]||(a[28]=e=>A.value=e),multiple:!0,"auto-upload":!0,title:"进度监听演示",onUploadProgress:Z},null,8,["modelValue"]),q.value.length>0?(r(),v("div",me,[a[37]||(a[37]=m("h4",null,"上传进度:",-1)),(r(!0),v(b,null,y(q.value,e=>(r(),v("div",{key:e.fileName,class:"progress-item"},[m("span",null,w(e.fileName),1),m("span",null,w(e.progress)+"%",1)]))),128))])):g("",!0)])]),_:1},8,["show"]),f(i,{show:j.value,"onUpdate:show":a[31]||(a[31]=e=>j.value=e),position:"center",title:"上传状态监听",width:500},{default:_(()=>[m("div",fe,[f(ee,{modelValue:R.value,"onUpdate:modelValue":a[30]||(a[30]=e=>R.value=e),multiple:!0,"auto-upload":!0,title:"状态监听演示",onUploadStart:J,onUploadSuccess:O,onUploadError:W,onUploadComplete:ge},null,8,["modelValue"]),m("div",he,[a[38]||(a[38]=m("h4",null,"上传状态:",-1)),m("p",null,w(G.value),1)])])]),_:1},8,["show"]),f(i,{show:I.value,"onUpdate:show":a[33]||(a[33]=e=>I.value=e),position:"center",title:"文件操作监听",width:500},{default:_(()=>[m("div",we,[f(ee,{modelValue:L.value,"onUpdate:modelValue":a[32]||(a[32]=e=>L.value=e),multiple:!0,"auto-upload":!0,title:"文件操作监听",onFileAdd:Y,onFileRemove:be,onFileClear:ye},null,8,["modelValue"]),m("div",ke,[a[39]||(a[39]=m("h4",null,"操作记录:",-1)),(r(!0),v(b,null,y(H.value,(e,l)=>(r(),v("div",{key:l,class:"log-item"},w(e),1))),128))])])]),_:1},8,["show"])]),_:1})}}}),[["__scopeId","data-v-768596af"]]);export{ge as default};
