import{ad as e,z as t,ae as a,af as l,ag as r,V as n,c as o,W as i,b as s,U as u,F as c,a4 as d,ah as g,a3 as f,a2 as m,I as p,p as v,r as h,n as b,ab as y,ai as x,aj as k,ak as w,al as S,w as V}from"./index-DvK_64jm.js";import{C,c as M}from"./index-euu7aa8h.js";import{u as I}from"./use-id-BN10QhF_.js";import{k as B,c as A,r as z,f as E,w as j,b as T,n as P,j as W,a4 as L,q as $,p as q}from"./vue-vendor-Caw1HGjZ.js";function F(e){return Array.isArray(e)?!e.length:0!==e&&!e}function H(e,t){const{message:a}=t;return l(a)?a(e,t):a||""}function R({target:e}){e.composing=!0}function D({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function N(e){return[...e].length}function O(e,t){return[...e].slice(0,t).join("")}const[K,U]=o("field");const G=V(B({name:K,props:n({},M,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:b,max:Number,min:Number,formatter:Function,clearIcon:v("clear"),modelValue:h(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:v("focus"),formatTrigger:v("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},{rows:b,type:v("text"),rules:Array,autosize:[Boolean,Object],labelWidth:b,labelClass:y,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(l,{emit:n,slots:o}){const v=I(),h=A({status:"unvalidated",focused:!1,validateMessage:""}),b=z(),y=z(),V=z(),{parent:M}=i(x),B=()=>{var e;return String(null!=(e=l.modelValue)?e:"")},K=e=>d(l[e])?l[e]:M&&d(M.props[e])?M.props[e]:void 0,G=E(()=>{const e=K("readonly");if(l.clearable&&!e){const e=""!==B(),t="always"===l.clearTrigger||"focus"===l.clearTrigger&&h.focused;return e&&t}return!1}),J=E(()=>V.value&&o.input?V.value():l.modelValue),Q=E(()=>{var e;const t=K("required");return"auto"===t?null==(e=l.rules)?void 0:e.some(e=>e.required):t}),X=e=>e.reduce((e,t)=>e.then(()=>{if("failed"===h.status)return;let{value:e}=J;if(t.formatter&&(e=t.formatter(e,t)),!function(e,t){if(F(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}(e,t))return h.status="failed",void(h.validateMessage=H(e,t));if(t.validator){if(F(e)&&!1===t.validateEmpty)return;return function(e,t){return new Promise(a=>{const l=t.validator(e,t);r(l)?l.then(a):a(l)})}(e,t).then(a=>{a&&"string"==typeof a?(h.status="failed",h.validateMessage=a):!1===a&&(h.status="failed",h.validateMessage=H(e,t))})}}),Promise.resolve()),Y=()=>{h.status="unvalidated",h.validateMessage=""},Z=()=>n("endValidate",{status:h.status,message:h.validateMessage}),_=(e=l.rules)=>new Promise(t=>{Y(),e?(n("startValidate"),X(e).then(()=>{"failed"===h.status?(t({name:l.name,message:h.validateMessage}),Z()):(h.status="passed",t(),Z())})):t()}),ee=e=>{if(M&&l.rules){const{validateTrigger:t}=M.props,a=k(t).includes(e),r=l.rules.filter(t=>t.trigger?k(t.trigger).includes(e):a);r.length&&_(r)}},te=(e,t="onChange")=>{var a,r;const o=e;e=(e=>{var t;const{maxlength:a}=l;if(d(a)&&N(e)>+a){const l=B();if(l&&N(l)===+a)return l;const r=null==(t=b.value)?void 0:t.selectionEnd;if(h.focused&&r){const t=[...e],l=t.length-+a;return t.splice(r-l,l),t.join("")}return O(e,+a)}return e})(e);const i=N(o)-N(e);if("number"===l.type||"digit"===l.type){const n="number"===l.type;if(e=g(e,n,n),"onBlur"===t&&""!==e&&(void 0!==l.min||void 0!==l.max)){const t=f(+e,null!=(a=l.min)?a:-1/0,null!=(r=l.max)?r:1/0);+e!==t&&(e=t.toString())}}let s=0;if(l.formatter&&t===l.formatTrigger){const{formatter:t,maxlength:a}=l;if(e=t(e),d(a)&&N(e)>+a&&(e=O(e,+a)),b.value&&h.focused){const{selectionEnd:e}=b.value,a=O(o,e);s=N(t(a))-N(a)}}if(b.value&&b.value.value!==e)if(h.focused){let{selectionStart:t,selectionEnd:a}=b.value;if(b.value.value=e,d(t)&&d(a)){const l=N(e);i?(t-=i,a-=i):s&&(t+=s,a+=s),b.value.setSelectionRange(Math.min(t,l),Math.min(a,l))}}else b.value.value=e;e!==l.modelValue&&n("update:modelValue",e)},ae=e=>{e.target.composing||te(e.target.value)},le=()=>{var e;return null==(e=b.value)?void 0:e.blur()},re=()=>{var e;return null==(e=b.value)?void 0:e.focus()},ne=()=>{const r=b.value;"textarea"===l.type&&l.autosize&&r&&function(l,r){const n=e();l.style.height="auto";let o=l.scrollHeight;if(t(r)){const{maxHeight:e,minHeight:t}=r;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(l.style.height=`${o}px`,a(n))}(r,l.autosize)},oe=e=>{h.focused=!0,n("focus",e),P(ne),K("readonly")&&le()},ie=e=>{h.focused=!1,te(B(),"onBlur"),n("blur",e),K("readonly")||(ee("onBlur"),P(ne),w())},se=e=>n("clickInput",e),ue=e=>n("clickLeftIcon",e),ce=e=>n("clickRightIcon",e),de=E(()=>"boolean"==typeof l.error?l.error:!(!M||!M.props.showError||"failed"!==h.status)||void 0),ge=E(()=>{const e=K("labelWidth"),t=K("labelAlign");if(e&&"top"!==t)return{width:s(e)}}),fe=e=>{if(13===e.keyCode){M&&M.props.submitOnEnter||"textarea"===l.type||m(e),"search"===l.type&&le()}n("keypress",e)},me=()=>l.id||`${v}-input`,pe=()=>{const e=U("control",[K("inputAlign"),{error:de.value,custom:!!o.input,"min-height":"textarea"===l.type&&!l.autosize}]);if(o.input)return W("div",{class:e,onClick:se},[o.input()]);const t={id:me(),ref:b,name:l.name,rows:void 0!==l.rows?+l.rows:void 0,class:e,disabled:K("disabled"),readonly:K("readonly"),autofocus:l.autofocus,placeholder:l.placeholder,autocomplete:l.autocomplete,autocapitalize:l.autocapitalize,autocorrect:l.autocorrect,enterkeyhint:l.enterkeyhint,spellcheck:l.spellcheck,"aria-labelledby":l.label?`${v}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:ie,onFocus:oe,onInput:ae,onClick:se,onChange:D,onKeypress:fe,onCompositionend:D,onCompositionstart:R};return"textarea"===l.type?W("textarea",$(t,{inputmode:l.inputmode}),null):W("input",$((a=l.type,r=l.inputmode,"number"===a&&(a="text",null!=r||(r="decimal")),"digit"===a&&(a="tel",null!=r||(r="numeric")),{type:a,inputmode:r}),t),null);var a,r},ve=()=>{const e=o["right-icon"];if(l.rightIcon||e)return W("div",{class:U("right-icon"),onClick:ce},[e?e():W(p,{name:l.rightIcon,classPrefix:l.iconPrefix},null)])},he=()=>{if(l.showWordLimit&&l.maxlength){const e=N(B());return W("div",{class:U("word-limit")},[W("span",{class:U("word-num")},[e]),L("/"),l.maxlength])}},be=()=>{if(M&&!1===M.props.showErrorMessage)return;const e=l.errorMessage||h.validateMessage;if(e){const t=o["error-message"],a=K("errorMessageAlign");return W("div",{class:U("error-message",a)},[t?t({message:e}):e])}},ye=()=>[W("div",{class:U("body")},[pe(),G.value&&W(p,{ref:y,name:l.clearIcon,class:U("clear")},null),ve(),o.button&&W("div",{class:U("button")},[o.button()])]),he(),be()];return u({blur:le,focus:re,validate:_,formValue:J,resetValidation:Y,getValidationStatus:()=>h.status}),q(S,{customValue:V,resetValidation:Y,validateWithTrigger:ee}),j(()=>l.modelValue,()=>{te(B()),Y(),ee("onChange"),P(ne)}),T(()=>{te(B(),l.formatTrigger),P(ne)}),c("touchstart",e=>{m(e),n("update:modelValue",""),n("clear",e)},{target:E(()=>{var e;return null==(e=y.value)?void 0:e.$el})}),()=>{const e=K("disabled"),t=K("labelAlign"),a=(()=>{const e=o["left-icon"];if(l.leftIcon||e)return W("div",{class:U("left-icon"),onClick:ue},[e?e():W(p,{name:l.leftIcon,classPrefix:l.iconPrefix},null)])})();return W(C,{size:l.size,class:U({error:de.value,disabled:e,[`label-${t}`]:t}),center:l.center,border:l.border,isLink:l.isLink,clickable:l.clickable,titleStyle:ge.value,valueClass:U("value"),titleClass:[U("label",[t,{required:Q.value}]),l.labelClass],arrowDirection:l.arrowDirection},{icon:a&&"top"!==t?()=>a:null,title:()=>{const e=(()=>{const e=K("labelWidth"),t=K("labelAlign"),a=K("colon")?":":"";return o.label?[o.label(),a]:l.label?W("label",{id:`${v}-label`,for:o.input?void 0:me(),"data-allow-mismatch":"attribute",onClick:e=>{m(e),re()},style:"top"===t&&e?{width:s(e)}:void 0},[l.label+a]):void 0})();return"top"===t?[a,e].filter(Boolean):e||[]},value:ye,extra:o.extra})}}}));export{G as F};
