import{s as e,h as a,B as l,I as t,_ as s}from"./index-5affcab4.js";/* empty css              *//* empty css              */import"./index-5d6825eb.js";import{U as o}from"./index-fa879ae6.js";/* empty css              */import{k as n,c as i,r,w as d,Q as u,R as c,S as p,$ as f,j as v,a0 as m,a4 as b,a1 as y,U as k,Z as w,X as h,V as g}from"./vue-vendor-a2672387.js";import{I as x}from"./index-4fcf5799.js";const B={class:"sdkwork-avatar"},C={key:0,class:"upload-overlay"},z={class:"progress-text"},_={class:"placeholder-text"},A={key:3,class:"avatar-actions"},j=s(n({__name:"sdkwork-avatar",props:{modelValue:{},src:{},size:{default:"40px"},uploadable:{type:Boolean,default:!0},showAiGenerate:{type:Boolean,default:!1},round:{type:Boolean,default:!0},text:{default:""},background:{default:"#f5f5f5"},disabled:{type:Boolean,default:!1},showClear:{type:Boolean,default:!1},uploadConfig:{}},emits:["update:modelValue","upload","upload-start","upload-progress","upload-complete","upload-error","aiGenerate","click","clear"],setup(s,{emit:n}){const j=s,$=n,F=i({get:()=>j.modelValue||j.src,set:e=>$("update:modelValue",e||"")}),I=r(!1),T=r(0),V=r(null),R=r(null),G=async a=>{let l=null;if(a instanceof File)l=a;else if(a&&a.file instanceof File)l=a.file;else if(a&&a.content&&a.content instanceof File)l=a.content;else if(Array.isArray(a)&&a.length>0){const e=a[0];e.file instanceof File?l=e.file:e.content instanceof File&&(l=e.content)}if(!l)return e("无效的文件格式"),!1;if(!l.type?.startsWith("image/"))return e("请上传图片文件"),!1;if(l.size>5242880)return e("图片大小不能超过5MB"),!1;const t=new FileReader;return t.onload=e=>{const a=e.target?.result;F.value=a},t.readAsDataURL(l),$("upload",l),await U(l),!0},U=async a=>{if(window.$uploader)try{I.value=!0,T.value=0,$("upload-start",a);const l=j.uploadConfig||{},t={file:a,bucket:l.bucket||{name:"public"},name:a.name,scene:"avatar",metadata:l.metadata||{},contentType:l.contentType||a.type,acl:l.acl||"public-read"},s=await window.$uploader.upload(t,e=>{T.value=e.percentage,$("upload-progress",e)});s.taskId&&(V.value=s.taskId),s.url&&s.url.startsWith("http")?(F.value=s.url,e("头像上传成功"),$("upload-complete",s)):(console.warn("上传返回的URL无效，保持本地预览:",s.url),e("头像上传完成，但URL无效"))}catch(l){console.error("头像上传失败:",l),e("头像上传失败，请重试"),$("upload-error",l)}finally{I.value=!1,T.value=0}else e("上传器未初始化")},q=()=>{I.value&&window.$uploader&&(V.value?window.$uploader.cancel(V.value):window.$uploader.cancelAll(),I.value=!1,T.value=0,V.value=null,e("上传已取消"),F.value="")},L=()=>{a({title:"AI生成头像",message:"确定要使用AI生成头像吗？",showCancelButton:!0,confirmButtonText:"生成",cancelButtonText:"取消"}).then(()=>{$("aiGenerate"),e("正在生成头像...")})},S=()=>{!j.disabled&&F.value&&a({title:"清空头像",message:"确定要清空当前头像吗？",showCancelButton:!0,confirmButtonText:"清空",cancelButtonText:"取消"}).then(()=>{F.value="",e("头像已清空"),$("clear")})},W=()=>{j.disabled||!j.uploadable||I.value||setTimeout(()=>{if(R.value)R.value.chooseFile();else{const e=document.querySelector('.upload-btn input[type="file"]');e&&e.click()}},10),$("click")},D=i(()=>({width:"number"==typeof j.size?`${j.size}px`:j.size,height:"number"==typeof j.size?`${j.size}px`:j.size,backgroundColor:j.background}));return d(()=>j.src,e=>{j.modelValue||(F.value=e)}),d(()=>j.modelValue,e=>{F.value=e}),(e,a)=>{const n=l,i=t,r=x,d=o;return u(),c("div",B,[p("div",{class:"avatar-container",onClick:W},[I.value?(u(),c("div",C,[a[3]||(a[3]=p("div",{class:"loading-spinner"},null,-1)),p("div",z,f(T.value)+"%",1),v(n,{type:"danger",onClick:y(q,["stop"]),class:"cancel-btn"},{default:m(()=>[...a[2]||(a[2]=[b(" 取消 ",-1)])]),_:1})])):k("",!0),F.value?(u(),w(r,{key:1,src:F.value,width:s.size,height:s.size,fit:"cover",class:h([{disabled:s.disabled,round:s.round,square:!s.round,uploading:I.value},"avatar-image"])},{extra:m(()=>[s.showClear&&!I.value?(u(),c("div",{key:0,class:"clear-btn",onClick:y(S,["stop"])},[v(i,{name:"cross",size:"12",color:"#fff"})])):k("",!0)]),_:1},8,["src","width","height","class"])):(u(),c("div",{key:2,class:h(["avatar-placeholder",{round:s.round,square:!s.round,uploading:I.value}]),style:g(D.value)},[p("span",_,f(s.text),1)],6)),!s.uploadable&&!s.showAiGenerate||I.value?k("",!0):(u(),c("div",A,[s.uploadable?(u(),w(d,{key:0,disabled:s.disabled,"after-read":G,"max-count":1,"preview-image":!1,"show-upload":!1,accept:"image/*",class:"upload-btn",ref_key:"uploaderRef",ref:R,onClick:a[1]||(a[1]=y(()=>{},["stop"]))},{default:m(()=>[v(n,{type:"primary",disabled:s.disabled,class:"action-btn",onClick:a[0]||(a[0]=y(()=>{},["stop"]))},{default:m(()=>[...a[4]||(a[4]=[b(" 上传 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"])):k("",!0),s.showAiGenerate?(u(),w(n,{key:1,type:"success",disabled:s.disabled,onClick:L,class:"action-btn ai-generate-btn"},{default:m(()=>[...a[5]||(a[5]=[b(" AI生成 ",-1)])]),_:1},8,["disabled"])):k("",!0)]))])])}}}),[["__scopeId","data-v-24222b83"]]);export{j as S};
