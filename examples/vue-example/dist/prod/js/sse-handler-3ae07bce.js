import{b1 as e,g as t}from"./index-5affcab4.js";import{A as o}from"./chat-88db1a6d.js";import{M as n}from"./chat-76669d74.js";import"./vue-vendor-a2672387.js";import"./utils-vendor-b5712723.js";import"./conversation-6ab73d69.js";import"./message-c1ac2c8f.js";import"./sdkwork_stream_player-856a9d65.js";class s{name="SseMessageHandler";connectionState;eventEmitter;eventAdapter;config;constructor(t,o,n){this.config=t,this.eventEmitter=o,this.eventAdapter=n,this.connectionState={state:e.DISCONNECTED,connected:!1}}async initialize(){try{await this.setupSseConnection(),this.setupEventListeners(),this.updateConnectionState({state:e.CONNECTED,connected:!0})}catch(t){throw this.eventEmitter.emit(this.eventAdapter.adaptErrorOccurred(t)),t}}disconnect(){this.updateConnectionState({state:e.DISCONNECTED,connected:!1})}startListening(){console.log("SSE开始监听")}stopListening(){console.log("SSE停止监听")}async send(e,s){console.log("SSE发送消息:",e);const i=new o;let c;c="string"==typeof e?{messages:[{role:t.ChatCompletionRole.user,content:e}],stream:!0}:n.toCompletionParam(e);const a=await i.create(c,{conversationId:s.conversation_id,id:s.agent_id});for await(const t of a)this.eventEmitter.emit(this.eventAdapter.adaptMessageChunkReceived({chunk:t,channelMsgId:t.id,id:t.id}))}sendAudioStream(e,t,o){console.log("SSE发送音频流")}sendHello(e,t){console.log("SSE发送Hello消息:",e)}sendEvent(e,t){console.log("SSE发送事件:",e,t)}sendProtocol(e){console.log("SSE发送协议:",e)}getConnectionState(){return this.connectionState}isConnected(){return this.connectionState.connected}onEvent(e,t){console.log("SSE注册事件监听器:",e)}onMessage(e){console.log("SSE注册消息监听器")}onAudioStream(e){console.log("SSE注册音频流监听器")}onData(e){console.log("SSE注册数据监听器")}onToolCall(e){console.log("SSE注册工具调用监听器")}offData(e){console.log("SSE移除数据监听器")}offEvent(e,t){console.log("SSE移除事件监听器:",e)}onError(e){console.log("SSE注册错误监听器")}offError(e){console.log("SSE移除错误监听器")}async destroy(){this.disconnect(),console.log("SSE处理器已销毁")}async reconnect(){console.log("SSE重新连接..."),this.disconnect(),await this.initialize()}enter(e){console.log("SSE进入聊天:",e.chatContext)}exit(e){console.log("SSE退出聊天:",e.chatContext)}abort(e){console.log("SSE中断聊天")}async setupSseConnection(){console.log("设置SSE连接")}setupEventListeners(){console.log("设置SSE事件监听器")}updateConnectionState(e){this.connectionState=e,this.eventEmitter.emit(this.eventAdapter.adaptConnectionChange(e))}}export{s as SseMessageHandler};
