import{_ as e}from"./sdkwork-popup-6e1ec418.js";import{i as a,M as l,j as t,I as o,_ as s,s as i,B as n,h as r,L as u}from"./index-5affcab4.js";import{S as c}from"./sdkwork-video-player-5c70329d.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{k as d,Q as v,R as m,S as p,j as f,$ as y,a1 as h,r as k,c as g,a0 as w,a4 as b,U as C,w as x,Z as _,V as z,b as T,o as I,F as S,Y as V,X as j,n as L}from"./vue-vendor-a2672387.js";import{I as B}from"./index-4fcf5799.js";import{S as M}from"./sdkwork-api-list-2f474514.js";import{F}from"./index-dee6a080.js";import{T as $}from"./index-7bca35b2.js";class D extends a.BaseService{constructor(){super(l.create(t.CommentsManager))}async reply(e,a,l){const t=await this.manager.reply(e,a,l);return null==t||null==t.data?Promise.reject(new Error("data error!")):t.data}async like(e,a){const l=await this.manager.like(e,a);return null==l||null==l.data?Promise.reject(new Error("data error!")):l.data}async unlike(e,a){const l=await this.manager.unlike(e,a);return null==l||null==l.data?Promise.reject(new Error("data error!")):l.data}}const U={class:"comment-item"},P={class:"user-avatar"},E={class:"comment-content"},Y={class:"user-info"},q={class:"username"},K={class:"create-time"},Q={class:"comment-text"},R={class:"comment-actions"},O={class:"like-count"},A=s(d({__name:"comments-list-item",props:{comment:{}},emits:["like","reply"],setup(e,{emit:a}){const l=e,t=a,s=()=>{t("like",l.comment)},i=()=>{t("reply",l.comment)},n=e=>{const a=new Date(e),l=(new Date).getTime()-a.getTime();return l<6e4?"刚刚":l<36e5?Math.floor(l/6e4)+"分钟前":l<864e5?Math.floor(l/36e5)+"小时前":l<2592e6?Math.floor(l/864e5)+"天前":a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()};return(a,l)=>{const t=B,r=o;return v(),m("div",U,[p("div",P,[f(t,{src:e.comment.user?.avatar||"https://via.placeholder.com/40",width:"40",height:"40",radius:"20",fit:"cover"},null,8,["src"])]),p("div",E,[p("div",Y,[p("span",q,y(e.comment.user?.username||"匿名用户"),1),p("span",K,y(n(e.comment.createTime)),1)]),p("div",Q,y(e.comment.content),1),p("div",R,[p("div",{class:"like-action",onClick:h(s,["stop"])},[f(r,{name:e.comment.liked?"like":"like-o",color:e.comment.liked?"#ff2442":"#999",size:"14"},null,8,["name","color"]),p("span",O,y(e.comment.likeCount),1)]),p("span",{class:"reply-btn",onClick:h(i,["stop"])},"回复")])])])}}}),[["__scopeId","data-v-e618d5c7"]]),H={class:"comments-container"},N={key:0,class:"reply-input-container"},J={class:"reply-actions"},W=s(d({__name:"sdkwork-comments-list",props:{queryParams:{default:()=>({})},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1},itemKey:{default:"id"},itemTitleField:{default:"content"},itemDescriptionField:{default:"user.username"}},emits:["select","delete","search","like","reply"],setup(e,{emit:a}){const l=e,t=a,o=new D,s=k(null),r=k(null),u=k(""),c=k(""),d=g(()=>({...l.queryParams,keyword:c.value})),y=async e=>{try{return await o.listByPage({},e)}catch(a){throw i("获取评论失败"),a}},h=e=>{t("select",e)},x=async e=>{try{await o.delete(e.id),i("删除成功"),s.value?.refresh()}catch(a){i("删除失败")}t("delete",e)},_=e=>{c.value=e,t("search",e)},z=async e=>{try{e.liked?(await o.unlike(e.id),e.likeCount--):(await o.like(e.id),e.likeCount++),e.liked=!e.liked,t("like",e)}catch(a){i("操作失败")}},T=e=>{r.value=e,u.value=""},I=()=>{r.value=null,u.value=""},S=async()=>{if(r.value&&u.value.trim())try{await o.reply({userId:r.value.user.id,content:u.value.trim()},r.value.id),i("回复成功"),t("reply",r.value,u.value.trim()),s.value?.refresh(),I()}catch(e){i("回复失败")}};return(a,l)=>{const t=F,o=n;return v(),m("div",H,[f(M,{ref_key:"apiListRef",ref:s,api:y,params:d.value,"item-key":e.itemKey,"item-title-field":e.itemTitleField,"item-description-field":e.itemDescriptionField,selectable:e.selectable,deletable:e.deletable,searchable:e.searchable,onSelect:h,onDelete:x,onSearch:_},{default:w(({item:e})=>[f(A,{comment:e,onLike:z,onReply:T},null,8,["comment"])]),_:1},8,["params","item-key","item-title-field","item-description-field","selectable","deletable","searchable"]),r.value?(v(),m("div",N,[f(t,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),placeholder:`回复 @${r.value.user.username}`,rows:"1",autosize:"",type:"textarea"},null,8,["modelValue","placeholder"]),p("div",J,[f(o,{size:"small",onClick:I},{default:w(()=>[...l[1]||(l[1]=[b("取消",-1)])]),_:1}),f(o,{type:"primary",size:"small",disabled:!u.value.trim(),onClick:S},{default:w(()=>[...l[2]||(l[2]=[b(" 发送 ",-1)])]),_:1},8,["disabled"])])])):C("",!0)])}}}),[["__scopeId","data-v-2b28814c"]]),X={class:"comments-list-popup"},Z={class:"popup-header"},G={class:"header-content"},ee={class:"popup-title"},ae={class:"popup-content"},le=s(d({__name:"sdkwork-comments-list-popup",props:{modelValue:{type:Boolean,default:!1},title:{default:"评论列表"},height:{default:"70vh"},api:{},params:{default:()=>({})},itemKey:{default:"id"},itemTitleField:{default:"content"},itemDescriptionField:{default:"user.username"},selectable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","close","select","delete","search"],setup(a,{emit:l}){const t=a,s=l,i=k(t.modelValue),n=k(null);x(()=>t.modelValue,e=>{i.value=e}),x(i,e=>{s("update:modelValue",e),e||s("close")});const r=()=>{i.value=!1,s("close")},u=e=>{n.value=e,s("select",e)},c=e=>{s("delete",e)},d=e=>{s("search",e)};return(l,t)=>{const s=o,n=e;return v(),_(n,{show:i.value,"onUpdate:show":t[0]||(t[0]=e=>i.value=e),position:"bottom",style:z({height:a.height,zIndex:1e4}),round:"",closeable:"","close-on-click-overlay":!1},{default:w(()=>[p("div",X,[p("div",Z,[p("div",G,[p("h3",ee,y(a.title),1),f(s,{name:"cross",class:"close-icon",onClick:r})])]),p("div",ae,[f(W,{api:a.api,params:a.params,"item-key":a.itemKey,"item-title-field":a.itemTitleField,"item-description-field":a.itemDescriptionField,selectable:a.selectable,deletable:a.deletable,searchable:a.searchable,onSelect:u,onDelete:c,onSearch:d},null,8,["api","params","item-key","item-title-field","item-description-field","selectable","deletable","searchable"])])])]),_:1},8,["show","style"])}}}),[["__scopeId","data-v-61faba13"]]),te={class:"share-panel"},oe={class:"share-header"},se={class:"share-platforms"},ie={class:"platform-icon wechat"},ne={class:"platform-icon moment"},re={class:"platform-icon qq"},ue={class:"platform-icon weibo"},ce={class:"platform-icon link"},de={class:"platform-icon download"},ve={class:"share-stats"},me={class:"stat-item"},pe={class:"stat-value"},fe=s(d({__name:"SharePanel",props:{video:{}},emits:["close"],setup(e,{emit:a}){const l=e,t=a,s=()=>{i("分享到微信"),setTimeout(()=>t("close"),1e3)},n=()=>{i("分享到朋友圈"),setTimeout(()=>t("close"),1e3)},u=()=>{i("分享到QQ"),setTimeout(()=>t("close"),1e3)},c=()=>{i("分享到微博"),setTimeout(()=>t("close"),1e3)},d=async()=>{try{const e=`https://example.com/video/${l.video.id}`;await navigator.clipboard.writeText(e),i("链接已复制"),setTimeout(()=>t("close"),1e3)}catch(e){i("复制失败")}},h=()=>{r({title:"保存视频",message:"是否保存视频到相册？",showCancelButton:!0}).then(()=>{i("视频保存成功"),setTimeout(()=>t("close"),1e3)})};return(a,l)=>{const t=o;return v(),m("div",te,[p("div",oe,[l[1]||(l[1]=p("span",{class:"share-title"},"分享到",-1)),f(t,{name:"cross",size:"20",onClick:l[0]||(l[0]=e=>a.$emit("close"))})]),p("div",se,[p("div",{class:"platform-item",onClick:s},[p("div",ie,[f(t,{name:"wechat",size:"32",color:"#fff"})]),l[2]||(l[2]=p("span",{class:"platform-name"},"微信",-1))]),p("div",{class:"platform-item",onClick:n},[p("div",ne,[f(t,{name:"friends-o",size:"32",color:"#fff"})]),l[3]||(l[3]=p("span",{class:"platform-name"},"朋友圈",-1))]),p("div",{class:"platform-item",onClick:u},[p("div",re,[f(t,{name:"qq",size:"32",color:"#fff"})]),l[4]||(l[4]=p("span",{class:"platform-name"},"QQ",-1))]),p("div",{class:"platform-item",onClick:c},[p("div",ue,[f(t,{name:"weibo",size:"32",color:"#fff"})]),l[5]||(l[5]=p("span",{class:"platform-name"},"微博",-1))]),p("div",{class:"platform-item",onClick:d},[p("div",ce,[f(t,{name:"link-o",size:"32",color:"#fff"})]),l[6]||(l[6]=p("span",{class:"platform-name"},"复制链接",-1))]),p("div",{class:"platform-item",onClick:h},[p("div",de,[f(t,{name:"down",size:"32",color:"#fff"})]),l[7]||(l[7]=p("span",{class:"platform-name"},"保存视频",-1))])]),p("div",ve,[p("div",me,[l[8]||(l[8]=p("span",{class:"stat-label"},"分享数",-1)),p("span",pe,y(e.video.shareCount),1)])])])}}}),[["__scopeId","data-v-3f1646ae"]]),ye={class:"right-actions"},he={class:"action-count"},ke={class:"action-count"},ge={class:"action-count"},we={class:"action-count"},be=s(d({__name:"RightActions",props:{video:{}},emits:["like","comment","share","follow","userClick"],setup(e,{emit:a}){const l=a,t=e=>e>=1e4?(e/1e4).toFixed(1)+"w":e>=1e3?(e/1e3).toFixed(1)+"k":e.toString();return(a,s)=>{const n=B,r=o;return v(),m("div",ye,[p("div",{class:"user-avatar",onClick:s[1]||(s[1]=a=>{return t=e.video.author,void l("userClick",t);var t})},[f(n,{src:e.video.author.avatar,width:"48",height:"48",radius:"24",fit:"cover"},null,8,["src"]),p("div",{class:"follow-btn",onClick:s[0]||(s[0]=h(a=>(async e=>{try{e.followed=!e.followed,l("follow",e),i(e.followed?"已关注":"已取消关注")}catch(a){e.followed=!e.followed,i("操作失败")}})(e.video.author),["stop"]))},[f(r,{name:e.video.author.followed?"friends-o":"add-o",color:e.video.author.followed?"#ff2442":"#fff"},null,8,["name","color"])])]),p("div",{class:"action-item",onClick:s[2]||(s[2]=a=>(async e=>{try{e.liked=!e.liked,e.likeCount+=e.liked?1:-1,l("like",e),i(e.liked?"已点赞":"已取消点赞")}catch(a){e.liked=!e.liked,e.likeCount+=e.liked?-1:1,i("操作失败")}})(e.video))},[f(r,{name:e.video.liked?"like":"like-o",color:e.video.liked?"#ff2442":"#fff",size:"32"},null,8,["name","color"]),p("span",he,y(t(e.video.likeCount)),1)]),p("div",{class:"action-item",onClick:s[3]||(s[3]=a=>{return t=e.video,void l("comment",t);var t})},[f(r,{name:"chat-o",color:"#fff",size:"32"}),p("span",ke,y(t(e.video.commentCount)),1)]),p("div",{class:"action-item",onClick:s[4]||(s[4]=a=>(e.video,void i("开始制作同款视频")))},[f(r,{name:"star-o",color:"#fff",size:"32"}),p("span",ge,y(t(e.video.makeSameCount)),1)]),p("div",{class:"action-item",onClick:s[5]||(s[5]=a=>{return t=e.video,void l("share",t);var t})},[f(r,{name:"share-o",color:"#fff",size:"32"}),p("span",we,y(t(e.video.shareCount)),1)])])}}}),[["__scopeId","data-v-bbb20ee9"]]),Ce={class:"right-content"},xe={class:"user-info"},_e={class:"username"},ze={class:"video-desc"},Te={class:"music-name"},Ie=s(d({__name:"RightContent",props:{video:{}},emits:["musicClick"],setup(e,{emit:a}){const l=a;return(a,t)=>{const s=$,i=o;return v(),m("div",Ce,[p("div",xe,[p("span",_e,"@"+y(e.video.author?.username||"未知用户"),1),e.video.author?.verified?(v(),_(s,{key:0,type:"primary",size:"medium"},{default:w(()=>[...t[1]||(t[1]=[b(" 已认证 ",-1)])]),_:1})):C("",!0)]),p("div",ze,y(e.video.description),1),p("div",{class:"music-info",onClick:t[0]||(t[0]=a=>{var t;(t=e.video.music)&&l("musicClick",t)})},[f(i,{name:"music-o",color:"#fff",size:"14"}),p("span",Te,y(e.video.music?.name||"原声"),1)])])}}}),[["__scopeId","data-v-5a364515"]]),Se={class:"sdkwork-scroll-video"},Ve=["src"],je={key:1,class:"loading-overlay"},Le={key:0,class:"data-overlay"},Be={key:1,class:"bottom-controls-fixed"},Me={class:"progress-bar"},Fe={class:"play-controls"},$e={class:"time-text"},De={key:1,class:"pull-text"},Ue={key:1,class:"pull-text"},Pe={key:0,class:"loading-more"},Ee=s(d({__name:"sdkwork-scroll-video",props:{api:{},params:{default:()=>({})},pageSize:{default:10},preloadCount:{default:3},autoplay:{type:Boolean,default:!0},muted:{type:Boolean,default:!1},enableLoading:{type:Boolean,default:!1}},emits:["video-change","like","comment","share","follow","load"],setup(a,{expose:l,emit:t}){const s=k();k();const n=k(0),r=k(0),d=k(0),h=k(0),b=k(!1),B=k(!1),M=k(!1),F=k(!1),$=k({}),D=k(!1),U=k("none"),P=k(0),E=k(!1),Y=k(!1),q=k([]),K=k(0),Q=g(()=>{const e=[],a=n.value-1,l=n.value+1;return a>=0&&e.push({...q.value[a],index:a,position:"prev",originalIndex:a}),e.push({...q.value[n.value],index:n.value,position:"current",originalIndex:n.value}),l<q.value.length&&e.push({...q.value[l],index:l,position:"next",originalIndex:l}),e}),R=g(()=>q.value[n.value]||null),O=a,A=t,H=e=>{const a=[...[e-1,e,e+1],...[e-2,e+2]];for(const l of a)if(l>=0&&l<q.value.length){const e=q.value[l];e&&!e.preloaded&&N(e)}},N=e=>{if(e.preloaded||!e.videoUrl)return;e.preloaded=!0;const a=document.createElement("video");a.setAttribute("src",e.videoUrl),a.preload="metadata",a.crossOrigin="anonymous";const l=setTimeout(()=>{a.remove(),console.warn("视频预加载超时:",e.id)},1e4);a.onloadeddata=()=>{clearTimeout(l),e.duration=a.duration,a.remove(),console.log("视频预加载完成:",e.id,"时长:",e.duration)},a.onerror=()=>{clearTimeout(l),console.error("视频预加载失败:",e.id),a.remove()}};x(n,(e,a)=>{H(e)},{immediate:!0}),T(()=>{xe(),J()}),I(()=>{W(),Ee()});const J=()=>{window.addEventListener("resize",He),document.addEventListener("visibilitychange",Ne)},W=()=>{window.removeEventListener("resize",He),document.removeEventListener("visibilitychange",Ne)},X=e=>{b.value=!0,d.value=e.touches[0].clientY,h.value=d.value,U.value="none",P.value=0;const a=s.value;a&&(a.style.transition="none")},Z=e=>{if(!b.value)return;e.preventDefault();const a=e.touches[0].clientY-h.value;h.value=e.touches[0].clientY;const l=qe(),t=0===n.value&&r.value>=0,o=n.value===q.value.length-1&&r.value<=-(q.value.length-1)*l;if(t&&a>0)U.value="refresh",P.value=Math.min(P.value+a,80),r.value=.3*P.value;else if(o&&a<0)U.value="loadmore",P.value=Math.min(P.value-a,80),r.value=-(q.value.length-1)*l-.3*P.value;else{U.value="none",P.value=0;const e=100,t=-(q.value.length-1)*l-100,o=r.value-a;r.value=o>e?e-.3*(o-e):o<t?t-.3*(o-t):o}},G=()=>{if(!b.value)return;b.value=!1;const e=h.value-d.value,a=qe(),l=s.value;l&&(l.style.transition="transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)");if("refresh"===U.value&&P.value>=60)return void ae();if("loadmore"===U.value&&P.value>=60)return void te();const t=.15*a,o=Math.abs(e)/300;Math.abs(e)>t||o>.5?e<0?n.value<q.value.length-1?ze(n.value+1):Ke():e>0&&n.value>0?ze(n.value-1):Ke():Ke(),U.value="none",P.value=0},ee=e=>{e.preventDefault();const a=e.deltaY;a>50&&n.value<q.value.length-1?ze(n.value+1):a<-50&&n.value>0&&ze(n.value-1)},ae=async()=>{if(!E.value&&!B.value)try{E.value=!0,U.value="refresh",i("刷新中..."),await xe(),n.value=0,r.value=0,Ke(),i("刷新成功")}catch(e){console.error("刷新失败:",e),i("刷新失败")}finally{E.value=!1,U.value="none",P.value=0}},te=async()=>{if(!Y.value&&!B.value)try{Y.value=!0,U.value="loadmore",i("加载更多..."),await _e(),q.value.length>n.value+1?ze(n.value+1):Ke(),i("加载成功")}catch(e){console.error("加载更多失败:",e),i("加载失败"),Ke()}finally{Y.value=!1,U.value="none",P.value=0}},oe=k(),se=()=>{R.value&&(R.value.loading=!0)},ie=()=>{R.value&&(R.value.loading=!1,oe.value&&(R.value.duration=oe.value.duration))},ne=()=>{R.value&&(R.value.loading=!1,O.autoplay&&!R.value.playing&&(R.value.playing=!0,Te()))},re=()=>{R.value&&(R.value.playing=!0)},ue=()=>{R.value&&(R.value.playing=!1)},ce=()=>{R.value&&oe.value&&(R.value.currentTime=oe.value.currentTime,oe.value.duration>0&&(R.value.progress=oe.value.currentTime/oe.value.duration*100))},de=()=>{R.value&&(R.value.playing=!1,n.value<q.value.length-1&&setTimeout(()=>ze(n.value+1),1e3))},ve=e=>{console.error("视频播放错误:",e),R.value&&(R.value.loading=!1),i("视频加载失败")},me=async e=>{try{e.liked=!e.liked,e.likeCount+=e.liked?1:-1,A("like",e),i(e.liked?"已点赞":"已取消点赞")}catch(a){e.liked=!e.liked,e.likeCount+=e.liked?-1:1,i("操作失败")}},pe=e=>{$.value={contentType:"VIDEO",contentId:e.id,...e.commentParams},M.value=!0,A("comment",e)},ye=e=>{M.value=!1},he=()=>{M.value=!1},ke=e=>{F.value=!0,A("share",e)},ge=async e=>{try{e.followed=!e.followed,A("follow",e),i(e.followed?"已关注":"已取消关注")}catch(a){e.followed=!e.followed,i("操作失败")}},we=e=>{console.log("跳转到用户主页:",e.username)},Ce=e=>{console.log("播放音乐:",e?.name)},xe=async()=>{try{B.value=!0;const e={pageNumber:1,pageSize:O.pageSize,...O.params},a=await O.api(e);q.value=a.records.map(e=>({...e,loading:!0,playing:!1,muted:O.muted,progress:0,currentTime:0,preloaded:!1})),K.value=a.total,A("load",a),H(0)}catch(e){console.error("加载视频失败:",e),i("加载失败")}finally{B.value=!1}},_e=async()=>{if(!B.value)try{B.value=!0;const e={pageNumber:Math.ceil(q.value.length/O.pageSize)+1,pageSize:O.pageSize,...O.params},a=await O.api(e),l=a.records.map(e=>({...e,loading:!0,playing:!1,muted:O.muted,progress:0,currentTime:0,preloaded:!1}));q.value.push(...l),K.value=a.total,A("load",a),H(n.value)}catch(e){console.error("加载更多视频失败:",e)}finally{B.value=!1}},ze=async e=>{if(!(e<0||e>=q.value.length||D.value)){D.value=!0;try{const a=n.value,l=e>a?"down":"up";Ee(),q.value[a]&&(q.value[a].playing=!1,q.value[a].loading=!1);const t=q.value[e];t&&(t.loading=!0,t.playing=!1),t?.preloaded||N(t),n.value=e,r.value=-e*qe(),U.value="none",P.value=0;const o=s.value;if(o){const e="down"===l?"cubic-bezier(0.25, 0.46, 0.45, 0.94)":"cubic-bezier(0.42, 0, 0.58, 1)";o.style.transition=`transform 0.4s ${e}`}await L(),O.autoplay&&setTimeout(async()=>{await Te()},200),A("video-change",t,e),H(e);(e>=q.value.length-Math.max(2,O.preloadCount)&&q.value.length<K.value||e===q.value.length-1&&q.value.length<K.value)&&_e()}catch(a){console.error("切换视频失败:",a)}finally{setTimeout(()=>{D.value=!1},300)}}},Te=async()=>{if(oe.value&&O.autoplay)try{oe.value.paused&&await oe.value.play()}catch(e){console.warn("播放失败，稍后重试:",e),setTimeout(async()=>{if(oe.value&&oe.value.paused)try{await oe.value.play()}catch(e){console.error("重试播放失败:",e)}},500)}},Ee=()=>{oe.value&&oe.value.pause()},Ye=async()=>{if(oe.value)try{oe.value.paused?await oe.value.play():oe.value.pause()}catch(e){console.error("切换播放状态失败:",e)}},qe=()=>s.value?.clientHeight||window.innerHeight,Ke=()=>{const e=-n.value*qe();r.value=e,U.value="none",P.value=0;const a=s.value;a&&(a.style.transition="transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)")},Qe=e=>{const a=qe();let l=0,t=1,o=1;return"prev"===e.position?(l=-a,t=.7,o=.95):"next"===e.position&&(l=a,t=.7,o=.95),{transform:`translateY(${l}px) scale(${o})`,opacity:t,zIndex:Oe(e.position),transition:"transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease"}},Re=e=>{if(!e)return{top:"0px",opacity:0,zIndex:0};const a=qe();let l=0,t=1;return"prev"===e.position?(l=-a,t=.7):"next"===e.position&&(l=a,t=.7),{top:`${l}px`,opacity:t,zIndex:Oe(e.position),transition:"top 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease"}},Oe=e=>{if(!e)return 0;switch(e){case"current":return 30;case"prev":case"next":return 20;default:return 0}},Ae=e=>{const a=Math.floor(e/60),l=Math.floor(e%60);return`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},He=()=>{Ke()},Ne=()=>{document.hidden?Ee():O.autoplay&&Te()};return l({play:()=>Te(),pause:()=>Ee(),switchTo:e=>ze(e),getCurrentIndex:()=>n.value,getVideoList:()=>q.value,getCurrentVideo:()=>R.value,refresh:()=>xe(),getVideoPlayer:()=>oe.value,getComponentInfo:()=>({totalVideos:q.value.length,currentIndex:n.value,isSwitching:D.value})}),(a,l)=>{const t=u,i=o,r=e;return v(),m("div",Se,[p("div",{ref_key:"scrollContainer",ref:s,class:"video-scroll-container",onTouchstart:X,onTouchmove:Z,onTouchend:G,onWheel:ee},[(v(!0),m(S,null,V(Q.value,e=>(v(),m("div",{key:e.id,class:j(["video-item",{active:n.value===e.originalIndex,prev:"prev"===e.position,current:"current"===e.position,next:"next"===e.position}]),style:z(Qe(e))},[e.coverUrl&&n.value!==e.originalIndex?(v(),m("img",{key:0,src:e.coverUrl,class:"video-cover",alt:"视频封面"},null,8,Ve)):C("",!0),e.loading&&O.enableLoading?(v(),m("div",je,[f(t,{type:"spinner",color:"#fff"}),l[3]||(l[3]=p("span",{class:"loading-text"},"加载中...",-1))])):C("",!0)],6))),128)),p("div",{class:j(["video-player",{current:!0}]),style:z(Re(R.value)),onClick:Ye},[R.value&&R.value.videoUrl?(v(),_(c,{key:0,ref_key:"currentVideoPlayer",ref:oe,src:R.value.videoUrl,poster:R.value.coverUrl,autoplay:O.autoplay,muted:R.value.muted||O.muted,playsInline:!0,controls:!1,mode:"fullscreen",preload:R.value.preloaded?"auto":"metadata",enableLoading:O.enableLoading,onLoadstart:se,onLoadedmetadata:ie,onCanplay:ne,onPlay:re,onPause:ue,onTimeupdate:ce,onEnded:de,onError:ve},null,8,["src","poster","autoplay","muted","preload","enableLoading"])):C("",!0)],4),R.value?(v(),m("div",Le,[f(Ie,{video:R.value,onMusicClick:Ce},null,8,["video"]),f(be,{video:R.value,onLike:me,onComment:pe,onShare:ke,onFollow:ge,onUserClick:we,style:{"pointer-events":"auto"}},null,8,["video"])])):C("",!0),R.value?(v(),m("div",Be,[p("div",Me,[p("div",{class:"progress-fill",style:z({width:`${R.value.progress||0}%`})},null,4)]),p("div",Fe,[f(i,{name:R.value.playing?"pause":"play",color:"#fff",size:"24",onClick:Ye},null,8,["name"]),p("span",$e,y(Ae(R.value.currentTime||0))+" / "+y(Ae(R.value.duration||0)),1)])])):C("",!0),"refresh"===U.value?(v(),m("div",{key:2,class:"pull-refresh-tip",style:z({top:`${-60+P.value}px`})},[E.value?(v(),_(t,{key:0,type:"spinner",color:"#fff"})):(v(),m("span",De,"下拉刷新"))],4)):C("",!0),"loadmore"===U.value?(v(),m("div",{key:3,class:"pull-loadmore-tip",style:z({top:q.value.length*qe()-P.value+"px"})},[Y.value?(v(),_(t,{key:0,type:"spinner",color:"#fff"})):(v(),m("span",Ue,"上拉加载更多"))],4)):C("",!0)],544),B.value?(v(),m("div",Pe,[f(t,{type:"spinner"}),l[4]||(l[4]=p("span",null,"加载更多...",-1))])):C("",!0),f(le,{modelValue:M.value,"onUpdate:modelValue":l[0]||(l[0]=e=>M.value=e),title:"视频评论",params:$.value,onConfirm:ye,onClose:he,style:{"z-index":"10000"}},null,8,["modelValue","params"]),f(r,{show:F.value,"onUpdate:show":l[2]||(l[2]=e=>F.value=e),position:"bottom",round:"",style:{height:"50%",zIndex:1e4}},{default:w(()=>[f(fe,{video:R.value,onClose:l[1]||(l[1]=e=>F.value=!1)},null,8,["video"])]),_:1},8,["show"])])}}}),[["__scopeId","data-v-404c9835"]]);export{Ee as _};
