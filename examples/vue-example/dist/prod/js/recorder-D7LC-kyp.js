import{S as e}from"./sdkwork-page-container-B9mZ0PBm.js";import{_ as o,g as t,R as a,S as l}from"./index-C5cIQ-JB.js";import{k as r,f as i,P as s,Q as d,S as c,$ as n,R as u,W as v,j as m,u as p,U as h,r as g,o as b,w as f,V as w,a1 as y,Z as k,F as R,Y as _,b as C,a0 as S,s as D,aa as M,ab as x,a8 as B,n as I,x as P}from"./vue-vendor-BAnrfl1G.js";import{S as E}from"./sdkwork-icon-B0kkyH_G.js";import{_ as z}from"./sdkwork-popup-BV1irj3C.js";import"./utils-vendor-WEzSe-CR.js";const L={class:"timer-display"},W={class:"timer-value"},O=o(r({__name:"TimerDisplay",props:{duration:{default:0},format:{default:"auto"}},setup(e){const o=e,t=i(()=>{const e=Math.floor(o.duration),t=Math.floor(e/3600),a=Math.floor(e%3600/60),l=e%60;return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`});return(e,o)=>(d(),s("div",L,[c("div",W,n(t.value),1),o[0]||(o[0]=c("div",{class:"timer-label"},"录制时长",-1))]))}}),[["__scopeId","data-v-414f18f7"]]),T={class:"state-text"},$={key:0,class:"processing-indicator"},U={class:"controls-container"},V={key:0,class:"controls-row"},F=["disabled"],A={key:1,class:"controls-row"},N=["disabled"],j=["disabled"],H=["disabled"],G={key:2,class:"controls-row"},K=["disabled"],Q=["disabled"],Y=["disabled"],Z={key:3,class:"controls-row"},q={class:"state-message"},J={key:0},X={key:1,class:"error-message"},ee={class:"hint-slot"},oe=o(r({__name:"ControlButtons",props:{mobileOptimized:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["record-start","record-pause","record-resume","record-cancel","record-finish"],setup(e,{emit:o}){const l=e,r=o,g=t(),b=i(()=>g.currentState),f=i(()=>g.currentState===a.PROCESSING||l.disabled),w=i(()=>b.value===a.IDLE||b.value===a.STOPPED),y=i(()=>b.value===a.ERROR),k=i(()=>({"control-buttons--mobile":l.mobileOptimized&&C(),"control-buttons--disabled":f.value})),R=i(()=>({"state-indicator--idle":w.value,"state-indicator--recording":b.value===a.RECORDING,"state-indicator--paused":b.value===a.PAUSED,"state-indicator--processing":f.value,"state-indicator--error":y.value})),_=i(()=>{switch(b.value){case a.IDLE:return"准备录制";case a.RECORDING:return"录制中...";case a.PAUSED:return"已暂停";case a.PROCESSING:return"处理中...";case a.STOPPED:return"录制完成";case a.ERROR:return"录制错误";default:return"未知状态"}}),C=()=>"undefined"!=typeof window&&window.innerWidth<=768,S=()=>{f.value||r("record-start")},D=()=>{f.value||r("record-pause")},M=()=>{f.value||r("record-resume")},x=()=>{f.value||r("record-cancel")},B=()=>{f.value||r("record-finish")};return(e,o)=>{const t=E;return d(),s("div",{class:u(["control-buttons",k.value])},[c("div",{class:u(["state-indicator",R.value])},[c("span",T,n(_.value),1),f.value?(d(),s("div",$,[...o[0]||(o[0]=[c("div",{class:"spinner"},null,-1),c("span",null,"处理中...",-1)])])):v("",!0)],2),c("div",U,[w.value?(d(),s("div",V,[o[1]||(o[1]=c("div",{class:"button-spacer"},null,-1)),c("button",{class:"control-btn start-btn",onClick:S,title:"开始录制",disabled:f.value},[m(t,{icon:"material-symbols:mic-rounded",width:"60",height:"60"})],8,F),o[2]||(o[2]=c("div",{class:"button-spacer"},null,-1))])):b.value===p(a).RECORDING?(d(),s("div",A,[c("button",{class:"control-btn cancel-btn",onClick:x,title:"取消录制",disabled:f.value},[m(t,{icon:"material-symbols:close-rounded",width:"32",height:"32"})],8,N),c("button",{class:"control-btn pause-btn",onClick:D,title:"暂停录制",disabled:f.value},[m(t,{icon:"material-symbols:pause-rounded",width:"60",height:"60"})],8,j),c("button",{class:"control-btn finish-btn",onClick:B,title:"结束录制",disabled:f.value},[m(t,{icon:"material-symbols:check-rounded",width:"32",height:"32"})],8,H)])):b.value===p(a).PAUSED?(d(),s("div",G,[c("button",{class:"control-btn cancel-btn",onClick:x,title:"取消录制",disabled:f.value},[m(t,{icon:"material-symbols:close-rounded",width:"32",height:"32"})],8,K),c("button",{class:"control-btn resume-btn",onClick:M,title:"继续录制",disabled:f.value},[m(t,{icon:"material-symbols:play-arrow-rounded",width:"60",height:"60"})],8,Q),c("button",{class:"control-btn finish-btn",onClick:B,title:"结束录制",disabled:f.value},[m(t,{icon:"material-symbols:check-rounded",width:"32",height:"32"})],8,Y)])):(d(),s("div",Z,[c("div",q,[f.value?(d(),s("span",J,"正在处理录制文件...")):y.value?(d(),s("span",X,"录制出现错误")):v("",!0)])]))]),c("div",ee,[h(e.$slots,"hint",{},void 0,!0)])],2)}}}),[["__scopeId","data-v-6e00d3a9"]]),te={class:"record-icon"},ae={class:"record-info"},le={class:"record-name"},re={key:0,class:"progress-container"},ie={class:"progress-bar"},se={class:"time-display"},de={class:"current-time"},ce={class:"duration"},ne={key:1,class:"record-duration"},ue={key:2,class:"record-time"},ve={class:"record-actions"},me=["title"],pe={key:0,class:"play-animation"},he=o(r({__name:"AudioRecordListItem",props:{record:{},activeRecordId:{},showTime:{type:Boolean,default:!1},showDownload:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},themeMode:{default:"auto"}},emits:["record-click","record-play","record-pause","record-stop","record-download","record-delete"],setup(e,{expose:o,emit:t}){const a=e,r=t,p=g(null),h=g(!1),k=g(null),R=g(0),_=g(0),C=g(0),S={listeners:new Set,emit(e,o){this.listeners.forEach(t=>{try{t(e,o)}catch(a){}})},on(e){return this.listeners.add(e),()=>this.listeners.delete(e)}},D=i(()=>"dark"===a.themeMode||"light"!==a.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches));i(()=>D.value?"audio-record-item--dark":"audio-record-item--light");let M=null;const x=()=>{B(),M=window.setInterval(()=>{if(p.value&&h.value){const e=p.value.getCurrentTime(),o=p.value.getDuration();R.value=e,_.value=o,I()}},100)},B=()=>{M&&(clearInterval(M),M=null)},I=()=>{_.value>0&&(C.value=R.value/_.value*100)},P=()=>{R.value=0,C.value=0};b(()=>{B(),p.value&&(p.value.stop(),p.value=null),U()});const z=e=>{if(!e||e<=0)return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`},L=e=>{if(!e||e<=0)return"0秒";const o=Math.floor(e/1e3),t=Math.floor(o/60);return t>0?`${t}分${(o%60).toString().padStart(2,"0")}秒`:`${o}秒`},W=e=>{if(!e)return"";const o=new Date(e),t=new Date,a=t.getTime()-o.getTime();if(o.toDateString()===t.toDateString())return o.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});const l=new Date(t);if(l.setDate(l.getDate()-1),o.toDateString()===l.toDateString())return"昨天";if(a<6048e5){return`${Math.floor(a/864e5)}天前`}return o.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},O=()=>{r("record-click",a.record)},T=async()=>{try{if(p.value||(p.value=new l({events:{onPlay:()=>{h.value=!0,x()},onPause:()=>{h.value=!1,B()},onEnd:()=>{h.value=!1,k.value=null,B(),P()},onError:e=>{h.value=!1,k.value=null,B(),P()},onTimeUpdate:(e,o)=>{R.value=e,_.value=o,I()}}})),k.value===a.record.id&&h.value)return await(p.value?.pause()),void r("record-pause",a.record);if(S.emit("stop-other-players",a.record.id),a.record.data){let e;e=a.record.data instanceof ArrayBuffer?new Blob([a.record.data],{type:"audio/pcm"}):a.record.data,await(p.value?.playBlob(e)),k.value=a.record.id,h.value=!0,r("record-play",a.record)}}catch(e){h.value=!1,k.value=null,P()}},$=async()=>{try{p.value&&(await p.value.stop(),h.value=!1,k.value=null,P(),r("record-stop",a.record))}catch(e){}},U=S.on((e,o)=>{var t;"stop-other-players"===e&&(t=o,h.value&&k.value!==t&&$())}),V=()=>{r("record-download",a.record)},F=()=>{r("record-delete",a.record)};return f(h,e=>{e||k.value!==a.record.id||B()}),o({stopPlayback:()=>{p.value&&(p.value.stop(),h.value=!1,k.value=null,P())},pausePlayback:()=>{p.value&&h.value&&(p.value.pause(),h.value=!1)},getPlaybackState:()=>({isPlaying:h.value,currentRecordId:k.value,currentTime:R.value,totalDuration:_.value,progressPercentage:C.value})}),(o,t)=>{const a=E;return d(),s("div",{class:u(["audio-record-item",{active:e.activeRecordId===e.record.id,playing:k.value===e.record.id&&h.value}]),onClick:O},[c("div",te,[m(a,{icon:"material-symbols:mic-rounded",width:"20",height:"20"})]),c("div",ae,[c("div",le,n(e.record.name||"未命名录音"),1),k.value===e.record.id&&h.value?(d(),s("div",re,[c("div",ie,[c("div",{class:"progress-fill",style:w({width:C.value+"%"})},null,4)]),c("div",se,[c("span",de,n(z(R.value)),1),c("span",ce,n(z(_.value)),1)])])):(d(),s("div",ne,n(L(e.record.duration)),1)),e.showTime?(d(),s("div",ue,n(W(e.record.createdAt)),1)):v("",!0)]),c("div",ve,[c("button",{class:"action-btn play-pause-btn",onClick:y(T,["stop"]),title:k.value===e.record.id&&h.value?"暂停":"播放"},[m(a,{icon:k.value===e.record.id&&h.value?"material-symbols:pause-rounded":"material-symbols:play-arrow-rounded",width:"16",height:"16"},null,8,["icon"]),k.value===e.record.id&&h.value?(d(),s("div",pe,[...t[0]||(t[0]=[c("div",{class:"wave-bar"},null,-1),c("div",{class:"wave-bar"},null,-1),c("div",{class:"wave-bar"},null,-1)])])):v("",!0)],8,me),k.value===e.record.id&&h.value?(d(),s("button",{key:0,class:"action-btn stop-btn",onClick:y($,["stop"]),title:"停止"},[m(a,{icon:"material-symbols:stop-rounded",width:"16",height:"16"})])):v("",!0),e.showDownload?(d(),s("button",{key:1,class:"action-btn",onClick:y(V,["stop"]),title:"下载"},[m(a,{icon:"material-symbols:download-rounded",width:"16",height:"16"})])):v("",!0),e.showDelete?(d(),s("button",{key:2,class:"action-btn",onClick:y(F,["stop"]),title:"删除"},[m(a,{icon:"material-symbols:delete-outline-rounded",width:"16",height:"16"})])):v("",!0)])],2)}}}),[["__scopeId","data-v-cc41cfc6"]]),ge={class:"latest-record-section"},be={key:1,class:"empty-state"},fe=o(r({__name:"LatestRecord",props:{activeRecordId:{},themeMode:{default:"auto"}},emits:["record-click","record-play","record-pause","record-delete"],setup(e,{emit:o}){const a=o,l=t(),r=i(()=>l.records),n=i(()=>r.value&&0!==r.value.length?r.value[0]:null),u=e=>{a("record-click",e)},v=e=>{a("record-play",e)},p=e=>{a("record-pause",e)},h=e=>{a("record-delete",e)};return(o,t)=>{const a=E;return d(),s("div",ge,[n.value?(d(),k(he,{key:0,record:n.value,"active-record-id":e.activeRecordId,"show-time":!0,"show-download":!1,"show-delete":!0,"theme-mode":e.themeMode,onRecordClick:u,onRecordPlay:v,onRecordPause:p,onRecordDelete:h},null,8,["record","active-record-id","theme-mode"])):(d(),s("div",be,[m(a,{icon:"material-symbols:mic-off-rounded",width:"24",height:"24"}),t[0]||(t[0]=c("span",null,"暂无录音记录",-1))]))])}}}),[["__scopeId","data-v-6096b388"]]),we={class:"record-list-section"},ye={key:0,class:"record-list-header"},ke={key:1,class:"record-list"},Re={key:2,class:"empty-state"},_e={class:"empty-icon"},Ce=o(r({__name:"RecordList",props:{records:{},activeRecordId:{},showActions:{type:Boolean,default:!0},maxRecords:{default:10},themeMode:{default:"auto"}},emits:["record-click","record-play","record-pause","record-download","record-delete","record-clear"],setup(e,{emit:o}){const t=o,a=e=>{t("record-click",e)},l=e=>{t("record-play",e)},r=e=>{t("record-pause",e)},i=e=>{t("record-download",e)},n=e=>{t("record-delete",e)},u=()=>{t("record-clear")};return(o,t)=>{const p=E;return d(),s("div",we,[e.records.length>0?(d(),s("div",ye,[t[0]||(t[0]=c("h3",{class:"list-title"},"录制记录",-1)),c("button",{class:"clear-btn",onClick:u,title:"清空记录"},[m(p,{icon:"material-symbols:delete-outline-rounded",width:"18",height:"18"})])])):v("",!0),e.records.length>0?(d(),s("div",ke,[(d(!0),s(R,null,_(e.records,o=>(d(),k(he,{key:o.id,record:o,"active-record-id":e.activeRecordId,"show-time":!1,"show-download":e.showActions,"show-delete":e.showActions,"theme-mode":e.themeMode,onRecordClick:a,onRecordPlay:l,onRecordPause:r,onRecordDownload:i,onRecordDelete:n},null,8,["record","active-record-id","show-download","show-delete","theme-mode"]))),128))])):(d(),s("div",Re,[c("div",_e,[m(p,{icon:"material-symbols:mic-outline-rounded",width:"48",height:"48"})]),t[1]||(t[1]=c("p",{class:"empty-text"},"暂无录音记录",-1)),t[2]||(t[2]=c("p",{class:"empty-subtext"},"开始录制音频后，记录将显示在这里",-1))]))])}}}),[["__scopeId","data-v-eff6d37d"]]),Se={class:"popup-container"},De={class:"popup-content"},Me={class:"popup-footer"},xe={class:"record-count"},Be=["disabled"],Ie=o(r({__name:"RecordListPopup",props:{show:{type:Boolean},activeRecordId:{},maxRecords:{default:20},themeMode:{default:"auto"}},emits:["close","record-click","record-play","record-download","record-delete","record-clear"],setup(e,{emit:o}){const a=e,l=t(),r=i(()=>l.records),s=i(()=>"dark"===a.themeMode||"light"!==a.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),u=i(()=>s.value?"record-list-popup--dark":"record-list-popup--light"),v=o,p=()=>{v("close")},h=e=>{e||p()},g=e=>{v("record-click",e)},f=e=>{v("record-play",e)},w=e=>{v("record-download",e)},y=e=>{v("record-delete",e)},R=()=>{v("record-clear")},_=()=>{r.value?.length>0&&v("record-clear")},D=e=>{"Escape"===e.key&&a.show&&p()};return C(()=>{document.addEventListener("keydown",D)}),b(()=>{document.removeEventListener("keydown",D)}),(o,t)=>(d(),k(z,{"model-value":e.show,title:"录音记录",position:"bottom",width:"100%",height:"80vh","max-height":"80vh",round:!0,closeable:!0,"close-on-click-overlay":!0,"safe-area-inset-bottom":!0,"theme-mode":e.themeMode,"custom-class":u.value,"onUpdate:modelValue":h,onClose:p},{default:S(()=>[c("div",Se,[c("div",De,[m(Ce,{records:r.value,"active-record-id":e.activeRecordId,"show-actions":!0,"max-records":e.maxRecords,onRecordClick:g,onRecordPlay:f,onRecordDownload:w,onRecordDelete:y,onRecordClear:R},null,8,["records","active-record-id","max-records"])]),c("div",Me,[c("div",xe," 共 "+n(r.value.length)+" 条录音记录 ",1),c("button",{class:"clear-all-btn",onClick:_,disabled:0===r.value.length}," 清空全部 ",8,Be)])])]),_:1},8,["model-value","theme-mode","custom-class"]))}}),[["__scopeId","data-v-50b70faf"]]),Pe={class:"setting-content"},Ee={class:"setting-body"},ze={class:"setting-item"},Le={class:"setting-item"},We={class:"setting-item"},Oe={class:"setting-label checkbox-label"},Te={class:"setting-item"},$e={class:"setting-label checkbox-label"},Ue={class:"setting-item"},Ve={class:"setting-label checkbox-label"},Fe={class:"setting-item"},Ae=o(r({__name:"RecorderSetting",props:{show:{type:Boolean,default:!1},config:{},themeMode:{default:"auto"},mobileOptimized:{type:Boolean,default:!0}},emits:["update:config","close"],setup(e,{expose:o,emit:t}){const a=e,l=t,r=g(!1),s=g({...a.config}),n=i(()=>"dark"===a.themeMode||"light"!==a.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches));i(()=>!!a.mobileOptimized&&("undefined"!=typeof window&&window.innerWidth<=768));const u=i(()=>n.value?"setting--dark":"setting--light");f(()=>a.config,e=>{s.value={...e}},{deep:!0}),f(()=>a.show,e=>{r.value=e});const v=e=>{r.value=e,e||m()},m=()=>{l("close")},p=()=>{l("update:config",{...s.value}),m()},h=()=>{s.value={sampleRate:16e3,format:"pcm",enableWave:!0,realtime:!1,recordToFile:!0,maxDuration:0,autoSendInterval:0}};return o({open:()=>{r.value=!0},close:()=>{r.value=!1}}),(o,t)=>(d(),k(z,{"model-value":r.value,title:"录制设置",position:"bottom",width:"100%",height:"auto","max-height":"80vh",round:!0,closeable:!0,"close-on-click-overlay":!0,"safe-area-inset-bottom":!0,"theme-mode":e.themeMode,"custom-class":u.value,"onUpdate:modelValue":v,onClose:m},{default:S(()=>[c("div",Pe,[c("div",Ee,[c("div",ze,[t[7]||(t[7]=c("label",{class:"setting-label"},"采样率",-1)),D(c("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.value.sampleRate=e),class:"setting-input"},[...t[6]||(t[6]=[c("option",{value:"8000"},"8000 Hz",-1),c("option",{value:"16000"},"16000 Hz",-1),c("option",{value:"44100"},"44100 Hz",-1),c("option",{value:"48000"},"48000 Hz",-1)])],512),[[M,s.value.sampleRate]])]),c("div",Le,[t[9]||(t[9]=c("label",{class:"setting-label"},"音频格式",-1)),D(c("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.format=e),class:"setting-input"},[...t[8]||(t[8]=[c("option",{value:"pcm"},"PCM",-1),c("option",{value:"mp3"},"MP3",-1),c("option",{value:"wav"},"WAV",-1)])],512),[[M,s.value.format]])]),c("div",We,[c("label",Oe,[D(c("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>s.value.enableWave=e),class:"setting-checkbox"},null,512),[[x,s.value.enableWave]]),t[10]||(t[10]=c("span",{class:"checkbox-text"},"启用波形显示",-1))])]),c("div",Te,[c("label",$e,[D(c("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>s.value.realtime=e),class:"setting-checkbox"},null,512),[[x,s.value.realtime]]),t[11]||(t[11]=c("span",{class:"checkbox-text"},"实时传输",-1))])]),c("div",Ue,[c("label",Ve,[D(c("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>s.value.recordToFile=e),class:"setting-checkbox"},null,512),[[x,s.value.recordToFile]]),t[12]||(t[12]=c("span",{class:"checkbox-text"},"保存到文件",-1))])]),c("div",Fe,[t[13]||(t[13]=c("label",{class:"setting-label"},"最大时长(秒)",-1)),D(c("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=e=>s.value.maxDuration=e),min:"0",placeholder:"0为无限制",class:"setting-input"},null,512),[[B,s.value.maxDuration]])])]),c("div",{class:"setting-footer"},[c("button",{class:"btn btn-secondary",onClick:h},"重置"),c("button",{class:"btn btn-primary",onClick:p},"应用")])])]),_:1},8,["model-value","theme-mode","custom-class"]))}}),[["__scopeId","data-v-969757e3"]]),Ne={class:"record-info"},je={class:"info-item"},He={class:"info-value"},Ge={class:"info-item"},Ke={class:"info-value"},Qe={class:"info-item"},Ye={class:"info-value"},Ze={class:"title-input-section"},qe={class:"input-hint"},Je={class:"char-count"},Xe=o(r({__name:"RecordSaveDialog",props:{show:{type:Boolean,default:!1},record:{default:()=>({blob:void 0,buffer:void 0,duration:0,size:0,createdAt:Date.now(),id:""})},themeMode:{default:"auto"}},emits:["save","cancel","close"],setup(e,{expose:o,emit:t}){const a=e,l=t,r=g(!1),s=g(""),u=g(),v=i(()=>"dark"===a.themeMode||"light"!==a.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),m=i(()=>v.value?"save-dialog--dark":"save-dialog--light");f(()=>a.show,e=>{r.value=e,e&&(s.value=p(),I(()=>{u.value?.focus(),u.value?.select()}))});const p=()=>{const e=new Date,o=e.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),t=e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),l=h(a.record.duration);return`录制_${o.replace(/\//g,"")}_${t.replace(/:/g,"")}_${l.replace(/:/g,"")}`},h=e=>{const o=Math.floor(e/60),t=Math.floor(e%60);return`${o.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},b=e=>{if(0===e)return"0 B";const o=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,o)).toFixed(2))+" "+["B","KB","MB","GB"][o]},w=()=>{if(!a.record)return;const e=s.value.trim()||p();l("save",{record:a.record,title:e}),r.value=!1,s.value=""},y=()=>{l("cancel",a.record),l("close"),r.value=!1,s.value=""},R=e=>{e||y()};return o({open:e=>{r.value=!0,s.value=p(),I(()=>{u.value?.focus(),u.value?.select()})},close:()=>{r.value=!1,s.value=""}}),(o,t)=>(d(),k(z,{"model-value":r.value,title:"保存录制文件",position:"center",width:"400px",round:!0,closeable:!0,"close-on-click-overlay":!1,"theme-mode":e.themeMode,"custom-class":m.value,"onUpdate:modelValue":R,onClose:y},{footer:S(()=>[c("div",{class:"dialog-footer"},[c("button",{class:"btn btn-cancel",onClick:y}," 取消保存 "),c("button",{class:"btn btn-save",onClick:w}," 确认保存 ")])]),default:S(()=>{return[c("div",Ne,[c("div",je,[t[1]||(t[1]=c("span",{class:"info-label"},"录制时长:",-1)),c("span",He,n(h(e.record.duration)),1)]),c("div",Ge,[t[2]||(t[2]=c("span",{class:"info-label"},"文件大小:",-1)),c("span",Ke,n(b(e.record.size)),1)]),c("div",Qe,[t[3]||(t[3]=c("span",{class:"info-label"},"录制时间:",-1)),c("span",Ye,n((o=e.record.createdAt,new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}))),1)])]),c("div",Ze,[t[4]||(t[4]=c("label",{class:"input-label"},"录制标题",-1)),D(c("input",{ref_key:"titleInput",ref:u,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),type:"text",class:"title-input",placeholder:"请输入录制标题",maxlength:"50",onKeyup:P(w,["enter"])},null,544),[[B,s.value]]),c("div",qe,[c("span",Je,n(s.value.length)+"/50",1)])])];var o}),_:1},8,["model-value","theme-mode","custom-class"]))}}),[["__scopeId","data-v-ffa43168"]]),eo={class:"top-bar-left"},oo={class:"top-bar-right"},to=o(r({__name:"RecorderTopBar",props:{config:{},showRecordList:{type:Boolean,default:!0},showSettingButton:{type:Boolean,default:!0},showBackButton:{type:Boolean,default:!1},themeMode:{default:"auto"},mobileOptimized:{type:Boolean,default:!0}},emits:["back","show-record-list","update:config","setting-click"],setup(e,{emit:o}){const t=e,a=o,l=i(()=>"dark"===t.themeMode||"light"!==t.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),r=i(()=>!!t.mobileOptimized&&("undefined"!=typeof window&&window.innerWidth<=768)),n=i(()=>l.value?"top-bar--dark":"top-bar--light"),p=i(()=>r.value?"top-bar--mobile":""),h=()=>{a("back")},g=()=>{a("show-record-list")},b=()=>{a("setting-click")};return(o,t)=>{const a=E;return d(),s("div",{class:u(["recorder-top-bar",[n.value,p.value]])},[c("div",eo,[e.showBackButton?(d(),s("button",{key:0,class:"back-btn",onClick:h,title:"返回"},[m(a,{icon:"material-symbols:arrow-back-ios-new-rounded",width:"20",height:"20"})])):v("",!0)]),c("div",oo,[e.showRecordList?(d(),s("button",{key:0,class:"record-list-btn",onClick:g,title:"查看录播记录"},[m(a,{icon:"material-symbols:playlist-play-rounded",width:"20",height:"20"}),t[0]||(t[0]=c("span",null,"录制记录",-1))])):v("",!0),e.showSettingButton?(d(),s("button",{key:1,class:"setting-btn",onClick:b,title:"设置"},[m(a,{icon:"material-symbols:settings-rounded",width:"20",height:"20"})])):v("",!0)])],2)}}}),[["__scopeId","data-v-5bbf9a2a"]]),ao={class:"sdkwork-audio-recorder"},lo={class:"recorder-main",style:{display:"flex","flex-direction":"column",height:"100%","justify-content":"space-between"}},ro={class:"content-section",style:{flex:"1",display:"flex","flex-direction":"column","min-height":"0"}},io={class:"wave-section"},so={class:"timer-section"},co={key:0,class:"latest-record-section"},no={class:"controls-section",style:{"flex-shrink":"0"}},uo={class:"recording-hints"},vo={class:"max-duration-hint"},mo={key:0,class:"confirm-dialog-overlay"},po={class:"confirm-dialog"},ho={class:"confirm-dialog__footer"},go=o(r({__name:"sdkwork-audio-recorder",props:{config:{default:()=>({sampleRate:16e3,format:"pcm",enableWave:!0,realtime:!1,recordToFile:!0,maxDuration:0,autoSendInterval:0})},api:{default:()=>({})},showRecordList:{type:Boolean,default:!0},showSubtitle:{type:Boolean,default:!0},waveWidth:{default:400},waveHeight:{default:120},waveLineColor:{default:"#409EFF"},containerClass:{default:""},themeMode:{default:"auto"},mobileOptimized:{type:Boolean,default:!0},showSettingButton:{type:Boolean,default:!0},showBackButton:{type:Boolean,default:!1},onBack:{}},emits:["start","pause","resume","stop","cancel","record-complete","record-error","record-save","record-save-cancel","record-click","record-play","record-pause","record-download","record-delete","record-remove","record-clear","update:config","back","show-record-list","setting-click"],setup(e,{emit:o}){const a=t(),l=e,r=o,u=g(),p=g();i(()=>a.currentState);const y=i(()=>a.currentDuration),R=i(()=>a.currentRecord),_=i(()=>a.cancelConfirmVisible),D=i(()=>a.saveDialogVisible),M=i(()=>a.recordListDialogVisible),x=i(()=>a.settingDialogVisible),B=g(),P=i(()=>"dark"===l.themeMode||"light"!==l.themeMode&&(!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches)),E=i(()=>!!l.mobileOptimized&&("undefined"!=typeof window&&window.innerWidth<=768));i(()=>P.value?"sdkwork-recorder--dark":"sdkwork-recorder--light"),i(()=>E.value?"sdkwork-recorder--mobile":"");const z=()=>{l.onBack&&l.onBack()},L=()=>{a.toggleRecordListDialog(!0)},W=()=>{a.toggleSettingDialog(!0)},T=e=>{a.updateConfig(e),r("update:config",e)},$=()=>{a.toggleSettingDialog(!1)},U=async()=>{try{await a.startRecording({}),r("start")}catch(e){ee(e)}},V=()=>{a.pauseRecording(),r("pause")},F=()=>{a.resumeRecording(),r("resume")},A=()=>{a.toggleCancelConfirm(!0)},N=async()=>{try{a.isPaused&&a.resumeRecording();const e=await a.stopRecording();e&&(r("stop"),r("record-complete",e))}catch(e){ee(e)}},j=e=>{r("record-click",e)},H=e=>{a.playRecord(e),r("record-play",e)},G=e=>{a.removeRecord(e.id),r("record-remove",e)},K=e=>{},Q=()=>{a.clearRecords(),r("record-clear")},Y=e=>{e.record.id&&a.updateRecord(e.record.id,{name:e.title}),r("record-save",e),a.toggleSaveDialog(!1)},Z=e=>{r("record-save-cancel",e),a.toggleSaveDialog(!1)},q=()=>{a.toggleSaveDialog(!1)},J=()=>{a.toggleRecordListDialog(!1)},X=async e=>{if(e)try{a.cancelRecording(),r("cancel"),await I()}catch(o){ee(o)}a.toggleCancelConfirm(!1)},ee=e=>{const o=e instanceof Error?e.message:"录制出现错误";a.setError(o),r("record-error",e instanceof Error?e:new Error(o))};return f(()=>l.config,e=>{a.updateConfig(e),u.value&&e.enableWave&&a.setWaveContainer(u.value)},{deep:!0,immediate:!0}),f(u,e=>{e&&l.config.enableWave&&a.setWaveContainer(e)}),C(async()=>{a.updateConfig(l.config);try{await I(),u.value&&l.config.enableWave&&a.setWaveContainer(u.value)}catch(e){ee(e)}}),b(()=>{a.cleanup()}),(o,t)=>(d(),s("div",ao,[m(to,{config:e.config,"show-record-list":e.showRecordList,"show-setting-button":e.showSettingButton,"show-back-button":e.showBackButton,"theme-mode":e.themeMode,"mobile-optimized":e.mobileOptimized,onBack:z,onShowRecordList:L,"onUpdate:config":T,onSettingClick:W},null,8,["config","show-record-list","show-setting-button","show-back-button","theme-mode","mobile-optimized"]),c("div",lo,[c("div",ro,[c("div",io,[h(o.$slots,"wave",{},()=>[e.config.enableWave?(d(),s("div",{key:0,ref_key:"waveContainer",ref:u,class:"wave-display-container",style:w({width:e.waveWidth+"px",height:e.waveHeight+"px",minWidth:e.waveWidth+"px",minHeight:e.waveHeight+"px"})},null,4)):v("",!0)],!0)]),c("div",so,[m(O,{duration:y.value,format:"auto"},null,8,["duration"])]),e.showRecordList?(d(),s("div",co,[m(fe,{"active-record-id":R.value?.id,onRecordClick:j,onRecordPlay:H,onRecordPause:V,onRecordDelete:G},null,8,["active-record-id"])])):v("",!0),h(o.$slots,"default",{},void 0,!0)]),c("div",no,[m(oe,{onRecordStart:U,onRecordPause:V,onRecordResume:F,onRecordCancel:A,onRecordFinish:N},{hint:S(()=>[c("div",uo,[c("div",vo," 最大可录制时长: "+n(e.config.maxDuration&&e.config.maxDuration>0?e.config.maxDuration+"秒":"无限制"),1),t[2]||(t[2]=c("div",{class:"marker-hint"}," 双击屏幕可以添加标记 ",-1))])]),_:1})])]),_.value?(d(),s("div",mo,[c("div",po,[t[3]||(t[3]=c("div",{class:"confirm-dialog__header"},[c("h3",{class:"confirm-dialog__title"},"确认取消录制")],-1)),t[4]||(t[4]=c("div",{class:"confirm-dialog__body"},[c("p",{class:"confirm-dialog__message"}," 确定要取消录制吗？取消后将不会保存录制内容。 ")],-1)),c("div",ho,[c("button",{class:"confirm-dialog__btn confirm-dialog__btn--cancel",onClick:t[0]||(t[0]=e=>X(!1))}," 继续录制 "),c("button",{class:"confirm-dialog__btn confirm-dialog__btn--confirm",onClick:t[1]||(t[1]=e=>X(!0))}," 确认取消 ")])])])):v("",!0),D.value?(d(),k(Xe,{key:1,show:D.value,record:B.value,"theme-mode":l.themeMode,onSave:Y,onCancel:Z,onClose:q},null,8,["show","record","theme-mode"])):v("",!0),M.value?(d(),k(Ie,{key:2,show:M.value,"active-record-id":R.value?.id,"max-records":20,"theme-mode":l.themeMode,onClose:J,onRecordClick:j,onRecordPlay:H,onRecordDownload:K,onRecordDelete:G,onRecordClear:Q},null,8,["show","active-record-id","theme-mode"])):v("",!0),m(Ae,{ref_key:"recorderSettingRef",ref:p,show:x.value,config:e.config,"theme-mode":l.themeMode,"mobile-optimized":l.mobileOptimized,"onUpdate:config":T,onClose:$},null,8,["show","config","theme-mode","mobile-optimized"])]))}}),[["__scopeId","data-v-b600bfd3"]]),bo=r({__name:"recorder",setup(o){const t=g({sampleRate:16e3,format:"pcm",enableWave:!0,realtime:!1,recordToFile:!0,maxDuration:0}),a=()=>{},l=e=>{},r=e=>{};return(o,i)=>{const s=e;return d(),k(s,null,{default:S(()=>[m(go,{config:t.value,"show-record-list":!0,"show-subtitle":!0,"wave-width":400,"wave-height":120,"wave-line-color":"#409EFF","container-class":"simple-recorder",onRecordStart:a,onRecordStop:l,onRecordError:r},null,8,["config"])]),_:1})}}});export{bo as default};
