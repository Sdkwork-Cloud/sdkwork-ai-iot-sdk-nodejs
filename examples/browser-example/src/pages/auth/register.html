<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户注册 - SDKWork AIoT</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@4/lib/index.css">
    <link rel="stylesheet" href="../../assets/styles/main.css">
</head>
<body>
    <div id="app">
        <app-header title="用户注册" show-back></app-header>
        
        <main class="auth-content">
            <van-form @submit="handleRegister" class="register-form">
                <van-cell-group>
                    <van-field
                        v-model="form.mobile"
                        label="手机号"
                        placeholder="请输入手机号"
                        type="tel"
                        :rules="[{ required: true, message: '请输入手机号' }]"
                    />
                    
                    <van-field
                        v-model="form.password"
                        label="密码"
                        placeholder="请输入密码"
                        type="password"
                        :rules="[{ required: true, message: '请输入密码' }]"
                    />
                    
                    <van-field
                        v-model="form.confirmPassword"
                        label="确认密码"
                        placeholder="请再次输入密码"
                        type="password"
                        :rules="[
                            { required: true, message: '请确认密码' },
                            { validator: validateConfirmPassword, message: '两次密码输入不一致' }
                        ]"
                    />
                    
                    <van-field
                        v-model="form.nickname"
                        label="昵称"
                        placeholder="请输入昵称"
                        :rules="[{ required: true, message: '请输入昵称' }]"
                    />
                    
                    <van-field
                        v-model="form.email"
                        label="邮箱"
                        placeholder="请输入邮箱（可选）"
                        type="email"
                    />
                </van-cell-group>
                
                <div class="form-actions">
                    <van-button 
                        type="primary" 
                        size="large" 
                        block 
                        native-type="submit"
                        :loading="loading"
                    >
                        注册
                    </van-button>
                    
                    <div class="auth-links">
                        <a href="login.html" class="link">已有账号？立即登录</a>
                    </div>
                </div>
            </van-form>
        </main>
    </div>

    <script type="module">
        import { createApp, ref } from 'https://cdn.jsdelivr.net/npm/vue@3/dist/vue.esm-browser.js'
        import { authStore } from '../../stores/auth-store.js'
        
        const app = createApp({
            setup() {
                const form = ref({
                    mobile: '',
                    password: '',
                    confirmPassword: '',
                    nickname: '',
                    email: ''
                })
                
                const loading = ref(false)
                
                // 验证确认密码
                const validateConfirmPassword = (val) => {
                    return val === form.value.password
                }
                
                // 处理注册
                const handleRegister = async () => {
                    loading.value = true
                    
                    try {
                        await authStore().register(form.value)
                        vanToast.success('注册成功')
                        
                        // 跳转到登录页面
                        setTimeout(() => {
                            window.location.href = 'login.html'
                        }, 1000)
                    } catch (error) {
                        console.error('注册失败:', error)
                        vanDialog.alert({
                            title: '注册失败',
                            message: error.message || '请检查输入信息'
                        })
                    } finally {
                        loading.value = false
                    }
                }
                
                return {
                    form,
                    loading,
                    validateConfirmPassword,
                    handleRegister
                }
            }
        })
        
        app.component('app-header', window.AppHeader)
        app.mount('#app')
    </script>
</body>
</html>